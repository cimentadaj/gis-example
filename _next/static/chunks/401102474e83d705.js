(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78756,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isUnsafeProperty=function(e){return"__proto__"===e}},33858,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},96736,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toKey=function(e){return"string"==typeof e||"symbol"==typeof e?e:Object.is(e?.valueOf?.(),-0)?"-0":String(e)}},48018,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toString=function e(t){if(null==t)return"";if("string"==typeof t)return t;if(Array.isArray(t))return t.map(e).join(",");let r=String(t);return"0"===r&&Object.is(Number(t),-0)?"-0":r}},79232,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(48018),n=e.r(96736);r.toPath=function(e){if(Array.isArray(e))return e.map(n.toKey);if("symbol"==typeof e)return[e];e=i.toString(e);let t=[],r=e.length;if(0===r)return t;let s=0,a="",o="",l=!1;for(46===e.charCodeAt(0)&&(t.push(""),s++);s<r;){let i=e[s];o?"\\"===i&&s+1<r?a+=e[++s]:i===o?o="":a+=i:l?'"'===i||"'"===i?o=i:"]"===i?(l=!1,t.push(a),a=""):a+=i:"["===i?(l=!0,a&&(t.push(a),a="")):"."===i?a&&(t.push(a),a=""):a+=i,s++}return a&&t.push(a),t}},18915,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(78756),n=e.r(33858),s=e.r(96736),a=e.r(79232);r.get=function e(t,r,o){if(null==t)return o;switch(typeof r){case"string":{if(i.isUnsafeProperty(r))return o;let s=t[r];if(void 0===s)if(n.isDeepKey(r))return e(t,a.toPath(r),o);else return o;return s}case"number":case"symbol":{"number"==typeof r&&(r=s.toKey(r));let e=t[r];if(void 0===e)return o;return e}default:{if(Array.isArray(r)){var l=t,u=r,c=o;if(0===u.length)return c;let e=l;for(let t=0;t<u.length;t++){if(null==e||i.isUnsafeProperty(u[t]))return c;e=e[u[t]]}return void 0===e?c:e}if(r=Object.is(r?.valueOf(),-0)?"-0":String(r),i.isUnsafeProperty(r))return o;let e=t[r];if(void 0===e)return o;return e}}}},92068,(e,t,r)=>{t.exports=e.r(18915).get},43210,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.last=function(e){return e[e.length-1]}},75576,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toArray=function(e){return Array.isArray(e)?e:Array.from(e)}},70871,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isLength=function(e){return Number.isSafeInteger(e)&&e>=0}},69642,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(70871);r.isArrayLike=function(e){return null!=e&&"function"!=typeof e&&i.isLength(e.length)}},5518,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(43210),n=e.r(75576),s=e.r(69642);r.last=function(e){if(s.isArrayLike(e))return i.last(n.toArray(e))}},4178,(e,t,r)=>{t.exports=e.r(5518).last},55838,(e,t,r)=>{"use strict";var i=e.r(71645),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useState,a=i.useEffect,o=i.useLayoutEffect,l=i.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=s({inst:{value:r,getSnapshot:t}}),n=i[0].inst,c=i[1];return o(function(){n.value=r,n.getSnapshot=t,u(n)&&c({inst:n})},[e,r,t]),a(function(){return u(n)&&c({inst:n}),e(function(){u(n)&&c({inst:n})})},[e]),l(r),r};r.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:c},2239,(e,t,r)=>{"use strict";t.exports=e.r(55838)},52822,(e,t,r)=>{"use strict";var i=e.r(71645),n=e.r(2239),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=n.useSyncExternalStore,o=i.useRef,l=i.useEffect,u=i.useMemo,c=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,n){var h=o(null);if(null===h.current){var f={hasValue:!1,value:null};h.current=f}else f=h.current;var d=a(e,(h=u(function(){function e(e){if(!l){if(l=!0,a=e,e=i(e),void 0!==n&&f.hasValue){var t=f.value;if(n(t,e))return o=t}return o=e}if(t=o,s(a,e))return t;var r=i(e);return void 0!==n&&n(t,r)?(a=e,t):(a=e,o=r)}var a,o,l=!1,u=void 0===r?null:r;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,r,i,n]))[0],h[1]);return l(function(){f.hasValue=!0,f.value=d},[d]),c(d),d}},30224,(e,t,r)=>{"use strict";t.exports=e.r(52822)},45403,(e,t,r)=>{"use strict";function i(e){return"symbol"==typeof e?1:null===e?2:void 0===e?3:4*(e!=e)}Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.compareValues=(e,t,r)=>{if(e!==t){let n=i(e),s=i(t);if(n===s&&0===n){if(e<t)return"desc"===r?1:-1;if(e>t)return"desc"===r?-1:1}return"desc"===r?s-n:n-s}return 0}},9542,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isSymbol=function(e){return"symbol"==typeof e||e instanceof Symbol}},38104,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(9542),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;r.isKey=function(e,t){return!Array.isArray(e)&&(!!("number"==typeof e||"boolean"==typeof e||null==e||i.isSymbol(e))||"string"==typeof e&&(s.test(e)||!n.test(e))||null!=t&&Object.hasOwn(t,e))}},910,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(45403),n=e.r(38104),s=e.r(79232);r.orderBy=function(e,t,r,a){if(null==e)return[];r=a?void 0:r,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=null==t?[null]:[t]),0===t.length&&(t=[null]),Array.isArray(r)||(r=null==r?[]:[r]),r=r.map(e=>String(e));let o=(e,t)=>{let r=e;for(let e=0;e<t.length&&null!=r;++e)r=r[t[e]];return r},l=t.map(e=>(Array.isArray(e)&&1===e.length&&(e=e[0]),null==e||"function"==typeof e||Array.isArray(e)||n.isKey(e))?e:{key:e,path:s.toPath(e)});return e.map(e=>({original:e,criteria:l.map(t=>{var r,i;return r=t,null==(i=e)||null==r?i:"object"==typeof r&&"key"in r?Object.hasOwn(i,r.key)?i[r.key]:o(i,r.path):"function"==typeof r?r(i):Array.isArray(r)?o(i,r):"object"==typeof i?i[r]:i})})).slice().sort((e,t)=>{for(let n=0;n<l.length;n++){let s=i.compareValues(e.criteria[n],t.criteria[n],r[n]);if(0!==s)return s}return 0}).map(e=>e.original)}},84578,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.flatten=function(e,t=1){let r=[],i=Math.floor(t),n=(e,t)=>{for(let s=0;s<e.length;s++){let a=e[s];Array.isArray(a)&&t<i?n(a,t+1):r.push(a)}};return n(e,0),r}},5257,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=/^(?:0|[1-9]\d*)$/;r.isIndex=function(e,t=Number.MAX_SAFE_INTEGER){switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return i.test(e)}}},90820,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isObject=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)}},23855,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.eq=function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}},15111,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(5257),n=e.r(69642),s=e.r(90820),a=e.r(23855);r.isIterateeCall=function(e,t,r){return!!s.isObject(r)&&(!!("number"==typeof t&&n.isArrayLike(r)&&i.isIndex(t))&&t<r.length||"string"==typeof t&&t in r)&&a.eq(r[t],e)}},69955,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(910),n=e.r(84578),s=e.r(15111);r.sortBy=function(e,...t){let r=t.length;return r>1&&s.isIterateeCall(e,t[0],t[1])?t=[]:r>2&&s.isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),i.orderBy(e,n.flatten(t),["asc"])}},42342,(e,t,r)=>{t.exports=e.r(69955).sortBy},24798,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.debounce=function(e,t,{signal:r,edges:i}={}){let n,s=null,a=null!=i&&i.includes("leading"),o=null==i||i.includes("trailing"),l=()=>{null!==s&&(e.apply(n,s),n=void 0,s=null)},u=null,c=()=>{null!=u&&clearTimeout(u),u=setTimeout(()=>{u=null,o&&l(),h()},t)},h=()=>{null!==u&&(clearTimeout(u),u=null),n=void 0,s=null},f=function(...e){if(r?.aborted)return;n=this,s=e;let t=null==u;c(),a&&t&&l()};return f.schedule=c,f.cancel=h,f.flush=()=>{l()},r?.addEventListener("abort",h,{once:!0}),f}},96074,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(24798);r.debounce=function(e,t=0,r={}){let n;"object"!=typeof r&&(r={});let{leading:s=!1,trailing:a=!0,maxWait:o}=r,l=[,,];s&&(l[0]="leading"),a&&(l[1]="trailing");let u=null,c=i.debounce(function(...t){n=e.apply(this,t),u=null},t,{edges:l}),h=function(...t){return null!=o&&(null===u&&(u=Date.now()),Date.now()-u>=o)?(n=e.apply(this,t),u=Date.now(),c.cancel(),c.schedule(),n):(c.apply(this,t),n)};return h.cancel=c.cancel,h.flush=()=>(c.flush(),n),h}},46508,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(96074);r.throttle=function(e,t=0,r={}){let{leading:n=!0,trailing:s=!0}=r;return i.debounce(e,t,{leading:n,maxWait:t,trailing:s})}},58723,(e,t,r)=>{t.exports=e.r(46508).throttle},52210,(e,t,r)=>{"use strict";var i="function"==typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,s=i?Symbol.for("react.portal"):60106,a=i?Symbol.for("react.fragment"):60107,o=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,u=i?Symbol.for("react.provider"):60109,c=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.async_mode"):60111,f=i?Symbol.for("react.concurrent_mode"):60111,d=i?Symbol.for("react.forward_ref"):60112,p=i?Symbol.for("react.suspense"):60113,g=i?Symbol.for("react.suspense_list"):60120,m=i?Symbol.for("react.memo"):60115,y=i?Symbol.for("react.lazy"):60116,v=i?Symbol.for("react.block"):60121,b=i?Symbol.for("react.fundamental"):60117,x=i?Symbol.for("react.responder"):60118,_=i?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case h:case f:case a:case l:case o:case p:return e;default:switch(e=e&&e.$$typeof){case c:case d:case y:case m:case u:return e;default:return t}}case s:return t}}}function k(e){return w(e)===f}r.AsyncMode=h,r.ConcurrentMode=f,r.ContextConsumer=c,r.ContextProvider=u,r.Element=n,r.ForwardRef=d,r.Fragment=a,r.Lazy=y,r.Memo=m,r.Portal=s,r.Profiler=l,r.StrictMode=o,r.Suspense=p,r.isAsyncMode=function(e){return k(e)||w(e)===h},r.isConcurrentMode=k,r.isContextConsumer=function(e){return w(e)===c},r.isContextProvider=function(e){return w(e)===u},r.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},r.isForwardRef=function(e){return w(e)===d},r.isFragment=function(e){return w(e)===a},r.isLazy=function(e){return w(e)===y},r.isMemo=function(e){return w(e)===m},r.isPortal=function(e){return w(e)===s},r.isProfiler=function(e){return w(e)===l},r.isStrictMode=function(e){return w(e)===o},r.isSuspense=function(e){return w(e)===p},r.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===f||e===l||e===o||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===m||e.$$typeof===u||e.$$typeof===c||e.$$typeof===d||e.$$typeof===b||e.$$typeof===x||e.$$typeof===_||e.$$typeof===v)},r.typeOf=w},79684,(e,t,r)=>{"use strict";t.exports=e.r(52210)},41015,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(9542);r.toNumber=function(e){return i.isSymbol(e)?NaN:Number(e)}},89793,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(41015);r.toFinite=function(e){return e?(e=i.toNumber(e))===1/0||e===-1/0?(e<0?-1:1)*Number.MAX_VALUE:e==e?e:0:0===e?e:0}},45264,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(15111),n=e.r(89793);r.range=function(e,t,r){r&&"number"!=typeof r&&i.isIterateeCall(e,t,r)&&(t=r=void 0),e=n.toFinite(e),void 0===t?(t=e,e=0):t=n.toFinite(t),r=void 0===r?e<t?1:-1:n.toFinite(r);let s=Math.max(Math.ceil((t-e)/(r||1)),0),a=Array(s);for(let t=0;t<s;t++)a[t]=e,e+=r;return a}},66814,(e,t,r)=>{t.exports=e.r(45264).range},51655,(e,t,r)=>{!function(r){"use strict";var i,n={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},s=!0,a="[DecimalError] ",o=a+"Invalid argument: ",l=a+"Exponent out of range: ",u=Math.floor,c=Math.pow,h=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,f=u(1286742750677284.5),d={};function p(e,t){var r,i,n,a,o,l,u,c,h=e.constructor,f=h.precision;if(!e.s||!t.s)return t.s||(t=new h(e)),s?P(t,f):t;if(u=e.d,c=t.d,o=e.e,n=t.e,u=u.slice(),a=o-n){for(a<0?(i=u,a=-a,l=c.length):(i=c,n=o,l=u.length),a>(l=(o=Math.ceil(f/7))>l?o+1:l+1)&&(a=l,i.length=1),i.reverse();a--;)i.push(0);i.reverse()}for((l=u.length)-(a=c.length)<0&&(a=l,i=c,c=u,u=i),r=0;a;)r=(u[--a]=u[a]+c[a]+r)/1e7|0,u[a]%=1e7;for(r&&(u.unshift(r),++n),l=u.length;0==u[--l];)u.pop();return t.d=u,t.e=n,s?P(t,f):t}function g(e,t,r){if(e!==~~e||e<t||e>r)throw Error(o+e)}function m(e){var t,r,i,n=e.length-1,s="",a=e[0];if(n>0){for(s+=a,t=1;t<n;t++)(r=7-(i=e[t]+"").length)&&(s+=_(r)),s+=i;(r=7-(i=(a=e[t])+"").length)&&(s+=_(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}d.absoluteValue=d.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},d.comparedTo=d.cmp=function(e){var t,r,i,n;if(e=new this.constructor(e),this.s!==e.s)return this.s||-e.s;if(this.e!==e.e)return this.e>e.e^this.s<0?1:-1;for(t=0,r=(i=this.d.length)<(n=e.d.length)?i:n;t<r;++t)if(this.d[t]!==e.d[t])return this.d[t]>e.d[t]^this.s<0?1:-1;return i===n?0:i>n^this.s<0?1:-1},d.decimalPlaces=d.dp=function(){var e=this.d.length-1,t=(e-this.e)*7;if(e=this.d[e])for(;e%10==0;e/=10)t--;return t<0?0:t},d.dividedBy=d.div=function(e){return y(this,new this.constructor(e))},d.dividedToIntegerBy=d.idiv=function(e){var t=this.constructor;return P(y(this,new t(e),0,1),t.precision)},d.equals=d.eq=function(e){return!this.cmp(e)},d.exponent=function(){return b(this)},d.greaterThan=d.gt=function(e){return this.cmp(e)>0},d.greaterThanOrEqualTo=d.gte=function(e){return this.cmp(e)>=0},d.isInteger=d.isint=function(){return this.e>this.d.length-2},d.isNegative=d.isneg=function(){return this.s<0},d.isPositive=d.ispos=function(){return this.s>0},d.isZero=function(){return 0===this.s},d.lessThan=d.lt=function(e){return 0>this.cmp(e)},d.lessThanOrEqualTo=d.lte=function(e){return 1>this.cmp(e)},d.logarithm=d.log=function(e){var t,r=this.constructor,n=r.precision,o=n+5;if(void 0===e)e=new r(10);else if((e=new r(e)).s<1||e.eq(i))throw Error(a+"NaN");if(this.s<1)throw Error(a+(this.s?"NaN":"-Infinity"));return this.eq(i)?new r(0):(s=!1,t=y(w(this,o),w(e,o),o),s=!0,P(t,n))},d.minus=d.sub=function(e){return e=new this.constructor(e),this.s==e.s?S(this,e):p(this,(e.s=-e.s,e))},d.modulo=d.mod=function(e){var t,r=this.constructor,i=r.precision;if(!(e=new r(e)).s)throw Error(a+"NaN");return this.s?(s=!1,t=y(this,e,0,1).times(e),s=!0,this.minus(t)):P(new r(this),i)},d.naturalExponential=d.exp=function(){return v(this)},d.naturalLogarithm=d.ln=function(){return w(this)},d.negated=d.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},d.plus=d.add=function(e){return e=new this.constructor(e),this.s==e.s?p(this,e):S(this,(e.s=-e.s,e))},d.precision=d.sd=function(e){var t,r,i;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(o+e);if(t=b(this)+1,r=7*(i=this.d.length-1)+1,i=this.d[i]){for(;i%10==0;i/=10)r--;for(i=this.d[0];i>=10;i/=10)r++}return e&&t>r?t:r},d.squareRoot=d.sqrt=function(){var e,t,r,i,n,o,l,c=this.constructor;if(this.s<1){if(!this.s)return new c(0);throw Error(a+"NaN")}for(e=b(this),s=!1,0==(n=Math.sqrt(+this))||n==1/0?(((t=m(this.d)).length+e)%2==0&&(t+="0"),n=Math.sqrt(t),e=u((e+1)/2)-(e<0||e%2),i=new c(t=n==1/0?"5e"+e:(t=n.toExponential()).slice(0,t.indexOf("e")+1)+e)):i=new c(n.toString()),n=l=(r=c.precision)+3;;)if(i=(o=i).plus(y(this,o,l+2)).times(.5),m(o.d).slice(0,l)===(t=m(i.d)).slice(0,l)){if(t=t.slice(l-3,l+1),n==l&&"4999"==t){if(P(o,r+1,0),o.times(o).eq(this)){i=o;break}}else if("9999"!=t)break;l+=4}return s=!0,P(i,r)},d.times=d.mul=function(e){var t,r,i,n,a,o,l,u,c,h=this.constructor,f=this.d,d=(e=new h(e)).d;if(!this.s||!e.s)return new h(0);for(e.s*=this.s,r=this.e+e.e,(u=f.length)<(c=d.length)&&(a=f,f=d,d=a,o=u,u=c,c=o),a=[],i=o=u+c;i--;)a.push(0);for(i=c;--i>=0;){for(t=0,n=u+i;n>i;)l=a[n]+d[i]*f[n-i-1]+t,a[n--]=l%1e7|0,t=l/1e7|0;a[n]=(a[n]+t)%1e7|0}for(;!a[--o];)a.pop();return t?++r:a.shift(),e.d=a,e.e=r,s?P(e,h.precision):e},d.toDecimalPlaces=d.todp=function(e,t){var r=this,i=r.constructor;return(r=new i(r),void 0===e)?r:(g(e,0,1e9),void 0===t?t=i.rounding:g(t,0,8),P(r,e+b(r)+1,t))},d.toExponential=function(e,t){var r,i=this,n=i.constructor;return void 0===e?r=E(i,!0):(g(e,0,1e9),void 0===t?t=n.rounding:g(t,0,8),r=E(i=P(new n(i),e+1,t),!0,e+1)),r},d.toFixed=function(e,t){var r,i,n=this.constructor;return void 0===e?E(this):(g(e,0,1e9),void 0===t?t=n.rounding:g(t,0,8),r=E((i=P(new n(this),e+b(this)+1,t)).abs(),!1,e+b(i)+1),this.isneg()&&!this.isZero()?"-"+r:r)},d.toInteger=d.toint=function(){var e=this.constructor;return P(new e(this),b(this)+1,e.rounding)},d.toNumber=function(){return+this},d.toPower=d.pow=function(e){var t,r,n,o,l,c,h=this,f=h.constructor,d=+(e=new f(e));if(!e.s)return new f(i);if(!(h=new f(h)).s){if(e.s<1)throw Error(a+"Infinity");return h}if(h.eq(i))return h;if(n=f.precision,e.eq(i))return P(h,n);if(c=(t=e.e)>=(r=e.d.length-1),l=h.s,c){if((r=d<0?-d:d)<=0x1fffffffffffff){for(o=new f(i),t=Math.ceil(n/7+4),s=!1;r%2&&A((o=o.times(h)).d,t),0!==(r=u(r/2));)A((h=h.times(h)).d,t);return s=!0,e.s<0?new f(i).div(o):P(o,n)}}else if(l<0)throw Error(a+"NaN");return l=l<0&&1&e.d[Math.max(t,r)]?-1:1,h.s=1,s=!1,o=e.times(w(h,n+12)),s=!0,(o=v(o)).s=l,o},d.toPrecision=function(e,t){var r,i,n=this,s=n.constructor;return void 0===e?(r=b(n),i=E(n,r<=s.toExpNeg||r>=s.toExpPos)):(g(e,1,1e9),void 0===t?t=s.rounding:g(t,0,8),r=b(n=P(new s(n),e,t)),i=E(n,e<=r||r<=s.toExpNeg,e)),i},d.toSignificantDigits=d.tosd=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(g(e,1,1e9),void 0===t?t=r.rounding:g(t,0,8)),P(new r(this),e,t)},d.toString=d.valueOf=d.val=d.toJSON=function(){var e=b(this),t=this.constructor;return E(this,e<=t.toExpNeg||e>=t.toExpPos)};var y=function(){function e(e,t){var r,i=0,n=e.length;for(e=e.slice();n--;)r=e[n]*t+i,e[n]=r%1e7|0,i=r/1e7|0;return i&&e.unshift(i),e}function t(e,t,r,i){var n,s;if(r!=i)s=r>i?1:-1;else for(n=s=0;n<r;n++)if(e[n]!=t[n]){s=e[n]>t[n]?1:-1;break}return s}function r(e,t,r){for(var i=0;r--;)e[r]-=i,i=+(e[r]<t[r]),e[r]=1e7*i+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(i,n,s,o){var l,u,c,h,f,d,p,g,m,y,v,x,_,w,k,S,E,A,M=i.constructor,T=i.s==n.s?1:-1,C=i.d,O=n.d;if(!i.s)return new M(i);if(!n.s)throw Error(a+"Division by zero");for(c=0,u=i.e-n.e,E=O.length,k=C.length,g=(p=new M(T)).d=[];O[c]==(C[c]||0);)++c;if(O[c]>(C[c]||0)&&--u,(x=null==s?s=M.precision:o?s+(b(i)-b(n))+1:s)<0)return new M(0);if(x=x/7+2|0,c=0,1==E)for(h=0,O=O[0],x++;(c<k||h)&&x--;c++)_=1e7*h+(C[c]||0),g[c]=_/O|0,h=_%O|0;else{for((h=1e7/(O[0]+1)|0)>1&&(O=e(O,h),C=e(C,h),E=O.length,k=C.length),w=E,y=(m=C.slice(0,E)).length;y<E;)m[y++]=0;(A=O.slice()).unshift(0),S=O[0],O[1]>=1e7/2&&++S;do h=0,(l=t(O,m,E,y))<0?(v=m[0],E!=y&&(v=1e7*v+(m[1]||0)),(h=v/S|0)>1?(h>=1e7&&(h=1e7-1),d=(f=e(O,h)).length,y=m.length,1==(l=t(f,m,d,y))&&(h--,r(f,E<d?A:O,d))):(0==h&&(l=h=1),f=O.slice()),(d=f.length)<y&&f.unshift(0),r(m,f,y),-1==l&&(y=m.length,(l=t(O,m,E,y))<1&&(h++,r(m,E<y?A:O,y))),y=m.length):0===l&&(h++,m=[0]),g[c++]=h,l&&m[0]?m[y++]=C[w]||0:(m=[C[w]],y=1);while((w++<k||void 0!==m[0])&&x--)}return g[0]||g.shift(),p.e=u,P(p,o?s+b(p)+1:s)}}();function v(e,t){var r,n,a,o,u,h=0,f=0,d=e.constructor,p=d.precision;if(b(e)>16)throw Error(l+b(e));if(!e.s)return new d(i);for(null==t?(s=!1,u=p):u=t,o=new d(.03125);e.abs().gte(.1);)e=e.times(o),f+=5;for(u+=Math.log(c(2,f))/Math.LN10*2+5|0,r=n=a=new d(i),d.precision=u;;){if(n=P(n.times(e),u),r=r.times(++h),m((o=a.plus(y(n,r,u))).d).slice(0,u)===m(a.d).slice(0,u)){for(;f--;)a=P(a.times(a),u);return d.precision=p,null==t?(s=!0,P(a,p)):a}a=o}}function b(e){for(var t=7*e.e,r=e.d[0];r>=10;r/=10)t++;return t}function x(e,t,r){if(t>e.LN10.sd())throw s=!0,r&&(e.precision=r),Error(a+"LN10 precision limit exceeded");return P(new e(e.LN10),t)}function _(e){for(var t="";e--;)t+="0";return t}function w(e,t){var r,n,o,l,u,c,h,f,d,p=1,g=e,v=g.d,_=g.constructor,k=_.precision;if(g.s<1)throw Error(a+(g.s?"NaN":"-Infinity"));if(g.eq(i))return new _(0);if(null==t?(s=!1,f=k):f=t,g.eq(10))return null==t&&(s=!0),x(_,f);if(_.precision=f+=10,n=(r=m(v)).charAt(0),!(15e14>Math.abs(l=b(g))))return h=x(_,f+2,k).times(l+""),g=w(new _(n+"."+r.slice(1)),f-10).plus(h),_.precision=k,null==t?(s=!0,P(g,k)):g;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=m((g=g.times(e)).d)).charAt(0),p++;for(l=b(g),n>1?(g=new _("0."+r),l++):g=new _(n+"."+r.slice(1)),c=u=g=y(g.minus(i),g.plus(i),f),d=P(g.times(g),f),o=3;;){if(u=P(u.times(d),f),m((h=c.plus(y(u,new _(o),f))).d).slice(0,f)===m(c.d).slice(0,f))return c=c.times(2),0!==l&&(c=c.plus(x(_,f+2,k).times(l+""))),c=y(c,new _(p),f),_.precision=k,null==t?(s=!0,P(c,k)):c;c=h,o+=2}}function k(e,t){var r,i,n;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(r<0&&(r=i),r+=+t.slice(i+1),t=t.substring(0,i)):r<0&&(r=t.length),i=0;48===t.charCodeAt(i);)++i;for(n=t.length;48===t.charCodeAt(n-1);)--n;if(t=t.slice(i,n)){if(n-=i,e.e=u((r=r-i-1)/7),e.d=[],i=(r+1)%7,r<0&&(i+=7),i<n){for(i&&e.d.push(+t.slice(0,i)),n-=7;i<n;)e.d.push(+t.slice(i,i+=7));i=7-(t=t.slice(i)).length}else i-=n;for(;i--;)t+="0";if(e.d.push(+t),s&&(e.e>f||e.e<-f))throw Error(l+r)}else e.s=0,e.e=0,e.d=[0];return e}function P(e,t,r){var i,n,a,o,h,d,p,g,m=e.d;for(o=1,a=m[0];a>=10;a/=10)o++;if((i=t-o)<0)i+=7,n=t,p=m[g=0];else{if((g=Math.ceil((i+1)/7))>=(a=m.length))return e;for(o=1,p=a=m[g];a>=10;a/=10)o++;i%=7,n=i-7+o}if(void 0!==r&&(h=p/(a=c(10,o-n-1))%10|0,d=t<0||void 0!==m[g+1]||p%a,d=r<4?(h||d)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||d||6==r&&(i>0?n>0?p/c(10,o-n):0:m[g-1])%10&1||r==(e.s<0?8:7))),t<1||!m[0])return d?(a=b(e),m.length=1,t=t-a-1,m[0]=c(10,(7-t%7)%7),e.e=u(-t/7)||0):(m.length=1,m[0]=e.e=e.s=0),e;if(0==i?(m.length=g,a=1,g--):(m.length=g+1,a=c(10,7-i),m[g]=n>0?(p/c(10,o-n)%c(10,n)|0)*a:0),d)for(;;)if(0==g){1e7==(m[0]+=a)&&(m[0]=1,++e.e);break}else{if(m[g]+=a,1e7!=m[g])break;m[g--]=0,a=1}for(i=m.length;0===m[--i];)m.pop();if(s&&(e.e>f||e.e<-f))throw Error(l+b(e));return e}function S(e,t){var r,i,n,a,o,l,u,c,h,f,d=e.constructor,p=d.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new d(e),s?P(t,p):t;if(u=e.d,f=t.d,i=t.e,c=e.e,u=u.slice(),o=c-i){for((h=o<0)?(r=u,o=-o,l=f.length):(r=f,i=c,l=u.length),o>(n=Math.max(Math.ceil(p/7),l)+2)&&(o=n,r.length=1),r.reverse(),n=o;n--;)r.push(0);r.reverse()}else{for((h=(n=u.length)<(l=f.length))&&(l=n),n=0;n<l;n++)if(u[n]!=f[n]){h=u[n]<f[n];break}o=0}for(h&&(r=u,u=f,f=r,t.s=-t.s),l=u.length,n=f.length-l;n>0;--n)u[l++]=0;for(n=f.length;n>o;){if(u[--n]<f[n]){for(a=n;a&&0===u[--a];)u[a]=1e7-1;--u[a],u[n]+=1e7}u[n]-=f[n]}for(;0===u[--l];)u.pop();for(;0===u[0];u.shift())--i;return u[0]?(t.d=u,t.e=i,s?P(t,p):t):new d(0)}function E(e,t,r){var i,n=b(e),s=m(e.d),a=s.length;return t?(r&&(i=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+_(i):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(n<0?"e":"e+")+n):n<0?(s="0."+_(-n-1)+s,r&&(i=r-a)>0&&(s+=_(i))):n>=a?(s+=_(n+1-a),r&&(i=r-n-1)>0&&(s=s+"."+_(i))):((i=n+1)<a&&(s=s.slice(0,i)+"."+s.slice(i)),r&&(i=r-a)>0&&(n+1===a&&(s+="."),s+=_(i))),e.s<0?"-"+s:s}function A(e,t){if(e.length>t)return e.length=t,!0}function M(e){if(!e||"object"!=typeof e)throw Error(a+"Object expected");var t,r,i,n=["precision",1,1e9,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<n.length;t+=3)if(void 0!==(i=e[r=n[t]]))if(u(i)===i&&i>=n[t+1]&&i<=n[t+2])this[r]=i;else throw Error(o+r+": "+i);if(void 0!==(i=e[r="LN10"]))if(i==Math.LN10)this[r]=new this(i);else throw Error(o+r+": "+i);return this}if((n=function e(t){var r,i,n;function s(e){if(!(this instanceof s))return new s(e);if(this.constructor=s,e instanceof s){this.s=e.s,this.e=e.e,this.d=(e=e.d)?e.slice():e;return}if("number"==typeof e){if(0*e!=0)throw Error(o+e);if(e>0)this.s=1;else if(e<0)e=-e,this.s=-1;else{this.s=0,this.e=0,this.d=[0];return}if(e===~~e&&e<1e7){this.e=0,this.d=[e];return}return k(this,e.toString())}if("string"!=typeof e)throw Error(o+e);if(45===e.charCodeAt(0)?(e=e.slice(1),this.s=-1):this.s=1,h.test(e))k(this,e);else throw Error(o+e)}if(s.prototype=d,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=e,s.config=s.set=M,void 0===t&&(t={}),t)for(r=0,n=["precision","rounding","toExpNeg","toExpPos","LN10"];r<n.length;)t.hasOwnProperty(i=n[r++])||(t[i]=this[i]);return s.config(t),s}(n)).default=n.Decimal=n,i=new n(1),"function"==typeof define&&define.amd){let t;e.r,void 0!==(t=n)&&e.v(t)}else t.exports?t.exports=n:(r||(r="undefined"!=typeof self&&self&&self.self==self?self:Function("return this")()),r.Decimal=n)}(e.e)},14595,(e,t,r)=>{"use strict";var i=e.r(71645),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=i.useRef,o=i.useEffect,l=i.useMemo,u=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,c){var h=a(null);if(null===h.current){var f={hasValue:!1,value:null};h.current=f}else f=h.current;var d=s(e,(h=l(function(){function e(e){if(!o){if(o=!0,s=e,e=i(e),void 0!==c&&f.hasValue){var t=f.value;if(c(t,e))return a=t}return a=e}if(t=a,n(s,e))return t;var r=i(e);return void 0!==c&&c(t,r)?(s=e,t):(s=e,a=r)}var s,a,o=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,i,c]))[0],h[1]);return o(function(){f.hasValue=!0,f.value=d},[d]),u(d),d}},13027,(e,t,r)=>{"use strict";t.exports=e.r(14595)},78492,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function s(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,i||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=Array(s);i<s;i++)a[i]=r[i].fn;return a},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,a),!0}for(u=1,l=Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(f=1,l=Array(h-1);f<h;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return l(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||l(this,s);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||i&&!a[o].once||r&&a[o].context!==r)&&u.push(a[o]);u.length?this._events[s]=1===u.length?u[0]:u:l(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},10185,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.uniqBy=function(e,t){let r=new Map;for(let i=0;i<e.length;i++){let n=e[i],s=t(n);r.has(s)||r.set(s,n)}return Array.from(r.values())}},36074,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.identity=function(e){return e}},52603,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isObjectLike=function(e){return"object"==typeof e&&null!==e}},44936,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(69642),n=e.r(52603);r.isArrayLikeObject=function(e){return n.isObjectLike(e)&&i.isArrayLike(e)}},77473,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(18915);r.property=function(e){return function(t){return i.get(t,e)}}},75234,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isPrimitive=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e}},44695,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(90820),n=e.r(75234),s=e.r(23855);function a(e,t,r,u){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,r,i){if(null==t)return!0;if(Array.isArray(t))return o(e,t,r,i);if(t instanceof Map){var s=e,a=t,u=r,c=i;if(0===a.size)return!0;if(!(s instanceof Map))return!1;for(let[e,t]of a.entries())if(!1===u(s.get(e),t,e,s,a,c))return!1;return!0}if(t instanceof Set)return l(e,t,r,i);let h=Object.keys(t);if(null==e)return 0===h.length;if(0===h.length)return!0;if(i?.has(t))return i.get(t)===e;i?.set(t,e);try{for(let s=0;s<h.length;s++){let a=h[s];if(!n.isPrimitive(e)&&!(a in e)||void 0===t[a]&&void 0!==e[a]||null===t[a]&&null!==e[a]||!r(e[a],t[a],a,e,t,i))return!1}return!0}finally{i?.delete(t)}}(e,t,r,u);case"function":if(Object.keys(t).length>0)return a(e,{...t},r,u);return s.eq(e,t);default:if(!i.isObject(e))return s.eq(e,t);if("string"==typeof t)return""===t;return!0}}function o(e,t,r,i){if(0===t.length)return!0;if(!Array.isArray(e))return!1;let n=new Set;for(let s=0;s<t.length;s++){let a=t[s],o=!1;for(let l=0;l<e.length;l++){if(n.has(l))continue;let u=e[l],c=!1;if(r(u,a,s,e,t,i)&&(c=!0),c){n.add(l),o=!0;break}}if(!o)return!1}return!0}function l(e,t,r,i){return 0===t.size||e instanceof Set&&o([...e],[...t],r,i)}r.isMatchWith=function e(t,r,i){return"function"!=typeof i?e(t,r,()=>void 0):a(t,r,function e(t,r,n,s,o,l){let u=i(t,r,n,s,o,l);return void 0!==u?!!u:a(t,r,e,l)},new Map)},r.isSetMatch=l},3450,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(44695);r.isMatch=function(e,t){return i.isMatchWith(e,t,()=>void 0)}},67034,(e,t,r)=>{var i={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],i=t[1];return(r+i)*3/4-i},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new n((a+o)*3/4-o),c=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,s=[],a=0,o=i-n;a<o;a+=16383)s.push(function(e,t,i){for(var n,s=[],a=t;a<i;a+=3)n=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[n>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===n?s.push(r[(t=e[i-1])>>2]+r[t<<4&63]+"=="):2===n&&s.push(r[(t=(e[i-2]<<8)+e[i-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}i[45]=62,i[95]=63},72:function(e,t,r){"use strict";var i=r(675),n=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var i=e,n=t;if(("string"!=typeof n||""===n)&&(n="utf8"),!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);var s=0|d(i,n),l=a(s),u=l.write(i,n);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(T(e,ArrayBuffer)||e&&T(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(T(e,SharedArrayBuffer)||e&&T(e.buffer,SharedArrayBuffer)))return function(e,t,r){var i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),i}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var c=e.valueOf&&e.valueOf();if(null!=c&&c!==e)return o.from(c,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|f(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),a(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),r=a(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)};function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function d(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||T(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(n)return i?-1:S(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=t;s<r;++s)n+=C[e[s]];return n}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}(this,t,r);case"latin1":case"binary":return function(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}(this,t,r);case"base64":return n=this,s=t,a=r,0===s&&a===n.length?i.fromByteArray(n):i.fromByteArray(n.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var i=e.slice(t,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function m(e,t,r,i,n){var s;if(0===e.length)return -1;if("string"==typeof r?(i=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(n)return -1;else r=e.length-1;else if(r<0)if(!n)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,i,n);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(n)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,i,n)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,i,n){var s,a=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var c=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else -1!==c&&(s-=s-c),c=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var h=!0,f=0;f<l;f++)if(u(e,s+f)!==u(t,f)){h=!1;break}if(h)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(T(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),T(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,i=t.length,n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:+(i<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,i=o.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(T(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,i,n){if(T(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,n>>>=0,this===e)return 0;for(var s=n-i,a=r-t,l=Math.min(s,a),u=this.slice(i,n),c=e.slice(t,r),h=0;h<l;++h)if(u[h]!==c[h]){s=u[h],a=c[h];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var s,a,o,l,u=e[n],c=null,h=u>239?4:u>223?3:u>191?2:1;if(n+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:(192&(s=e[n+1]))==128&&(l=(31&u)<<6|63&s)>127&&(c=l);break;case 3:s=e[n+1],a=e[n+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=e[n+1],a=e[n+2],o=e[n+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),n+=h}var f=i,d=f.length;if(d<=4096)return String.fromCharCode.apply(String,f);for(var p="",g=0;g<d;)p+=String.fromCharCode.apply(String,f.slice(g,g+=4096));return p}function b(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function x(e,t,r,i,n,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw RangeError('"value" argument is out of bounds');if(r+i>e.length)throw RangeError("Index out of range")}function _(e,t,r,i,n,s){if(r+i>e.length||r<0)throw RangeError("Index out of range")}function w(e,t,r,i,s){return t*=1,r>>>=0,s||_(e,t,r,4,34028234663852886e22,-34028234663852886e22),n.write(e,t,r,i,23,4),r+4}function k(e,t,r,i,s){return t*=1,r>>>=0,s||_(e,t,r,8,17976931348623157e292,-17976931348623157e292),n.write(e,t,r,i,52,8),r+8}o.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var n,s,a,o,l,u,c,h,f=this.length-t;if((void 0===r||r>f)&&(r=f),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var d=!1;;)switch(i){case"hex":return function(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=t.length;i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return n=t,s=r,M(S(e,this.length-n),this,n,s);case"ascii":return a=t,o=r,M(E(e),this,a,o);case"latin1":case"binary":return function(e,t,r,i){return M(E(t),e,r,i)}(this,e,t,r);case"base64":return l=t,u=r,M(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,h=r,M(function(e,t){for(var r,i,n=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n.push(r%256),n.push(i);return n}(e,this.length-c),this,c,h);default:if(d)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),d=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,o.prototype),i},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=t,n=1,s=this[e+--i];i>0&&(n*=256);)s+=this[e+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,i){if(e*=1,t>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;x(this,e,t,r,n,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,i){if(e*=1,t>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;x(this,e,t,r,n,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,i){if(e*=1,t>>>=0,!i){var n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,i){if(e*=1,t>>>=0,!i){var n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return w(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return w(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,i){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n=i-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,i);else if(this===e&&r<t&&t<i)for(var s=n-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,i),t);return n},o.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){var n,s=e.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{var a=o.isBuffer(e)?e:o.from(e,i),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=a[n%l]}return this};var P=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,i=e.length,n=null,s=[],a=0;a<i;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319||a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function E(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function M(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length)&&!(n>=e.length);++n)t[n+r]=e[n];return n}function T(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var C=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var i=16*r,n=0;n<16;++n)t[i+n]=e[r]+e[n];return t}()},783:function(e,t){t.read=function(e,t,r,i,n){var s,a,o=8*n-i-1,l=(1<<o)-1,u=l>>1,c=-7,h=r?n-1:0,f=r?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-c)-1,d>>=-c,c+=o;c>0;s=256*s+e[t+h],h+=f,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=i;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,i),s-=u}return(d?-1:1)*a*Math.pow(2,s-i)},t.write=function(e,t,r,i,n,s){var a,o,l,u=8*s-n-1,c=(1<<u)-1,h=c>>1,f=5960464477539062e-23*(23===n),d=i?0:s-1,p=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=f/l:t+=f*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=c?(o=0,a=c):a+h>=1?(o=(t*l-1)*Math.pow(2,n),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;e[r+d]=255&o,d+=p,o/=256,n-=8);for(a=a<<n|o,u+=n;u>0;e[r+d]=255&a,d+=p,a/=256,u-=8);e[r+d-p]|=128*g}}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}},a=!0;try{i[e](r,r.exports,s),a=!1}finally{a&&delete n[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},9866,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.getSymbols=function(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}},23678,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.getTag=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}},55813,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.argumentsTag="[object Arguments]",r.arrayBufferTag="[object ArrayBuffer]",r.arrayTag="[object Array]",r.bigInt64ArrayTag="[object BigInt64Array]",r.bigUint64ArrayTag="[object BigUint64Array]",r.booleanTag="[object Boolean]",r.dataViewTag="[object DataView]",r.dateTag="[object Date]",r.errorTag="[object Error]",r.float32ArrayTag="[object Float32Array]",r.float64ArrayTag="[object Float64Array]",r.functionTag="[object Function]",r.int16ArrayTag="[object Int16Array]",r.int32ArrayTag="[object Int32Array]",r.int8ArrayTag="[object Int8Array]",r.mapTag="[object Map]",r.numberTag="[object Number]",r.objectTag="[object Object]",r.regexpTag="[object RegExp]",r.setTag="[object Set]",r.stringTag="[object String]",r.symbolTag="[object Symbol]",r.uint16ArrayTag="[object Uint16Array]",r.uint32ArrayTag="[object Uint32Array]",r.uint8ArrayTag="[object Uint8Array]",r.uint8ClampedArrayTag="[object Uint8ClampedArray]"},55424,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isTypedArray=function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}},92348,(e,t,r)=>{"use strict";var i=e.i(67034);Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let n=e.r(9866),s=e.r(23678),a=e.r(55813),o=e.r(75234),l=e.r(55424);function u(e,t,r,n=new Map,h){let f=h?.(e,t,r,n);if(void 0!==f)return f;if(o.isPrimitive(e))return e;if(n.has(e))return n.get(e);if(Array.isArray(e)){let t=Array(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=u(e[i],i,r,n,h);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[i,s]of(n.set(e,t),e))t.set(i,u(s,i,r,n,h));return t}if(e instanceof Set){let t=new Set;for(let i of(n.set(e,t),e))t.add(u(i,void 0,r,n,h));return t}if(void 0!==i.Buffer&&i.Buffer.isBuffer(e))return e.subarray();if(l.isTypedArray(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=u(e[i],i,r,n,h);return t}if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return n.set(e,t),c(t,e,r,n,h),t}if("undefined"!=typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return n.set(e,t),c(t,e,r,n,h),t}if("undefined"!=typeof Blob&&e instanceof Blob){let t=new Blob([e],{type:e.type});return n.set(e,t),c(t,e,r,n,h),t}if(e instanceof Error){let t=new e.constructor;return n.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,c(t,e,r,n,h),t}if(e instanceof Boolean){let t=new Boolean(e.valueOf());return n.set(e,t),c(t,e,r,n,h),t}if(e instanceof Number){let t=new Number(e.valueOf());return n.set(e,t),c(t,e,r,n,h),t}if(e instanceof String){let t=new String(e.valueOf());return n.set(e,t),c(t,e,r,n,h),t}if("object"==typeof e&&function(e){switch(s.getTag(e)){case a.argumentsTag:case a.arrayTag:case a.arrayBufferTag:case a.dataViewTag:case a.booleanTag:case a.dateTag:case a.float32ArrayTag:case a.float64ArrayTag:case a.int8ArrayTag:case a.int16ArrayTag:case a.int32ArrayTag:case a.mapTag:case a.numberTag:case a.objectTag:case a.regexpTag:case a.setTag:case a.stringTag:case a.symbolTag:case a.uint8ArrayTag:case a.uint8ClampedArrayTag:case a.uint16ArrayTag:case a.uint32ArrayTag:return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return n.set(e,t),c(t,e,r,n,h),t}return e}function c(e,t,r=e,i,s){let a=[...Object.keys(t),...n.getSymbols(t)];for(let n=0;n<a.length;n++){let o=a[n],l=Object.getOwnPropertyDescriptor(e,o);(null==l||l.writable)&&(e[o]=u(t[o],o,r,i,s))}}r.cloneDeepWith=function(e,t){return u(e,void 0,e,new Map,t)},r.cloneDeepWithImpl=u,r.copyProperties=c},99510,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(92348);r.cloneDeep=function(e){return i.cloneDeepWithImpl(e,void 0,e,new Map,void 0)}},67284,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(3450),n=e.r(99510);r.matches=function(e){return e=n.cloneDeep(e),t=>i.isMatch(t,e)}},68110,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(92348),n=e.r(55813);r.cloneDeepWith=function(e,t){return i.cloneDeepWith(e,(r,s,a,o)=>{let l=t?.(r,s,a,o);if(void 0!==l)return l;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case n.numberTag:case n.stringTag:case n.booleanTag:{let t=new e.constructor(e?.valueOf());return i.copyProperties(t,e),t}case n.argumentsTag:{let t={};return i.copyProperties(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}},93141,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(68110);r.cloneDeep=function(e){return i.cloneDeepWith(e)}},17858,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(23678);r.isArguments=function(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===i.getTag(e)}},56518,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(33858),n=e.r(5257),s=e.r(17858),a=e.r(79232);r.has=function(e,t){let r;if(0===(r=Array.isArray(t)?t:"string"==typeof t&&i.isDeepKey(t)&&e?.[t]==null?a.toPath(t):[t]).length)return!1;let o=e;for(let e=0;e<r.length;e++){let t=r[e];if((null==o||!Object.hasOwn(o,t))&&!((Array.isArray(o)||s.isArguments(o))&&n.isIndex(t)&&t<o.length))return!1;o=o[t]}return!0}},40656,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(3450),n=e.r(96736),s=e.r(93141),a=e.r(18915),o=e.r(56518);r.matchesProperty=function(e,t){switch(typeof e){case"object":Object.is(e?.valueOf(),-0)&&(e="-0");break;case"number":e=n.toKey(e)}return t=s.cloneDeep(t),function(r){let n=a.get(r,e);return void 0===n?o.has(r,e):void 0===t?void 0===n:i.isMatch(n,t)}}},27519,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(36074),n=e.r(77473),s=e.r(67284),a=e.r(40656);r.iteratee=function(e){if(null==e)return i.identity;switch(typeof e){case"function":return e;case"object":if(Array.isArray(e)&&2===e.length)return a.matchesProperty(e[0],e[1]);return s.matches(e);case"string":case"symbol":case"number":return n.property(e)}}},77008,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(10185),n=e.r(36074),s=e.r(44936),a=e.r(27519);r.uniqBy=function(e,t=n.identity){return s.isArrayLikeObject(e)?i.uniqBy(Array.from(e),a.iteratee(t)):[]}},92809,(e,t,r)=>{t.exports=e.r(77008).uniqBy},54008,(e,t,r)=>{"use strict";function i(e,t,r){r=r||2;var i,f,d,m,v,b,x,_=t&&t.length,w=_?t[0]*r:e.length,k=n(e,0,w,r,!0),P=[];if(!k||k.next===k.prev)return P;if(_&&(k=function(e,t,r,i){var o,c,h,f,d,m=[];for(o=0,c=t.length;o<c;o++)h=t[o]*i,f=o<c-1?t[o+1]*i:e.length,(d=n(e,h,f,i,!1))===d.next&&(d.steiner=!0),m.push(function(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e)return r}(d));for(m.sort(a),o=0;o<m.length;o++)r=function(e,t){var r=function(e,t){var r,i,n,s=t,a=e.x,o=e.y,c=-1/0;do{if(o<=s.y&&o>=s.next.y&&s.next.y!==s.y){var h=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(h<=a&&h>c&&(c=h,n=s.x<s.next.x?s:s.next,h===a))return n}s=s.next}while(s!==t)if(!n)return null;var f,d=n,g=n.x,m=n.y,y=1/0;s=n;do{a>=s.x&&s.x>=g&&a!==s.x&&l(o<m?a:c,o,g,m,o<m?c:a,o,s.x,s.y)&&(f=Math.abs(o-s.y)/(a-s.x),p(s,e)&&(f<y||f===y&&(s.x>n.x||s.x===n.x&&(r=n,i=s,0>u(r.prev,r,i.prev)&&0>u(i.next,r,r.next))))&&(n=s,y=f)),s=s.next}while(s!==d)return n}(e,t);if(!r)return t;var i=g(r,e);return s(i,i.next),s(r,r.next)}(m[o],r);return r}(e,t,k,r)),e.length>80*r){i=d=e[0],f=m=e[1];for(var S=r;S<w;S+=r)v=e[S],b=e[S+1],v<i&&(i=v),b<f&&(f=b),v>d&&(d=v),b>m&&(m=b);x=0!==(x=Math.max(d-i,m-f))?32767/x:0}return function e(t,r,i,n,a,f,d){if(t){!d&&f&&function(e,t,r,i){var n=e;do 0===n.z&&(n.z=o(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e)n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,a,o,l,u=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,i=r,o=0,t=0;t<u&&(o++,i=i.nextZ);t++);for(l=u;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,u*=2}while(a>1)}(n)}(t,n,a,f);for(var m,v,b=t;t.prev!==t.next;){if(m=t.prev,v=t.next,f?function(e,t,r,i){var n=e.prev,s=e.next;if(u(n,e,s)>=0)return!1;for(var a=n.x,c=e.x,h=s.x,f=n.y,d=e.y,p=s.y,g=a<c?a<h?a:h:c<h?c:h,m=f<d?f<p?f:p:d<p?d:p,y=a>c?a>h?a:h:c>h?c:h,v=f>d?f>p?f:p:d>p?d:p,b=o(g,m,t,r,i),x=o(y,v,t,r,i),_=e.prevZ,w=e.nextZ;_&&_.z>=b&&w&&w.z<=x;){if(_.x>=g&&_.x<=y&&_.y>=m&&_.y<=v&&_!==n&&_!==s&&l(a,f,c,d,h,p,_.x,_.y)&&u(_.prev,_,_.next)>=0||(_=_.prevZ,w.x>=g&&w.x<=y&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&l(a,f,c,d,h,p,w.x,w.y)&&u(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;_&&_.z>=b;){if(_.x>=g&&_.x<=y&&_.y>=m&&_.y<=v&&_!==n&&_!==s&&l(a,f,c,d,h,p,_.x,_.y)&&u(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;w&&w.z<=x;){if(w.x>=g&&w.x<=y&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&l(a,f,c,d,h,p,w.x,w.y)&&u(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}(t,n,a,f):function(e){var t=e.prev,r=e.next;if(u(t,e,r)>=0)return!1;for(var i=t.x,n=e.x,s=r.x,a=t.y,o=e.y,c=r.y,h=i<n?i<s?i:s:n<s?n:s,f=a<o?a<c?a:c:o<c?o:c,d=i>n?i>s?i:s:n>s?n:s,p=a>o?a>c?a:c:o>c?o:c,g=r.next;g!==t;){if(g.x>=h&&g.x<=d&&g.y>=f&&g.y<=p&&l(i,a,n,o,s,c,g.x,g.y)&&u(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}(t)){r.push(m.i/i|0),r.push(t.i/i|0),r.push(v.i/i|0),y(t),t=v.next,b=v.next;continue}if((t=v)===b){d?1===d?e(t=function(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!c(n,a)&&h(n,i,i.next,a)&&p(n,a)&&p(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),y(i),y(i.next),i=e=a),i=i.next}while(i!==e)return s(i)}(s(t),r,i),r,i,n,a,f,2):2===d&&function(t,r,i,n,a,o){var l=t;do{for(var f,d,m=l.next.next;m!==l.prev;){if(l.i!==m.i&&(f=l,d=m,f.next.i!==d.i&&f.prev.i!==d.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&h(r,r.next,e,t))return!0;r=r.next}while(r!==e)return!1}(f,d)&&(p(f,d)&&p(d,f)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e)return i}(f,d)&&(u(f.prev,f,d.prev)||u(f,d.prev,d))||c(f,d)&&u(f.prev,f,f.next)>0&&u(d.prev,d,d.next)>0))){var y=g(l,m);l=s(l,l.next),y=s(y,y.next),e(l,r,i,n,a,o,0),e(y,r,i,n,a,o,0);return}m=m.next}l=l.next}while(l!==t)}(t,r,i,n,a,f):e(s(t),r,i,n,a,f,1);break}}}}(k,P,r,i,f,x,0),P}function n(e,t,r,i,n){var s,a;if(n===b(e,t,r,i)>0)for(s=t;s<r;s+=i)a=m(s,e[s],e[s+1],a);else for(s=r-i;s>=t;s-=i)a=m(s,e[s],e[s+1],a);return a&&c(a,a.next)&&(y(a),a=a.next),a}function s(e,t){if(!e)return e;t||(t=e);var r,i=e;do if(r=!1,!i.steiner&&(c(i,i.next)||0===u(i.prev,i,i.next))){if(y(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function a(e,t){return e.x-t.x}function o(e,t,r,i,n){return(e=((e=((e=((e=((e=(e-r)*n|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-i)*n|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function l(e,t,r,i,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(r-a)*(t-o)&&(r-a)*(s-o)>=(n-a)*(i-o)}function u(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function c(e,t){return e.x===t.x&&e.y===t.y}function h(e,t,r,i){var n=d(u(e,t,r)),s=d(u(e,t,i)),a=d(u(r,i,e)),o=d(u(r,i,t));return!!(n!==s&&a!==o||0===n&&f(e,r,t)||0===s&&f(e,i,t)||0===a&&f(r,e,i)||0===o&&f(r,t,i))}function f(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function d(e){return e>0?1:e<0?-1:0}function p(e,t){return 0>u(e.prev,e,e.next)?u(e,t,e.next)>=0&&u(e,e.prev,t)>=0:0>u(e,t,e.prev)||0>u(e,e.next,t)}function g(e,t){var r=new v(e.i,e.x,e.y),i=new v(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function m(e,t,r,i){var n=new v(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function y(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function v(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function b(e,t,r,i){for(var n=0,s=t,a=r-i;s<r;s+=i)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}t.exports=i,t.exports.default=i,i.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,a=Math.abs(b(e,0,s,r));if(n)for(var o=0,l=t.length;o<l;o++){var u=t[o]*r,c=o<l-1?t[o+1]*r:e.length;a-=Math.abs(b(e,u,c,r))}var h=0;for(o=0;o<i.length;o+=3){var f=i[o]*r,d=i[o+1]*r,p=i[o+2]*r;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[n][s][a]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}},52683,e=>{"use strict";let t,r,i,n,s,a,o,l,u,c,h,f,d,p,g,m,y,v;var b,x,_,w,k,P,S,E,A,M,T,C,O,I,L,j,N,D,R,z,F,B,U,$,V,W,G,q,H,K,Y,Z,X,J=e.i(43476),Q=e.i(71645),ee=e.i(55274),et=e.i(75254);let er=(0,et.default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),ei=(0,et.default)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),en=(0,et.default)("workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);var es=Q,ea=e.i(7670);function eo(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function el(e){return function(){return e}}function eu(e){this._context=e}function ec(e){return new eu(e)}Array.prototype.slice,eu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};let eh=Math.PI,ef=2*eh,ed=ef-1e-6;function ep(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class eg{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?ep:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return ep;let r=10**t;return function(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,i){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,t,r,i,n,s){this._append`C${+e},${+t},${+r},${+i},${this._x1=+n},${this._y1=+s}`}arcTo(e,t,r,i,n){if(e*=1,t*=1,r*=1,i*=1,(n*=1)<0)throw Error(`negative radius: ${n}`);let s=this._x1,a=this._y1,o=r-e,l=i-t,u=s-e,c=a-t,h=u*u+c*c;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(h>1e-6)if(Math.abs(c*o-l*u)>1e-6&&n){let f=r-s,d=i-a,p=o*o+l*l,g=Math.sqrt(p),m=Math.sqrt(h),y=n*Math.tan((eh-Math.acos((p+h-(f*f+d*d))/(2*g*m)))/2),v=y/m,b=y/g;Math.abs(v-1)>1e-6&&this._append`L${e+v*u},${t+v*c}`,this._append`A${n},${n},0,0,${+(c*f>u*d)},${this._x1=e+b*o},${this._y1=t+b*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,r,i,n,s){if(e*=1,t*=1,r*=1,s=!!s,r<0)throw Error(`negative radius: ${r}`);let a=r*Math.cos(i),o=r*Math.sin(i),l=e+a,u=t+o,c=1^s,h=s?i-n:n-i;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append`L${l},${u}`,r&&(h<0&&(h=h%ef+ef),h>ed?this._append`A${r},${r},0,1,${c},${e-a},${t-o}A${r},${r},0,1,${c},${this._x1=l},${this._y1=u}`:h>1e-6&&this._append`A${r},${r},0,${+(h>=eh)},${c},${this._x1=e+r*Math.cos(n)},${this._y1=t+r*Math.sin(n)}`)}rect(e,t,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r*=1}v${+i}h${-r}Z`}toString(){return this._}}function em(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(null==r)t=null;else{let e=Math.floor(r);if(!(e>=0))throw RangeError(`invalid digits: ${r}`);t=e}return e},()=>new eg(t)}function ey(e){return e[0]}function ev(e){return e[1]}function eb(e,t){var r=el(!0),i=null,n=ec,s=null,a=em(o);function o(o){var l,u,c,h=(o=eo(o)).length,f=!1;for(null==i&&(s=n(c=a())),l=0;l<=h;++l)!(l<h&&r(u=o[l],l,o))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+e(u,l,o),+t(u,l,o));if(c)return s=null,c+""||null}return e="function"==typeof e?e:void 0===e?ey:el(e),t="function"==typeof t?t:void 0===t?ev:el(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:el(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:el(+e),o):t},o.defined=function(e){return arguments.length?(r="function"==typeof e?e:el(!!e),o):r},o.curve=function(e){return arguments.length?(n=e,null!=i&&(s=n(i)),o):n},o.context=function(e){return arguments.length?(null==e?i=s=null:s=n(i=e),o):i},o}function ex(e,t,r){var i=null,n=el(!0),s=null,a=ec,o=null,l=em(u);function u(u){var c,h,f,d,p,g=(u=eo(u)).length,m=!1,y=Array(g),v=Array(g);for(null==s&&(o=a(p=l())),c=0;c<=g;++c){if(!(c<g&&n(d=u[c],c,u))===m)if(m=!m)h=c,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),f=c-1;f>=h;--f)o.point(y[f],v[f]);o.lineEnd(),o.areaEnd()}m&&(y[c]=+e(d,c,u),v[c]=+t(d,c,u),o.point(i?+i(d,c,u):y[c],r?+r(d,c,u):v[c]))}if(p)return o=null,p+""||null}function c(){return eb().defined(n).curve(a).context(s)}return e="function"==typeof e?e:void 0===e?ey:el(+e),t="function"==typeof t?t:void 0===t?el(0):el(+t),r="function"==typeof r?r:void 0===r?ev:el(+r),u.x=function(t){return arguments.length?(e="function"==typeof t?t:el(+t),i=null,u):e},u.x0=function(t){return arguments.length?(e="function"==typeof t?t:el(+t),u):e},u.x1=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:el(+e),u):i},u.y=function(e){return arguments.length?(t="function"==typeof e?e:el(+e),r=null,u):t},u.y0=function(e){return arguments.length?(t="function"==typeof e?e:el(+e),u):t},u.y1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:el(+e),u):r},u.lineX0=u.lineY0=function(){return c().x(e).y(t)},u.lineY1=function(){return c().x(e).y(r)},u.lineX1=function(){return c().x(i).y(t)},u.defined=function(e){return arguments.length?(n="function"==typeof e?e:el(!!e),u):n},u.curve=function(e){return arguments.length?(a=e,null!=s&&(o=a(s)),u):a},u.context=function(e){return arguments.length?(null==e?s=o=null:o=a(s=e),u):s},u}function e_(){}function ew(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function ek(e){this._context=e}function eP(e){this._context=e}function eS(e){this._context=e}eg.prototype,ek.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ew(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ew(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},eP.prototype={areaStart:e_,areaEnd:e_,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:ew(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},eS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,i):this._context.moveTo(r,i);break;case 3:this._point=4;default:ew(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class eE{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function eA(e){this._context=e}eA.prototype={areaStart:e_,areaEnd:e_,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e*=1,t*=1,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function eM(e,t,r){var i=e._x1-e._x0,n=t-e._x1,s=(e._y1-e._y0)/(i||n<0&&-0),a=(r-e._y1)/(n||i<0&&-0);return((s<0?-1:1)+(a<0?-1:1))*Math.min(Math.abs(s),Math.abs(a),.5*Math.abs((s*n+a*i)/(i+n)))||0}function eT(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function eC(e,t,r){var i=e._x0,n=e._y0,s=e._x1,a=e._y1,o=(s-i)/3;e._context.bezierCurveTo(i+o,n+o*t,s-o,a-o*r,s,a)}function eO(e){this._context=e}function eI(e){this._context=new eL(e)}function eL(e){this._context=e}function ej(e){this._context=e}function eN(e){var t,r,i=e.length-1,n=Array(i),s=Array(i),a=Array(i);for(n[0]=0,s[0]=2,a[0]=e[0]+2*e[1],t=1;t<i-1;++t)n[t]=1,s[t]=4,a[t]=4*e[t]+2*e[t+1];for(n[i-1]=2,s[i-1]=7,a[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)r=n[t]/s[t-1],s[t]-=r,a[t]-=r*a[t-1];for(n[i-1]=a[i-1]/s[i-1],t=i-2;t>=0;--t)n[t]=(a[t]-n[t+1])/s[t];for(t=0,s[i-1]=(e[i]+n[i-1])/2;t<i-1;++t)s[t]=2*e[t+1]-n[t+1];return[n,s]}function eD(e,t){this._context=e,this._t=t}eO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:eC(this,this._t0,eT(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(t*=1,(e*=1)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,eC(this,eT(this,r=eM(this,e,t)),r);break;default:eC(this,this._t0,r=eM(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}},(eI.prototype=Object.create(eO.prototype)).point=function(e,t){eO.prototype.point.call(this,t,e)},eL.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,i,n,s){this._context.bezierCurveTo(t,e,i,r,s,n)}},ej.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===r)this._context.lineTo(e[1],t[1]);else for(var i=eN(e),n=eN(t),s=0,a=1;a<r;++s,++a)this._context.bezierCurveTo(i[0][s],n[0][s],i[1][s],n[1][s],e[a],t[a]);(this._line||0!==this._line&&1===r)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},eD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}}this._x=e,this._y=t}};var eR=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function ez(e){return"string"==typeof e&&eR.includes(e)}var eF=(e,t)=>{if(!e||"function"==typeof e||"boolean"==typeof e)return null;var r=e;if((0,Q.isValidElement)(e)&&(r=e.props),"object"!=typeof r&&"function"!=typeof r)return null;var i={};return Object.keys(r).forEach(e=>{ez(e)&&(i[e]=t||(t=>r[e](r,t)))}),i},eB=e.i(92068),eU=e=>0===e?0:e>0?1:-1,e$=e=>"number"==typeof e&&e!=+e,eV=e=>"string"==typeof e&&e.indexOf("%")===e.length-1,eW=e=>("number"==typeof e||e instanceof Number)&&!e$(e),eG=e=>eW(e)||"string"==typeof e,eq=0,eH=e=>{var t=++eq;return"".concat(e||"").concat(t)},eK=function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!eW(e)&&"string"!=typeof e)return i;if(eV(e)){if(null==t)return i;var s=e.indexOf("%");r=t*parseFloat(e.slice(0,s))/100}else r=+e;return e$(r)&&(r=i),n&&null!=t&&r>t&&(r=t),r},eY=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,r={},i=0;i<t;i++)if(r[e[i]])return!0;else r[e[i]]=!0;return!1};function eZ(e,t,r){return eW(e)&&eW(t)?e+r*(t-e):t}function eX(e,t,r){if(e&&e.length)return e.find(e=>e&&("function"==typeof t?t(e):(0,eB.default)(e,t))===r)}var eJ=e=>null==e?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function eQ(e){return Number.isFinite(e)}function e0(e){return"number"==typeof e&&e>0&&Number.isFinite(e)}var e1=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function e2(e){return"string"==typeof e&&e1.includes(e)}function e3(e){return"string"==typeof e&&e.startsWith("data-")}function e4(e){return Object.fromEntries(Object.entries(e).filter(e=>{var[t]=e;return e2(t)||e3(t)}))}function e6(e){return null==e?null:(0,Q.isValidElement)(e)&&"object"==typeof e.props&&null!==e.props?e4(e.props):"object"!=typeof e||Array.isArray(e)?null:e4(e)}function e5(){return(e5=Object.assign.bind()).apply(null,arguments)}function e8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function e7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e8(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e8(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var e9={curveBasisClosed:function(e){return new eP(e)},curveBasisOpen:function(e){return new eS(e)},curveBasis:function(e){return new ek(e)},curveBumpX:function(e){return new eE(e,!0)},curveBumpY:function(e){return new eE(e,!1)},curveLinearClosed:function(e){return new eA(e)},curveLinear:ec,curveMonotoneX:function(e){return new eO(e)},curveMonotoneY:function(e){return new eI(e)},curveNatural:function(e){return new ej(e)},curveStep:function(e){return new eD(e,.5)},curveStepAfter:function(e){return new eD(e,1)},curveStepBefore:function(e){return new eD(e,0)}},te=e=>eQ(e.x)&&eQ(e.y),tt=e=>e.x,tr=e=>e.y,ti=e=>{var{className:t,points:r,path:i,pathRef:n}=e;if((!r||!r.length)&&!i)return null;var s=r&&r.length?(e=>{var t,{type:r="linear",points:i=[],baseLine:n,layout:s,connectNulls:a=!1}=e,o=((e,t)=>{if("function"==typeof e)return e;var r="curve".concat(eJ(e));return("curveMonotone"===r||"curveBump"===r)&&t?e9["".concat(r).concat("vertical"===t?"Y":"X")]:e9[r]||ec})(r,s),l=a?i.filter(te):i;if(Array.isArray(n)){var u=a?n.filter(e=>te(e)):n,c=l.map((e,t)=>e7(e7({},e),{},{base:u[t]}));return(t="vertical"===s?ex().y(tr).x1(tt).x0(e=>e.base.x):ex().x(tt).y1(tr).y0(e=>e.base.y)).defined(te).curve(o),t(c)}return(t="vertical"===s&&eW(n)?ex().y(tr).x1(tt).x0(n):eW(n)?ex().x(tt).y1(tr).y0(n):eb().x(tt).y(tr)).defined(te).curve(o),t(l)})(e):i;return Q.createElement("path",e5({},e4(e),eF(e),{className:(0,ea.clsx)("recharts-curve",t),d:null===s?void 0:s,ref:n}))};function tn(){return(tn=Object.assign.bind()).apply(null,arguments)}var ts=e=>{var{cx:t,cy:r,r:i,className:n}=e,s=(0,ea.clsx)("recharts-dot",n);return t===+t&&r===+r&&i===+i?Q.createElement("circle",tn({},e4(e),eF(e),{className:s,cx:t,cy:r,r:i})):null};function ta(e){return Object.fromEntries(Object.entries(e).filter(e=>{var[t]=e;return e2(t)||e3(t)||ez(t)}))}function to(e){return null==e?null:(0,Q.isValidElement)(e)?ta(e.props):"object"!=typeof e||Array.isArray(e)?null:ta(e)}var tl=["children","className"];function tu(){return(tu=Object.assign.bind()).apply(null,arguments)}var tc=Q.forwardRef((e,t)=>{var{children:r,className:i}=e,n=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,tl),s=(0,ea.clsx)("recharts-layer",i);return Q.createElement("g",tu({className:s},ta(n),{ref:t}),r)}),th=e.i(4178),tf={devToolsEnabled:!1,isSsr:!("undefined"!=typeof window&&window.document&&window.document.createElement&&window.setTimeout)};function td(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}var tp=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?td(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):td(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},{cacheSize:2e3,enableCache:!0}),tg=new class{constructor(e){!function(e,t,r){var i;(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"cache",new Map),this.maxSize=e}get(e){var t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}}(tp.cacheSize),tm={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},ty="recharts_measurement_span",tv=(e,t)=>{try{var r=document.getElementById(ty);r||((r=document.createElement("span")).setAttribute("id",ty),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,tm,t),r.textContent="".concat(e);var i=r.getBoundingClientRect();return{width:i.width,height:i.height}}catch(e){return{width:0,height:0}}},tb=function(e){var t,r,i,n,s,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e||tf.isSsr)return{width:0,height:0};if(!tp.enableCache)return tv(e,o);var l=(t=o.fontSize||"",r=o.fontFamily||"",i=o.fontWeight||"",n=o.fontStyle||"",s=o.letterSpacing||"",a=o.textTransform||"","".concat(e,"|").concat(t,"|").concat(r,"|").concat(i,"|").concat(n,"|").concat(s,"|").concat(a)),u=tg.get(l);if(u)return u;var c=tv(e,o);return tg.set(l,c),c},tx=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,t_=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,tw=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,tk=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,tP={cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,in:96,Q:96/101.6,px:1},tS=Object.keys(tP);class tE{static parse(e){var t,[,r,i]=null!=(t=tk.exec(e))?t:[];return new tE(parseFloat(r),null!=i?i:"")}constructor(e,t){this.num=e,this.unit=t,this.num=e,this.unit=t,e$(e)&&(this.unit=""),""===t||tw.test(t)||(this.num=NaN,this.unit=""),tS.includes(t)&&(this.num=e*tP[t],this.unit="px")}add(e){return this.unit!==e.unit?new tE(NaN,""):new tE(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new tE(NaN,""):new tE(this.num-e.num,this.unit)}multiply(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tE(NaN,""):new tE(this.num*e.num,this.unit||e.unit)}divide(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tE(NaN,""):new tE(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return e$(this.num)}}function tA(e){if(e.includes("NaN"))return"NaN";for(var t=e;t.includes("*")||t.includes("/");){var r,[,i,n,s]=null!=(r=tx.exec(t))?r:[],a=tE.parse(null!=i?i:""),o=tE.parse(null!=s?s:""),l="*"===n?a.multiply(o):a.divide(o);if(l.isNaN())return"NaN";t=t.replace(tx,l.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var u,[,c,h,f]=null!=(u=t_.exec(t))?u:[],d=tE.parse(null!=c?c:""),p=tE.parse(null!=f?f:""),g="+"===h?d.add(p):d.subtract(p);if(g.isNaN())return"NaN";t=t.replace(t_,g.toString())}return t}var tM=/\(([^()]*)\)/;function tT(e){var t=function(e){try{var t;return t=e.replace(/\s+/g,""),t=function(e){for(var t,r=e;null!=(t=tM.exec(r));){var[,i]=t;r=r.replace(tM,tA(i))}return r}(t),t=tA(t)}catch(e){return"NaN"}}(e.slice(5,-1));return"NaN"===t?"":t}var tC=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],tO=["dx","dy","angle","className","breakAll"];function tI(){return(tI=Object.assign.bind()).apply(null,arguments)}function tL(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var tj=/[ \f\n\r\t\v\u2028\u2029]+/,tN=e=>{var{children:t,breakAll:r,style:i}=e;try{var n=[];null!=t&&(n=r?t.toString().split(""):t.toString().split(tj));var s=n.map(e=>({word:e,width:tb(e,i).width})),a=r?0:tb("",i).width;return{wordsWithComputedWidth:s,spaceWidth:a}}catch(e){return null}},tD=e=>[{words:null==e?[]:e.toString().split(tj)}],tR="#808080",tz=(0,Q.forwardRef)((e,t)=>{var r,{x:i=0,y:n=0,lineHeight:s="1em",capHeight:a="0.71em",scaleToFit:o=!1,textAnchor:l="start",verticalAnchor:u="end",fill:c=tR}=e,h=tL(e,tC),f=(0,Q.useMemo)(()=>(e=>{var{width:t,scaleToFit:r,children:i,style:n,breakAll:s,maxLines:a}=e;if((t||r)&&!tf.isSsr){var o=tN({breakAll:s,children:i,style:n});if(!o)return tD(i);var{wordsWithComputedWidth:l,spaceWidth:u}=o;return((e,t,r,i,n)=>{var s,{maxLines:a,children:o,style:l,breakAll:u}=e,c=eW(a),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((e,t)=>{var{word:s,width:a}=t,o=e[e.length-1];return o&&(null==i||n||o.width+a+r<Number(i))?(o.words.push(s),o.width+=a+r):e.push({words:[s],width:a}),e},[])},f=h(t),d=e=>e.reduce((e,t)=>e.width>t.width?e:t);if(!c||n||!(f.length>a||d(f).width>Number(i)))return f;for(var p=e=>{var t=h(tN({breakAll:u,style:l,children:o.slice(0,e)+""}).wordsWithComputedWidth);return[t.length>a||d(t).width>Number(i),t]},g=0,m=o.length-1,y=0;g<=m&&y<=o.length-1;){var v=Math.floor((g+m)/2),[b,x]=p(v-1),[_]=p(v);if(b||_||(g=v+1),b&&_&&(m=v-1),!b&&_){s=x;break}y++}return s||f})({breakAll:s,children:i,maxLines:a,style:n},l,u,t,r)}return tD(i)})({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:o,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,o,h.style,h.width]),{dx:d,dy:p,angle:g,className:m,breakAll:y}=h,v=tL(h,tO);if(!eG(i)||!eG(n)||0===f.length)return null;var b=i+(eW(d)?d:0),x=n+(eW(p)?p:0);switch(u){case"start":r=tT("calc(".concat(a,")"));break;case"middle":r=tT("calc(".concat((f.length-1)/2," * -").concat(s," + (").concat(a," / 2))"));break;default:r=tT("calc(".concat(f.length-1," * -").concat(s,")"))}var _=[];if(o){var w=f[0].width,{width:k}=h;_.push("scale(".concat(eW(k)?k/w:1,")"))}return g&&_.push("rotate(".concat(g,", ").concat(b,", ").concat(x,")")),_.length&&(v.transform=_.join(" ")),Q.createElement("text",tI({},ta(v),{ref:t,x:b,y:x,className:(0,ea.clsx)("recharts-text",m),textAnchor:l,fill:c.includes("url")?tR:c}),f.map((e,t)=>{var i=e.words.join(y?"":" ");return Q.createElement("tspan",{x:b,dy:0===t?r:s,key:"".concat(i,"-").concat(t)},i)}))});function tF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function tB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tF(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}tz.displayName="Text";var tU=Math.PI/180,t$=(e,t,r,i)=>({x:e+Math.cos(-tU*i)*r,y:t+Math.sin(-tU*i)*r}),tV=e.i(30224),tW=(0,Q.createContext)(null),tG=e=>e,tq=()=>{var e=(0,Q.useContext)(tW);return e?e.store.dispatch:tG},tH=()=>{},tK=()=>tH,tY=(e,t)=>e===t;function tZ(e){var t=(0,Q.useContext)(tW);return(0,tV.useSyncExternalStoreWithSelector)(t?t.subscription.addNestedSub:tK,t?t.store.getState:tH,t?t.store.getState:tH,t?e:tH,tY)}var tX=e.i(47167),tJ=Symbol.for("immer-nothing"),tQ=Symbol.for("immer-draftable"),t0=Symbol.for("immer-state");function t1(e){throw Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var t2=Object.getPrototypeOf;function t3(e){return!!e&&!!e[t0]}function t4(e){return!!e&&(t8(e)||Array.isArray(e)||!!e[tQ]||!!e.constructor?.[tQ]||rr(e)||ri(e))}var t6=Object.prototype.constructor.toString(),t5=new WeakMap;function t8(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);if(null===t||t===Object.prototype)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(r===Object)return!0;if("function"!=typeof r)return!1;let i=t5.get(r);return void 0===i&&(i=Function.toString.call(r),t5.set(r,i)),i===t6}function t7(e,t,r=!0){0===t9(e)?(r?Reflect.ownKeys(e):Object.keys(e)).forEach(r=>{t(r,e[r],e)}):e.forEach((r,i)=>t(i,r,e))}function t9(e){let t=e[t0];return t?t.type_:Array.isArray(e)?1:rr(e)?2:3*!!ri(e)}function re(e,t){return 2===t9(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function rt(e,t,r){let i=t9(e);2===i?e.set(t,r):3===i?e.add(r):e[t]=r}function rr(e){return e instanceof Map}function ri(e){return e instanceof Set}function rn(e){return e.copy_||e.base_}function rs(e,t){if(rr(e))return new Map(e);if(ri(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=t8(e);if(!0!==t&&("class_only"!==t||r)){let t=t2(e);return null!==t&&r?{...e}:Object.assign(Object.create(t),e)}{let t=Object.getOwnPropertyDescriptors(e);delete t[t0];let r=Reflect.ownKeys(t);for(let i=0;i<r.length;i++){let n=r[i],s=t[n];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[n]})}return Object.create(t2(e),t)}}function ra(e,t=!1){return rl(e)||t3(e)||!t4(e)||(t9(e)>1&&Object.defineProperties(e,{set:ro,add:ro,clear:ro,delete:ro}),Object.freeze(e),t&&Object.values(e).forEach(e=>ra(e,!0))),e}var ro={value:function(){t1(2)}};function rl(e){return null===e||"object"!=typeof e||Object.isFrozen(e)}var ru={};function rc(e){let t=ru[e];return t||t1(0,e),t}function rh(e,t){t&&(rc("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function rf(e){rd(e),e.drafts_.forEach(rg),e.drafts_=null}function rd(e){e===L&&(L=e.parent_)}function rp(e){return L={drafts_:[],parent_:L,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function rg(e){let t=e[t0];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function rm(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return void 0!==e&&e!==r?(r[t0].modified_&&(rf(t),t1(4)),t4(e)&&(e=ry(t,e),t.parent_||rb(t,e)),t.patches_&&rc("Patches").generateReplacementPatches_(r[t0].base_,e,t.patches_,t.inversePatches_)):e=ry(t,r,[]),rf(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==tJ?e:void 0}function ry(e,t,r){if(rl(t))return t;let i=e.immer_.shouldUseStrictIteration(),n=t[t0];if(!n)return t7(t,(i,s)=>rv(e,n,t,i,s,r),i),t;if(n.scope_!==e)return t;if(!n.modified_)return rb(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let t=n.copy_,s=t,a=!1;3===n.type_&&(s=new Set(t),t.clear(),a=!0),t7(s,(i,s)=>rv(e,n,t,i,s,r,a),i),rb(e,t,!1),r&&e.patches_&&rc("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function rv(e,t,r,i,n,s,a){if(null==n||"object"!=typeof n&&!a)return;let o=rl(n);if(!o||a){if(t3(n)){let a=ry(e,n,s&&t&&3!==t.type_&&!re(t.assigned_,i)?s.concat(i):void 0);if(rt(r,i,a),!t3(a))return;e.canAutoFreeze_=!1}else a&&r.add(n);if(t4(n)&&!o){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[i]===n&&o)return;ry(e,n),(!t||!t.scope_.parent_)&&"symbol"!=typeof i&&(rr(r)?r.has(i):Object.prototype.propertyIsEnumerable.call(r,i))&&rb(e,n)}}}function rb(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ra(t,r)}var rx={get(e,t){if(t===t0)return e;let r=rn(e);if(!re(r,t)){var i;let n;return i=e,(n=rk(r,t))?"value"in n?n.value:n.get?.call(i.draft_):void 0}let n=r[t];return e.finalized_||!t4(n)?n:n===rw(e.base_,t)?(rS(e),e.copy_[t]=rE(n,e)):n},has:(e,t)=>t in rn(e),ownKeys:e=>Reflect.ownKeys(rn(e)),set(e,t,r){let i=rk(rn(e),t);if(i?.set)return i.set.call(e.draft_,r),!0;if(!e.modified_){let i=rw(rn(e),t),n=i?.[t0];if(n&&n.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||re(e.base_,t)))return!0;rS(e),rP(e)}return!!(e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t]))||(e.copy_[t]=r,e.assigned_[t]=!0,!0)},deleteProperty:(e,t)=>(void 0!==rw(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,rS(e),rP(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){let r=rn(e),i=Reflect.getOwnPropertyDescriptor(r,t);return i?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:i.enumerable,value:r[t]}:i},defineProperty(){t1(11)},getPrototypeOf:e=>t2(e.base_),setPrototypeOf(){t1(12)}},r_={};function rw(e,t){let r=e[t0];return(r?rn(r):e)[t]}function rk(e,t){if(!(t in e))return;let r=t2(e);for(;r;){let e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=t2(r)}}function rP(e){!e.modified_&&(e.modified_=!0,e.parent_&&rP(e.parent_))}function rS(e){e.copy_||(e.copy_=rs(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function rE(e,t){let r=rr(e)?rc("MapSet").proxyMap_(e,t):ri(e)?rc("MapSet").proxySet_(e,t):function(e,t){let r=Array.isArray(e),i={type_:+!!r,scope_:t?t.scope_:L,modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},n=i,s=rx;r&&(n=[i],s=r_);let{revoke:a,proxy:o}=Proxy.revocable(n,s);return i.draft_=o,i.revoke_=a,o}(e,t);return(t?t.scope_:L).drafts_.push(r),r}function rA(e){return t3(e)||t1(10,e),function e(t){let r;if(!t4(t)||rl(t))return t;let i=t[t0],n=!0;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,r=rs(t,i.scope_.immer_.useStrictShallowCopy_),n=i.scope_.immer_.shouldUseStrictIteration()}else r=rs(t,!0);return t7(r,(t,i)=>{rt(r,t,e(i))},n),i&&(i.finalized_=!1),r}(e)}t7(rx,(e,t)=>{r_[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),r_.deleteProperty=function(e,t){return r_.set.call(this,e,t,void 0)},r_.set=function(e,t,r){return rx.set.call(this,e[0],t,r,e[0])};var rM=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,r)=>{let i;if("function"==typeof e&&"function"!=typeof t){let r=t;t=e;let i=this;return function(e=r,...n){return i.produce(e,e=>t.call(this,e,...n))}}if("function"!=typeof t&&t1(6),void 0!==r&&"function"!=typeof r&&t1(7),t4(e)){let n=rp(this),s=rE(e,void 0),a=!0;try{i=t(s),a=!1}finally{a?rf(n):rd(n)}return rh(n,r),rm(i,n)}if(e&&"object"==typeof e)t1(1,e);else{if(void 0===(i=t(e))&&(i=e),i===tJ&&(i=void 0),this.autoFreeze_&&ra(i,!0),r){let t=[],n=[];rc("Patches").generateReplacementPatches_(e,i,t,n),r(t,n)}return i}},this.produceWithPatches=(e,t)=>{let r,i;return"function"==typeof e?(t,...r)=>this.produceWithPatches(t,t=>e(t,...r)):[this.produce(e,t,(e,t)=>{r=e,i=t}),r,i]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),"boolean"==typeof e?.useStrictIteration&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){t4(e)||t1(8),t3(e)&&(e=rA(e));let t=rp(this),r=rE(e,void 0);return r[t0].isManual_=!0,rd(t),r}finishDraft(e,t){let r=e&&e[t0];r&&r.isManual_||t1(9);let{scope_:i}=r;return rh(i,t),rm(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}r>-1&&(t=t.slice(r+1));let i=rc("Patches").applyPatches_;return t3(e)?i(e,t):this.produce(e,e=>i(e,t))}}().produce,rT=e=>Array.isArray(e)?e:[e],rC=0,rO=class{revision=rC;_value;_lastValue;_isEqual=rI;constructor(e,t=rI){this._value=this._lastValue=e,this._isEqual=t}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.revision=++rC)}};function rI(e,t){return e===t}function rL(e){return e instanceof rO||console.warn("Not a valid cell! ",e),e.value}var rj=(e,t)=>!1;function rN(){return function(e,t=rI){return new rO(null,t)}(0,rj)}var rD=e=>{let t=e.collectionTag;null===t&&(t=e.collectionTag=rN()),rL(t)};Symbol();var rR=0,rz=Object.getPrototypeOf({}),rF=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy(this,rB);tag=rN();tags={};children={};collectionTag=null;id=rR++},rB={get:(e,t)=>(function(){let{value:r}=e,i=Reflect.get(r,t);if("symbol"==typeof t||t in rz)return i;if("object"==typeof i&&null!==i){var n;let r=e.children[t];return void 0===r&&(r=e.children[t]=Array.isArray(n=i)?new rU(n):new rF(n)),r.tag&&rL(r.tag),r.proxy}{let r=e.tags[t];return void 0===r&&((r=e.tags[t]=rN()).value=i),rL(r),i}})(),ownKeys:e=>(rD(e),Reflect.ownKeys(e.value)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e.value,t),has:(e,t)=>Reflect.has(e.value,t)},rU=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy([this],r$);tag=rN();tags={};children={};collectionTag=null;id=rR++},r$={get:([e],t)=>("length"===t&&rD(e),rB.get(e,t)),ownKeys:([e])=>rB.ownKeys(e),getOwnPropertyDescriptor:([e],t)=>rB.getOwnPropertyDescriptor(e,t),has:([e],t)=>rB.has(e,t)},rV="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function rW(){return{s:0,v:void 0,o:null,p:null}}function rG(e,t={}){let r,i=rW(),{resultEqualityCheck:n}=t,s=0;function a(){let t,a=i,{length:o}=arguments;for(let e=0;e<o;e++){let t=arguments[e];if("function"==typeof t||"object"==typeof t&&null!==t){let e=a.o;null===e&&(a.o=e=new WeakMap);let r=e.get(t);void 0===r?(a=rW(),e.set(t,a)):a=r}else{let e=a.p;null===e&&(a.p=e=new Map);let r=e.get(t);void 0===r?(a=rW(),e.set(t,a)):a=r}}let l=a;if(1===a.s)t=a.v;else if(t=e.apply(null,arguments),s++,n){let e=r?.deref?.()??r;null!=e&&n(e,t)&&(t=e,0!==s&&s--),r="object"==typeof t&&null!==t||"function"==typeof t?new rV(t):t}return l.s=1,l.v=t,t}return a.clearCache=()=>{i=rW(),a.resetResultsCount()},a.resultsCount=()=>s,a.resetResultsCount=()=>{s=0},a}var rq=function(e,...t){let r="function"==typeof e?{memoize:e,memoizeOptions:t}:e,i=(...e)=>{let t,i,n=0,s=0,a={},o=e.pop();"object"==typeof o&&(a=o,o=e.pop()),function(e,t=`expected a function, instead received ${typeof e}`){if("function"!=typeof e)throw TypeError(t)}(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);let{memoize:l,memoizeOptions:u=[],argsMemoize:c=rG,argsMemoizeOptions:h=[],devModeChecks:f={}}={...r,...a},d=rT(u),p=rT(h),g=(!function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(e=>"function"==typeof e)){let r=e.map(e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e).join(", ");throw TypeError(`${t}[${r}]`)}}(t=Array.isArray(e[0])?e[0]:e,"createSelector expects all input-selectors to be functions, but received the following types: "),t),m=l(function(){return n++,o.apply(null,arguments)},...d);return Object.assign(c(function(){s++;let e=function(e,t){let r=[],{length:i}=e;for(let n=0;n<i;n++)r.push(e[n].apply(null,t));return r}(g,arguments);return i=m.apply(null,e)},...p),{resultFunc:o,memoizedResultFunc:m,dependencies:g,dependencyRecomputations:()=>s,resetDependencyRecomputations:()=>{s=0},lastResult:()=>i,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:l,argsMemoize:c})};return Object.assign(i,{withTypes:()=>i}),i}(rG),rH=Object.assign((e,t=rq)=>{!function(e,t=`expected an object, instead received ${typeof e}`){if("object"!=typeof e)throw TypeError(t)}(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);let r=Object.keys(e);return t(r.map(t=>e[t]),(...e)=>e.reduce((e,t,i)=>(e[r[i]]=t,e),{}))},{withTypes:()=>rH});function rK(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var rY="function"==typeof Symbol&&Symbol.observable||"@@observable",rZ=()=>Math.random().toString(36).substring(7).split("").join("."),rX={INIT:`@@redux/INIT${rZ()}`,REPLACE:`@@redux/REPLACE${rZ()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${rZ()}`};function rJ(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function rQ(e){let t,r=Object.keys(e),i={};for(let t=0;t<r.length;t++){let n=r[t];"function"==typeof e[n]&&(i[n]=e[n])}let n=Object.keys(i);try{Object.keys(i).forEach(e=>{let t=i[e];if(void 0===t(void 0,{type:rX.INIT}))throw Error(rK(12));if(void 0===t(void 0,{type:rX.PROBE_UNKNOWN_ACTION()}))throw Error(rK(13))})}catch(e){t=e}return function(e={},r){if(t)throw t;let s=!1,a={};for(let t=0;t<n.length;t++){let o=n[t],l=i[o],u=e[o],c=l(u,r);if(void 0===c)throw r&&r.type,Error(rK(14));a[o]=c,s=s||c!==u}return(s=s||n.length!==Object.keys(e).length)?a:e}}function r0(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...r)=>e(t(...r)))}function r1(e){return rJ(e)&&"type"in e&&"string"==typeof e.type}function r2(e){return({dispatch:t,getState:r})=>i=>n=>"function"==typeof n?n(t,r,e):i(n)}var r3=r2(),r4="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!=arguments.length)return"object"==typeof arguments[0]?r0:r0.apply(null,arguments)};function r6(e,t){function r(...i){if(t){let r=t(...i);if(!r)throw Error(iU(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:i[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=t=>r1(t)&&t.type===e,r}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var r5=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function r8(e){return t4(e)?rM(e,()=>{}):e}function r7(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}var r9="RTK_autoBatch",ie=()=>e=>({payload:e,meta:{[r9]:!0}}),it=e=>t=>{setTimeout(t,e)},ir=(e={type:"raf"})=>t=>(...r)=>{let i=t(...r),n=!0,s=!1,a=!1,o=new Set,l="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:it(10):"callback"===e.type?e.queueNotification:it(e.timeout),u=()=>{a=!1,s&&(s=!1,o.forEach(e=>e()))};return Object.assign({},i,{subscribe(e){let t=i.subscribe(()=>n&&e());return o.add(e),()=>{t(),o.delete(e)}},dispatch(e){try{return(s=!(n=!e?.meta?.[r9]))&&!a&&(a=!0,l(u)),i.dispatch(e)}finally{n=!0}}})};function ii(e){let t,r={},i=[],n={addCase(e,t){let i="string"==typeof e?e:e.type;if(!i)throw Error(iU(28));if(i in r)throw Error(iU(29));return r[i]=t,n},addAsyncThunk:(e,t)=>(t.pending&&(r[e.pending.type]=t.pending),t.rejected&&(r[e.rejected.type]=t.rejected),t.fulfilled&&(r[e.fulfilled.type]=t.fulfilled),t.settled&&i.push({matcher:e.settled,reducer:t.settled}),n),addMatcher:(e,t)=>(i.push({matcher:e,reducer:t}),n),addDefaultCase:e=>(t=e,n)};return e(n),[r,i,t]}var is=Symbol.for("rtk-slice-createasyncthunk"),ia=((x=ia||{}).reducer="reducer",x.reducerWithPrepare="reducerWithPrepare",x.asyncThunk="asyncThunk",x),io=function({creators:e}={}){let t=e?.asyncThunk?.[is];return function(e){let r,{name:i,reducerPath:n=i}=e;if(!i)throw Error(iU(11));let s=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},a=Object.keys(s),o={},l={},u={},c=[],h={addCase(e,t){let r="string"==typeof e?e:e.type;if(!r)throw Error(iU(12));if(r in l)throw Error(iU(13));return l[r]=t,h},addMatcher:(e,t)=>(c.push({matcher:e,reducer:t}),h),exposeAction:(e,t)=>(u[e]=t,h),exposeCaseReducer:(e,t)=>(o[e]=t,h)};function f(){let[t={},r=[],i]="function"==typeof e.extraReducers?ii(e.extraReducers):[e.extraReducers],n={...t,...l};return function(e,t){let r,[i,n,s]=ii(t);if("function"==typeof e)r=()=>r8(e());else{let t=r8(e);r=()=>t}function a(e=r(),t){let o=[i[t.type],...n.filter(({matcher:e})=>e(t)).map(({reducer:e})=>e)];return 0===o.filter(e=>!!e).length&&(o=[s]),o.reduce((e,r)=>{if(r)if(t3(e)){let i=r(e,t);return void 0===i?e:i}else{if(t4(e))return rM(e,e=>r(e,t));let i=r(e,t);if(void 0===i){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return i}return e},e)}return a.getInitialState=r,a}(e.initialState,e=>{for(let t in n)e.addCase(t,n[t]);for(let t of c)e.addMatcher(t.matcher,t.reducer);for(let t of r)e.addMatcher(t.matcher,t.reducer);i&&e.addDefaultCase(i)})}a.forEach(r=>{let n=s[r],a={reducerName:r,type:`${i}/${r}`,createNotation:"function"==typeof e.reducers};"asyncThunk"===n._reducerDefinitionType?function({type:e,reducerName:t},r,i,n){if(!n)throw Error(iU(18));let{payloadCreator:s,fulfilled:a,pending:o,rejected:l,settled:u,options:c}=r,h=n(e,s,c);i.exposeAction(t,h),a&&i.addCase(h.fulfilled,a),o&&i.addCase(h.pending,o),l&&i.addCase(h.rejected,l),u&&i.addMatcher(h.settled,u),i.exposeCaseReducer(t,{fulfilled:a||il,pending:o||il,rejected:l||il,settled:u||il})}(a,n,h,t):function({type:e,reducerName:t,createNotation:r},i,n){let s,a;if("reducer"in i){if(r&&"reducerWithPrepare"!==i._reducerDefinitionType)throw Error(iU(17));s=i.reducer,a=i.prepare}else s=i;n.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,a?r6(e,a):r6(e))}(a,n,h)});let d=e=>e,p=new Map,g=new WeakMap;function m(e,t){return r||(r=f()),r(e,t)}function y(){return r||(r=f()),r.getInitialState()}function v(t,r=!1){function i(e){let n=e[t];return void 0===n&&r&&(n=r7(g,i,y)),n}function n(t=d){let i=r7(p,r,()=>new WeakMap);return r7(i,t,()=>{let i={};for(let[n,s]of Object.entries(e.selectors??{}))i[n]=function(e,t,r,i){function n(s,...a){let o=t(s);return void 0===o&&i&&(o=r()),e(o,...a)}return n.unwrapped=e,n}(s,t,()=>r7(g,t,y),r);return i})}return{reducerPath:t,getSelectors:n,get selectors(){return n(i)},selectSlice:i}}let b={name:i,reducer:m,actions:u,caseReducers:o,getInitialState:y,...v(n),injectInto(e,{reducerPath:t,...r}={}){let i=t??n;return e.inject({reducerPath:i,reducer:m},r),{...b,...v(i,!0)}}};return b}}();function il(){}var iu="listener",ic="completed",ih="cancelled",id=`task-${ih}`,ip=`task-${ic}`,ig=`${iu}-${ih}`,im=`${iu}-${ic}`,iy=class{constructor(e){this.code=e,this.message=`task ${ih} (reason: ${e})`}name="TaskAbortError";message},iv=(e,t)=>{if("function"!=typeof e)throw TypeError(iU(32))},ib=()=>{},ix=(e,t=ib)=>(e.catch(t),e),i_=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),iw=(e,t)=>{let r=e.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},ik=e=>{if(e.aborted){let{reason:t}=e;throw new iy(t)}};function iP(e,t){let r=ib;return new Promise((i,n)=>{let s=()=>n(new iy(e.reason));e.aborted?s():(r=i_(e,s),t.finally(()=>r()).then(i,n))}).finally(()=>{r=ib})}var iS=async(e,t)=>{try{await Promise.resolve();let t=await e();return{status:"ok",value:t}}catch(e){return{status:e instanceof iy?"cancelled":"rejected",error:e}}finally{t?.()}},iE=e=>t=>ix(iP(e,t).then(t=>(ik(e),t))),iA=e=>{let t=iE(e);return e=>t(new Promise(t=>setTimeout(t,e)))},{assign:iM}=Object,iT={},iC="listenerMiddleware",iO=e=>{let{type:t,actionCreator:r,matcher:i,predicate:n,effect:s}=e;if(t)n=r6(t).match;else if(r)t=r.type,n=r.match;else if(i)n=i;else if(n);else throw Error(iU(21));return iv(s,"options.listener"),{predicate:n,type:t,effect:s}},iI=iM(e=>{let{type:t,predicate:r,effect:i}=iO(e);return{id:((e=21)=>{let t="",r=e;for(;r--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t})(),effect:i,type:t,predicate:r,pending:new Set,unsubscribe:()=>{throw Error(iU(22))}}},{withTypes:()=>iI}),iL=(e,t)=>{let{type:r,effect:i,predicate:n}=iO(t);return Array.from(e.values()).find(e=>("string"==typeof r?e.type===r:e.predicate===n)&&e.effect===i)},ij=e=>{e.pending.forEach(e=>{iw(e,ig)})},iN=(e,t,r)=>{try{e(t,r)}catch(e){setTimeout(()=>{throw e},0)}},iD=iM(r6(`${iC}/add`),{withTypes:()=>iD}),iR=r6(`${iC}/removeAll`),iz=iM(r6(`${iC}/remove`),{withTypes:()=>iz}),iF=(...e)=>{console.error(`${iC}/error`,...e)},iB=(e={})=>{let t=new Map,r=new Map,{extra:i,onError:n=iF}=e;iv(n,"onError");let s=e=>{var r;return(r=iL(t,e)??iI(e)).unsubscribe=()=>t.delete(r.id),t.set(r.id,r),e=>{r.unsubscribe(),e?.cancelActive&&ij(r)}};iM(s,{withTypes:()=>s});let a=e=>{let r=iL(t,e);return r&&(r.unsubscribe(),e.cancelActive&&ij(r)),!!r};iM(a,{withTypes:()=>a});let o=async(e,a,o,l)=>{var u,c;let h,f=new AbortController,d=(u=f.signal,h=async(e,t)=>{ik(u);let r=()=>{},i=[new Promise((t,i)=>{let n=s({predicate:e,effect:(e,r)=>{r.unsubscribe(),t([e,r.getState(),r.getOriginalState()])}});r=()=>{n(),i()}})];null!=t&&i.push(new Promise(e=>setTimeout(e,t,null)));try{let e=await iP(u,Promise.race(i));return ik(u),e}finally{r()}},(e,t)=>ix(h(e,t))),p=[];try{let n;e.pending.add(f),n=r.get(e)??0,r.set(e,n+1),await Promise.resolve(e.effect(a,iM({},o,{getOriginalState:l,condition:(e,t)=>d(e,t).then(Boolean),take:d,delay:iA(f.signal),pause:iE(f.signal),extra:i,signal:f.signal,fork:(c=f.signal,(e,t)=>{iv(e,"taskExecutor");let r=new AbortController;i_(c,()=>iw(r,c.reason));let i=iS(async()=>{ik(c),ik(r.signal);let t=await e({pause:iE(r.signal),delay:iA(r.signal),signal:r.signal});return ik(r.signal),t},()=>iw(r,ip));return t?.autoJoin&&p.push(i.catch(ib)),{result:iE(c)(i),cancel(){iw(r,id)}}}),unsubscribe:e.unsubscribe,subscribe:()=>{t.set(e.id,e)},cancelActiveListeners:()=>{e.pending.forEach((e,t,r)=>{e!==f&&(iw(e,ig),r.delete(e))})},cancel:()=>{iw(f,ig),e.pending.delete(f)},throwIfCancelled:()=>{ik(f.signal)}})))}catch(e){e instanceof iy||iN(n,e,{raisedBy:"effect"})}finally{let t;await Promise.all(p),iw(f,im),1===(t=r.get(e)??1)?r.delete(e):r.set(e,t-1),e.pending.delete(f)}},l=()=>{for(let e of r.keys())ij(e);t.clear()};return{middleware:e=>r=>i=>{let u;if(!r1(i))return r(i);if(iD.match(i))return s(i.payload);if(iR.match(i))return void l();if(iz.match(i))return a(i.payload);let c=e.getState(),h=()=>{if(c===iT)throw Error(iU(23));return c};try{if(u=r(i),t.size>0){let r=e.getState();for(let s of Array.from(t.values())){let t=!1;try{t=s.predicate(i,r,c)}catch(e){t=!1,iN(n,e,{raisedBy:"predicate"})}t&&o(s,i,e,h)}}}finally{c=iT}return u},startListening:s,stopListening:a,clearListeners:l}};function iU(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Symbol.for("rtk-state-proxy-original");var i$=io({name:"chartLayout",initialState:{layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var r,i,n,s;e.margin.top=null!=(r=t.payload.top)?r:0,e.margin.right=null!=(i=t.payload.right)?i:0,e.margin.bottom=null!=(n=t.payload.bottom)?n:0,e.margin.left=null!=(s=t.payload.left)?s:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:iV,setLayout:iW,setChartSize:iG,setScale:iq}=i$.actions,iH=i$.reducer,iK=e.i(42342),iY=e=>e.legend.settings;function iZ(e,t){if((n=e.length)>1)for(var r,i,n,s=1,a=e[t[0]],o=a.length;s<n;++s)for(i=a,a=e[t[s]],r=0;r<o;++r)a[r][1]+=a[r][0]=isNaN(i[r][1])?i[r][0]:i[r][1]}function iX(e){for(var t=e.length,r=Array(t);--t>=0;)r[t]=t;return r}function iJ(e,t){return e[t]}function iQ(e){let t=[];return t.key=e,t}function i0(e,t,r){return Array.isArray(e)&&e&&t+r!==0?e.slice(t,r+1):e}function i1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function i2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i1(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i3(e,t,r){return null==e||null==t?r:eG(t)?(0,eB.default)(e,t,r):"function"==typeof t?t(e):r}rq([e=>e.legend.payload,iY],(e,t)=>{var{itemSorter:r}=t,i=e.flat(1);return r?(0,iK.default)(i,r):i});var i4=(e,t)=>"horizontal"===e&&"xAxis"===t||"vertical"===e&&"yAxis"===t||"centric"===e&&"angleAxis"===t||"radial"===e&&"radiusAxis"===t,i6=(e,t,r,i)=>{if(i)return e.map(e=>e.coordinate);var n,s,a=e.map(e=>(e.coordinate===t&&(n=!0),e.coordinate===r&&(s=!0),e.coordinate));return n||a.push(t),s||a.push(r),a},i5=(e,t,r)=>{if(!e)return null;var{duplicateDomain:i,type:n,range:s,scale:a,realScaleType:o,isCategorical:l,categoricalDomain:u,tickCount:c,ticks:h,niceTicks:f,axisType:d}=e;if(!a)return null;var p="scaleBand"===o&&a.bandwidth?a.bandwidth()/2:2,g=(t||r)&&"category"===n&&a.bandwidth?a.bandwidth()/p:0;return(g="angleAxis"===d&&s&&s.length>=2?2*eU(s[0]-s[1])*g:g,t&&(h||f))?(h||f||[]).map((e,t)=>({coordinate:a(i?i.indexOf(e):e)+g,value:e,offset:g,index:t})).filter(e=>!e$(e.coordinate)):l&&u?u.map((e,t)=>({coordinate:a(e)+g,value:e,index:t,offset:g})):a.ticks&&!r&&null!=c?a.ticks(c).map((e,t)=>({coordinate:a(e)+g,value:e,offset:g,index:t})):a.domain().map((e,t)=>({coordinate:a(e)+g,value:i?i[e]:e,index:t,offset:g}))},i8={sign:e=>{var t=e.length;if(!(t<=0))for(var r=0,i=e[0].length;r<i;++r)for(var n=0,s=0,a=0;a<t;++a){var o=e$(e[a][r][1])?e[a][r][0]:e[a][r][1];o>=0?(e[a][r][0]=n,e[a][r][1]=n+o,n=e[a][r][1]):(e[a][r][0]=s,e[a][r][1]=s+o,s=e[a][r][1])}},expand:function(e,t){if((i=e.length)>0){for(var r,i,n,s=0,a=e[0].length;s<a;++s){for(n=r=0;r<i;++r)n+=e[r][s][1]||0;if(n)for(r=0;r<i;++r)e[r][s][1]/=n}iZ(e,t)}},none:iZ,silhouette:function(e,t){if((r=e.length)>0){for(var r,i=0,n=e[t[0]],s=n.length;i<s;++i){for(var a=0,o=0;a<r;++a)o+=e[a][i][1]||0;n[i][1]+=n[i][0]=-o/2}iZ(e,t)}},wiggle:function(e,t){if((n=e.length)>0&&(i=(r=e[t[0]]).length)>0){for(var r,i,n,s=0,a=1;a<i;++a){for(var o=0,l=0,u=0;o<n;++o){for(var c=e[t[o]],h=c[a][1]||0,f=(h-(c[a-1][1]||0))/2,d=0;d<o;++d){var p=e[t[d]];f+=(p[a][1]||0)-(p[a-1][1]||0)}l+=h,u+=f*h}r[a-1][1]+=r[a-1][0]=s,l&&(s-=u/l)}r[a-1][1]+=r[a-1][0]=s,iZ(e,t)}},positive:e=>{var t=e.length;if(!(t<=0))for(var r=0,i=e[0].length;r<i;++r)for(var n=0,s=0;s<t;++s){var a=e$(e[s][r][1])?e[s][r][0]:e[s][r][1];a>=0?(e[s][r][0]=n,e[s][r][1]=n+a,n=e[s][r][1]):(e[s][r][0]=0,e[s][r][1]=0)}}};function i7(e){var{axis:t,ticks:r,bandSize:i,entry:n,index:s,dataKey:a}=e;if("category"===t.type){if(!t.allowDuplicatedCategory&&t.dataKey&&null!=n[t.dataKey]){var o=eX(r,"value",n[t.dataKey]);if(o)return o.coordinate+i/2}return r[s]?r[s].coordinate+i/2:null}var l=i3(n,null==a?t.dataKey:a);return null==l?null:t.scale(l)}var i9=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,ne=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nt=(e,t,r)=>{if(e&&e.scale&&e.scale.bandwidth){var i=e.scale.bandwidth();if(!r||i>0)return i}if(e&&t&&t.length>=2){for(var n=(0,iK.default)(t,e=>e.coordinate),s=1/0,a=1,o=n.length;a<o;a++){var l=n[a],u=n[a-1];s=Math.min((l.coordinate||0)-(u.coordinate||0),s)}return s===1/0?0:s}return r?void 0:0};function nr(e){var{tooltipEntrySettings:t,dataKey:r,payload:i,value:n,name:s}=e;return i2(i2({},t),{},{dataKey:r,payload:i,value:n,name:s})}function ni(e,t){return e?String(e):"string"==typeof t?t:void 0}var nn=e=>e.layout.width,ns=e=>e.layout.height,na=e=>e.layout.scale,no=e=>e.layout.margin,nl=rq(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),nu=rq(e=>e.cartesianAxis.yAxis,e=>Object.values(e));function nc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function nh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var nf=rq([nn,ns,no,e=>e.brush.height,function(e){return nu(e).reduce((e,t)=>"left"!==t.orientation||t.mirror||t.hide?e:e+("number"==typeof t.width?t.width:60),0)},function(e){return nu(e).reduce((e,t)=>"right"!==t.orientation||t.mirror||t.hide?e:e+("number"==typeof t.width?t.width:60),0)},function(e){return nl(e).reduce((e,t)=>"top"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},function(e){return nl(e).reduce((e,t)=>"bottom"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},iY,e=>e.legend.size],(e,t,r,i,n,s,a,o,l,u)=>{var c={left:(r.left||0)+n,right:(r.right||0)+s},h=nh(nh({},{top:(r.top||0)+a,bottom:(r.bottom||0)+o}),c),f=h.bottom;h.bottom+=i;var d=e-(h=((e,t,r)=>{if(t&&r){var{width:i,height:n}=r,{align:s,verticalAlign:a,layout:o}=t;if(("vertical"===o||"horizontal"===o&&"middle"===a)&&"center"!==s&&eW(e[s]))return i2(i2({},e),{},{[s]:e[s]+(i||0)});if(("horizontal"===o||"vertical"===o&&"center"===s)&&"middle"!==a&&eW(e[a]))return i2(i2({},e),{},{[a]:e[a]+(n||0)})}return e})(h,l,u)).left-h.right,p=t-h.top-h.bottom;return nh(nh({brushBottom:f},h),{},{width:Math.max(d,0),height:Math.max(p,0)})}),nd=rq(nf,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),np=rq(nn,ns,(e,t)=>({x:0,y:0,width:e,height:t})),ng=(0,Q.createContext)(null),nm=()=>null!=(0,Q.useContext)(ng),ny=e=>e.brush,nv=rq([ny,nf,no],(e,t,r)=>({height:e.height,x:eW(e.x)?e.x:t.left,y:eW(e.y)?e.y:t.top+t.height+t.brushBottom-((null==r?void 0:r.bottom)||0),width:eW(e.width)?e.width:t.width})),nb=e.i(58723),nx=function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n]},n_=(e,t,r)=>{var{width:i="100%",height:n="100%",aspect:s,maxHeight:a}=r,o=eV(i)?e:Number(i),l=eV(n)?t:Number(n);return s&&s>0&&(o?l=o/s:l&&(o=l*s),a&&l>a&&(l=a)),{calculatedWidth:o,calculatedHeight:l}},nw={width:0,height:0,overflow:"visible"},nk={width:0,overflowX:"visible"},nP={height:0,overflowY:"visible"},nS={};function nE(){return(nE=Object.assign.bind()).apply(null,arguments)}function nA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function nM(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nA(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nA(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var nT=(0,Q.createContext)({width:-1,height:-1});function nC(e){var{children:t,width:r,height:i}=e,n=(0,Q.useMemo)(()=>({width:r,height:i}),[r,i]);return r<=0||i<=0?null:Q.createElement(nT.Provider,{value:n},t)}var nO=()=>(0,Q.useContext)(nT),nI=(0,Q.forwardRef)((e,t)=>{var{aspect:r,initialDimension:i={width:-1,height:-1},width:n,height:s,minWidth:a=0,minHeight:o,maxHeight:l,children:u,debounce:c=0,id:h,className:f,onResize:d,style:p={}}=e,g=(0,Q.useRef)(null),m=(0,Q.useRef)();m.current=d,(0,Q.useImperativeHandle)(t,()=>g.current);var[y,v]=(0,Q.useState)({containerWidth:i.width,containerHeight:i.height}),b=(0,Q.useCallback)((e,t)=>{v(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]);(0,Q.useEffect)(()=>{var e=e=>{var t,{width:r,height:i}=e[0].contentRect;b(r,i),null==(t=m.current)||t.call(m,r,i)};c>0&&(e=(0,nb.default)(e,c,{trailing:!0,leading:!1}));var t=new ResizeObserver(e),{width:r,height:i}=g.current.getBoundingClientRect();return b(r,i),t.observe(g.current),()=>{t.disconnect()}},[b,c]);var{containerWidth:x,containerHeight:_}=y;nx(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:w,calculatedHeight:k}=n_(x,_,{width:n,height:s,aspect:r,maxHeight:l});return nx(w>0||k>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",w,k,n,s,a,o,r),Q.createElement("div",{id:h?"".concat(h):void 0,className:(0,ea.clsx)("recharts-responsive-container",f),style:nM(nM({},p),{},{width:n,height:s,minWidth:a,minHeight:o,maxHeight:l}),ref:g},Q.createElement("div",{style:(e=>{var{width:t,height:r}=e,i=eV(t),n=eV(r);return i&&n?nw:i?nk:n?nP:nS})({width:n,height:s})},Q.createElement(nC,{width:w,height:k},u)))}),nL=(0,Q.forwardRef)((e,t)=>{var r=nO();if(e0(r.width)&&e0(r.height))return e.children;var{width:i,height:n}=function(e){var{width:t,height:r,aspect:i}=e,n=t,s=r;return void 0===n&&void 0===s?(n="100%",s="100%"):void 0===n?n=i&&i>0?void 0:"100%":void 0===s&&(s=i&&i>0?void 0:"100%"),{width:n,height:s}}({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:s,calculatedHeight:a}=n_(void 0,void 0,{width:i,height:n,aspect:e.aspect,maxHeight:e.maxHeight});return eW(s)&&eW(a)?Q.createElement(nC,{width:s,height:a},e.children):Q.createElement(nI,nE({},e,{width:i,height:n,ref:t}))}),nj=()=>{var e,t=nm(),r=tZ(nd),i=tZ(nv),n=null==(e=tZ(ny))?void 0:e.padding;return t&&i&&n?{width:i.width-n.left-n.right,height:i.height-n.top-n.bottom,x:n.left,y:n.top}:r},nN={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},nD=()=>{var e;return null!=(e=tZ(nf))?e:nN},nR=e=>e.layout.layoutType,nz=e=>{var t=tq(),r=nm(),{width:i,height:n}=e,s=nO(),a=i,o=n;return s&&(a=s.width>0?s.width:i,o=s.height>0?s.height:n),(0,Q.useEffect)(()=>{!r&&e0(a)&&e0(o)&&t(iG({width:a,height:o}))},[t,r,a,o]),null},nF="auto",nB="auto",nU=(e,t)=>{if(e&&t)return null!=e&&e.reversed?[t[1],t[0]]:t},n$={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nF,tick:!0,tickCount:void 0,ticks:void 0,type:"category",unit:void 0},nV={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nB,tick:!0,tickCount:5,ticks:void 0,type:"number",unit:void 0},nW={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nF,tick:!0,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},nG={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nB,tick:!0,tickCount:5,ticks:void 0,type:"category",unit:void 0},nq=(e,t)=>null!=e.polarAxis.angleAxis[t]?e.polarAxis.angleAxis[t]:"radial"===e.layout.layoutType?nW:n$,nH=(e,t)=>null!=e.polarAxis.radiusAxis[t]?e.polarAxis.radiusAxis[t]:"radial"===e.layout.layoutType?nG:nV,nK=e=>e.polarOptions,nY=rq([nn,ns,nf],function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{top:0,right:0,bottom:0,left:0,width:0,height:0,brushBottom:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(t-(r.top||0)-(r.bottom||0)))/2}),nZ=rq([nK,nY],(e,t)=>{if(null!=e)return eK(e.innerRadius,t,0)}),nX=rq([nK,nY],(e,t)=>{if(null!=e)return eK(e.outerRadius,t,.8*t)}),nJ=rq([nK],e=>{if(null==e)return[0,0];var{startAngle:t,endAngle:r}=e;return[t,r]});rq([nq,nJ],nU);var nQ=rq([nY,nZ,nX],(e,t,r)=>{if(null!=e&&null!=t&&null!=r)return[t,r]});rq([nH,nQ],nU);var n0=rq([nR,nK,nZ,nX,nn,ns],(e,t,r,i,n,s)=>{if(("centric"===e||"radial"===e)&&null!=t&&null!=r&&null!=i){var{cx:a,cy:o,startAngle:l,endAngle:u}=t;return{cx:eK(a,n,n/2),cy:eK(o,s,s/2),innerRadius:r,outerRadius:i,startAngle:l,endAngle:u,clockWise:!1}}});function n1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function n2(e,t){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n1(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e);return Object.keys(t).reduce((e,r)=>(void 0===e[r]&&void 0!==t[r]&&(e[r]=t[r]),e),r)}var n3=["labelRef"];function n4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function n6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n4(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n4(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function n5(){return(n5=Object.assign.bind()).apply(null,arguments)}var n8=(0,Q.createContext)(null),n7=e=>{var{x:t,y:r,width:i,height:n,children:s}=e,a=(0,Q.useMemo)(()=>({x:t,y:r,width:i,height:n}),[t,r,i,n]);return Q.createElement(n8.Provider,{value:a},s)},n9=()=>{var e=(0,Q.useContext)(n8),t=nj();return e||t},se=(0,Q.createContext)(null),st=e=>null!=e&&"function"==typeof e,sr=e=>"cx"in e&&eW(e.cx),si={offset:5};function sn(e){var t,r,i,n=n2(e,si),{viewBox:s,position:a,value:o,children:l,content:u,className:c="",textBreakAll:h,labelRef:f}=n,d=(t=(0,Q.useContext)(se),r=tZ(n0),t||r),p=n9(),g=s||("center"===a?p:null!=d?d:p);if(!g||null==o&&null==l&&!(0,Q.isValidElement)(u)&&"function"!=typeof u)return null;var m=n6(n6({},n),{},{viewBox:g});if((0,Q.isValidElement)(u)){var{labelRef:y}=m,v=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(m,n3);return(0,Q.cloneElement)(u,v)}if("function"==typeof u){if(i=(0,Q.createElement)(u,m),(0,Q.isValidElement)(i))return i}else i=(e=>{var{value:t,formatter:r}=e,i=null==e.children?t:e.children;return"function"==typeof r?r(i):i})(n);var b=sr(g),x=ta(n);if(b&&("insideStart"===a||"insideEnd"===a||"end"===a))return((e,t,r,i,n)=>{var s,a,{offset:o,className:l}=e,{cx:u,cy:c,innerRadius:h,outerRadius:f,startAngle:d,endAngle:p,clockWise:g}=n,m=(h+f)/2,y=eU(p-d)*Math.min(Math.abs(p-d),360),v=y>=0?1:-1;switch(t){case"insideStart":s=d+v*o,a=g;break;case"insideEnd":s=p-v*o,a=!g;break;case"end":s=p+v*o,a=g;break;default:throw Error("Unsupported position ".concat(t))}a=y<=0?a:!a;var b=t$(u,c,m,s),x=t$(u,c,m,s+(a?1:-1)*359),_="M".concat(b.x,",").concat(b.y,"\n    A").concat(m,",").concat(m,",0,1,").concat(+!a,",\n    ").concat(x.x,",").concat(x.y),w=null==e.id?eH("recharts-radial-line-"):e.id;return Q.createElement("text",n5({},i,{dominantBaseline:"central",className:(0,ea.clsx)("recharts-radial-bar-label",l)}),Q.createElement("defs",null,Q.createElement("path",{id:w,d:_})),Q.createElement("textPath",{xlinkHref:"#".concat(w)},r))})(n,a,i,x,g);var _=b?((e,t,r)=>{var{cx:i,cy:n,innerRadius:s,outerRadius:a,startAngle:o,endAngle:l}=e,u=(o+l)/2;if("outside"===r){var{x:c,y:h}=t$(i,n,a+t,u);return{x:c,y:h,textAnchor:c>=i?"start":"end",verticalAnchor:"middle"}}if("center"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"middle"};if("centerTop"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"start"};if("centerBottom"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"end"};var{x:f,y:d}=t$(i,n,(s+a)/2,u);return{x:f,y:d,textAnchor:"middle",verticalAnchor:"middle"}})(g,n.offset,n.position):((e,t)=>{var r,{parentViewBox:i,offset:n,position:s}=e;null==i||sr(i)||(r=i);var{x:a,y:o,width:l,height:u}=t,c=u>=0?1:-1,h=c*n,f=c>0?"end":"start",d=c>0?"start":"end",p=l>=0?1:-1,g=p*n,m=p>0?"end":"start",y=p>0?"start":"end";if("top"===s)return n6(n6({},{x:a+l/2,y:o-c*n,textAnchor:"middle",verticalAnchor:f}),r?{height:Math.max(o-r.y,0),width:l}:{});if("bottom"===s)return n6(n6({},{x:a+l/2,y:o+u+h,textAnchor:"middle",verticalAnchor:d}),r?{height:Math.max(r.y+r.height-(o+u),0),width:l}:{});if("left"===s){var v={x:a-g,y:o+u/2,textAnchor:m,verticalAnchor:"middle"};return n6(n6({},v),r?{width:Math.max(v.x-r.x,0),height:u}:{})}if("right"===s){var b={x:a+l+g,y:o+u/2,textAnchor:y,verticalAnchor:"middle"};return n6(n6({},b),r?{width:Math.max(r.x+r.width-b.x,0),height:u}:{})}var x=r?{width:l,height:u}:{};return"insideLeft"===s?n6({x:a+g,y:o+u/2,textAnchor:y,verticalAnchor:"middle"},x):"insideRight"===s?n6({x:a+l-g,y:o+u/2,textAnchor:m,verticalAnchor:"middle"},x):"insideTop"===s?n6({x:a+l/2,y:o+h,textAnchor:"middle",verticalAnchor:d},x):"insideBottom"===s?n6({x:a+l/2,y:o+u-h,textAnchor:"middle",verticalAnchor:f},x):"insideTopLeft"===s?n6({x:a+g,y:o+h,textAnchor:y,verticalAnchor:d},x):"insideTopRight"===s?n6({x:a+l-g,y:o+h,textAnchor:m,verticalAnchor:d},x):"insideBottomLeft"===s?n6({x:a+g,y:o+u-h,textAnchor:y,verticalAnchor:f},x):"insideBottomRight"===s?n6({x:a+l-g,y:o+u-h,textAnchor:m,verticalAnchor:f},x):s&&"object"==typeof s&&(eW(s.x)||eV(s.x))&&(eW(s.y)||eV(s.y))?n6({x:a+eK(s.x,l),y:o+eK(s.y,u),textAnchor:"end",verticalAnchor:"end"},x):n6({x:a+l/2,y:o+u/2,textAnchor:"middle",verticalAnchor:"middle"},x)})(n,g);return Q.createElement(tz,n5({ref:f,className:(0,ea.clsx)("recharts-label",c)},x,_,{breakAll:h}),i)}function ss(e){var{label:t,labelRef:r}=e;return((e,t,r)=>{if(!e)return null;var i={viewBox:t,labelRef:r};return!0===e?Q.createElement(sn,n5({key:"label-implicit"},i)):eG(e)?Q.createElement(sn,n5({key:"label-implicit",value:e},i)):(0,Q.isValidElement)(e)?e.type===sn?(0,Q.cloneElement)(e,n6({key:"label-implicit"},i)):Q.createElement(sn,n5({key:"label-implicit",content:e},i)):st(e)?Q.createElement(sn,n5({key:"label-implicit",content:e},i)):e&&"object"==typeof e?Q.createElement(sn,n5({},e,{key:"label-implicit"},i)):null})(t,n9(),r)||null}sn.displayName="Label";var sa=["valueAccessor"],so=["dataKey","clockWise","id","textBreakAll"];function sl(){return(sl=Object.assign.bind()).apply(null,arguments)}function su(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var sc=e=>Array.isArray(e.value)?(0,th.default)(e.value):e.value,sh=(0,Q.createContext)(void 0),sf=sh.Provider,sd=(0,Q.createContext)(void 0);function sp(e){var{valueAccessor:t=sc}=e,r=su(e,sa),{dataKey:i,clockWise:n,id:s,textBreakAll:a}=r,o=su(r,so),l=(0,Q.useContext)(sh),u=(0,Q.useContext)(sd),c=l||u;return c&&c.length?Q.createElement(tc,{className:"recharts-label-list"},c.map((e,n)=>{var l,u=null==i?t(e,n):i3(e&&e.payload,i),c=null==s?{}:{id:"".concat(s,"-").concat(n)};return Q.createElement(sn,sl({key:"label-".concat(n)},ta(e),o,c,{fill:null!=(l=r.fill)?l:e.fill,parentViewBox:e.parentViewBox,value:u,textBreakAll:a,viewBox:e.viewBox,index:n}))})):null}function sg(e){var{label:t}=e;return t?!0===t?Q.createElement(sp,{key:"labelList-implicit"}):Q.isValidElement(t)||st(t)?Q.createElement(sp,{key:"labelList-implicit",content:t}):"object"==typeof t?Q.createElement(sp,sl({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}sd.Provider,sp.displayName="LabelList",e.i(79684);var sm=e=>!e||"object"!=typeof e||!("clipDot"in e)||!!e.clipDot,sy=e.i(66814);function sv(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function sb(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}e.s([],25212),e.i(25212),e.s([],67155),e.i(67155);class sx extends Map{constructor(e,t=sw){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[t,r]of e)this.set(t,r)}get(e){return super.get(s_(this,e))}has(e){return super.has(s_(this,e))}set(e,t){return super.set(function({_intern:e,_key:t},r){let i=t(r);return e.has(i)?e.get(i):(e.set(i,r),r)}(this,e),t)}delete(e){return super.delete(function({_intern:e,_key:t},r){let i=t(r);return e.has(i)&&(r=e.get(i),e.delete(i)),r}(this,e))}}function s_({_intern:e,_key:t},r){let i=t(r);return e.has(i)?e.get(i):r}function sw(e){return null!==e&&"object"==typeof e?e.valueOf():e}let sk=Symbol("implicit");function sP(){var e=new sx,t=[],r=[],i=sk;function n(n){let s=e.get(n);if(void 0===s){if(i!==sk)return i;e.set(n,s=t.push(n)-1)}return r[s%r.length]}return n.domain=function(r){if(!arguments.length)return t.slice();for(let i of(t=[],e=new sx,r))e.has(i)||e.set(i,t.push(i)-1);return n},n.range=function(e){return arguments.length?(r=Array.from(e),n):r.slice()},n.unknown=function(e){return arguments.length?(i=e,n):i},n.copy=function(){return sP(t,r).unknown(i)},sv.apply(n,arguments),n}function sS(){var e,t,r=sP().unknown(void 0),i=r.domain,n=r.range,s=0,a=1,o=!1,l=0,u=0,c=.5;function h(){var r=i().length,h=a<s,f=h?a:s,d=h?s:a;e=(d-f)/Math.max(1,r-l+2*u),o&&(e=Math.floor(e)),f+=(d-f-e*(r-l))*c,t=e*(1-l),o&&(f=Math.round(f),t=Math.round(t));var p=(function(e,t,r){e*=1,t*=1,r=(n=arguments.length)<2?(t=e,e=0,1):n<3?1:+r;for(var i=-1,n=0|Math.max(0,Math.ceil((t-e)/r)),s=Array(n);++i<n;)s[i]=e+i*r;return s})(r).map(function(t){return f+e*t});return n(h?p.reverse():p)}return delete r.unknown,r.domain=function(e){return arguments.length?(i(e),h()):i()},r.range=function(e){return arguments.length?([s,a]=e,s*=1,a*=1,h()):[s,a]},r.rangeRound=function(e){return[s,a]=e,s*=1,a*=1,o=!0,h()},r.bandwidth=function(){return t},r.step=function(){return e},r.round=function(e){return arguments.length?(o=!!e,h()):o},r.padding=function(e){return arguments.length?(l=Math.min(1,u=+e),h()):l},r.paddingInner=function(e){return arguments.length?(l=Math.min(1,e),h()):l},r.paddingOuter=function(e){return arguments.length?(u=+e,h()):u},r.align=function(e){return arguments.length?(c=Math.max(0,Math.min(1,e)),h()):c},r.copy=function(){return sS(i(),[s,a]).round(o).paddingInner(l).paddingOuter(u).align(c)},sv.apply(h(),arguments)}function sE(){return function e(t){var r=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return e(r())},t}(sS.apply(null,arguments).paddingInner(1))}let sA=Math.sqrt(50),sM=Math.sqrt(10),sT=Math.sqrt(2);function sC(e,t,r){let i,n,s,a=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(a)),l=a/Math.pow(10,o),u=l>=sA?10:l>=sM?5:l>=sT?2:1;return(o<0?(i=Math.round(e*(s=Math.pow(10,-o)/u)),n=Math.round(t*s),i/s<e&&++i,n/s>t&&--n,s=-s):(i=Math.round(e/(s=Math.pow(10,o)*u)),n=Math.round(t/s),i*s<e&&++i,n*s>t&&--n),n<i&&.5<=r&&r<2)?sC(e,t,2*r):[i,n,s]}function sO(e,t,r){if(t*=1,e*=1,!((r*=1)>0))return[];if(e===t)return[e];let i=t<e,[n,s,a]=i?sC(t,e,r):sC(e,t,r);if(!(s>=n))return[];let o=s-n+1,l=Array(o);if(i)if(a<0)for(let e=0;e<o;++e)l[e]=-((s-e)/a);else for(let e=0;e<o;++e)l[e]=(s-e)*a;else if(a<0)for(let e=0;e<o;++e)l[e]=-((n+e)/a);else for(let e=0;e<o;++e)l[e]=(n+e)*a;return l}function sI(e,t,r){return sC(e*=1,t*=1,r*=1)[2]}function sL(e,t,r){t*=1,e*=1,r*=1;let i=t<e,n=i?sI(t,e,r):sI(e,t,r);return(i?-1:1)*(n<0?-(1/n):n)}function sj(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function sN(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function sD(e){let t,r,i;function n(e,i,s=0,a=e.length){if(s<a){if(0!==t(i,i))return a;do{let t=s+a>>>1;0>r(e[t],i)?s=t+1:a=t}while(s<a)}return s}return 2!==e.length?(t=sj,r=(t,r)=>sj(e(t),r),i=(t,r)=>e(t)-r):(t=e===sj||e===sN?e:sR,r=e,i=e),{left:n,center:function(e,t,r=0,s=e.length){let a=n(e,t,r,s-1);return a>r&&i(e[a-1],t)>-i(e[a],t)?a-1:a},right:function(e,i,n=0,s=e.length){if(n<s){if(0!==t(i,i))return s;do{let t=n+s>>>1;0>=r(e[t],i)?n=t+1:s=t}while(n<s)}return n}}}function sR(){return 0}function sz(e){return null===e?NaN:+e}let sF=sD(sj),sB=sF.right;function sU(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function s$(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function sV(){}sF.left,sD(sz).center;var sW="\\s*([+-]?\\d+)\\s*",sG="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sq="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sH=/^#([0-9a-f]{3,8})$/,sK=RegExp(`^rgb\\(${sW},${sW},${sW}\\)$`),sY=RegExp(`^rgb\\(${sq},${sq},${sq}\\)$`),sZ=RegExp(`^rgba\\(${sW},${sW},${sW},${sG}\\)$`),sX=RegExp(`^rgba\\(${sq},${sq},${sq},${sG}\\)$`),sJ=RegExp(`^hsl\\(${sG},${sq},${sq}\\)$`),sQ=RegExp(`^hsla\\(${sG},${sq},${sq},${sG}\\)$`),s0={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function s1(){return this.rgb().formatHex()}function s2(){return this.rgb().formatRgb()}function s3(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=sH.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?s4(t):3===r?new s8(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?s6(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?s6(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=sK.exec(e))?new s8(t[1],t[2],t[3],1):(t=sY.exec(e))?new s8(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=sZ.exec(e))?s6(t[1],t[2],t[3],t[4]):(t=sX.exec(e))?s6(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=sJ.exec(e))?ai(t[1],t[2]/100,t[3]/100,1):(t=sQ.exec(e))?ai(t[1],t[2]/100,t[3]/100,t[4]):s0.hasOwnProperty(e)?s4(s0[e]):"transparent"===e?new s8(NaN,NaN,NaN,0):null}function s4(e){return new s8(e>>16&255,e>>8&255,255&e,1)}function s6(e,t,r,i){return i<=0&&(e=t=r=NaN),new s8(e,t,r,i)}function s5(e,t,r,i){var n;return 1==arguments.length?((n=e)instanceof sV||(n=s3(n)),n)?new s8((n=n.rgb()).r,n.g,n.b,n.opacity):new s8:new s8(e,t,r,null==i?1:i)}function s8(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}function s7(){return`#${ar(this.r)}${ar(this.g)}${ar(this.b)}`}function s9(){let e=ae(this.opacity);return`${1===e?"rgb(":"rgba("}${at(this.r)}, ${at(this.g)}, ${at(this.b)}${1===e?")":`, ${e})`}`}function ae(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function at(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ar(e){return((e=at(e))<16?"0":"")+e.toString(16)}function ai(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new as(e,t,r,i)}function an(e){if(e instanceof as)return new as(e.h,e.s,e.l,e.opacity);if(e instanceof sV||(e=s3(e)),!e)return new as;if(e instanceof as)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,n=Math.min(t,r,i),s=Math.max(t,r,i),a=NaN,o=s-n,l=(s+n)/2;return o?(a=t===s?(r-i)/o+(r<i)*6:r===s?(i-t)/o+2:(t-r)/o+4,o/=l<.5?s+n:2-s-n,a*=60):o=l>0&&l<1?0:a,new as(a,o,l,e.opacity)}function as(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}function aa(e){return(e=(e||0)%360)<0?e+360:e}function ao(e){return Math.max(0,Math.min(1,e||0))}function al(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function au(e,t,r,i,n){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*r+(1+3*e+3*s-3*a)*i+a*n)/6}sU(sV,s3,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:s1,formatHex:s1,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return an(this).formatHsl()},formatRgb:s2,toString:s2}),sU(s8,s5,s$(sV,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new s8(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new s8(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new s8(at(this.r),at(this.g),at(this.b),ae(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:s7,formatHex:s7,formatHex8:function(){return`#${ar(this.r)}${ar(this.g)}${ar(this.b)}${ar((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:s9,toString:s9})),sU(as,function(e,t,r,i){return 1==arguments.length?an(e):new as(e,t,r,null==i?1:i)},s$(sV,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new as(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new as(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,n=2*r-i;return new s8(al(e>=240?e-240:e+120,n,i),al(e,n,i),al(e<120?e+240:e-120,n,i),this.opacity)},clamp(){return new as(aa(this.h),ao(this.s),ao(this.l),ae(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=ae(this.opacity);return`${1===e?"hsl(":"hsla("}${aa(this.h)}, ${100*ao(this.s)}%, ${100*ao(this.l)}%${1===e?")":`, ${e})`}`}}));let ac=e=>()=>e;function ah(e,t){var r=t-e;return r?function(t){return e+t*r}:ac(isNaN(e)?t:e)}let af=function e(t){var r,i=1==(r=+t)?ah:function(e,t){var i,n,s;return t-e?(i=e,n=t,i=Math.pow(i,s=r),n=Math.pow(n,s)-i,s=1/s,function(e){return Math.pow(i+e*n,s)}):ac(isNaN(e)?t:e)};function n(e,t){var r=i((e=s5(e)).r,(t=s5(t)).r),n=i(e.g,t.g),s=i(e.b,t.b),a=ah(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=n(t),e.b=s(t),e.opacity=a(t),e+""}}return n.gamma=e,n}(1);function ad(e){return function(t){var r,i,n=t.length,s=Array(n),a=Array(n),o=Array(n);for(r=0;r<n;++r)i=s5(t[r]),s[r]=i.r||0,a[r]=i.g||0,o[r]=i.b||0;return s=e(s),a=e(a),o=e(o),i.opacity=1,function(e){return i.r=s(e),i.g=a(e),i.b=o(e),i+""}}}function ap(e,t){return e*=1,t*=1,function(r){return e*(1-r)+t*r}}ad(function(e){var t=e.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),n=e[i],s=e[i+1],a=i>0?e[i-1]:2*n-s,o=i<t-1?e[i+2]:2*s-n;return au((r-i/t)*t,a,n,s,o)}}),ad(function(e){var t=e.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*t),n=e[(i+t-1)%t],s=e[i%t],a=e[(i+1)%t],o=e[(i+2)%t];return au((r-i/t)*t,n,s,a,o)}});var ag=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,am=RegExp(ag.source,"g");function ay(e,t){var r,i,n=typeof t;return null==t||"boolean"===n?ac(t):("number"===n?ap:"string"===n?(i=s3(t))?(t=i,af):function(e,t){var r,i,n,s,a,o=ag.lastIndex=am.lastIndex=0,l=-1,u=[],c=[];for(e+="",t+="";(n=ag.exec(e))&&(s=am.exec(t));)(a=s.index)>o&&(a=t.slice(o,a),u[l]?u[l]+=a:u[++l]=a),(n=n[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,c.push({i:l,x:ap(n,s)})),o=am.lastIndex;return o<t.length&&(a=t.slice(o),u[l]?u[l]+=a:u[++l]=a),u.length<2?c[0]?(r=c[0].x,function(e){return r(e)+""}):(i=t,function(){return i}):(t=c.length,function(e){for(var r,i=0;i<t;++i)u[(r=c[i]).i]=r.x(e);return u.join("")})}:t instanceof s3?af:t instanceof Date?function(e,t){var r=new Date;return e*=1,t*=1,function(i){return r.setTime(e*(1-i)+t*i),r}}:!ArrayBuffer.isView(r=t)||r instanceof DataView?Array.isArray(t)?function(e,t){var r,i=t?t.length:0,n=e?Math.min(i,e.length):0,s=Array(n),a=Array(i);for(r=0;r<n;++r)s[r]=ay(e[r],t[r]);for(;r<i;++r)a[r]=t[r];return function(e){for(r=0;r<n;++r)a[r]=s[r](e);return a}}:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?function(e,t){var r,i={},n={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?i[r]=ay(e[r],t[r]):n[r]=t[r];return function(e){for(r in i)n[r]=i[r](e);return n}}:ap:function(e,t){t||(t=[]);var r,i=e?Math.min(t.length,e.length):0,n=t.slice();return function(s){for(r=0;r<i;++r)n[r]=e[r]*(1-s)+t[r]*s;return n}})(e,t)}function av(e,t){return e*=1,t*=1,function(r){return Math.round(e*(1-r)+t*r)}}function ab(e){return+e}var ax=[0,1];function a_(e){return e}function aw(e,t){var r;return(t-=e*=1)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r})}function ak(e,t,r){var i=e[0],n=e[1],s=t[0],a=t[1];return n<i?(i=aw(n,i),s=r(a,s)):(i=aw(i,n),s=r(s,a)),function(e){return s(i(e))}}function aP(e,t,r){var i=Math.min(e.length,t.length)-1,n=Array(i),s=Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)n[a]=aw(e[a],e[a+1]),s[a]=r(t[a],t[a+1]);return function(t){var r=sB(e,t,1,i)-1;return s[r](n[r](t))}}function aS(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function aE(){var e,t,r,i,n,s,a=ax,o=ax,l=ay,u=a_;function c(){var e,t,r,l=Math.min(a.length,o.length);return u!==a_&&(e=a[0],t=a[l-1],e>t&&(r=e,e=t,t=r),u=function(r){return Math.max(e,Math.min(t,r))}),i=l>2?aP:ak,n=s=null,h}function h(t){return null==t||isNaN(t*=1)?r:(n||(n=i(a.map(e),o,l)))(e(u(t)))}return h.invert=function(r){return u(t((s||(s=i(o,a.map(e),ap)))(r)))},h.domain=function(e){return arguments.length?(a=Array.from(e,ab),c()):a.slice()},h.range=function(e){return arguments.length?(o=Array.from(e),c()):o.slice()},h.rangeRound=function(e){return o=Array.from(e),l=av,c()},h.clamp=function(e){return arguments.length?(u=!!e||a_,c()):u!==a_},h.interpolate=function(e){return arguments.length?(l=e,c()):l},h.unknown=function(e){return arguments.length?(r=e,h):r},function(r,i){return e=r,t=i,c()}}function aA(){return aE()(a_,a_)}function aM(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function aT(e){return(e=aM(Math.abs(e)))?e[1]:NaN}var aC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function aO(e){var t;if(!(t=aC.exec(e)))throw Error("invalid format: "+e);return new aI({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function aI(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function aL(e,t){var r=aM(e,t);if(!r)return e+"";var i=r[0],n=r[1];return n<0?"0."+Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+Array(n-i.length+2).join("0")}aO.prototype=aI.prototype,aI.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};let aj={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>aL(100*e,t),r:aL,s:function(e,t){var r=aM(e,t);if(!r)return e+"";var i=r[0],n=r[1],s=n-(j=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=i.length;return s===a?i:s>a?i+Array(s-a+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+Array(1-s).join("0")+aM(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function aN(e){return e}var aD=Array.prototype.map,aR=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function az(e,t,r,i){var n,s,a=sL(e,t,r);switch((i=aO(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(s=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(aT(o)/3)))-aT(Math.abs(a))))||(i.precision=s),R(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(s=Math.max(0,aT(Math.abs(Math.max(Math.abs(e),Math.abs(t)))-(n=Math.abs(n=a)))-aT(n))+1)||(i.precision=s-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(s=Math.max(0,-aT(Math.abs(a))))||(i.precision=s-("%"===i.type)*2)}return D(i)}function aF(e){var t=e.domain;return e.ticks=function(e){var r=t();return sO(r[0],r[r.length-1],null==e?10:e)},e.tickFormat=function(e,r){var i=t();return az(i[0],i[i.length-1],null==e?10:e,r)},e.nice=function(r){null==r&&(r=10);var i,n,s=t(),a=0,o=s.length-1,l=s[a],u=s[o],c=10;for(u<l&&(n=l,l=u,u=n,n=a,a=o,o=n);c-- >0;){if((n=sI(l,u,r))===i)return s[a]=l,s[o]=u,t(s);if(n>0)l=Math.floor(l/n)*n,u=Math.ceil(u/n)*n;else if(n<0)l=Math.ceil(l*n)/n,u=Math.floor(u*n)/n;else break;i=n}return e},e}function aB(){var e=aA();return e.copy=function(){return aS(e,aB())},sv.apply(e,arguments),aF(e)}function aU(e){var t;function r(e){return null==e||isNaN(e*=1)?t:e}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,ab),r):e.slice()},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return aU(e).unknown(t)},e=arguments.length?Array.from(e,ab):[0,1],aF(r)}function a$(e,t){e=e.slice();var r,i=0,n=e.length-1,s=e[i],a=e[n];return a<s&&(r=i,i=n,n=r,r=s,s=a,a=r),e[i]=t.floor(s),e[n]=t.ceil(a),e}function aV(e){return Math.log(e)}function aW(e){return Math.exp(e)}function aG(e){return-Math.log(-e)}function aq(e){return-Math.exp(-e)}function aH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function aK(e){return(t,r)=>-e(-t,r)}function aY(e){let t,r,i=e(aV,aW),n=i.domain,s=10;function a(){var a,o;return t=(a=s)===Math.E?Math.log:10===a&&Math.log10||2===a&&Math.log2||(a=Math.log(a),e=>Math.log(e)/a),r=10===(o=s)?aH:o===Math.E?Math.exp:e=>Math.pow(o,e),n()[0]<0?(t=aK(t),r=aK(r),e(aG,aq)):e(aV,aW),i}return i.base=function(e){return arguments.length?(s=+e,a()):s},i.domain=function(e){return arguments.length?(n(e),a()):n()},i.ticks=e=>{let i,a,o=n(),l=o[0],u=o[o.length-1],c=u<l;c&&([l,u]=[u,l]);let h=t(l),f=t(u),d=null==e?10:+e,p=[];if(!(s%1)&&f-h<d){if(h=Math.floor(h),f=Math.ceil(f),l>0){for(;h<=f;++h)for(i=1;i<s;++i)if(!((a=h<0?i/r(-h):i*r(h))<l)){if(a>u)break;p.push(a)}}else for(;h<=f;++h)for(i=s-1;i>=1;--i)if(!((a=h>0?i/r(-h):i*r(h))<l)){if(a>u)break;p.push(a)}2*p.length<d&&(p=sO(l,u,d))}else p=sO(h,f,Math.min(f-h,d)).map(r);return c?p.reverse():p},i.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===s?"s":","),"function"!=typeof n&&(s%1||null!=(n=aO(n)).precision||(n.trim=!0),n=D(n)),e===1/0)return n;let a=Math.max(1,s*e/i.ticks().length);return e=>{let i=e/r(Math.round(t(e)));return i*s<s-.5&&(i*=s),i<=a?n(e):""}},i.nice=()=>n(a$(n(),{floor:e=>r(Math.floor(t(e))),ceil:e=>r(Math.ceil(t(e)))})),i}function aZ(){let e=aY(aE()).domain([1,10]);return e.copy=()=>aS(e,aZ()).base(e.base()),sv.apply(e,arguments),e}function aX(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function aJ(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function aQ(e){var t=1,r=e(aX(1),aJ(t));return r.constant=function(r){return arguments.length?e(aX(t=+r),aJ(t)):t},aF(r)}function a0(){var e=aQ(aE());return e.copy=function(){return aS(e,a0()).constant(e.constant())},sv.apply(e,arguments)}function a1(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function a2(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function a3(e){return e<0?-e*e:e*e}function a4(e){var t=e(a_,a_),r=1;return t.exponent=function(t){return arguments.length?1==(r=+t)?e(a_,a_):.5===r?e(a2,a3):e(a1(r),a1(1/r)):r},aF(t)}function a6(){var e=a4(aE());return e.copy=function(){return aS(e,a6()).exponent(e.exponent())},sv.apply(e,arguments),e}function a5(){return a6.apply(null,arguments).exponent(.5)}function a8(e){return Math.sign(e)*e*e}function a7(){var e,t=aA(),r=[0,1],i=!1;function n(r){var n,s=Math.sign(n=t(r))*Math.sqrt(Math.abs(n));return isNaN(s)?e:i?Math.round(s):s}return n.invert=function(e){return t.invert(a8(e))},n.domain=function(e){return arguments.length?(t.domain(e),n):t.domain()},n.range=function(e){return arguments.length?(t.range((r=Array.from(e,ab)).map(a8)),n):r.slice()},n.rangeRound=function(e){return n.range(e).round(!0)},n.round=function(e){return arguments.length?(i=!!e,n):i},n.clamp=function(e){return arguments.length?(t.clamp(e),n):t.clamp()},n.unknown=function(t){return arguments.length?(e=t,n):e},n.copy=function(){return a7(t.domain(),r).round(i).clamp(t.clamp()).unknown(e)},sv.apply(n,arguments),aF(n)}function a9(e,t){let r;if(void 0===t)for(let t of e)null!=t&&(r<t||void 0===r&&t>=t)&&(r=t);else{let i=-1;for(let n of e)null!=(n=t(n,++i,e))&&(r<n||void 0===r&&n>=n)&&(r=n)}return r}function oe(e,t){let r;if(void 0===t)for(let t of e)null!=t&&(r>t||void 0===r&&t>=t)&&(r=t);else{let i=-1;for(let n of e)null!=(n=t(n,++i,e))&&(r>n||void 0===r&&n>=n)&&(r=n)}return r}function ot(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:+(e>t))}function or(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}function oi(){var e,t=[],r=[],i=[];function n(){var e=0,n=Math.max(1,r.length);for(i=Array(n-1);++e<n;)i[e-1]=function(e,t,r=sz){if(!(!(i=e.length)||isNaN(t*=1))){if(t<=0||i<2)return+r(e[0],0,e);if(t>=1)return+r(e[i-1],i-1,e);var i,n=(i-1)*t,s=Math.floor(n),a=+r(e[s],s,e);return a+(r(e[s+1],s+1,e)-a)*(n-s)}}(t,e/n);return s}function s(t){return null==t||isNaN(t*=1)?e:r[sB(i,t)]}return s.invertExtent=function(e){var n=r.indexOf(e);return n<0?[NaN,NaN]:[n>0?i[n-1]:t[0],n<i.length?i[n]:t[t.length-1]]},s.domain=function(e){if(!arguments.length)return t.slice();for(let r of(t=[],e))null==r||isNaN(r*=1)||t.push(r);return t.sort(sj),n()},s.range=function(e){return arguments.length?(r=Array.from(e),n()):r.slice()},s.unknown=function(t){return arguments.length?(e=t,s):e},s.quantiles=function(){return i.slice()},s.copy=function(){return oi().domain(t).range(r).unknown(e)},sv.apply(s,arguments)}function on(){var e,t=0,r=1,i=1,n=[.5],s=[0,1];function a(t){return null!=t&&t<=t?s[sB(n,t,0,i)]:e}function o(){var e=-1;for(n=Array(i);++e<i;)n[e]=((e+1)*r-(e-i)*t)/(i+1);return a}return a.domain=function(e){return arguments.length?([t,r]=e,t*=1,r*=1,o()):[t,r]},a.range=function(e){return arguments.length?(i=(s=Array.from(e)).length-1,o()):s.slice()},a.invertExtent=function(e){var a=s.indexOf(e);return a<0?[NaN,NaN]:a<1?[t,n[0]]:a>=i?[n[i-1],r]:[n[a-1],n[a]]},a.unknown=function(t){return arguments.length&&(e=t),a},a.thresholds=function(){return n.slice()},a.copy=function(){return on().domain([t,r]).range(s).unknown(e)},sv.apply(aF(a),arguments)}function os(){var e,t=[.5],r=[0,1],i=1;function n(n){return null!=n&&n<=n?r[sB(t,n,0,i)]:e}return n.domain=function(e){return arguments.length?(i=Math.min((t=Array.from(e)).length,r.length-1),n):t.slice()},n.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(t.length,r.length-1),n):r.slice()},n.invertExtent=function(e){var i=r.indexOf(e);return[t[i-1],t[i]]},n.unknown=function(t){return arguments.length?(e=t,n):e},n.copy=function(){return os().domain(t).range(r).unknown(e)},sv.apply(n,arguments)}D=(N=function(e){var t,r,i,n=void 0===e.grouping||void 0===e.thousands?aN:(t=aD.call(e.grouping,Number),r=e.thousands+"",function(e,i){for(var n=e.length,s=[],a=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>i&&(o=Math.max(1,i-l)),s.push(e.substring(n-=o,n+o)),!((l+=o+1)>i));)o=t[a=(a+1)%t.length];return s.reverse().join(r)}),s=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?aN:(i=aD.call(e.numerals,String),function(e){return e.replace(/[0-9]/g,function(e){return i[+e]})}),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"":e.minus+"",h=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=aO(e)).fill,r=e.align,i=e.sign,f=e.symbol,d=e.zero,p=e.width,g=e.comma,m=e.precision,y=e.trim,v=e.type;"n"===v?(g=!0,v="g"):aj[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===t&&"="===r)&&(d=!0,t="0",r="=");var b="$"===f?s:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===f?a:/[%p]/.test(v)?u:"",_=aj[v],w=/[defgprs%]/.test(v);function k(e){var s,a,u,f=b,k=x;if("c"===v)k=_(e)+k,e="";else{var P=(e*=1)<0||1/e<0;if(e=isNaN(e)?h:_(Math.abs(e),m),y&&(e=function(e){e:for(var t,r=e.length,i=1,n=-1;i<r;++i)switch(e[i]){case".":n=t=i;break;case"0":0===n&&(n=i),t=i;break;default:if(!+e[i])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(t+1):e}(e)),P&&0==+e&&"+"!==i&&(P=!1),f=(P?"("===i?i:c:"-"===i||"("===i?"":i)+f,k=("s"===v?aR[8+j/3]:"")+k+(P&&"("===i?")":""),w){for(s=-1,a=e.length;++s<a;)if(48>(u=e.charCodeAt(s))||u>57){k=(46===u?o+e.slice(s+1):e.slice(s))+k,e=e.slice(0,s);break}}}g&&!d&&(e=n(e,1/0));var S=f.length+e.length+k.length,E=S<p?Array(p-S+1).join(t):"";switch(g&&d&&(e=n(E+e,E.length?p-k.length:1/0),E=""),r){case"<":e=f+e+k+E;break;case"=":e=f+E+e+k;break;case"^":e=E.slice(0,S=E.length>>1)+f+e+k+E.slice(S);break;default:e=E+f+e+k}return l(e)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return e+""},k}return{format:f,formatPrefix:function(e,t){var r=f(((e=aO(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(aT(t)/3))),n=Math.pow(10,-i),s=aR[8+i/3];return function(e){return r(n*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]})).format,R=N.formatPrefix;let oa=new Date,oo=new Date;function ol(e,t,r,i){function n(t){return e(t=0==arguments.length?new Date:new Date(+t)),t}return n.floor=t=>(e(t=new Date(+t)),t),n.ceil=r=>(e(r=new Date(r-1)),t(r,1),e(r),r),n.round=e=>{let t=n(e),r=n.ceil(e);return e-t<r-e?t:r},n.offset=(e,r)=>(t(e=new Date(+e),null==r?1:Math.floor(r)),e),n.range=(r,i,s)=>{let a,o=[];if(r=n.ceil(r),s=null==s?1:Math.floor(s),!(r<i)||!(s>0))return o;do o.push(a=new Date(+r)),t(r,s),e(r);while(a<r&&r<i)return o},n.filter=r=>ol(t=>{if(t>=t)for(;e(t),!r(t);)t.setTime(t-1)},(e,i)=>{if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!r(e););else for(;--i>=0;)for(;t(e,1),!r(e););}),r&&(n.count=(t,i)=>(oa.setTime(+t),oo.setTime(+i),e(oa),e(oo),Math.floor(r(oa,oo))),n.every=e=>isFinite(e=Math.floor(e))&&e>0?e>1?n.filter(i?t=>i(t)%e==0:t=>n.count(0,t)%e==0):n:null),n}let ou=ol(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());ou.every=e=>isFinite(e=Math.floor(e))&&e>0?ol(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)}):null,ou.range;let oc=ol(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());oc.every=e=>isFinite(e=Math.floor(e))&&e>0?ol(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)}):null,oc.range;let oh=ol(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());oh.range;let of=ol(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());of.range;function od(e){return ol(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/6048e5)}let op=od(0),og=od(1),om=od(2),oy=od(3),ov=od(4),ob=od(5),ox=od(6);function o_(e){return ol(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/6048e5)}op.range,og.range,om.range,oy.range,ov.range,ob.range,ox.range;let ow=o_(0),ok=o_(1),oP=o_(2),oS=o_(3),oE=o_(4),oA=o_(5),oM=o_(6);ow.range,ok.range,oP.range,oS.range,oE.range,oA.range,oM.range;let oT=ol(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1);oT.range;let oC=ol(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1);oC.range;let oO=ol(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5));oO.range;let oI=ol(e=>{e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())},(e,t)=>{e.setTime(+e+36e5*t)},(e,t)=>(t-e)/36e5,e=>e.getHours());oI.range;let oL=ol(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+36e5*t)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours());oL.range;let oj=ol(e=>{e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())},(e,t)=>{e.setTime(+e+6e4*t)},(e,t)=>(t-e)/6e4,e=>e.getMinutes());oj.range;let oN=ol(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+6e4*t)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes());oN.range;let oD=ol(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+1e3*t)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds());oD.range;let oR=ol(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);function oz(e,t,r,i,n,s){let a=[[oD,1,1e3],[oD,5,5e3],[oD,15,15e3],[oD,30,3e4],[s,1,6e4],[s,5,3e5],[s,15,9e5],[s,30,18e5],[n,1,36e5],[n,3,108e5],[n,6,216e5],[n,12,432e5],[i,1,864e5],[i,2,1728e5],[r,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function o(t,r,i){let n=Math.abs(r-t)/i,s=sD(([,,e])=>e).right(a,n);if(s===a.length)return e.every(sL(t/31536e6,r/31536e6,i));if(0===s)return oR.every(Math.max(sL(t,r,i),1));let[o,l]=a[n/a[s-1][2]<a[s][2]/n?s-1:s];return o.every(l)}return[function(e,t,r){let i=t<e;i&&([e,t]=[t,e]);let n=r&&"function"==typeof r.range?r:o(e,t,r),s=n?n.range(e,+t+1):[];return i?s.reverse():s},o]}oR.every=e=>isFinite(e=Math.floor(e))&&e>0?e>1?ol(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):oR:null,oR.range;let[oF,oB]=oz(oc,of,ow,oO,oL,oN),[oU,o$]=oz(ou,oh,op,oT,oI,oj);function oV(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function oW(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function oG(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}var oq={"-":"",_:" ",0:"0"},oH=/^\s*\d+/,oK=/^%/,oY=/[\\^$*+?|[\]().{}]/g;function oZ(e,t,r){var i=e<0?"-":"",n=(i?-e:e)+"",s=n.length;return i+(s<r?Array(r-s+1).join(t)+n:n)}function oX(e){return e.replace(oY,"\\$&")}function oJ(e){return RegExp("^(?:"+e.map(oX).join("|")+")","i")}function oQ(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function o0(e,t,r){var i=oH.exec(t.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function o1(e,t,r){var i=oH.exec(t.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function o2(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function o3(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function o4(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function o6(e,t,r){var i=oH.exec(t.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function o5(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function o8(e,t,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function o7(e,t,r){var i=oH.exec(t.slice(r,r+1));return i?(e.q=3*i[0]-3,r+i[0].length):-1}function o9(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function le(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function lt(e,t,r){var i=oH.exec(t.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function lr(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function li(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function ln(e,t,r){var i=oH.exec(t.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function ls(e,t,r){var i=oH.exec(t.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function la(e,t,r){var i=oH.exec(t.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function lo(e,t,r){var i=oK.exec(t.slice(r,r+1));return i?r+i[0].length:-1}function ll(e,t,r){var i=oH.exec(t.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function lu(e,t,r){var i=oH.exec(t.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function lc(e,t){return oZ(e.getDate(),t,2)}function lh(e,t){return oZ(e.getHours(),t,2)}function lf(e,t){return oZ(e.getHours()%12||12,t,2)}function ld(e,t){return oZ(1+oT.count(ou(e),e),t,3)}function lp(e,t){return oZ(e.getMilliseconds(),t,3)}function lg(e,t){return lp(e,t)+"000"}function lm(e,t){return oZ(e.getMonth()+1,t,2)}function ly(e,t){return oZ(e.getMinutes(),t,2)}function lv(e,t){return oZ(e.getSeconds(),t,2)}function lb(e){var t=e.getDay();return 0===t?7:t}function lx(e,t){return oZ(op.count(ou(e)-1,e),t,2)}function l_(e){var t=e.getDay();return t>=4||0===t?ov(e):ov.ceil(e)}function lw(e,t){return e=l_(e),oZ(ov.count(ou(e),e)+(4===ou(e).getDay()),t,2)}function lk(e){return e.getDay()}function lP(e,t){return oZ(og.count(ou(e)-1,e),t,2)}function lS(e,t){return oZ(e.getFullYear()%100,t,2)}function lE(e,t){return oZ((e=l_(e)).getFullYear()%100,t,2)}function lA(e,t){return oZ(e.getFullYear()%1e4,t,4)}function lM(e,t){var r=e.getDay();return oZ((e=r>=4||0===r?ov(e):ov.ceil(e)).getFullYear()%1e4,t,4)}function lT(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+oZ(t/60|0,"0",2)+oZ(t%60,"0",2)}function lC(e,t){return oZ(e.getUTCDate(),t,2)}function lO(e,t){return oZ(e.getUTCHours(),t,2)}function lI(e,t){return oZ(e.getUTCHours()%12||12,t,2)}function lL(e,t){return oZ(1+oC.count(oc(e),e),t,3)}function lj(e,t){return oZ(e.getUTCMilliseconds(),t,3)}function lN(e,t){return lj(e,t)+"000"}function lD(e,t){return oZ(e.getUTCMonth()+1,t,2)}function lR(e,t){return oZ(e.getUTCMinutes(),t,2)}function lz(e,t){return oZ(e.getUTCSeconds(),t,2)}function lF(e){var t=e.getUTCDay();return 0===t?7:t}function lB(e,t){return oZ(ow.count(oc(e)-1,e),t,2)}function lU(e){var t=e.getUTCDay();return t>=4||0===t?oE(e):oE.ceil(e)}function l$(e,t){return e=lU(e),oZ(oE.count(oc(e),e)+(4===oc(e).getUTCDay()),t,2)}function lV(e){return e.getUTCDay()}function lW(e,t){return oZ(ok.count(oc(e)-1,e),t,2)}function lG(e,t){return oZ(e.getUTCFullYear()%100,t,2)}function lq(e,t){return oZ((e=lU(e)).getUTCFullYear()%100,t,2)}function lH(e,t){return oZ(e.getUTCFullYear()%1e4,t,4)}function lK(e,t){var r=e.getUTCDay();return oZ((e=r>=4||0===r?oE(e):oE.ceil(e)).getUTCFullYear()%1e4,t,4)}function lY(){return"+0000"}function lZ(){return"%"}function lX(e){return+e}function lJ(e){return Math.floor(e/1e3)}function lQ(e){return new Date(e)}function l0(e){return e instanceof Date?+e:+new Date(+e)}function l1(e,t,r,i,n,s,a,o,l,u){var c=aA(),h=c.invert,f=c.domain,d=u(".%L"),p=u(":%S"),g=u("%I:%M"),m=u("%I %p"),y=u("%a %d"),v=u("%b %d"),b=u("%B"),x=u("%Y");function _(e){return(l(e)<e?d:o(e)<e?p:a(e)<e?g:s(e)<e?m:i(e)<e?n(e)<e?y:v:r(e)<e?b:x)(e)}return c.invert=function(e){return new Date(h(e))},c.domain=function(e){return arguments.length?f(Array.from(e,l0)):f().map(lQ)},c.ticks=function(t){var r=f();return e(r[0],r[r.length-1],null==t?10:t)},c.tickFormat=function(e,t){return null==t?_:u(t)},c.nice=function(e){var r=f();return e&&"function"==typeof e.range||(e=t(r[0],r[r.length-1],null==e?10:e)),e?f(a$(r,e)):c},c.copy=function(){return aS(c,l1(e,t,r,i,n,s,a,o,l,u))},c}function l2(){return sv.apply(l1(oU,o$,ou,oh,op,oT,oI,oj,oD,F).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function l3(){return sv.apply(l1(oF,oB,oc,of,ow,oC,oL,oN,oD,B).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function l4(){var e,t,r,i,n,s=0,a=1,o=a_,l=!1;function u(t){return null==t||isNaN(t*=1)?n:o(0===r?.5:(t=(i(t)-e)*r,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var r,i;return arguments.length?([r,i]=t,o=e(r,i),u):[o(0),o(1)]}}return u.domain=function(n){return arguments.length?([s,a]=n,e=i(s*=1),t=i(a*=1),r=e===t?0:1/(t-e),u):[s,a]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(o=e,u):o},u.range=c(ay),u.rangeRound=c(av),u.unknown=function(e){return arguments.length?(n=e,u):n},function(n){return i=n,e=n(s),t=n(a),r=e===t?0:1/(t-e),u}}function l6(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function l5(){var e=aF(l4()(a_));return e.copy=function(){return l6(e,l5())},sb.apply(e,arguments)}function l8(){var e=aY(l4()).domain([1,10]);return e.copy=function(){return l6(e,l8()).base(e.base())},sb.apply(e,arguments)}function l7(){var e=aQ(l4());return e.copy=function(){return l6(e,l7()).constant(e.constant())},sb.apply(e,arguments)}function l9(){var e=a4(l4());return e.copy=function(){return l6(e,l9()).exponent(e.exponent())},sb.apply(e,arguments)}function ue(){return l9.apply(null,arguments).exponent(.5)}function ut(){var e=[],t=a_;function r(r){if(null!=r&&!isNaN(r*=1))return t((sB(e,r,1)-1)/(e.length-1))}return r.domain=function(t){if(!arguments.length)return e.slice();for(let r of(e=[],t))null==r||isNaN(r*=1)||e.push(r);return e.sort(sj),r},r.interpolator=function(e){return arguments.length?(t=e,r):t},r.range=function(){return e.map((r,i)=>t(i/(e.length-1)))},r.quantiles=function(t){return Array.from({length:t+1},(r,i)=>(function(e,t,r){if(!(!(i=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t*=1)>=t&&(yield t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(i*=1)>=i&&(yield i)}}(e,void 0))).length)||isNaN(t*=1))){if(t<=0||i<2)return oe(e);if(t>=1)return a9(e);var i,n=(i-1)*t,s=Math.floor(n),a=a9((function e(t,r,i=0,n=1/0,s){if(r=Math.floor(r),i=Math.floor(Math.max(0,i)),n=Math.floor(Math.min(t.length-1,n)),!(i<=r&&r<=n))return t;for(s=void 0===s?ot:function(e=sj){if(e===sj)return ot;if("function"!=typeof e)throw TypeError("compare is not a function");return(t,r)=>{let i=e(t,r);return i||0===i?i:(0===e(r,r))-(0===e(t,t))}}(s);n>i;){if(n-i>600){let a=n-i+1,o=r-i+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(o-a/2<0?-1:1),h=Math.max(i,Math.floor(r-o*u/a+c)),f=Math.min(n,Math.floor(r+(a-o)*u/a+c));e(t,r,h,f,s)}let a=t[r],o=i,l=n;for(or(t,i,r),s(t[n],a)>0&&or(t,i,n);o<l;){for(or(t,o,l),++o,--l;0>s(t[o],a);)++o;for(;s(t[l],a)>0;)--l}0===s(t[i],a)?or(t,i,l):or(t,++l,n),l<=r&&(i=l+1),r<=l&&(n=l-1)}return t})(e,s).subarray(0,s+1));return a+(oe(e.subarray(s+1))-a)*(n-s)}})(e,i/t))},r.copy=function(){return ut(t).domain(e)},sb.apply(r,arguments)}function ur(){var e,t,r,i,n,s,a,o=0,l=.5,u=1,c=1,h=a_,f=!1;function d(e){return isNaN(e*=1)?a:(e=.5+((e=+s(e))-t)*(c*e<c*t?i:n),h(f?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var r,i,n;return arguments.length?([r,i,n]=t,h=function(e,t){void 0===t&&(t=e,e=ay);for(var r=0,i=t.length-1,n=t[0],s=Array(i<0?0:i);r<i;)s[r]=e(n,n=t[++r]);return function(e){var t=Math.max(0,Math.min(i-1,Math.floor(e*=i)));return s[t](e-t)}}(e,[r,i,n]),d):[h(0),h(.5),h(1)]}}return d.domain=function(a){return arguments.length?([o,l,u]=a,e=s(o*=1),t=s(l*=1),r=s(u*=1),i=e===t?0:.5/(t-e),n=t===r?0:.5/(r-t),c=t<e?-1:1,d):[o,l,u]},d.clamp=function(e){return arguments.length?(f=!!e,d):f},d.interpolator=function(e){return arguments.length?(h=e,d):h},d.range=p(ay),d.rangeRound=p(av),d.unknown=function(e){return arguments.length?(a=e,d):a},function(a){return s=a,e=a(o),t=a(l),r=a(u),i=e===t?0:.5/(t-e),n=t===r?0:.5/(r-t),c=t<e?-1:1,d}}function ui(){var e=aF(ur()(a_));return e.copy=function(){return l6(e,ui())},sb.apply(e,arguments)}function un(){var e=aY(ur()).domain([.1,1,10]);return e.copy=function(){return l6(e,un()).base(e.base())},sb.apply(e,arguments)}function us(){var e=aQ(ur());return e.copy=function(){return l6(e,us()).constant(e.constant())},sb.apply(e,arguments)}function ua(){var e=a4(ur());return e.copy=function(){return l6(e,ua()).exponent(e.exponent())},sb.apply(e,arguments)}function uo(){return ua.apply(null,arguments).exponent(.5)}F=(z=function(e){var t=e.dateTime,r=e.date,i=e.time,n=e.periods,s=e.days,a=e.shortDays,o=e.months,l=e.shortMonths,u=oJ(n),c=oQ(n),h=oJ(s),f=oQ(s),d=oJ(a),p=oQ(a),g=oJ(o),m=oQ(o),y=oJ(l),v=oQ(l),b={a:function(e){return a[e.getDay()]},A:function(e){return s[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return o[e.getMonth()]},c:null,d:lc,e:lc,f:lg,g:lE,G:lM,H:lh,I:lf,j:ld,L:lp,m:lm,M:ly,p:function(e){return n[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:lX,s:lJ,S:lv,u:lb,U:lx,V:lw,w:lk,W:lP,x:null,X:null,y:lS,Y:lA,Z:lT,"%":lZ},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return s[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return o[e.getUTCMonth()]},c:null,d:lC,e:lC,f:lN,g:lq,G:lK,H:lO,I:lI,j:lL,L:lj,m:lD,M:lR,p:function(e){return n[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:lX,s:lJ,S:lz,u:lF,U:lB,V:l$,w:lV,W:lW,x:null,X:null,y:lG,Y:lH,Z:lY,"%":lZ},_={a:function(e,t,r){var i=d.exec(t.slice(r));return i?(e.w=p.get(i[0].toLowerCase()),r+i[0].length):-1},A:function(e,t,r){var i=h.exec(t.slice(r));return i?(e.w=f.get(i[0].toLowerCase()),r+i[0].length):-1},b:function(e,t,r){var i=y.exec(t.slice(r));return i?(e.m=v.get(i[0].toLowerCase()),r+i[0].length):-1},B:function(e,t,r){var i=g.exec(t.slice(r));return i?(e.m=m.get(i[0].toLowerCase()),r+i[0].length):-1},c:function(e,r,i){return P(e,t,r,i)},d:le,e:le,f:la,g:o5,G:o6,H:lr,I:lr,j:lt,L:ls,m:o9,M:li,p:function(e,t,r){var i=u.exec(t.slice(r));return i?(e.p=c.get(i[0].toLowerCase()),r+i[0].length):-1},q:o7,Q:ll,s:lu,S:ln,u:o1,U:o2,V:o3,w:o0,W:o4,x:function(e,t,i){return P(e,r,t,i)},X:function(e,t,r){return P(e,i,t,r)},y:o5,Y:o6,Z:o8,"%":lo};function w(e,t){return function(r){var i,n,s,a=[],o=-1,l=0,u=e.length;for(r instanceof Date||(r=new Date(+r));++o<u;)37===e.charCodeAt(o)&&(a.push(e.slice(l,o)),null!=(n=oq[i=e.charAt(++o)])?i=e.charAt(++o):n="e"===i?" ":"0",(s=t[i])&&(i=s(r,n)),a.push(i),l=o+1);return a.push(e.slice(l,o)),a.join("")}}function k(e,t){return function(r){var i,n,s=oG(1900,void 0,1);if(P(s,e,r+="",0)!=r.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(!t||"Z"in s||(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(i=(n=(i=oW(oG(s.y,0,1))).getUTCDay())>4||0===n?ok.ceil(i):ok(i),i=oC.offset(i,(s.V-1)*7),s.y=i.getUTCFullYear(),s.m=i.getUTCMonth(),s.d=i.getUTCDate()+(s.w+6)%7):(i=(n=(i=oV(oG(s.y,0,1))).getDay())>4||0===n?og.ceil(i):og(i),i=oT.offset(i,(s.V-1)*7),s.y=i.getFullYear(),s.m=i.getMonth(),s.d=i.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:+("W"in s)),n="Z"in s?oW(oG(s.y,0,1)).getUTCDay():oV(oG(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(n+5)%7:s.w+7*s.U-(n+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,oW(s)):oV(s)}}function P(e,t,r,i){for(var n,s,a=0,o=t.length,l=r.length;a<o;){if(i>=l)return -1;if(37===(n=t.charCodeAt(a++))){if(!(s=_[(n=t.charAt(a++))in oq?t.charAt(a++):n])||(i=s(e,r,i))<0)return -1}else if(n!=r.charCodeAt(i++))return -1}return i}return b.x=w(r,b),b.X=w(i,b),b.c=w(t,b),x.x=w(r,x),x.X=w(i,x),x.c=w(t,x),{format:function(e){var t=w(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})).format,z.parse,B=z.utcFormat,z.utcParse,e.s(["scaleBand",()=>sS,"scaleDiverging",()=>ui,"scaleDivergingLog",()=>un,"scaleDivergingPow",()=>ua,"scaleDivergingSqrt",()=>uo,"scaleDivergingSymlog",()=>us,"scaleIdentity",()=>aU,"scaleImplicit",0,sk,"scaleLinear",()=>aB,"scaleLog",()=>aZ,"scaleOrdinal",()=>sP,"scalePoint",()=>sE,"scalePow",()=>a6,"scaleQuantile",()=>oi,"scaleQuantize",()=>on,"scaleRadial",()=>a7,"scaleSequential",()=>l5,"scaleSequentialLog",()=>l8,"scaleSequentialPow",()=>l9,"scaleSequentialQuantile",()=>ut,"scaleSequentialSqrt",()=>ue,"scaleSequentialSymlog",()=>l7,"scaleSqrt",()=>a5,"scaleSymlog",()=>a0,"scaleThreshold",()=>os,"scaleTime",()=>l2,"scaleUtc",()=>l3,"tickFormat",()=>az],29061),e.i(29061),e.s(["scaleBand",()=>sS,"scaleDiverging",()=>ui,"scaleDivergingLog",()=>un,"scaleDivergingPow",()=>ua,"scaleDivergingSqrt",()=>uo,"scaleDivergingSymlog",()=>us,"scaleIdentity",()=>aU,"scaleImplicit",0,sk,"scaleLinear",()=>aB,"scaleLog",()=>aZ,"scaleOrdinal",()=>sP,"scalePoint",()=>sE,"scalePow",()=>a6,"scaleQuantile",()=>oi,"scaleQuantize",()=>on,"scaleRadial",()=>a7,"scaleSequential",()=>l5,"scaleSequentialLog",()=>l8,"scaleSequentialPow",()=>l9,"scaleSequentialQuantile",()=>ut,"scaleSequentialSqrt",()=>ue,"scaleSequentialSymlog",()=>l7,"scaleSqrt",()=>a5,"scaleSymlog",()=>a0,"scaleThreshold",()=>os,"scaleTime",()=>l2,"scaleUtc",()=>l3,"tickFormat",()=>az],79357);var ul=e.i(79357);function uu(e){return null!=e}var uc=e=>e.chartData,uh=rq([uc],e=>{var t=null!=e.chartData?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),uf=(e,t,r,i)=>i?uh(e):uc(e);function ud(e){if(Array.isArray(e)&&2===e.length){var[t,r]=e;if(eQ(t)&&eQ(r))return!0}return!1}function up(e,t,r){return r?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function ug(e,t){if(t&&"function"!=typeof e&&Array.isArray(e)&&2===e.length){var r,i,[n,s]=e;if(eQ(n))r=n;else if("function"==typeof n)return;if(eQ(s))i=s;else if("function"==typeof s)return;var a=[r,i];if(ud(a))return a}}var um=e.i(51655),uy=e=>e,uv={},ub=e=>function t(){let r;return 0==arguments.length||1==arguments.length&&(r=arguments.length<=0?void 0:arguments[0],r===uv)?t:e(...arguments)},ux=(e,t)=>1===e?t:ub(function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];var s=i.filter(e=>e!==uv).length;return s>=e?t(...i):ux(e-s,ub(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t(...i.map(e=>e===uv?r.shift():e),...r)}))}),u_=(e,t)=>{for(var r=[],i=e;i<t;++i)r[i-e]=i;return r},uw=ux((o=(e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(e=>t[e]).map(e)).length,o),uk=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return uy;var i=t.reverse(),n=i[0],s=i.slice(1);return function(){return s.reduce((e,t)=>t(e),n(...arguments))}},uP=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join(""),uS=e=>{var t=null,r=null;return function(){for(var i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];return t&&n.every((e,r)=>{var i;return e===(null==(i=t)?void 0:i[r])})?r:(t=n,r=e(...n))}};function uE(e){return 0===e?1:Math.floor(new um.default(e).abs().log(10).toNumber())+1}function uA(e,t,r){for(var i=new um.default(e),n=0,s=[];i.lt(t)&&n<1e5;)s.push(i.toNumber()),i=i.add(r),n++;return s}ux((l=(e,t,r)=>{var i=+e;return i+r*(t-i)}).length,l),ux((u=(e,t,r)=>{var i=t-e;return(r-e)/(i=i||1/0)}).length,u),ux((c=(e,t,r)=>{var i=t-e;return Math.max(0,Math.min(1,(r-e)/(i=i||1/0)))}).length,c);var uM=e=>{var[t,r]=e,[i,n]=[t,r];return t>r&&([i,n]=[r,t]),[i,n]},uT=(e,t,r)=>{if(e.lte(0))return new um.default(0);var i=uE(e.toNumber()),n=new um.default(10).pow(i),s=e.div(n),a=1!==i?.05:.1,o=new um.default(Math.ceil(s.div(a).toNumber())).add(r).mul(a).mul(n);return new um.default(t?o.toNumber():Math.ceil(o.toNumber()))},uC=function(e,t,r,i){var n,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new um.default(0),tickMin:new um.default(0),tickMax:new um.default(0)};var a=uT(new um.default(t).sub(e).div(r-1),i,s),o=Math.ceil((n=e<=0&&t>=0?new um.default(0):(n=new um.default(e).add(t).div(2)).sub(new um.default(n).mod(a))).sub(e).div(a).toNumber()),l=Math.ceil(new um.default(t).sub(n).div(a).toNumber()),u=o+l+1;return u>r?uC(e,t,r,i,s+1):(u<r&&(l=t>0?l+(r-u):l,o=t>0?o:o+(r-u)),{step:a,tickMin:n.sub(new um.default(o).mul(a)),tickMax:n.add(new um.default(l).mul(a))})},uO=uS(function(e){var[t,r]=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=Math.max(i,2),[a,o]=uM([t,r]);if(a===-1/0||o===1/0){var l=o===1/0?[a,...u_(0,i-1).map(()=>1/0)]:[...u_(0,i-1).map(()=>-1/0),o];return t>r?uP(l):l}if(a===o){var u=new um.default(1),c=new um.default(a);if(!c.isint()&&n){var h=Math.abs(a);h<1?(u=new um.default(10).pow(uE(a)-1),c=new um.default(Math.floor(c.div(u).toNumber())).mul(u)):h>1&&(c=new um.default(Math.floor(a)))}else 0===a?c=new um.default(Math.floor((i-1)/2)):n||(c=new um.default(Math.floor(a)));var f=Math.floor((i-1)/2);return uk(uw(e=>c.add(new um.default(e-f).mul(u)).toNumber()),u_)(0,i)}var{step:d,tickMin:p,tickMax:g}=uC(a,o,s,n,0),m=uA(p,g.add(new um.default(.1).mul(d)),d);return t>r?uP(m):m}),uI=uS(function(e,t){var[r,i]=e,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,a]=uM([r,i]);if(s===-1/0||a===1/0)return[r,i];if(s===a)return[s];var o=Math.max(t,2),l=uT(new um.default(a).sub(s).div(o-1),n,0),u=[...uA(new um.default(s),new um.default(a),l),a];return!1===n&&(u=u.map(e=>Math.round(e))),r>i?uP(u):u}),uL=e=>e.rootProps.stackOffset,uj=e=>e.options.chartName,uN=e=>e.rootProps.syncId,uD=e=>e.rootProps.syncMethod,uR=e=>e.options.eventEmitter,uz=(e,t)=>t,uF=(e,t,r)=>r;function uB(e){return null==e?void 0:e.id}var uU=e=>{var t=nR(e);return"horizontal"===t?"xAxis":"vertical"===t?"yAxis":"centric"===t?"angleAxis":"radiusAxis"},u$=e=>e.tooltip.settings.axisId,uV=e=>{var t=uU(e),r=u$(e);return u8(e,t,r)},uW=rq([uV],e=>null==e?void 0:e.dataKey);function uG(e,t,r){var{chartData:i=[]}=t,{allowDuplicatedCategory:n,dataKey:s}=r,a=new Map;return e.forEach(e=>{var t,r=null!=(t=e.data)?t:i;if(null!=r&&0!==r.length){var o=uB(e);r.forEach((t,r)=>{var i,l=null==s||n?r:String(i3(t,s,null)),u=i3(t,e.dataKey,0);Object.assign(i=a.has(l)?a.get(l):{},{[o]:u}),a.set(l,i)})}}),Array.from(a.values())}function uq(e){return null!=e.stackId&&null!=e.dataKey}var uH=(e,t)=>e===t||null!=e&&null!=t&&e[0]===t[0]&&e[1]===t[1];function uK(e,t){return!!(Array.isArray(e)&&Array.isArray(t))&&0===e.length&&0===t.length||e===t}function uY(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function uZ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?uY(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uY(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var uX=[0,"auto"],uJ={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},uQ=(e,t)=>e.cartesianAxis.xAxis[t],u0=(e,t)=>{var r=uQ(e,t);return null==r?uJ:r},u1={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:uX,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:60},u2=(e,t)=>e.cartesianAxis.yAxis[t],u3=(e,t)=>{var r=u2(e,t);return null==r?u1:r},u4={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},u6=(e,t)=>{var r=e.cartesianAxis.zAxis[t];return null==r?u4:r},u5=(e,t,r)=>{switch(t){case"xAxis":return u0(e,r);case"yAxis":return u3(e,r);case"zAxis":return u6(e,r);case"angleAxis":return nq(e,r);case"radiusAxis":return nH(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},u8=(e,t,r)=>{switch(t){case"xAxis":return u0(e,r);case"yAxis":return u3(e,r);case"angleAxis":return nq(e,r);case"radiusAxis":return nH(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},u7=e=>e.graphicalItems.cartesianItems.some(e=>"bar"===e.type)||e.graphicalItems.polarItems.some(e=>"radialBar"===e.type);function u9(e,t){return r=>{switch(e){case"xAxis":return"xAxisId"in r&&r.xAxisId===t;case"yAxis":return"yAxisId"in r&&r.yAxisId===t;case"zAxis":return"zAxisId"in r&&r.zAxisId===t;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===t;default:return!1}}}var ce=e=>e.graphicalItems.cartesianItems,ct=rq([uz,uF],u9),cr=(e,t,r)=>e.filter(r).filter(e=>(null==t?void 0:t.includeHidden)===!0||!e.hide),ci=rq([ce,u5,ct],cr,{memoizeOptions:{resultEqualityCheck:uK}}),cn=rq([ci],e=>e.filter(e=>"area"===e.type||"bar"===e.type).filter(uq)),cs=e=>e.filter(e=>!("stackId"in e)||void 0===e.stackId),ca=rq([ci],cs),co=e=>e.map(e=>e.data).filter(Boolean).flat(1),cl=rq([ci],co,{memoizeOptions:{resultEqualityCheck:uK}}),cu=(e,t)=>{var{chartData:r=[],dataStartIndex:i,dataEndIndex:n}=t;return e.length>0?e:r.slice(i,n+1)},cc=rq([cl,uf],cu),ch=(e,t,r)=>(null==t?void 0:t.dataKey)!=null?e.map(e=>({value:i3(e,t.dataKey)})):r.length>0?r.map(e=>e.dataKey).flatMap(t=>e.map(e=>({value:i3(e,t)}))):e.map(e=>({value:e})),cf=rq([cc,u5,ci],ch);function cd(e,t){switch(e){case"xAxis":return"x"===t.direction;case"yAxis":return"y"===t.direction;default:return!1}}function cp(e){if(eG(e)||e instanceof Date){var t=Number(e);if(eQ(t))return t}}function cg(e){if(Array.isArray(e)){var t=[cp(e[0]),cp(e[1])];return ud(t)?t:void 0}var r=cp(e);if(null!=r)return[r,r]}function cm(e){return e.map(cp).filter(uu)}var cy=rq([cn,uf,uV],uG),cv=(e,t,r)=>Object.fromEntries(Object.entries(t.reduce((e,t)=>(null==t.stackId||(null==e[t.stackId]&&(e[t.stackId]=[]),e[t.stackId].push(t)),e),{})).map(t=>{var i,[n,s]=t,a=s.map(uB);return[n,{stackedData:(i=i8[r],(function(){var e=el([]),t=iX,r=iZ,i=iJ;function n(n){var s,a,o=Array.from(e.apply(this,arguments),iQ),l=o.length,u=-1;for(let e of n)for(s=0,++u;s<l;++s)(o[s][u]=[0,+i(e,o[s].key,u,n)]).data=e;for(s=0,a=eo(t(o));s<l;++s)o[a[s]].index=s;return r(o,a),o}return n.keys=function(t){return arguments.length?(e="function"==typeof t?t:el(Array.from(t)),n):e},n.value=function(e){return arguments.length?(i="function"==typeof e?e:el(+e),n):i},n.order=function(e){return arguments.length?(t=null==e?iX:"function"==typeof e?e:el(Array.from(e)),n):t},n.offset=function(e){return arguments.length?(r=null==e?iZ:e,n):r},n})().keys(a).value((e,t)=>+i3(e,t,0)).order(iX).offset(i)(e)),graphicalItems:s}]})),cb=rq([cy,cn,uL],cv),cx=(e,t,r,i)=>{var{dataStartIndex:n,dataEndIndex:s}=t;if(null==i&&"zAxis"!==r){var a=((e,t,r)=>{if(null!=e){let i;return[(i=Object.keys(e).reduce((i,n)=>{var{stackedData:s}=e[n],a=s.reduce((e,i)=>{var n,s=[Math.min(...n=i0(i,t,r).flat(2).filter(eW)),Math.max(...n)];return[Math.min(e[0],s[0]),Math.max(e[1],s[1])]},[1/0,-1/0]);return[Math.min(a[0],i[0]),Math.max(a[1],i[1])]},[1/0,-1/0]))[0]===1/0?0:i[0],i[1]===-1/0?0:i[1]]}})(e,n,s);if(null==a||0!==a[0]||0!==a[1])return a}},c_=rq([u5],e=>e.allowDataOverflow),cw=e=>{var t;if(null==e||!("domain"in e))return uX;if(null!=e.domain)return e.domain;if(null!=e.ticks){if("number"===e.type){var r=cm(e.ticks);return[Math.min(...r),Math.max(...r)]}if("category"===e.type)return e.ticks.map(String)}return null!=(t=null==e?void 0:e.domain)?t:uX},ck=rq([u5],cw),cP=rq([ck,c_],ug),cS=rq([cb,uc,uz,cP],cx,{memoizeOptions:{resultEqualityCheck:uH}}),cE=e=>e.errorBars,cA=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.filter(Boolean);if(0!==i.length){var n=i.flat();return[Math.min(...n),Math.max(...n)]}},cM=(e,t,r,i,n)=>{var s,a;if(r.length>0&&e.forEach(e=>{r.forEach(r=>{var o,l,u=null==(o=i[r.id])?void 0:o.filter(e=>cd(n,e)),c=i3(e,null!=(l=t.dataKey)?l:r.dataKey),h=!(!u||"number"!=typeof c||e$(c))&&u.length?cm(u.flatMap(t=>{var r,i,n=i3(e,t.dataKey);if(Array.isArray(n)?[r,i]=n:r=i=n,eQ(r)&&eQ(i))return[c-r,c+i]})):[];if(h.length>=2){var f=Math.min(...h),d=Math.max(...h);(null==s||f<s)&&(s=f),(null==a||d>a)&&(a=d)}var p=cg(c);null!=p&&(s=null==s?p[0]:Math.min(s,p[0]),a=null==a?p[1]:Math.max(a,p[1]))})}),(null==t?void 0:t.dataKey)!=null&&e.forEach(e=>{var r=cg(i3(e,t.dataKey));null!=r&&(s=null==s?r[0]:Math.min(s,r[0]),a=null==a?r[1]:Math.max(a,r[1]))}),eQ(s)&&eQ(a))return[s,a]},cT=rq([cc,u5,ca,cE,uz],cM,{memoizeOptions:{resultEqualityCheck:uH}});function cC(e){var{value:t}=e;if(eG(t)||t instanceof Date)return t}var cO=e=>e.referenceElements.dots,cI=(e,t,r)=>e.filter(e=>"extendDomain"===e.ifOverflow).filter(e=>"xAxis"===t?e.xAxisId===r:e.yAxisId===r),cL=rq([cO,uz,uF],cI),cj=e=>e.referenceElements.areas,cN=rq([cj,uz,uF],cI),cD=e=>e.referenceElements.lines,cR=rq([cD,uz,uF],cI),cz=(e,t)=>{var r=cm(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},cF=rq(cL,uz,cz),cB=(e,t)=>{var r=cm(e.flatMap(e=>["xAxis"===t?e.x1:e.y1,"xAxis"===t?e.x2:e.y2]));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},cU=rq([cN,uz],cB),c$=(e,t)=>{var r=cm(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},cV=rq(cR,uz,c$),cW=rq(cF,cV,cU,(e,t,r)=>cA(e,r,t)),cG=(e,t,r,i,n,s,a,o)=>null!=r?r:function(e,t,r){if(r||null!=t){if("function"==typeof e&&null!=t)try{var i=e(t,r);if(ud(i))return up(i,t,r)}catch(e){}if(Array.isArray(e)&&2===e.length){var n,s,[a,o]=e;if("auto"===a)null!=t&&(n=Math.min(...t));else if(eW(a))n=a;else if("function"==typeof a)try{null!=t&&(n=a(null==t?void 0:t[0]))}catch(e){}else if("string"==typeof a&&i9.test(a)){var l=i9.exec(a);if(null==l||null==t)n=void 0;else{var u=+l[1];n=t[0]-u}}else n=null==t?void 0:t[0];if("auto"===o)null!=t&&(s=Math.max(...t));else if(eW(o))s=o;else if("function"==typeof o)try{null!=t&&(s=o(null==t?void 0:t[1]))}catch(e){}else if("string"==typeof o&&ne.test(o)){var c=ne.exec(o);if(null==c||null==t)s=void 0;else{var h=+c[1];s=t[1]+h}}else s=null==t?void 0:t[1];var f=[n,s];if(ud(f))return null==t?f:up(f,t,r)}}}(t,"vertical"===a&&"xAxis"===o||"horizontal"===a&&"yAxis"===o?cA(i,s,n):cA(s,n),e.allowDataOverflow),cq=rq([u5,ck,cP,cS,cT,cW,nR,uz],cG,{memoizeOptions:{resultEqualityCheck:uH}}),cH=[0,1],cK=(e,t,r,i,n,s,a)=>{if(null!=e&&null!=r&&0!==r.length||void 0!==a){var o,{dataKey:l,type:u}=e,c=i4(t,s);return c&&null==l?(0,sy.default)(0,r.length):"category"===u?(o=i.map(cC).filter(e=>null!=e),c&&(null==e.dataKey||e.allowDuplicatedCategory&&eY(o))?(0,sy.default)(0,i.length):e.allowDuplicatedCategory?o:Array.from(new Set(o))):"expand"===n?cH:a}},cY=rq([u5,nR,cc,cf,uL,uz,cq],cK),cZ=(e,t,r,i,n)=>{if(null!=e){var{scale:s,type:a}=e;if("auto"===s)return"radial"===t&&"radiusAxis"===n?"band":"radial"===t&&"angleAxis"===n?"linear":"category"===a&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!r)?"point":"category"===a?"band":"linear";if("string"==typeof s){var o="scale".concat(eJ(s));return o in ul?o:"point"}}},cX=rq([u5,nR,u7,uj,uz],cZ);function cJ(e,t,r,i){if(null!=r&&null!=i){if("function"==typeof e.scale)return e.scale.copy().domain(r).range(i);var n=function(e){if(null!=e){if(e in ul)return ul[e]();var t="scale".concat(eJ(e));if(t in ul)return ul[t]()}}(t);if(null!=n){var s=n.domain(r).range(i);return(e=>{var t=e.domain();if(t&&!(t.length<=2)){var r=t.length,i=e.range(),n=Math.min(i[0],i[1])-1e-4,s=Math.max(i[0],i[1])+1e-4,a=e(t[0]),o=e(t[r-1]);(a<n||a>s||o<n||o>s)&&e.domain([t[0],t[r-1]])}})(s),s}}}var cQ=(e,t,r)=>{var i=cw(t);if("auto"===r||"linear"===r){if(null!=t&&t.tickCount&&Array.isArray(i)&&("auto"===i[0]||"auto"===i[1])&&ud(e))return uO(e,t.tickCount,t.allowDecimals);if(null!=t&&t.tickCount&&"number"===t.type&&ud(e))return uI(e,t.tickCount,t.allowDecimals)}},c0=rq([cY,u8,cX],cQ),c1=(e,t,r,i)=>"angleAxis"!==i&&(null==e?void 0:e.type)==="number"&&ud(t)&&Array.isArray(r)&&r.length>0?[Math.min(t[0],r[0]),Math.max(t[1],r[r.length-1])]:t,c2=rq([u5,cY,c0,uz],c1),c3=rq(cf,u5,(e,t)=>{if(t&&"number"===t.type){var r=1/0,i=Array.from(cm(e.map(e=>e.value))).sort((e,t)=>e-t);if(i.length<2)return 1/0;var n=i[i.length-1]-i[0];if(0===n)return 1/0;for(var s=0;s<i.length-1;s++)r=Math.min(r,i[s+1]-i[s]);return r/n}}),c4=rq(c3,nR,e=>e.rootProps.barCategoryGap,nf,(e,t,r,i)=>i,(e,t,r,i,n)=>{if(!eQ(e))return 0;var s="vertical"===t?i.height:i.width;if("gap"===n)return e*s/2;if("no-gap"===n){var a=eK(r,e*s),o=e*s/2;return o-a-(o-a)/s*a}return 0}),c6=rq(u0,(e,t)=>{var r=u0(e,t);return null==r||"string"!=typeof r.padding?0:c4(e,"xAxis",t,r.padding)},(e,t)=>{if(null==e)return{left:0,right:0};var r,i,{padding:n}=e;return"string"==typeof n?{left:t,right:t}:{left:(null!=(r=n.left)?r:0)+t,right:(null!=(i=n.right)?i:0)+t}}),c5=rq(u3,(e,t)=>{var r=u3(e,t);return null==r||"string"!=typeof r.padding?0:c4(e,"yAxis",t,r.padding)},(e,t)=>{if(null==e)return{top:0,bottom:0};var r,i,{padding:n}=e;return"string"==typeof n?{top:t,bottom:t}:{top:(null!=(r=n.top)?r:0)+t,bottom:(null!=(i=n.bottom)?i:0)+t}}),c8=rq([nf,c6,nv,ny,(e,t,r)=>r],(e,t,r,i,n)=>{var{padding:s}=i;return n?[s.left,r.width-s.right]:[e.left+t.left,e.left+e.width-t.right]}),c7=rq([nf,nR,c5,nv,ny,(e,t,r)=>r],(e,t,r,i,n,s)=>{var{padding:a}=n;return s?[i.height-a.bottom,a.top]:"horizontal"===t?[e.top+e.height-r.bottom,e.top+r.top]:[e.top+r.top,e.top+e.height-r.bottom]}),c9=(e,t,r,i)=>{var n;switch(t){case"xAxis":return c8(e,r,i);case"yAxis":return c7(e,r,i);case"zAxis":return null==(n=u6(e,r))?void 0:n.range;case"angleAxis":return nJ(e);case"radiusAxis":return nQ(e,r);default:return}},he=rq([u5,c9],nU),ht=rq([u5,cX,c2,he],cJ);function hr(e,t){return e.id<t.id?-1:+(e.id>t.id)}rq([ci,cE,uz],(e,t,r)=>e.flatMap(e=>t[e.id]).filter(Boolean).filter(e=>cd(r,e)));var hi=(e,t)=>t,hn=(e,t,r)=>r,hs=rq(nl,hi,hn,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(hr)),ha=rq(nu,hi,hn,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(hr)),ho=(e,t)=>({width:e.width,height:t.height}),hl=rq(nf,u0,ho),hu=rq(ns,nf,hs,hi,hn,(e,t,r,i,n)=>{var s,a={};return r.forEach(r=>{var o=ho(t,r);null==s&&(s=((e,t,r)=>{switch(t){case"top":return e.top;case"bottom":return r-e.bottom;default:return 0}})(t,i,e));var l="top"===i&&!n||"bottom"===i&&n;a[r.id]=s-Number(l)*o.height,s+=(l?-1:1)*o.height}),a}),hc=rq(nn,nf,ha,hi,hn,(e,t,r,i,n)=>{var s,a={};return r.forEach(r=>{var o={width:"number"==typeof r.width?r.width:60,height:t.height};null==s&&(s=((e,t,r)=>{switch(t){case"left":return e.left;case"right":return r-e.right;default:return 0}})(t,i,e));var l="left"===i&&!n||"right"===i&&n;a[r.id]=s-Number(l)*o.width,s+=(l?-1:1)*o.width}),a}),hh=rq([nf,u0,(e,t)=>{var r=u0(e,t);if(null!=r)return hu(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,i)=>{if(null!=t){var n=null==r?void 0:r[i];return null==n?{x:e.left,y:0}:{x:e.left,y:n}}}),hf=rq([nf,u3,(e,t)=>{var r=u3(e,t);if(null!=r)return hc(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,i)=>{if(null!=t){var n=null==r?void 0:r[i];return null==n?{x:0,y:e.top}:{x:n,y:e.top}}}),hd=rq(nf,u3,(e,t)=>({width:"number"==typeof t.width?t.width:60,height:e.height})),hp=(e,t,r,i)=>{if(null!=r){var{allowDuplicatedCategory:n,type:s,dataKey:a}=r,o=i4(e,i),l=t.map(e=>e.value);if(a&&o&&"category"===s&&n&&eY(l))return l}},hg=rq([nR,cf,u5,uz],hp),hm=(e,t,r,i)=>{if(null!=r&&null!=r.dataKey){var{type:n,scale:s}=r;if(i4(e,i)&&("number"===n||"auto"!==s))return t.map(e=>e.value)}},hy=rq([nR,cf,u8,uz],hm),hv=rq([nR,(e,t,r)=>{switch(t){case"xAxis":return u0(e,r);case"yAxis":return u3(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},cX,ht,hg,hy,c9,c0,uz],(e,t,r,i,n,s,a,o,l)=>{if(null==t)return null;var u=i4(e,l);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:l,categoricalDomain:s,duplicateDomain:n,isCategorical:u,niceTicks:o,range:a,realScaleType:r,scale:i}}),hb=rq([nR,u8,cX,ht,c0,c9,hg,hy,uz],(e,t,r,i,n,s,a,o,l)=>{if(null!=t&&null!=i){var u=i4(e,l),{type:c,ticks:h,tickCount:f}=t,d="scaleBand"===r&&"function"==typeof i.bandwidth?i.bandwidth()/2:2,p="category"===c&&i.bandwidth?i.bandwidth()/d:0;p="angleAxis"===l&&null!=s&&s.length>=2?2*eU(s[0]-s[1])*p:p;var g=h||n;return g?g.map((e,t)=>({index:t,coordinate:i(a?a.indexOf(e):e)+p,value:e,offset:p})).filter(e=>!e$(e.coordinate)):u&&o?o.map((e,t)=>({coordinate:i(e)+p,value:e,index:t,offset:p})):i.ticks?i.ticks(f).map(e=>({coordinate:i(e)+p,value:e,offset:p})):i.domain().map((e,t)=>({coordinate:i(e)+p,value:a?a[e]:e,index:t,offset:p}))}}),hx=rq([nR,u8,ht,c9,hg,hy,uz],(e,t,r,i,n,s,a)=>{if(null!=t&&null!=r&&null!=i&&i[0]!==i[1]){var o=i4(e,a),{tickCount:l}=t,u=0;return(u="angleAxis"===a&&(null==i?void 0:i.length)>=2?2*eU(i[0]-i[1])*u:u,o&&s)?s.map((e,t)=>({coordinate:r(e)+u,value:e,index:t,offset:u})):r.ticks?r.ticks(l).map(e=>({coordinate:r(e)+u,value:e,offset:u})):r.domain().map((e,t)=>({coordinate:r(e)+u,value:n?n[e]:e,index:t,offset:u}))}}),h_=rq(u5,ht,(e,t)=>{if(null!=e&&null!=t)return uZ(uZ({},e),{},{scale:t})}),hw=rq([u5,cX,cY,he],cJ);rq((e,t,r)=>u6(e,r),hw,(e,t)=>{if(null!=e&&null!=t)return uZ(uZ({},e),{},{scale:t})});var hk=rq([nR,nl,nu],(e,t,r)=>{switch(e){case"horizontal":return t.some(e=>e.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(e=>e.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),hP=e=>e.options.defaultTooltipEventType,hS=e=>e.options.validateTooltipEventTypes;function hE(e,t,r){if(null==e)return t;var i=e?"axis":"item";return null==r?t:r.includes(i)?i:t}function hA(e,t){return hE(t,hP(e),hS(e))}var hM=(e,t)=>{var r,i=Number(t);if(!e$(i)&&null!=t)return i>=0?null==e||null==(r=e[i])?void 0:r.value:void 0},hT={active:!1,index:null,dataKey:void 0,coordinate:void 0},hC=io({name:"tooltip",initialState:{itemInteraction:{click:hT,hover:hT},axisInteraction:{click:hT,hover:hT},keyboardInteraction:hT,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:ie()},removeTooltipEntrySettings:{reducer(e,t){var r=rA(e).tooltipItemPayloads.indexOf(t.payload);r>-1&&e.tooltipItemPayloads.splice(r,1)},prepare:ie()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:hO,removeTooltipEntrySettings:hI,setTooltipSettingsState:hL,setActiveMouseOverItemIndex:hj,mouseLeaveItem:hN,mouseLeaveChart:hD,setActiveClickItemIndex:hR,setMouseOverAxisIndex:hz,setMouseClickAxisIndex:hF,setSyncInteraction:hB,setKeyboardInteraction:hU}=hC.actions,h$=hC.reducer;function hV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function hW(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hV(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hV(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var hG=(e,t,r,i)=>{if(null==t)return hT;var n,s,a,o=(n=e,s=t,a=r,"axis"===s?"click"===a?n.axisInteraction.click:n.axisInteraction.hover:"click"===a?n.itemInteraction.click:n.itemInteraction.hover);if(null==o)return hT;if(o.active)return o;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&null!=e.syncInteraction.index)return e.syncInteraction;var l=!0===e.settings.active;if(null!=o.index){if(l)return hW(hW({},o),{},{active:!0})}else if(null!=i)return{active:!0,coordinate:void 0,dataKey:void 0,index:i};return hW(hW({},hT),{},{coordinate:o.coordinate})},hq=(e,t)=>{var r=null==e?void 0:e.index;if(null==r)return null;var i=Number(r);if(!eQ(i))return r;var n=Infinity;return t.length>0&&(n=t.length-1),String(Math.max(0,Math.min(i,n)))},hH=(e,t,r,i,n,s,a,o)=>{if(null!=s&&null!=o){var l=a[0],u=null==l?void 0:o(l.positions,s);if(null!=u)return u;var c=null==n?void 0:n[Number(s)];if(c)if("horizontal"===r)return{x:c.coordinate,y:(i.top+t)/2};else return{x:(i.left+e)/2,y:c.coordinate}}},hK=(e,t,r,i)=>{var n;return"axis"===t?e.tooltipItemPayloads:0===e.tooltipItemPayloads.length?[]:null==(n="hover"===r?e.itemInteraction.hover.dataKey:e.itemInteraction.click.dataKey)&&null!=i?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(e=>{var t;return(null==(t=e.settings)?void 0:t.dataKey)===n})},hY=e=>e.options.tooltipPayloadSearcher,hZ=e=>e.tooltip;function hX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function hJ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hX(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hX(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var hQ=(e,t,r,i,n,s,a)=>{if(null!=t&&null!=s){var{chartData:o,computedData:l,dataStartIndex:u,dataEndIndex:c}=r;return e.reduce((e,r)=>{var h,f,d,{dataDefinedOnItem:p,settings:g}=r,m=null!=p?p:o,y=Array.isArray(m)?i0(m,u,c):m,v=null!=(h=null==g?void 0:g.dataKey)?h:i,b=null==g?void 0:g.nameKey;return Array.isArray(f=i&&Array.isArray(y)&&!Array.isArray(y[0])&&"axis"===a?eX(y,i,n):s(y,t,l,b))?f.forEach(t=>{var r=hJ(hJ({},g),{},{name:t.name,unit:t.unit,color:void 0,fill:void 0});e.push(nr({tooltipEntrySettings:r,dataKey:t.dataKey,payload:t.payload,value:i3(t.payload,t.dataKey),name:t.name}))}):e.push(nr({tooltipEntrySettings:g,dataKey:v,payload:f,value:i3(f,v),name:null!=(d=i3(f,b))?d:null==g?void 0:g.name})),e},[])}},h0=rq([uV,nR,u7,uj,uU],cZ),h1=rq([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),h2=rq([uU,u$],u9),h3=rq([h1,uV,h2],cr,{memoizeOptions:{resultEqualityCheck:uK}}),h4=rq([h3],e=>e.filter(uq)),h6=rq([h3],co,{memoizeOptions:{resultEqualityCheck:uK}}),h5=rq([h6,uc],cu),h8=rq([h4,uc,uV],uG),h7=rq([h5,uV,h3],ch),h9=rq([uV],cw),fe=rq([uV],e=>e.allowDataOverflow),ft=rq([h9,fe],ug),fr=rq([h3],e=>e.filter(uq)),fi=rq([h8,fr,uL],cv),fn=rq([fi,uc,uU,ft],cx),fs=rq([h3],cs),fa=rq([h5,uV,fs,cE,uU],cM,{memoizeOptions:{resultEqualityCheck:uH}}),fo=rq([cO,uU,u$],cI),fl=rq([fo,uU],cz),fu=rq([cj,uU,u$],cI),fc=rq([fu,uU],cB),fh=rq([cD,uU,u$],cI),ff=rq([fh,uU],c$),fd=rq([fl,ff,fc],cA),fp=rq([uV,h9,ft,fn,fa,fd,nR,uU],cG),fg=rq([uV,nR,h5,h7,uL,uU,fp],cK),fm=rq([fg,uV,h0],cQ),fy=rq([uV,fg,fm,uU],c1),fv=e=>{var t=uU(e),r=u$(e);return c9(e,t,r,!1)},fb=rq([uV,fv],nU),fx=rq([uV,h0,fy,fb],cJ),f_=rq([nR,h7,uV,uU],hp),fw=rq([nR,h7,uV,uU],hm),fk=rq([nR,uV,h0,fx,fv,f_,fw,uU],(e,t,r,i,n,s,a,o)=>{if(t){var{type:l}=t,u=i4(e,o);if(i){var c="scaleBand"===r&&i.bandwidth?i.bandwidth()/2:2,h="category"===l&&i.bandwidth?i.bandwidth()/c:0;return(h="angleAxis"===o&&null!=n&&(null==n?void 0:n.length)>=2?2*eU(n[0]-n[1])*h:h,u&&a)?a.map((e,t)=>({coordinate:i(e)+h,value:e,index:t,offset:h})):i.domain().map((e,t)=>({coordinate:i(e)+h,value:s?s[e]:e,index:t,offset:h}))}}}),fP=rq([hP,hS,e=>e.tooltip.settings],(e,t,r)=>hE(r.shared,e,t)),fS=e=>e.tooltip.settings.trigger,fE=e=>e.tooltip.settings.defaultIndex,fA=rq([hZ,fP,fS,fE],hG),fM=rq([fA,h5],hq),fT=rq([fk,fM],hM),fC=rq([fA],e=>{if(e)return e.dataKey}),fO=rq([hZ,fP,fS,fE],hK),fI=rq([nn,ns,nR,nf,fk,fE,fO,hY],hH),fL=rq([fA,fI],(e,t)=>null!=e&&e.coordinate?e.coordinate:t),fj=rq([fA],e=>e.active),fN=rq([fO,fM,uc,uW,fT,hY,fP],hQ),fD=rq([fN],e=>{if(null!=e)return Array.from(new Set(e.map(e=>e.payload).filter(e=>null!=e)))});function fR(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function fz(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fR(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fR(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var fF=io({name:"cartesianAxis",initialState:{xAxis:{},yAxis:{},zAxis:{}},reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:ie()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:ie()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:ie()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:ie()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:ie()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:ie()},updateYAxisWidth(e,t){var{id:r,width:i}=t.payload,n=e.yAxis[r];if(n){var s=n.widthHistory||[];if(3===s.length&&s[0]===s[2]&&i===s[1]&&i!==n.width&&1>=Math.abs(i-s[0]))return;var a=[...s,i].slice(-3);e.yAxis[r]=fz(fz({},e.yAxis[r]),{},{width:i,widthHistory:a})}}}}),{addXAxis:fB,removeXAxis:fU,addYAxis:f$,removeYAxis:fV,addZAxis:fW,removeZAxis:fG,updateYAxisWidth:fq}=fF.actions,fH=fF.reducer,fK=rq([nf],e=>{if(e)return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}),fY=rq([fK,nn,ns],(e,t,r)=>{if(e&&null!=t&&null!=r)return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,r-e.top-e.bottom)}});function fZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function fX(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fZ(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fZ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function fJ(e){var{points:t,mainColor:r,activeDot:i,itemDataKey:n}=e,s=tZ(fM),a=tZ(fD);if(null==t||null==a)return null;var o=t.find(e=>a.includes(e.payload));return null==o?null:(e=>{var t,{point:r,childIndex:i,mainColor:n,activeDot:s,dataKey:a}=e;if(!1===s||null==r.x||null==r.y)return null;var o=fX(fX({index:i,dataKey:a,cx:r.x,cy:r.y,r:4,fill:null!=n?n:"none",strokeWidth:2,stroke:"#fff",payload:r.payload,value:r.value},e6(s)),eF(s));return t=(0,Q.isValidElement)(s)?(0,Q.cloneElement)(s,o):"function"==typeof s?s(o):Q.createElement(ts,o),Q.createElement(tc,{className:"recharts-active-dot"},t)})({point:o,childIndex:Number(s),mainColor:r,dataKey:n,activeDot:i})}function fQ(e){var{fn:t,args:r}=e,i=tq(),n=nm();return(0,Q.useLayoutEffect)(()=>{if(!n){var e=t(r);return i(hO(e)),()=>{i(hI(e))}}},[t,r,i,n]),null}function f0(e,t){var r,i,n=tZ(t=>u0(t,e)),s=tZ(e=>u3(e,t)),a=null!=(r=null==n?void 0:n.allowDataOverflow)?r:uJ.allowDataOverflow,o=null!=(i=null==s?void 0:s.allowDataOverflow)?i:u1.allowDataOverflow;return{needClip:a||o,needClipX:a,needClipY:o}}function f1(e){var{xAxisId:t,yAxisId:r,clipPathId:i}=e,n=tZ(fY),{needClipX:s,needClipY:a,needClip:o}=f0(t,r);if(!o)return null;var{x:l,y:u,width:c,height:h}=n;return Q.createElement("clipPath",{id:"clipPath-".concat(i)},Q.createElement("rect",{x:s?l:l-c/2,y:a?u:u-h/2,width:s?c:2*c,height:a?h:2*h}))}var f2=(e,t,r,i)=>h_(e,"xAxis",t,i),f3=(e,t,r,i)=>hx(e,"xAxis",t,i),f4=(e,t,r,i)=>h_(e,"yAxis",r,i),f6=(e,t,r,i)=>hx(e,"yAxis",r,i),f5=rq([nR,f2,f4,f3,f6],(e,t,r,i,n)=>i4(e,"xAxis")?nt(t,i,!1):nt(r,n,!1)),f8=rq([ce,(e,t,r,i,n)=>n],(e,t)=>e.filter(e=>"area"===e.type).find(e=>e.id===t)),f7=rq([nR,f2,f4,f3,f6,(e,t,r,i,n)=>{var s,a,o=f8(e,t,r,i,n);if(null!=o&&null!=(a=i4(nR(e),"xAxis")?cb(e,"yAxis",r,i):cb(e,"xAxis",t,i))){var{stackId:l}=o,u=uB(o);if(null!=l&&null!=u){var c=null==(s=a[l])?void 0:s.stackedData;return null==c?void 0:c.find(e=>e.key===u)}}},uf,f5,f8],(e,t,r,i,n,s,a,o,l)=>{var u,{chartData:c,dataStartIndex:h,dataEndIndex:f}=a;if(null!=l&&("horizontal"===e||"vertical"===e)&&null!=t&&null!=r&&null!=i&&null!=n&&0!==i.length&&0!==n.length&&null!=o){var{data:d}=l;if(null!=(u=d&&d.length>0?d:null==c?void 0:c.slice(h,f+1)))return function(e){var t,{areaSettings:{connectNulls:r,baseValue:i,dataKey:n},stackedData:s,layout:a,chartBaseValue:o,xAxis:l,yAxis:u,displayedData:c,dataStartIndex:h,xAxisTicks:f,yAxisTicks:d,bandSize:p}=e,g=s&&s.length,m=((e,t,r,i,n)=>{var s=null!=r?r:t;if(eW(s))return s;var a="horizontal"===e?n:i,o=a.scale.domain();if("number"===a.type){var l=Math.max(o[0],o[1]),u=Math.min(o[0],o[1]);return"dataMin"===s?u:"dataMax"===s||l<0?l:Math.max(Math.min(o[0],o[1]),0)}return"dataMin"===s?o[0]:"dataMax"===s?o[1]:o[0]})(a,o,i,l,u),y="horizontal"===a,v=!1,b=c.map((e,t)=>{g?i=s[h+t]:Array.isArray(i=i3(e,n))?v=!0:i=[m,i];var i,a=null==i[1]||g&&!r&&null==i3(e,n);return y?{x:i7({axis:l,ticks:f,bandSize:p,entry:e,index:t}),y:a?null:u.scale(i[1]),value:i,payload:e}:{x:a?null:l.scale(i[1]),y:i7({axis:u,ticks:d,bandSize:p,entry:e,index:t}),value:i,payload:e}});return t=g||v?b.map(e=>{var t=Array.isArray(e.value)?e.value[0]:null;return y?{x:e.x,y:null!=t&&null!=e.y?u.scale(t):null,payload:e.payload}:{x:null!=t?l.scale(t):null,y:e.y,payload:e.payload}}):y?u.scale(m):l.scale(m),{points:b,baseLine:t,isRange:v}}({layout:e,xAxis:t,yAxis:r,xAxisTicks:i,yAxisTicks:n,dataStartIndex:h,areaSettings:l,stackedData:s,displayedData:u,chartBaseValue:void 0,bandSize:o})}}),f9=(e,t)=>t,de=(e,t,r)=>r,dt=(e,t,r,i)=>i,dr=rq(fk,e=>(0,iK.default)(e,e=>e.coordinate)),di=rq([hZ,f9,de,dt],hG),dn=rq([di,h5],hq),ds=rq([hZ,f9,de,dt],hK),da=rq([nn,ns,nR,nf,fk,dt,ds,hY],hH),dl=rq([di,da],(e,t)=>{var r;return null!=(r=e.coordinate)?r:t}),du=rq(fk,dn,hM),dc=rq([ds,dn,uc,uW,du,hY,f9],hQ),dh=rq([di],e=>({isActive:e.active,activeIndex:e.index})),df=io({name:"legend",initialState:{settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:ie()},removeLegendPayload:{reducer(e,t){var r=rA(e).payload.indexOf(t.payload);r>-1&&e.payload.splice(r,1)},prepare:ie()}}}),{setLegendSize:dd,setLegendSettings:dp,addLegendPayload:dg,removeLegendPayload:dm}=df.actions,dy=df.reducer,dv=()=>{};function db(e){var{legendPayload:t}=e,r=tq(),i=nm();return(0,Q.useLayoutEffect)(()=>i?dv:(r(dg(t)),()=>{r(dm(t))}),[r,i,t]),null}function dx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"animation-",r=(0,Q.useRef)(eH(t)),i=(0,Q.useRef)(e);return i.current!==e&&(r.current=eH(t),i.current=e),r.current}var d_=null!=(U=Q["useId".toString()])?U:()=>{var[e]=Q.useState(()=>eH("uid-"));return e},dw=(0,Q.createContext)(void 0),dk=e=>{var t,r,{id:i,type:n,children:s}=e,a=(t="recharts-".concat(n),r=d_(),i||(t?"".concat(t,"-").concat(r):r));return Q.createElement(dw.Provider,{value:a},s(a))},dP=io({name:"graphicalItems",initialState:{cartesianItems:[],polarItems:[]},reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:ie()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:r,next:i}=t.payload,n=rA(e).cartesianItems.indexOf(r);n>-1&&(e.cartesianItems[n]=i)},prepare:ie()},removeCartesianGraphicalItem:{reducer(e,t){var r=rA(e).cartesianItems.indexOf(t.payload);r>-1&&e.cartesianItems.splice(r,1)},prepare:ie()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:ie()},removePolarGraphicalItem:{reducer(e,t){var r=rA(e).polarItems.indexOf(t.payload);r>-1&&e.polarItems.splice(r,1)},prepare:ie()}}}),{addCartesianGraphicalItem:dS,replaceCartesianGraphicalItem:dE,removeCartesianGraphicalItem:dA,addPolarGraphicalItem:dM,removePolarGraphicalItem:dT}=dP.actions,dC=dP.reducer;function dO(e){var t=tq(),r=(0,Q.useRef)(null);return(0,Q.useLayoutEffect)(()=>{null===r.current?t(dS(e)):r.current!==e&&t(dE({prev:r.current,next:e})),r.current=e},[t,e]),(0,Q.useLayoutEffect)(()=>()=>{r.current&&(t(dA(r.current)),r.current=null)},[t]),null}function dI(){}function dL(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function dj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dL(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dL(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var dN=(e,t)=>Object.keys(t).reduce((r,i)=>dj(dj({},r),{},{[i]:e(i,t[i])}),{});function dD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function dR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dD(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dD(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var dz=(e,t,r)=>e+(t-e)*r,dF=e=>{var{from:t,to:r}=e;return t!==r},dB=(e,t,r)=>{var i=dN((t,r)=>{if(dF(r)){var[i,n]=e(r.from,r.to,r.velocity);return dR(dR({},r),{},{from:i,velocity:n})}return r},t);return r<1?dN((e,t)=>dF(t)?dR(dR({},t),{},{velocity:dz(t.velocity,i[e].velocity,r),from:dz(t.from,i[e].from,r)}):t,t):dB(e,i,r-1)},dU=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],d$=(e,t)=>e.map((e,r)=>e*t**r).reduce((e,t)=>e+t),dV=(e,t)=>r=>d$(dU(e,t),r),dW=function(){let e,t;for(var r,i,n,s,a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];if(1===o.length)switch(o[0]){case"linear":[r,n,i,s]=[0,0,1,1];break;case"ease":[r,n,i,s]=[.25,.1,.25,1];break;case"ease-in":[r,n,i,s]=[.42,0,1,1];break;case"ease-out":[r,n,i,s]=[.42,0,.58,1];break;case"ease-in-out":[r,n,i,s]=[0,0,.58,1];break;default:var u=o[0].split("(");"cubic-bezier"===u[0]&&4===u[1].split(")")[0].split(",").length&&([r,n,i,s]=u[1].split(")")[0].split(",").map(e=>parseFloat(e)))}else 4===o.length&&([r,n,i,s]=o);var c=dV(r,i),h=dV(n,s),f=(e=r,t=i,r=>d$([...dU(e,t).map((e,t)=>e*t).slice(1),0],r)),d=e=>e>1?1:e<0?0:e,p=e=>{for(var t=e>1?1:e,r=t,i=0;i<8;++i){var n=c(r)-t,s=f(r);if(1e-4>Math.abs(n-t)||s<1e-4)break;r=d(r-n/s)}return h(r)};return p.isStepper=!1,p},dG=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stiff:t=100,damping:r=8,dt:i=17}=e,n=(e,n,s)=>{var a=s+(-(e-n)*t-s*r)*i/1e3,o=s*i/1e3+e;return 1e-4>Math.abs(o-n)&&1e-4>Math.abs(a)?[n,0]:[o,a]};return n.isStepper=!0,n.dt=i,n};class dq{setTimeout(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=performance.now(),i=null,n=s=>{s-r>=t?e(s):"function"==typeof requestAnimationFrame&&(i=requestAnimationFrame(n))};return i=requestAnimationFrame(n),()=>{cancelAnimationFrame(i)}}}var dH=(0,Q.createContext)(function(){var e,t,r,i,n;return e=new dq,t=()=>null,r=!1,i=null,n=s=>{if(!r){if(Array.isArray(s)){if(!s.length)return;var[a,...o]=s;if("number"==typeof a){i=e.setTimeout(n.bind(null,o),a);return}n(a),i=e.setTimeout(n.bind(null,o));return}"string"==typeof s&&t(s),"object"==typeof s&&t(s),"function"==typeof s&&s()}},{stop:()=>{r=!0},start:e=>{r=!1,i&&(i(),i=null),n(e)},subscribe:e=>(t=e,()=>{t=()=>null}),getTimeoutController:()=>e}}),dK={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},dY={t:0},dZ={t:1};function dX(e){var t,r,i,n=n2(e,dK),{isActive:s,canBegin:a,duration:o,easing:l,begin:u,onAnimationEnd:c,onAnimationStart:h,children:f}=n,d=(t=n.animationId,r=n.animationManager,i=(0,Q.useContext)(dH),(0,Q.useMemo)(()=>null!=r?r:i(t),[t,r,i])),[p,g]=(0,Q.useState)(s?dY:dZ),m=(0,Q.useRef)(null);return(0,Q.useEffect)(()=>{s||g(dZ)},[s]),(0,Q.useEffect)(()=>{if(!s||!a)return dI;var e,t,r,i,n,f,p,y,v,b,x,_=(e=(e=>{if("string"==typeof e)switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return dW(e);case"spring":return dG();default:if("cubic-bezier"===e.split("(")[0])return dW(e)}return"function"==typeof e?e:null})(l),t=d.getTimeoutController(),r=[Object.keys(dY),Object.keys(dZ)].reduce((e,t)=>e.filter(e=>t.includes(e))),!0===e.isStepper?(n=r.reduce((e,t)=>dR(dR({},e),{},{[t]:{from:dY[t],velocity:0,to:dZ[t]}}),{}),f=null,p=r=>{i||(i=r);var s=(r-i)/e.dt;n=dB(e,n,s),g(dR(dR(dR({},dY),dZ),dN((e,t)=>t.from,n))),i=r,Object.values(n).filter(dF).length&&(f=t.setTimeout(p))},()=>(f=t.setTimeout(p),()=>{f()})):(v=null,b=r.reduce((e,t)=>dR(dR({},e),{},{[t]:[dY[t],dZ[t]]}),{}),x=r=>{y||(y=r);var i=(r-y)/o,n=dN((t,r)=>dz(...r,e(i)),b);if(g(dR(dR(dR({},dY),dZ),n)),i<1)v=t.setTimeout(x);else{var s=dN((t,r)=>dz(...r,e(1)),b);g(dR(dR(dR({},dY),dZ),s))}},()=>(v=t.setTimeout(x),()=>{v()})));return d.start([h,u,()=>{m.current=_()},o,c]),()=>{d.stop(),m.current&&m.current(),c()}},[s,a,o,l,u,h,c,d]),f(p.t)}function dJ(e){var t=e6(e);if(null!=t){var{r,strokeWidth:i}=t,n=Number(r),s=Number(i);return(Number.isNaN(n)||n<0)&&(n=3),(Number.isNaN(s)||s<0)&&(s=2),{r:n,strokeWidth:s}}return{r:3,strokeWidth:2}}var dQ=["id"],d0=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function d1(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function d2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function d3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d2(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d2(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d4(){return(d4=Object.assign.bind()).apply(null,arguments)}function d6(e,t){return e&&"none"!==e?e:t}function d5(e){var{dataKey:t,data:r,stroke:i,strokeWidth:n,fill:s,name:a,hide:o,unit:l}=e;return{dataDefinedOnItem:r,positions:void 0,settings:{stroke:i,strokeWidth:n,fill:s,dataKey:t,nameKey:void 0,name:ni(a,t),hide:o,type:e.tooltipType,color:d6(i,s),unit:l}}}function d8(e){var{clipPathId:t,points:r,props:i}=e,{needClip:n,dot:s,dataKey:a}=i;if(null==r||!s&&1!==r.length)return null;var o=sm(s),l=e4(i),u=to(s),c=r.map((e,t)=>{var i,n=d3(d3(d3({key:"dot-".concat(t),r:3},l),u),{},{index:t,cx:e.x,cy:e.y,dataKey:a,value:e.value,payload:e.payload,points:r});if(es.isValidElement(s))i=es.cloneElement(s,n);else if("function"==typeof s)i=s(n);else{var o=(0,ea.clsx)("recharts-area-dot","boolean"!=typeof s?s.className:"");i=es.createElement(ts,d4({},n,{className:o}))}return i}),h={clipPath:n?"url(#clipPath-".concat(o?"":"dots-").concat(t,")"):void 0};return es.createElement(tc,d4({className:"recharts-area-dots"},h),c)}function d7(e){var{showLabels:t,children:r,points:i}=e,n=i.map(e=>{var t={x:e.x,y:e.y,width:0,height:0};return d3(d3({},t),{},{value:e.value,payload:e.payload,parentViewBox:void 0,viewBox:t,fill:void 0})});return es.createElement(sf,{value:t?n:null},r)}function d9(e){var{points:t,baseLine:r,needClip:i,clipPathId:n,props:s}=e,{layout:a,type:o,stroke:l,connectNulls:u,isRange:c}=s,{id:h}=s,f=d1(s,dQ),d=e4(f);return es.createElement(es.Fragment,null,(null==t?void 0:t.length)>1&&es.createElement(tc,{clipPath:i?"url(#clipPath-".concat(n,")"):void 0},es.createElement(ti,d4({},d,{id:h,points:t,connectNulls:u,type:o,baseLine:r,layout:a,stroke:"none",className:"recharts-area-area"})),"none"!==l&&es.createElement(ti,d4({},d,{className:"recharts-area-curve",layout:a,type:o,connectNulls:u,fill:"none",points:t})),"none"!==l&&c&&es.createElement(ti,d4({},d,{className:"recharts-area-curve",layout:a,type:o,connectNulls:u,fill:"none",points:r}))),es.createElement(d8,{points:t,props:f,clipPathId:n}))}function pe(e){var{alpha:t,baseLine:r,points:i,strokeWidth:n}=e,s=i[0].y,a=i[i.length-1].y;if(!eQ(s)||!eQ(a))return null;var o=t*Math.abs(s-a),l=Math.max(...i.map(e=>e.x||0));return(eW(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(e=>e.x||0),l)),eW(l))?es.createElement("rect",{x:0,y:s<a?s:s-o,width:l+(n?parseInt("".concat(n),10):1),height:Math.floor(o)}):null}function pt(e){var{alpha:t,baseLine:r,points:i,strokeWidth:n}=e,s=i[0].x,a=i[i.length-1].x;if(!eQ(s)||!eQ(a))return null;var o=t*Math.abs(s-a),l=Math.max(...i.map(e=>e.y||0));return(eW(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(e=>e.y||0),l)),eW(l))?es.createElement("rect",{x:s<a?s:s-o,y:0,width:o,height:Math.floor(l+(n?parseInt("".concat(n),10):1))}):null}function pr(e){var{alpha:t,layout:r,points:i,baseLine:n,strokeWidth:s}=e;return"vertical"===r?es.createElement(pe,{alpha:t,points:i,baseLine:n,strokeWidth:s}):es.createElement(pt,{alpha:t,points:i,baseLine:n,strokeWidth:s})}function pi(e){var{needClip:t,clipPathId:r,props:i,previousPointsRef:n,previousBaselineRef:s}=e,{points:a,baseLine:o,isAnimationActive:l,animationBegin:u,animationDuration:c,animationEasing:h,onAnimationStart:f,onAnimationEnd:d}=i,p=dx(i,"recharts-area-"),[g,m]=(0,es.useState)(!1),y=(0,es.useCallback)(()=>{"function"==typeof d&&d(),m(!1)},[d]),v=(0,es.useCallback)(()=>{"function"==typeof f&&f(),m(!0)},[f]),b=n.current,x=s.current;return es.createElement(d7,{showLabels:!g,points:a},i.children,es.createElement(dX,{animationId:p,begin:u,duration:c,isActive:l,easing:h,onAnimationEnd:y,onAnimationStart:v,key:p},e=>{if(b){var u,c=b.length/a.length,h=1===e?a:a.map((t,r)=>{var i=Math.floor(r*c);if(b[i]){var n=b[i];return d3(d3({},t),{},{x:eZ(n.x,t.x,e),y:eZ(n.y,t.y,e)})}return t});if(eW(o))u=eZ(x,o,e);else u=null==o||e$(o)?eZ(x,0,e):o.map((t,r)=>{var i=Math.floor(r*c);if(Array.isArray(x)&&x[i]){var n=x[i];return d3(d3({},t),{},{x:eZ(n.x,t.x,e),y:eZ(n.y,t.y,e)})}return t});return e>0&&(n.current=h,s.current=u),es.createElement(d9,{points:h,baseLine:u,needClip:t,clipPathId:r,props:i})}return e>0&&(n.current=a,s.current=o),es.createElement(tc,null,l&&es.createElement("defs",null,es.createElement("clipPath",{id:"animationClipPath-".concat(r)},es.createElement(pr,{alpha:e,points:a,baseLine:o,layout:i.layout,strokeWidth:i.strokeWidth}))),es.createElement(tc,{clipPath:"url(#animationClipPath-".concat(r,")")},es.createElement(d9,{points:a,baseLine:o,needClip:t,clipPathId:r,props:i})))}),es.createElement(sg,{label:i.label}))}function pn(e){var{needClip:t,clipPathId:r,props:i}=e,n=(0,es.useRef)(null),s=(0,es.useRef)();return es.createElement(pi,{needClip:t,clipPathId:r,props:i,previousPointsRef:n,previousBaselineRef:s})}class ps extends es.PureComponent{render(){var{hide:e,dot:t,points:r,className:i,top:n,left:s,needClip:a,xAxisId:o,yAxisId:l,width:u,height:c,id:h,baseLine:f}=this.props;if(e)return null;var d=(0,ea.clsx)("recharts-area",i),{r:p,strokeWidth:g}=dJ(t),m=sm(t),y=2*p+g;return es.createElement(es.Fragment,null,es.createElement(tc,{className:d},a&&es.createElement("defs",null,es.createElement(f1,{clipPathId:h,xAxisId:o,yAxisId:l}),!m&&es.createElement("clipPath",{id:"clipPath-dots-".concat(h)},es.createElement("rect",{x:s-y/2,y:n-y/2,width:u+y,height:c+y}))),es.createElement(pn,{needClip:a,clipPathId:h,props:this.props})),es.createElement(fJ,{points:r,mainColor:d6(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}),this.props.isRange&&Array.isArray(f)&&es.createElement(fJ,{points:f,mainColor:d6(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}))}}var pa={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:!tf.isSsr,legendType:"line",stroke:"#3182bd",xAxisId:0,yAxisId:0};function po(e){var t,r=n2(e,pa),{activeDot:i,animationBegin:n,animationDuration:s,animationEasing:a,connectNulls:o,dot:l,fill:u,fillOpacity:c,hide:h,isAnimationActive:f,legendType:d,stroke:p,xAxisId:g,yAxisId:m}=r,y=d1(r,d0),v=tZ(nR),b=tZ(uj),{needClip:x}=f0(g,m),_=nm(),{points:w,isRange:k,baseLine:P}=null!=(t=tZ(t=>f7(t,g,m,_,e.id)))?t:{},S=tZ(fY);if("horizontal"!==v&&"vertical"!==v||null==S||"AreaChart"!==b&&"ComposedChart"!==b)return null;var{height:E,width:A,x:M,y:T}=S;return w&&w.length?es.createElement(ps,d4({},y,{activeDot:i,animationBegin:n,animationDuration:s,animationEasing:a,baseLine:P,connectNulls:o,dot:l,fill:u,fillOpacity:c,height:E,hide:h,layout:v,isAnimationActive:f,isRange:k,legendType:d,needClip:x,points:w,stroke:p,width:A,left:M,top:T,xAxisId:g,yAxisId:m})):null}var pl=es.memo(function(e){var t=n2(e,pa),r=nm();return es.createElement(dk,{id:t.id,type:"area"},e=>{var i;return es.createElement(es.Fragment,null,es.createElement(db,{legendPayload:(e=>{var{dataKey:t,name:r,stroke:i,fill:n,legendType:s,hide:a}=e;return[{inactive:a,dataKey:t,type:s,color:d6(i,n),value:ni(r,t),payload:e}]})(t)}),es.createElement(fQ,{fn:d5,args:t}),es.createElement(dO,{type:"area",id:e,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:null==(i=t.stackId)?void 0:String(i),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:r,connectNulls:t.connectNulls}),es.createElement(po,d4({},t,{id:e})))})});function pu(e,t){if(t){var r=Number.parseInt(t,10);if(!e$(r))return null==e?void 0:e[r]}}pl.displayName="Area";var pc=io({name:"options",initialState:{chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},reducers:{createEventEmitter:e=>{null==e.eventEmitter&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),ph=pc.reducer,{createEventEmitter:pf}=pc.actions,pd=(e.i(13027),{notify(){},get:()=>[]}),pp="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,pg="undefined"!=typeof navigator&&"ReactNative"===navigator.product,pm=pp||pg?Q.useLayoutEffect:Q.useEffect,py=Symbol.for("react-redux-context"),pv="undefined"!=typeof globalThis?globalThis:{},pb=function(){if(!Q.createContext)return{};let e=pv[py]??=new Map,t=e.get(Q.createContext);return t||(t=Q.createContext(null),e.set(Q.createContext,t)),t}(),px=function(e){let{children:t,context:r,serverState:i,store:n}=e,s=Q.useMemo(()=>{let e=function(e,t){let r,i=pd,n=0,s=!1;function a(){u.onStateChange&&u.onStateChange()}function o(){if(n++,!r){let t,n;r=e.subscribe(a),t=null,n=null,i={clear(){t=null,n=null},notify(){let e=t;for(;e;)e.callback(),e=e.next},get(){let e=[],r=t;for(;r;)e.push(r),r=r.next;return e},subscribe(e){let r=!0,i=n={callback:e,next:null,prev:n};return i.prev?i.prev.next=i:t=i,function(){r&&null!==t&&(r=!1,i.next?i.next.prev=i.prev:n=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}}function l(){n--,r&&0===n&&(r(),r=void 0,i.clear(),i=pd)}let u={addNestedSub:function(e){o();let t=i.subscribe(e),r=!1;return()=>{r||(r=!0,t(),l())}},notifyNestedSubs:function(){i.notify()},handleChangeWrapper:a,isSubscribed:function(){return s},trySubscribe:function(){s||(s=!0,o())},tryUnsubscribe:function(){s&&(s=!1,l())},getListeners:()=>i};return u}(n);return{store:n,subscription:e,getServerState:i?()=>i:void 0}},[n,i]),a=Q.useMemo(()=>n.getState(),[n]);return pm(()=>{let{subscription:e}=s;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),a!==n.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}},[s,a]),Q.createElement((r||pb).Provider,{value:s},t)};function p_(e=pb){return function(){return Q.useContext(e)}}var pw=p_(),pk=io({name:"chartData",initialState:{chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},reducers:{setChartData(e,t){if(e.chartData=t.payload,null==t.payload){e.dataStartIndex=0,e.dataEndIndex=0;return}t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:r,endIndex:i}=t.payload;null!=r&&(e.dataStartIndex=r),null!=i&&(e.dataEndIndex=i)}}}),{setChartData:pP,setDataStartEndIndexes:pS,setComputedData:pE}=pk.actions,pA=pk.reducer,pM=rq([(e,t)=>t,nR,n0,uU,fb,fk,dr,nf],(e,t,r,i,n,s,a,o)=>{if(e&&t&&i&&n&&s){var l=(u=e.chartX,c=e.chartY,"horizontal"===t||"vertical"===t?u>=o.left&&u<=o.left+o.width&&c>=o.top&&c<=o.top+o.height?{x:u,y:c}:null:r?((e,t)=>{var r,{x:i,y:n}=e,{radius:s,angle:a}=((e,t)=>{var{x:r,y:i}=e,{cx:n,cy:s}=t,a=((e,t)=>{var{x:r,y:i}=e,{x:n,y:s}=t;return Math.sqrt((r-n)**2+(i-s)**2)})({x:r,y:i},{x:n,y:s});if(a<=0)return{radius:a,angle:0};var o=Math.acos((r-n)/a);return i>s&&(o=2*Math.PI-o),{radius:a,angle:180*o/Math.PI,angleInRadian:o}})({x:i,y:n},t),{innerRadius:o,outerRadius:l}=t;if(s<o||s>l||0===s)return null;var{startAngle:u,endAngle:c}=(e=>{var{startAngle:t,endAngle:r}=e,i=Math.min(Math.floor(t/360),Math.floor(r/360));return{startAngle:t-360*i,endAngle:r-360*i}})(t),h=a;if(u<=c){for(;h>c;)h-=360;for(;h<u;)h+=360;r=h>=u&&h<=c}else{for(;h>u;)h-=360;for(;h<c;)h+=360;r=h>=c&&h<=u}return r?tB(tB({},t),{},{radius:s,angle:((e,t)=>{var{startAngle:r,endAngle:i}=t;return e+360*Math.min(Math.floor(r/360),Math.floor(i/360))})(h,t)}):null})({x:u,y:c},r):null);if(l){var u,c,h=((e,t,r,i,n)=>{var s,a=-1,o=null!=(s=null==t?void 0:t.length)?s:0;if(o<=1||null==e)return 0;if("angleAxis"===i&&null!=n&&1e-6>=Math.abs(Math.abs(n[1]-n[0])-360))for(var l=0;l<o;l++){var u=l>0?r[l-1].coordinate:r[o-1].coordinate,c=r[l].coordinate,h=l>=o-1?r[0].coordinate:r[l+1].coordinate,f=void 0;if(eU(c-u)!==eU(h-c)){var d=[];if(eU(h-c)===eU(n[1]-n[0])){f=h;var p=c+n[1]-n[0];d[0]=Math.min(p,(p+u)/2),d[1]=Math.max(p,(p+u)/2)}else{f=u;var g=h+n[1]-n[0];d[0]=Math.min(c,(g+c)/2),d[1]=Math.max(c,(g+c)/2)}var m=[Math.min(c,(f+c)/2),Math.max(c,(f+c)/2)];if(e>m[0]&&e<=m[1]||e>=d[0]&&e<=d[1]){({index:a}=r[l]);break}}else{var y=Math.min(u,h),v=Math.max(u,h);if(e>(y+c)/2&&e<=(v+c)/2){({index:a}=r[l]);break}}}else if(t){for(var b=0;b<o;b++)if(0===b&&e<=(t[b].coordinate+t[b+1].coordinate)/2||b>0&&b<o-1&&e>(t[b].coordinate+t[b-1].coordinate)/2&&e<=(t[b].coordinate+t[b+1].coordinate)/2||b===o-1&&e>(t[b].coordinate+t[b-1].coordinate)/2){({index:a}=t[b]);break}}return a})("horizontal"===t?l.x:"vertical"===t?l.y:"centric"===t?l.angle:l.radius,a,s,i,n),f=((e,t,r,i)=>{var n=t.find(e=>e&&e.index===r);if(n){if("horizontal"===e)return{x:n.coordinate,y:i.y};if("vertical"===e)return{x:i.x,y:n.coordinate};if("centric"===e){var s=n.coordinate,{radius:a}=i;return i2(i2(i2({},i),t$(i.cx,i.cy,a,s)),{},{angle:s,radius:a})}var o=n.coordinate,{angle:l}=i;return i2(i2(i2({},i),t$(i.cx,i.cy,o,l)),{},{angle:l,radius:o})}return{x:0,y:0}})(t,s,h,l);return{activeIndex:String(h),activeCoordinate:f}}}}),pT=e=>{var t=e.currentTarget.getBoundingClientRect(),r=t.width/e.currentTarget.offsetWidth,i=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/r),chartY:Math.round((e.clientY-t.top)/i)}},pC=r6("mouseClick"),pO=iB();pO.startListening({actionCreator:pC,effect:(e,t)=>{var r=e.payload,i=pM(t.getState(),pT(r));(null==i?void 0:i.activeIndex)!=null&&t.dispatch(hF({activeIndex:i.activeIndex,activeDataKey:void 0,activeCoordinate:i.activeCoordinate}))}});var pI=r6("mouseMove"),pL=iB();function pj(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":t}pL.startListening({actionCreator:pI,effect:(e,t)=>{var r=e.payload,i=t.getState(),n=hA(i,i.tooltip.settings.shared),s=pM(i,pT(r));"axis"===n&&((null==s?void 0:s.activeIndex)!=null?t.dispatch(hz({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate})):t.dispatch(hD()))}});var pN=io({name:"referenceElements",initialState:{dots:[],areas:[],lines:[]},reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var r=rA(e).dots.findIndex(e=>e===t.payload);-1!==r&&e.dots.splice(r,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var r=rA(e).areas.findIndex(e=>e===t.payload);-1!==r&&e.areas.splice(r,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var r=rA(e).lines.findIndex(e=>e===t.payload);-1!==r&&e.lines.splice(r,1)}}}),{addDot:pD,removeDot:pR,addArea:pz,removeArea:pF,addLine:pB,removeLine:pU}=pN.actions,p$=pN.reducer,pV={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},pW=io({name:"brush",initialState:pV,reducers:{setBrushSettings:(e,t)=>null==t.payload?pV:t.payload}}),{setBrushSettings:pG}=pW.actions,pq=pW.reducer,pH={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},pK=io({name:"rootProps",initialState:pH,reducers:{updateOptions:(e,t)=>{var r;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=null!=(r=t.payload.barGap)?r:pH.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className}}}),pY=pK.reducer,{updateOptions:pZ}=pK.actions,pX=io({name:"polarAxis",initialState:{radiusAxis:{},angleAxis:{}},reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:pJ,removeRadiusAxis:pQ,addAngleAxis:p0,removeAngleAxis:p1}=pX.actions,p2=pX.reducer,p3=io({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:p4}=p3.actions,p6=p3.reducer,p5=r6("keyDown"),p8=r6("focus"),p7=iB();p7.startListening({actionCreator:p5,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:i}=r.tooltip,n=e.payload;if("ArrowRight"===n||"ArrowLeft"===n||"Enter"===n){var s=Number(hq(i,h5(r))),a=fk(r);if("Enter"===n){var o=da(r,"axis","hover",String(i.index));t.dispatch(hU({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:o}));return}var l=s+("ArrowRight"===n?1:-1)*("left-to-right"===hk(r)?1:-1);if(null!=a&&!(l>=a.length)&&!(l<0)){var u=da(r,"axis","hover",String(l));t.dispatch(hU({active:!0,activeIndex:l.toString(),activeDataKey:void 0,activeCoordinate:u}))}}}}}),p7.startListening({actionCreator:p8,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&null==i.index){var n=da(r,"axis","hover",String("0"));t.dispatch(hU({activeDataKey:void 0,active:!0,activeIndex:"0",activeCoordinate:n}))}}}});var p9=r6("externalEvent"),ge=iB();ge.startListening({actionCreator:p9,effect:(e,t)=>{if(null!=e.payload.handler){var r=t.getState(),i={activeCoordinate:fL(r),activeDataKey:fC(r),activeIndex:fM(r),activeLabel:fT(r),activeTooltipIndex:fM(r),isTooltipActive:fj(r)};e.payload.handler(i,e.payload.reactEvent)}}});var gt=rq([hZ],e=>e.tooltipItemPayloads),gr=rq([gt,hY,(e,t,r)=>t,(e,t,r)=>r],(e,t,r,i)=>{var n=e.find(e=>e.settings.dataKey===i);if(null!=n){var{positions:s}=n;if(null!=s)return t(s,r)}}),gi=r6("touchMove"),gn=iB();gn.startListening({actionCreator:gi,effect:(e,t)=>{var r=e.payload,i=t.getState(),n=hA(i,i.tooltip.settings.shared);if("axis"===n){var s=pM(i,pT({clientX:r.touches[0].clientX,clientY:r.touches[0].clientY,currentTarget:r.currentTarget}));(null==s?void 0:s.activeIndex)!=null&&t.dispatch(hz({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate}))}else if("item"===n){var a,o=r.touches[0],l=document.elementFromPoint(o.clientX,o.clientY);if(!l||!l.getAttribute)return;var u=l.getAttribute("data-recharts-item-index"),c=null!=(a=l.getAttribute("data-recharts-item-data-key"))?a:void 0,h=gr(t.getState(),u,c);t.dispatch(hj({activeDataKey:c,activeIndex:u,activeCoordinate:h}))}}});var gs=io({name:"errorBars",initialState:{},reducers:{addErrorBar:(e,t)=>{var{itemId:r,errorBar:i}=t.payload;e[r]||(e[r]=[]),e[r].push(i)},replaceErrorBar:(e,t)=>{var{itemId:r,prev:i,next:n}=t.payload;e[r]&&(e[r]=e[r].map(e=>e.dataKey===i.dataKey&&e.direction===i.direction?n:e))},removeErrorBar:(e,t)=>{var{itemId:r,errorBar:i}=t.payload;e[r]&&(e[r]=e[r].filter(e=>e.dataKey!==i.dataKey||e.direction!==i.direction))}}}),{addErrorBar:ga,replaceErrorBar:go,removeErrorBar:gl}=gs.actions,gu=rQ({brush:pq,cartesianAxis:fH,chartData:pA,errorBars:gs.reducer,graphicalItems:dC,layout:iH,legend:dy,options:ph,polarAxis:p2,polarOptions:p6,referenceElements:p$,rootProps:pY,tooltip:h$}),gc=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart";return function(e){let t,r,i,n=function(e){let{thunk:t=!0,immutableCheck:r=!0,serializableCheck:i=!0,actionCreatorCheck:n=!0}=e??{},s=new r5;return t&&("boolean"==typeof t?s.push(r3):s.push(r2(t.extraArgument))),s},{reducer:s,middleware:a,devTools:o=!0,duplicateMiddlewareCheck:l=!0,preloadedState:u,enhancers:c}=e||{};if("function"==typeof s)t=s;else if(rJ(s))t=rQ(s);else throw Error(iU(1));r="function"==typeof a?a(n):n();let h=r0;o&&(h=r4({trace:!1,..."object"==typeof o&&o}));let f=(i=function(...e){return t=>(r,i)=>{let n=t(r,i),s=()=>{throw Error(rK(15))},a={getState:n.getState,dispatch:(e,...t)=>s(e,...t)};return s=r0(...e.map(e=>e(a)))(n.dispatch),{...n,dispatch:s}}}(...r),function(e){let{autoBatch:t=!0}=e??{},r=new r5(i);return t&&r.push(ir("object"==typeof t?t:void 0)),r});return function e(t,r,i){if("function"!=typeof t)throw Error(rK(2));if("function"==typeof r&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw Error(rK(0));if("function"==typeof r&&void 0===i&&(i=r,r=void 0),void 0!==i){if("function"!=typeof i)throw Error(rK(1));return i(e)(t,r)}let n=t,s=r,a=new Map,o=a,l=0,u=!1;function c(){o===a&&(o=new Map,a.forEach((e,t)=>{o.set(t,e)}))}function h(){if(u)throw Error(rK(3));return s}function f(e){if("function"!=typeof e)throw Error(rK(4));if(u)throw Error(rK(5));let t=!0;c();let r=l++;return o.set(r,e),function(){if(t){if(u)throw Error(rK(6));t=!1,c(),o.delete(r),a=null}}}function d(e){if(!rJ(e))throw Error(rK(7));if(void 0===e.type)throw Error(rK(8));if("string"!=typeof e.type)throw Error(rK(17));if(u)throw Error(rK(9));try{u=!0,s=n(s,e)}finally{u=!1}return(a=o).forEach(e=>{e()}),e}return d({type:rX.INIT}),{dispatch:d,subscribe:f,getState:h,replaceReducer:function(e){if("function"!=typeof e)throw Error(rK(10));n=e,d({type:rX.REPLACE})},[rY]:function(){return{subscribe(e){if("object"!=typeof e||null===e)throw Error(rK(11));function t(){e.next&&e.next(h())}return t(),{unsubscribe:f(t)}},[rY](){return this}}}}}(t,u,h(..."function"==typeof c?c(f):f()))}({reducer:gu,preloadedState:e,middleware:e=>e({serializableCheck:!1}).concat([pO.middleware,pL.middleware,p7.middleware,ge.middleware,gn.middleware]),enhancers:e=>{var t=e;return"function"==typeof e&&(t=e()),t.concat(ir({type:"raf"}))},devTools:tf.devToolsEnabled&&{serialize:{replacer:pj},name:"recharts-".concat(t)}})};function gh(e){var{preloadedState:t,children:r,reduxStoreName:i}=e,n=nm(),s=(0,Q.useRef)(null);return n?r:(null==s.current&&(s.current=gc(t,i)),Q.createElement(px,{context:tW,store:s.current},r))}var gf=e=>{var{chartData:t}=e,r=tq(),i=nm();return(0,Q.useEffect)(()=>i?()=>{}:(r(pP(t)),()=>{r(pP(void 0))}),[t,r,i]),null};function gd(e){var{layout:t,margin:r}=e,i=tq(),n=nm();return(0,Q.useEffect)(()=>{n||(i(iW(t)),i(iV(r)))},[i,n,t,r]),null}function gp(e){var t=tq();return(0,Q.useEffect)(()=>{t(pZ(e))},[t,e]),null}var gg=()=>tZ(e=>e.rootProps.accessibilityLayer),gm=["children","width","height","viewBox","className","style","title","desc"];function gy(){return(gy=Object.assign.bind()).apply(null,arguments)}var gv=(0,Q.forwardRef)((e,t)=>{var{children:r,width:i,height:n,viewBox:s,className:a,style:o,title:l,desc:u}=e,c=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gm),h=s||{width:i,height:n,x:0,y:0},f=(0,ea.clsx)("recharts-surface",a);return Q.createElement("svg",gy({},ta(c),{className:f,width:i,height:n,style:o,viewBox:"".concat(h.x," ").concat(h.y," ").concat(h.width," ").concat(h.height),ref:t}),Q.createElement("title",null,l),Q.createElement("desc",null,u),r)}),gb=["children"];function gx(){return(gx=Object.assign.bind()).apply(null,arguments)}var g_={width:"100%",height:"100%",display:"block"},gw=(0,Q.forwardRef)((e,t)=>{var r,i,n=tZ(nn),s=tZ(ns),a=gg();if(!e0(n)||!e0(s))return null;var{children:o,otherAttributes:l,title:u,desc:c}=e;return r="number"==typeof l.tabIndex?l.tabIndex:a?0:void 0,i="string"==typeof l.role?l.role:a?"application":void 0,Q.createElement(gv,gx({},l,{title:u,desc:c,role:i,tabIndex:r,width:n,height:s,style:g_,ref:t}),o)}),gk=e=>{var{children:t}=e,r=tZ(nv);if(!r)return null;var{width:i,height:n,y:s,x:a}=r;return Q.createElement(gv,{width:i,height:n,x:a,y:s},t)},gP=(0,Q.forwardRef)((e,t)=>{var{children:r}=e,i=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gb);return nm()?Q.createElement(gk,null,r):Q.createElement(gw,gx({ref:t},i),r)}),gS=new(e.i(78492)).default,gE="recharts.syncEvent.tooltip",gA="recharts.syncEvent.brush";function gM(e){return e.tooltip.syncInteraction}var gT=["x","y"];function gC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function gO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gC(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var gI=()=>{},gL=(0,Q.createContext)(null),gj=(0,Q.createContext)(null);function gN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function gD(){return(gD=Object.assign.bind()).apply(null,arguments)}var gR=()=>{var e,t,r,i,n,s,a,o,l,u,c,h;return e=tq(),(0,Q.useEffect)(()=>{e(pf())},[e]),t=tZ(uN),r=tZ(uR),i=tq(),n=tZ(uD),s=tZ(fk),a=tZ(nR),o=nj(),l=tZ(e=>e.rootProps.className),(0,Q.useEffect)(()=>{if(null==t)return gI;var e=(e,l,u)=>{if(r!==u&&t===e){if("index"===n){if(o&&null!=l&&null!=(c=l.payload)&&c.coordinate&&l.payload.sourceViewBox){var c,h,f=l.payload.coordinate,{x:d,y:p}=f,g=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(f,gT),{x:m,y:y,width:v,height:b}=l.payload.sourceViewBox,x=gO(gO({},g),{},{x:o.x+(v?(d-m)/v:0)*o.width,y:o.y+(b?(p-y)/b:0)*o.height});i(gO(gO({},l),{},{payload:gO(gO({},l.payload),{},{coordinate:x})}))}else i(l);return}if(null!=s){if("function"==typeof n){var _=n(s,{activeTooltipIndex:null==l.payload.index?void 0:Number(l.payload.index),isTooltipActive:l.payload.active,activeIndex:null==l.payload.index?void 0:Number(l.payload.index),activeLabel:l.payload.label,activeDataKey:l.payload.dataKey,activeCoordinate:l.payload.coordinate});h=s[_]}else"value"===n&&(h=s.find(e=>String(e.value)===l.payload.label));var{coordinate:w}=l.payload;if(null==h||!1===l.payload.active||null==w||null==o)return void i(hB({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0}));var{x:k,y:P}=w,S=Math.min(k,o.x+o.width),E=Math.min(P,o.y+o.height),A={x:"horizontal"===a?h.coordinate:S,y:"horizontal"===a?E:h.coordinate};i(hB({active:l.payload.active,coordinate:A,dataKey:l.payload.dataKey,index:String(h.index),label:l.payload.label,sourceViewBox:l.payload.sourceViewBox}))}}};return gS.on(gE,e),()=>{gS.off(gE,e)}},[l,i,r,t,n,s,a,o]),u=tZ(uN),c=tZ(uR),h=tq(),(0,Q.useEffect)(()=>{if(null==u)return gI;var e=(e,t,r)=>{c!==r&&u===e&&h(pS(t))};return gS.on(gA,e),()=>{gS.off(gA,e)}},[h,c,u]),null};function gz(e){if("number"==typeof e)return e;if("string"==typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var gF=(0,Q.forwardRef)((e,t)=>{var r,i,n=(0,Q.useRef)(null),[s,a]=(0,Q.useState)({containerWidth:gz(null==(r=e.style)?void 0:r.width),containerHeight:gz(null==(i=e.style)?void 0:i.height)}),o=(0,Q.useCallback)((e,t)=>{a(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]),l=(0,Q.useCallback)(e=>{if("function"==typeof t&&t(e),null!=e){var{width:r,height:i}=e.getBoundingClientRect();o(r,i);var s=new ResizeObserver(e=>{var{width:t,height:r}=e[0].contentRect;o(t,r)});s.observe(e),n.current=s}},[t,o]);return(0,Q.useEffect)(()=>()=>{var e=n.current;null!=e&&e.disconnect()},[o]),Q.createElement(Q.Fragment,null,Q.createElement(nz,{width:s.containerWidth,height:s.containerHeight}),Q.createElement("div",gD({ref:l},e)))}),gB=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e,[n,s]=(0,Q.useState)({containerWidth:gz(r),containerHeight:gz(i)}),a=(0,Q.useCallback)((e,t)=>{s(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]),o=(0,Q.useCallback)(e=>{if("function"==typeof t&&t(e),null!=e){var{width:r,height:i}=e.getBoundingClientRect();a(r,i)}},[t,a]);return Q.createElement(Q.Fragment,null,Q.createElement(nz,{width:n.containerWidth,height:n.containerHeight}),Q.createElement("div",gD({ref:o},e)))}),gU=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e;return Q.createElement(Q.Fragment,null,Q.createElement(nz,{width:r,height:i}),Q.createElement("div",gD({ref:t},e)))}),g$=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e;return eV(r)||eV(i)?Q.createElement(gB,gD({},e,{ref:t})):Q.createElement(gU,gD({},e,{ref:t}))}),gV=(0,Q.forwardRef)((e,t)=>{var{children:r,className:i,height:n,onClick:s,onContextMenu:a,onDoubleClick:o,onMouseDown:l,onMouseEnter:u,onMouseLeave:c,onMouseMove:h,onMouseUp:f,onTouchEnd:d,onTouchMove:p,onTouchStart:g,style:m,width:y,responsive:v,dispatchTouchEvents:b=!0}=e,x=(0,Q.useRef)(null),_=tq(),[w,k]=(0,Q.useState)(null),[P,S]=(0,Q.useState)(null),E=function(){var e=tq(),[t,r]=(0,Q.useState)(null),i=tZ(na);return(0,Q.useEffect)(()=>{if(null!=t){var r=t.getBoundingClientRect().width/t.offsetWidth;eQ(r)&&r!==i&&e(iq(r))}},[t,e,i]),r}(),A=nO(),M=(null==A?void 0:A.width)>0?A.width:y,T=(null==A?void 0:A.height)>0?A.height:n,C=(0,Q.useCallback)(e=>{E(e),"function"==typeof t&&t(e),k(e),S(e),null!=e&&(x.current=e)},[E,t,k,S]),O=(0,Q.useCallback)(e=>{_(pC(e)),_(p9({handler:s,reactEvent:e}))},[_,s]),I=(0,Q.useCallback)(e=>{_(pI(e)),_(p9({handler:u,reactEvent:e}))},[_,u]),L=(0,Q.useCallback)(e=>{_(hD()),_(p9({handler:c,reactEvent:e}))},[_,c]),j=(0,Q.useCallback)(e=>{_(pI(e)),_(p9({handler:h,reactEvent:e}))},[_,h]),N=(0,Q.useCallback)(()=>{_(p8())},[_]),D=(0,Q.useCallback)(e=>{_(p5(e.key))},[_]),R=(0,Q.useCallback)(e=>{_(p9({handler:a,reactEvent:e}))},[_,a]),z=(0,Q.useCallback)(e=>{_(p9({handler:o,reactEvent:e}))},[_,o]),F=(0,Q.useCallback)(e=>{_(p9({handler:l,reactEvent:e}))},[_,l]),B=(0,Q.useCallback)(e=>{_(p9({handler:f,reactEvent:e}))},[_,f]),U=(0,Q.useCallback)(e=>{_(p9({handler:g,reactEvent:e}))},[_,g]),$=(0,Q.useCallback)(e=>{b&&_(gi(e)),_(p9({handler:p,reactEvent:e}))},[_,b,p]),V=(0,Q.useCallback)(e=>{_(p9({handler:d,reactEvent:e}))},[_,d]);return Q.createElement(gL.Provider,{value:w},Q.createElement(gj.Provider,{value:P},Q.createElement(!0===v?gF:g$,{width:null!=M?M:null==m?void 0:m.width,height:null!=T?T:null==m?void 0:m.height,className:(0,ea.clsx)("recharts-wrapper",i),style:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gN(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gN(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({position:"relative",cursor:"default",width:M,height:T},m),onClick:O,onContextMenu:R,onDoubleClick:z,onFocus:N,onKeyDown:D,onMouseDown:F,onMouseEnter:I,onMouseLeave:L,onMouseMove:j,onMouseUp:B,onTouchEnd:V,onTouchMove:$,onTouchStart:U,ref:C},Q.createElement(gR,null),r)))}),gW=(0,Q.createContext)(void 0),gG=e=>{var{children:t}=e,[r]=(0,Q.useState)("".concat(eH("recharts"),"-clip")),i=tZ(fY);if(null==i)return null;var{x:n,y:s,width:a,height:o}=i;return Q.createElement(gW.Provider,{value:r},Q.createElement("defs",null,Q.createElement("clipPath",{id:r},Q.createElement("rect",{x:n,y:s,height:o,width:a}))),t)},gq=["width","height","responsive","children","className","style","compact","title","desc"],gH=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i,responsive:n,children:s,className:a,style:o,compact:l,title:u,desc:c}=e,h=e4(function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gq));return l?Q.createElement(Q.Fragment,null,Q.createElement(nz,{width:r,height:i}),Q.createElement(gP,{otherAttributes:h,title:u,desc:c},s)):Q.createElement(gV,{className:a,style:o,width:r,height:i,responsive:n,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},Q.createElement(gP,{otherAttributes:h,title:u,desc:c,ref:t},Q.createElement(gG,null,s)))});function gK(){return(gK=Object.assign.bind()).apply(null,arguments)}var gY={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index",responsive:!1},gZ=(0,Q.forwardRef)(function(e,t){var r,i=n2(e.categoricalChartProps,gY),{chartName:n,defaultTooltipEventType:s,validateTooltipEventTypes:a,tooltipPayloadSearcher:o,categoricalChartProps:l}=e;return Q.createElement(gh,{preloadedState:{options:{chartName:n,defaultTooltipEventType:s,validateTooltipEventTypes:a,tooltipPayloadSearcher:o,eventEmitter:void 0}},reduxStoreName:null!=(r=l.id)?r:n},Q.createElement(gf,{chartData:l.data}),Q.createElement(gd,{layout:i.layout,margin:i.margin}),Q.createElement(gp,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),Q.createElement(gH,gK({},i,{ref:t})))}),gX=["axis"],gJ=(0,Q.forwardRef)((e,t)=>Q.createElement(gZ,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:gX,tooltipPayloadSearcher:pu,categoricalChartProps:e,ref:t}));class gQ{static create(e){return new gQ(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:t,position:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==e){if(r)switch(r){case"start":default:return this.scale(e);case"middle":var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+i;case"end":var n=this.bandwidth?this.bandwidth():0;return this.scale(e)+n}if(t){var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+s}return this.scale(e)}}isInRange(e){var t=this.range(),r=t[0],i=t[t.length-1];return r<=i?e>=r&&e<=i:e>=i&&e<=r}}(_="symbol"==typeof(b=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(_="EPS","string"))?b:b+"")in gQ?Object.defineProperty(gQ,_,{value:1e-4,enumerable:!0,configurable:!0,writable:!0}):gQ[_]=1e-4;var g0=function(e){var{width:t,height:r}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i%180+180)%180*Math.PI/180,s=Math.atan(r/t);return Math.abs(n>s&&n<Math.PI-s?r/Math.sin(n):t/Math.cos(n))};function g1(e,t,r){if(t<1)return[];if(1===t&&void 0===r)return e;for(var i=[],n=0;n<e.length;n+=t)if(void 0!==r&&!0!==r(e[n]))return;else i.push(e[n]);return i}function g2(e,t,r,i,n){if(e*t<e*i||e*t>e*n)return!1;var s=r();return e*(t-e*s/2-i)>=0&&e*(t+e*s/2-n)<=0}function g3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function g4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g3(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g3(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function g6(e,t,r){var i,{tick:n,ticks:s,viewBox:a,minTickGap:o,orientation:l,interval:u,tickFormatter:c,unit:h,angle:f}=e;if(!s||!s.length||!n)return[];if(eW(u)||tf.isSsr)return null!=(i=g1(s,(eW(u)?u:0)+1))?i:[];var d="top"===l||"bottom"===l?"width":"height",p=h&&"width"===d?tb(h,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=(e,i)=>{var n,s="function"==typeof c?c(e.value,i):e.value;return"width"===d?(n=tb(s,{fontSize:t,letterSpacing:r}),g0({width:n.width+p.width,height:n.height+p.height},f)):tb(s,{fontSize:t,letterSpacing:r})[d]},m=s.length>=2?eU(s[1].coordinate-s[0].coordinate):1,y=function(e,t,r){var i="width"===r,{x:n,y:s,width:a,height:o}=e;return 1===t?{start:i?n:s,end:i?n+a:s+o}:{start:i?n+a:s+o,end:i?n:s}}(a,m,d);return"equidistantPreserveStart"===u?function(e,t,r,i,n){for(var s,a=(i||[]).slice(),{start:o,end:l}=t,u=0,c=1,h=o;c<=a.length;)if(s=function(){var t,s=null==i?void 0:i[u];if(void 0===s)return{v:g1(i,c)};var a=u,f=()=>(void 0===t&&(t=r(s,a)),t),d=s.coordinate,p=0===u||g2(e,d,f,h,l);p||(u=0,h=o,c+=1),p&&(h=d+e*(f()/2+n),u+=c)}())return s.v;return[]}(m,y,g,s,o):("preserveStart"===u||"preserveStartEnd"===u?function(e,t,r,i,n,s){var a=(i||[]).slice(),o=a.length,{start:l,end:u}=t;if(s){var c=i[o-1],h=r(c,o-1),f=e*(c.coordinate+e*h/2-u);a[o-1]=c=g4(g4({},c),{},{tickCoord:f>0?c.coordinate-f*e:c.coordinate}),g2(e,c.tickCoord,()=>h,l,u)&&(u=c.tickCoord-e*(h/2+n),a[o-1]=g4(g4({},c),{},{isShow:!0}))}for(var d=s?o-1:o,p=function(t){var i,s=a[t],o=()=>(void 0===i&&(i=r(s,t)),i);if(0===t){var c=e*(s.coordinate-e*o()/2-l);a[t]=s=g4(g4({},s),{},{tickCoord:c<0?s.coordinate-c*e:s.coordinate})}else a[t]=s=g4(g4({},s),{},{tickCoord:s.coordinate});g2(e,s.tickCoord,o,l,u)&&(l=s.tickCoord+e*(o()/2+n),a[t]=g4(g4({},s),{},{isShow:!0}))},g=0;g<d;g++)p(g);return a}(m,y,g,s,o,"preserveStartEnd"===u):function(e,t,r,i,n){for(var s=(i||[]).slice(),a=s.length,{start:o}=t,{end:l}=t,u=function(t){var i,u=s[t],c=()=>(void 0===i&&(i=r(u,t)),i);if(t===a-1){var h=e*(u.coordinate+e*c()/2-l);s[t]=u=g4(g4({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate})}else s[t]=u=g4(g4({},u),{},{tickCoord:u.coordinate});g2(e,u.tickCoord,c,o,l)&&(l=u.tickCoord-e*(c()/2+n),s[t]=g4(g4({},u),{},{isShow:!0}))},c=a-1;c>=0;c--)u(c);return s}(m,y,g,s,o)).filter(e=>e.isShow)}function g5(e,t){for(var r in e)if(({}).hasOwnProperty.call(e,r)&&(!({}).hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var i in t)if(({}).hasOwnProperty.call(t,i)&&!({}).hasOwnProperty.call(e,i))return!1;return!0}var g8=["axisLine","width","height","className","hide","ticks"],g7=["viewBox"],g9=["viewBox"];function me(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function mt(){return(mt=Object.assign.bind()).apply(null,arguments)}function mr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var mn={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"};function ms(e){var{x:t,y:r,width:i,height:n,orientation:s,mirror:a,axisLine:o,otherSvgProps:l}=e;if(!o)return null;var u=mi(mi(mi({},l),e4(o)),{},{fill:"none"});if("top"===s||"bottom"===s){var c=+("top"===s&&!a||"bottom"===s&&a);u=mi(mi({},u),{},{x1:t,y1:r+c*n,x2:t+i,y2:r+c*n})}else{var h=+("left"===s&&!a||"right"===s&&a);u=mi(mi({},u),{},{x1:t+h*i,y1:r,x2:t+h*i,y2:r+n})}return Q.createElement("line",mt({},u,{className:(0,ea.clsx)("recharts-cartesian-axis-line",(0,eB.default)(o,"className"))}))}function ma(e){var t,{option:r,tickProps:i,value:n}=e,s=(0,ea.clsx)(i.className,"recharts-cartesian-axis-tick-value");if(Q.isValidElement(r))t=Q.cloneElement(r,mi(mi({},i),{},{className:s}));else if("function"==typeof r)t=r(mi(mi({},i),{},{className:s}));else{var a="recharts-cartesian-axis-tick-value";"boolean"!=typeof r&&(a=(0,ea.clsx)(a,null==r?void 0:r.className)),t=Q.createElement(tz,mt({},i,{className:a}),n)}return t}function mo(e){var{ticks:t=[],tick:r,tickLine:i,stroke:n,tickFormatter:s,unit:a,padding:o,tickTextProps:l,orientation:u,mirror:c,x:h,y:f,width:d,height:p,tickSize:g,tickMargin:m,fontSize:y,letterSpacing:v,getTicksConfig:b,events:x}=e,_=g6(mi(mi({},b),{},{ticks:t}),y,v),w=function(e,t){switch(e){case"left":return t?"start":"end";case"right":return t?"end":"start";default:return"middle"}}(u,c),k=function(e,t){switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}(u,c),P=e4(b),S=e6(r),E={};"object"==typeof i&&(E=i);var A=mi(mi({},P),{},{fill:"none"},E),M=_.map((e,t)=>{var{line:y,tick:v}=function(e,t,r,i,n,s,a,o,l){var u,c,h,f,d,p,g=o?-1:1,m=e.tickSize||a,y=eW(e.tickCoord)?e.tickCoord:e.coordinate;switch(s){case"top":u=c=e.coordinate,p=(h=(f=r+!o*n)-g*m)-g*l,d=y;break;case"left":h=f=e.coordinate,d=(u=(c=t+!o*i)-g*m)-g*l,p=y;break;case"right":h=f=e.coordinate,d=(u=(c=t+o*i)+g*m)+g*l,p=y;break;default:u=c=e.coordinate,p=(h=(f=r+o*n)+g*m)+g*l,d=y}return{line:{x1:u,y1:h,x2:c,y2:f},tick:{x:d,y:p}}}(e,h,f,d,p,u,g,c,m),b=mi(mi(mi(mi({textAnchor:w,verticalAnchor:k},P),{},{stroke:"none",fill:n},S),v),{},{index:t,payload:e,visibleTicksCount:_.length,tickFormatter:s,padding:o},l);return Q.createElement(tc,mt({className:"recharts-cartesian-axis-tick",key:"tick-".concat(e.value,"-").concat(e.coordinate,"-").concat(e.tickCoord)},((e,t,r)=>{if(null===e||"object"!=typeof e&&"function"!=typeof e)return null;var i=null;return Object.keys(e).forEach(n=>{var s=e[n];ez(n)&&"function"==typeof s&&(i||(i={}),i[n]=e=>(s(t,r,e),null))}),i})(x,e,t)),i&&Q.createElement("line",mt({},A,y,{className:(0,ea.clsx)("recharts-cartesian-axis-tick-line",(0,eB.default)(i,"className"))})),r&&Q.createElement(ma,{option:r,tickProps:b,value:"".concat("function"==typeof s?s(e.value,t):e.value).concat(a||"")}))});return M.length>0?Q.createElement("g",{className:"recharts-cartesian-axis-ticks"},M):null}var ml=(0,Q.forwardRef)((e,t)=>{var{axisLine:r,width:i,height:n,className:s,hide:a,ticks:o}=e,l=me(e,g8),[u,c]=(0,Q.useState)(""),[h,f]=(0,Q.useState)(""),d=(0,Q.useRef)(null);(0,Q.useImperativeHandle)(t,()=>({getCalculatedWidth:()=>{var t;return(e=>{var{ticks:t,label:r,labelGapWithTick:i=5,tickSize:n=0,tickMargin:s=0}=e,a=0;if(t){Array.from(t).forEach(e=>{if(e){var t=e.getBoundingClientRect();t.width>a&&(a=t.width)}});var o=r?r.getBoundingClientRect().width:0;return Math.round(a+(n+s)+o+(r?i:0))}return 0})({ticks:d.current,label:null==(t=e.labelRef)?void 0:t.current,labelGapWithTick:5,tickSize:e.tickSize,tickMargin:e.tickMargin})}}));var p=(0,Q.useCallback)(e=>{if(e){var t=e.getElementsByClassName("recharts-cartesian-axis-tick-value");d.current=t;var r=t[0];if(r){var i=window.getComputedStyle(r),n=i.fontSize,s=i.letterSpacing;(n!==u||s!==h)&&(c(n),f(s))}}},[u,h]);return a||null!=i&&i<=0||null!=n&&n<=0?null:Q.createElement(tc,{className:(0,ea.clsx)("recharts-cartesian-axis",s),ref:p},Q.createElement(ms,{x:e.x,y:e.y,width:i,height:n,orientation:e.orientation,mirror:e.mirror,axisLine:r,otherSvgProps:e4(e)}),Q.createElement(mo,{ticks:o,tick:e.tick,tickLine:e.tickLine,stroke:e.stroke,tickFormatter:e.tickFormatter,unit:e.unit,padding:e.padding,tickTextProps:e.tickTextProps,orientation:e.orientation,mirror:e.mirror,x:e.x,y:e.y,width:e.width,height:e.height,tickSize:e.tickSize,tickMargin:e.tickMargin,fontSize:u,letterSpacing:h,getTicksConfig:e,events:l}),Q.createElement(n7,{x:e.x,y:e.y,width:e.width,height:e.height},Q.createElement(ss,{label:e.label,labelRef:e.labelRef}),e.children))}),mu=Q.memo(ml,(e,t)=>{var{viewBox:r}=e,i=me(e,g7),{viewBox:n}=t,s=me(t,g9);return g5(r,n)&&g5(i,s)}),mc=Q.forwardRef((e,t)=>{var r=n2(e,mn);return Q.createElement(mu,mt({},r,{ref:t}))});mc.displayName="CartesianAxis";var mh=["x1","y1","x2","y2","key"],mf=["offset"],md=["xAxisId","yAxisId"],mp=["xAxisId","yAxisId"];function mg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mm(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mg(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function my(){return(my=Object.assign.bind()).apply(null,arguments)}function mv(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var mb=e=>{var{fill:t}=e;if(!t||"none"===t)return null;var{fillOpacity:r,x:i,y:n,width:s,height:a,ry:o}=e;return Q.createElement("rect",{x:i,y:n,ry:o,width:s,height:a,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function mx(e,t){var r;if(Q.isValidElement(e))r=Q.cloneElement(e,t);else if("function"==typeof e)r=e(t);else{var{x1:i,y1:n,x2:s,y2:a,key:o}=t,l=e4(mv(t,mh)),{offset:u}=l,c=mv(l,mf);r=Q.createElement("line",my({},c,{x1:i,y1:n,x2:s,y2:a,fill:"none",key:o}))}return r}function m_(e){var{x:t,width:r,horizontal:i=!0,horizontalPoints:n}=e;if(!i||!n||!n.length)return null;var{xAxisId:s,yAxisId:a}=e,o=mv(e,md),l=n.map((e,n)=>mx(i,mm(mm({},o),{},{x1:t,y1:e,x2:t+r,y2:e,key:"line-".concat(n),index:n})));return Q.createElement("g",{className:"recharts-cartesian-grid-horizontal"},l)}function mw(e){var{y:t,height:r,vertical:i=!0,verticalPoints:n}=e;if(!i||!n||!n.length)return null;var{xAxisId:s,yAxisId:a}=e,o=mv(e,mp),l=n.map((e,n)=>mx(i,mm(mm({},o),{},{x1:e,y1:t,x2:e,y2:t+r,key:"line-".concat(n),index:n})));return Q.createElement("g",{className:"recharts-cartesian-grid-vertical"},l)}function mk(e){var{horizontalFill:t,fillOpacity:r,x:i,y:n,width:s,height:a,horizontalPoints:o,horizontal:l=!0}=e;if(!l||!t||!t.length)return null;var u=o.map(e=>Math.round(e+n-n)).sort((e,t)=>e-t);n!==u[0]&&u.unshift(0);var c=u.map((e,o)=>{var l=u[o+1]?u[o+1]-e:n+a-e;if(l<=0)return null;var c=o%t.length;return Q.createElement("rect",{key:"react-".concat(o),y:e,x:i,height:l,width:s,stroke:"none",fill:t[c],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},c)}function mP(e){var{vertical:t=!0,verticalFill:r,fillOpacity:i,x:n,y:s,width:a,height:o,verticalPoints:l}=e;if(!t||!r||!r.length)return null;var u=l.map(e=>Math.round(e+n-n)).sort((e,t)=>e-t);n!==u[0]&&u.unshift(0);var c=u.map((e,t)=>{var l=u[t+1]?u[t+1]-e:n+a-e;if(l<=0)return null;var c=t%r.length;return Q.createElement("rect",{key:"react-".concat(t),x:e,y:s,width:l,height:o,stroke:"none",fill:r[c],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},c)}var mS=(e,t)=>{var{xAxis:r,width:i,height:n,offset:s}=e;return i6(g6(mm(mm(mm({},mn),r),{},{ticks:i5(r,!0),viewBox:{x:0,y:0,width:i,height:n}})),s.left,s.left+s.width,t)},mE=(e,t)=>{var{yAxis:r,width:i,height:n,offset:s}=e;return i6(g6(mm(mm(mm({},mn),r),{},{ticks:i5(r,!0),viewBox:{x:0,y:0,width:i,height:n}})),s.top,s.top+s.height,t)},mA={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function mM(e){var t=tZ(nn),r=tZ(ns),i=nD(),n=mm(mm({},n2(e,mA)),{},{x:eW(e.x)?e.x:i.left,y:eW(e.y)?e.y:i.top,width:eW(e.width)?e.width:i.width,height:eW(e.height)?e.height:i.height}),{xAxisId:s,yAxisId:a,x:o,y:l,width:u,height:c,syncWithTicks:h,horizontalValues:f,verticalValues:d}=n,p=nm(),g=tZ(e=>hv(e,"xAxis",s,p)),m=tZ(e=>hv(e,"yAxis",a,p));if(!eW(u)||u<=0||!eW(c)||c<=0||!eW(o)||o!==+o||!eW(l)||l!==+l)return null;var y=n.verticalCoordinatesGenerator||mS,v=n.horizontalCoordinatesGenerator||mE,{horizontalPoints:b,verticalPoints:x}=n;if((!b||!b.length)&&"function"==typeof v){var _=f&&f.length,w=v({yAxis:m?mm(mm({},m),{},{ticks:_?f:m.ticks}):void 0,width:t,height:r,offset:i},!!_||h);nx(Array.isArray(w),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof w,"]")),Array.isArray(w)&&(b=w)}if((!x||!x.length)&&"function"==typeof y){var k=d&&d.length,P=y({xAxis:g?mm(mm({},g),{},{ticks:k?d:g.ticks}):void 0,width:t,height:r,offset:i},!!k||h);nx(Array.isArray(P),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof P,"]")),Array.isArray(P)&&(x=P)}return Q.createElement("g",{className:"recharts-cartesian-grid"},Q.createElement(mb,{fill:n.fill,fillOpacity:n.fillOpacity,x:n.x,y:n.y,width:n.width,height:n.height,ry:n.ry}),Q.createElement(mk,my({},n,{horizontalPoints:b})),Q.createElement(mP,my({},n,{verticalPoints:x})),Q.createElement(m_,my({},n,{offset:i,horizontalPoints:b,xAxis:g,yAxis:m})),Q.createElement(mw,my({},n,{offset:i,verticalPoints:x,xAxis:g,yAxis:m})))}mM.displayName="CartesianGrid";var mT=Q,mC=["children"],mO=(0,Q.createContext)({data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0});function mI(e){var{children:t}=e,r=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,mC);return Q.createElement(mO.Provider,{value:r},t)}var mL=(e,t,r,i)=>h_(e,"xAxis",t,i),mj=(e,t,r,i)=>hx(e,"xAxis",t,i),mN=(e,t,r,i)=>h_(e,"yAxis",r,i),mD=(e,t,r,i)=>hx(e,"yAxis",r,i),mR=rq([nR,mL,mN,mj,mD],(e,t,r,i,n)=>i4(e,"xAxis")?nt(t,i,!1):nt(r,n,!1));function mz(e){return"line"===e.type}var mF=rq([ce,(e,t,r,i,n)=>n],(e,t)=>e.filter(mz).find(e=>e.id===t)),mB=rq([nR,mL,mN,mj,mD,mF,mR,uf],(e,t,r,i,n,s,a,o)=>{var l,{chartData:u,dataStartIndex:c,dataEndIndex:h}=o;if(null!=s&&null!=t&&null!=r&&null!=i&&null!=n&&0!==i.length&&0!==n.length&&null!=a){var{dataKey:f,data:d}=s;if(null!=(l=null!=d&&d.length>0?d:null==u?void 0:u.slice(c,h+1)))return function(e){var{layout:t,xAxis:r,yAxis:i,xAxisTicks:n,yAxisTicks:s,dataKey:a,bandSize:o,displayedData:l}=e;return l.map((e,l)=>{var u=i3(e,a);if("horizontal"===t)return{x:i7({axis:r,ticks:n,bandSize:o,entry:e,index:l}),y:null==u?null:i.scale(u),value:u,payload:e};var c=null==u?null:r.scale(u),h=i7({axis:i,ticks:s,bandSize:o,entry:e,index:l});return null==c||null==h?null:{x:c,y:h,value:u,payload:e}}).filter(Boolean)}({layout:e,xAxis:t,yAxis:r,xAxisTicks:i,yAxisTicks:n,dataKey:f,bandSize:a,displayedData:l})}}),mU=["id"],m$=["type","layout","connectNulls","needClip"],mV=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function mW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mG(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mW(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mW(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function mq(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function mH(){return(mH=Object.assign.bind()).apply(null,arguments)}function mK(e){var{dataKey:t,data:r,stroke:i,strokeWidth:n,fill:s,name:a,hide:o,unit:l}=e;return{dataDefinedOnItem:r,positions:void 0,settings:{stroke:i,strokeWidth:n,fill:s,dataKey:t,nameKey:void 0,name:ni(a,t),hide:o,type:e.tooltipType,color:e.stroke,unit:l}}}var mY=(e,t)=>"".concat(t,"px ").concat(e-t,"px");function mZ(e){var{clipPathId:t,points:r,props:i}=e,{dot:n,dataKey:s,needClip:a}=i;if(null==r||!n&&1!==r.length)return null;var{id:o}=i,l=mq(i,mU),u=sm(n),c=e4(l),h=to(n),f=r.map((e,t)=>{var i,a=mG(mG(mG({key:"dot-".concat(t),r:3},c),h),{},{index:t,cx:e.x,cy:e.y,dataKey:s,value:e.value,payload:e.payload,points:r});if(mT.isValidElement(n))i=mT.cloneElement(n,a);else if("function"==typeof n)i=n(a);else{var o=(0,ea.clsx)("recharts-line-dot","boolean"!=typeof n?n.className:"");i=mT.createElement(ts,mH({},a,{className:o}))}return i}),d={clipPath:a?"url(#clipPath-".concat(u?"":"dots-").concat(t,")"):void 0};return mT.createElement(tc,mH({className:"recharts-line-dots",key:"dots"},d),f)}function mX(e){var{showLabels:t,children:r,points:i}=e,n=(0,mT.useMemo)(()=>null==i?void 0:i.map(e=>{var t={x:e.x,y:e.y,width:0,height:0};return mG(mG({},t),{},{value:e.value,payload:e.payload,viewBox:t,parentViewBox:void 0,fill:void 0})}),[i]);return mT.createElement(sf,{value:t?n:null},r)}function mJ(e){var{clipPathId:t,pathRef:r,points:i,strokeDasharray:n,props:s}=e,{type:a,layout:o,connectNulls:l,needClip:u}=s,c=mG(mG({},ta(mq(s,m$))),{},{fill:"none",className:"recharts-line-curve",clipPath:u?"url(#clipPath-".concat(t,")"):void 0,points:i,type:a,layout:o,connectNulls:l,strokeDasharray:null!=n?n:s.strokeDasharray});return mT.createElement(mT.Fragment,null,(null==i?void 0:i.length)>1&&mT.createElement(ti,mH({},c,{pathRef:r})),mT.createElement(mZ,{points:i,clipPathId:t,props:s}))}function mQ(e){var{clipPathId:t,props:r,pathRef:i,previousPointsRef:n,longestAnimatedLengthRef:s}=e,{points:a,strokeDasharray:o,isAnimationActive:l,animationBegin:u,animationDuration:c,animationEasing:h,animateNewValues:f,width:d,height:p,onAnimationEnd:g,onAnimationStart:m}=r,y=n.current,v=dx(r,"recharts-line-"),[b,x]=(0,mT.useState)(!1),_=(0,mT.useCallback)(()=>{"function"==typeof g&&g(),x(!1)},[g]),w=(0,mT.useCallback)(()=>{"function"==typeof m&&m(),x(!0)},[m]),k=function(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(e){return 0}}(i.current),P=s.current;return mT.createElement(mX,{points:a,showLabels:!b},r.children,mT.createElement(dX,{animationId:v,begin:u,duration:c,isActive:l,easing:h,onAnimationEnd:_,onAnimationStart:w,key:v},e=>{var u,c=Math.min(eZ(P,k+P,e),k);if(u=l?o?((e,t,r)=>{var i=r.reduce((e,t)=>e+t);if(!i)return mY(t,e);for(var n=Math.floor(e/i),s=e%i,a=t-e,o=[],l=0,u=0;l<r.length;u+=r[l],++l)if(u+r[l]>s){o=[...r.slice(0,l),s-u];break}var c=o.length%2==0?[0,a]:[a];return[...function(e,t){for(var r=e.length%2!=0?[...e,0]:e,i=[],n=0;n<t;++n)i=[...i,...r];return i}(r,n),...o,...c].map(e=>"".concat(e,"px")).join(", ")})(c,k,"".concat(o).split(/[,\s]+/gim).map(e=>parseFloat(e))):mY(k,c):null==o?void 0:String(o),y){var h=y.length/a.length,g=1===e?a:a.map((t,r)=>{var i=Math.floor(r*h);if(y[i]){var n=y[i];return mG(mG({},t),{},{x:eZ(n.x,t.x,e),y:eZ(n.y,t.y,e)})}return f?mG(mG({},t),{},{x:eZ(2*d,t.x,e),y:eZ(p/2,t.y,e)}):mG(mG({},t),{},{x:t.x,y:t.y})});return n.current=g,mT.createElement(mJ,{props:r,points:g,clipPathId:t,pathRef:i,strokeDasharray:u})}return e>0&&k>0&&(n.current=a,s.current=c),mT.createElement(mJ,{props:r,points:a,clipPathId:t,pathRef:i,strokeDasharray:u})}),mT.createElement(sg,{label:r.label}))}function m0(e){var{clipPathId:t,props:r}=e,i=(0,mT.useRef)(null),n=(0,mT.useRef)(0),s=(0,mT.useRef)(null);return mT.createElement(mQ,{props:r,clipPathId:t,previousPointsRef:i,longestAnimatedLengthRef:n,pathRef:s})}var m1=(e,t)=>({x:e.x,y:e.y,value:e.value,errorVal:i3(e.payload,t)});class m2 extends mT.Component{render(){var{hide:e,dot:t,points:r,className:i,xAxisId:n,yAxisId:s,top:a,left:o,width:l,height:u,id:c,needClip:h}=this.props;if(e)return null;var f=(0,ea.clsx)("recharts-line",i),{r:d,strokeWidth:p}=dJ(t),g=sm(t),m=2*d+p;return mT.createElement(mT.Fragment,null,mT.createElement(tc,{className:f},h&&mT.createElement("defs",null,mT.createElement(f1,{clipPathId:c,xAxisId:n,yAxisId:s}),!g&&mT.createElement("clipPath",{id:"clipPath-dots-".concat(c)},mT.createElement("rect",{x:o-m/2,y:a-m/2,width:l+m,height:u+m}))),mT.createElement(mI,{xAxisId:n,yAxisId:s,data:r,dataPointFormatter:m1,errorBarOffset:0},mT.createElement(m0,{props:this.props,clipPathId:c}))),mT.createElement(fJ,{activeDot:this.props.activeDot,points:r,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var m3={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!tf.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function m4(e){var t=n2(e,m3),{activeDot:r,animateNewValues:i,animationBegin:n,animationDuration:s,animationEasing:a,connectNulls:o,dot:l,hide:u,isAnimationActive:c,label:h,legendType:f,xAxisId:d,yAxisId:p,id:g}=t,m=mq(t,mV),{needClip:y}=f0(d,p),v=tZ(fY),b=tZ(nR),x=nm(),_=tZ(e=>mB(e,d,p,x,g));if("horizontal"!==b&&"vertical"!==b||null==_||null==v)return null;var{height:w,width:k,x:P,y:S}=v;return mT.createElement(m2,mH({},m,{id:g,connectNulls:o,dot:l,activeDot:r,animateNewValues:i,animationBegin:n,animationDuration:s,animationEasing:a,isAnimationActive:c,hide:u,label:h,legendType:f,xAxisId:d,yAxisId:p,points:_,layout:b,height:w,width:k,left:P,top:S,needClip:y}))}var m6=mT.memo(function(e){var t=n2(e,m3),r=nm();return mT.createElement(dk,{id:t.id,type:"line"},e=>mT.createElement(mT.Fragment,null,mT.createElement(db,{legendPayload:(e=>{var{dataKey:t,name:r,stroke:i,legendType:n,hide:s}=e;return[{inactive:s,dataKey:t,type:n,color:i,value:ni(r,t),payload:e}]})(t)}),mT.createElement(fQ,{fn:mK,args:t}),mT.createElement(dO,{type:"line",id:e,data:t.data,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,hide:t.hide,isPanorama:r}),mT.createElement(m4,mH({},t,{id:e}))))});m6.displayName="Line";var m5=["axis"],m8=(0,Q.forwardRef)((e,t)=>Q.createElement(gZ,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:m5,tooltipPayloadSearcher:pu,categoricalChartProps:e,ref:t})),m7=e.i(74080);function m9(){return(m9=Object.assign.bind()).apply(null,arguments)}function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yr(e){return Array.isArray(e)&&eG(e[0])&&eG(e[1])?e.join(" ~ "):e}var yi=e=>{var{separator:t=" : ",contentStyle:r={},itemStyle:i={},labelStyle:n={},payload:s,formatter:a,itemSorter:o,wrapperClassName:l,labelClassName:u,label:c,labelFormatter:h,accessibilityLayer:f=!1}=e,d=yt({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),p=yt({margin:0},n),g=null!=c,m=g?c:"",y=(0,ea.clsx)("recharts-default-tooltip",l),v=(0,ea.clsx)("recharts-tooltip-label",u);return g&&h&&null!=s&&(m=h(c,s)),Q.createElement("div",m9({className:y,style:d},f?{role:"status","aria-live":"assertive"}:{}),Q.createElement("p",{className:v,style:p},Q.isValidElement(m)?m:"".concat(m)),(()=>{if(s&&s.length){var e=(o?(0,iK.default)(s,o):s).map((e,r)=>{if("none"===e.type)return null;var n=e.formatter||a||yr,{value:o,name:l}=e,u=o,c=l;if(n){var h=n(o,l,e,r,s);if(Array.isArray(h))[u,c]=h;else{if(null==h)return null;u=h}}var f=yt({display:"block",paddingTop:4,paddingBottom:4,color:e.color||"#000"},i);return Q.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(r),style:f},eG(c)?Q.createElement("span",{className:"recharts-tooltip-item-name"},c):null,eG(c)?Q.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,Q.createElement("span",{className:"recharts-tooltip-item-value"},u),Q.createElement("span",{className:"recharts-tooltip-item-unit"},e.unit||""))});return Q.createElement("ul",{className:"recharts-tooltip-item-list",style:{padding:0,margin:0}},e)}return null})())},yn=Q,ys="recharts-tooltip-wrapper",ya={visibility:"hidden"};function yo(e){var{allowEscapeViewBox:t,coordinate:r,key:i,offsetTopLeft:n,position:s,reverseDirection:a,tooltipDimension:o,viewBox:l,viewBoxDimension:u}=e;if(s&&eW(s[i]))return s[i];var c=r[i]-o-(n>0?n:0),h=r[i]+n;if(t[i])return a[i]?c:h;var f=l[i];return null==f?0:a[i]?c<f?Math.max(h,f):Math.max(c,f):null==u?0:h+o>f+u?Math.max(c,f):Math.max(h,f)}function yl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yl(Object(r),!0).forEach(function(t){yc(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yc(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class yh extends yn.PureComponent{constructor(){super(...arguments),yc(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),yc(this,"handleKeyDown",e=>{if("Escape"===e.key){var t,r,i,n;this.setState({dismissed:!0,dismissedAtCoordinate:{x:null!=(t=null==(r=this.props.coordinate)?void 0:r.x)?t:0,y:null!=(i=null==(n=this.props.coordinate)?void 0:n.y)?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,t;this.state.dismissed&&((null==(e=this.props.coordinate)?void 0:e.x)!==this.state.dismissedAtCoordinate.x||(null==(t=this.props.coordinate)?void 0:t.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:t,animationDuration:r,animationEasing:i,children:n,coordinate:s,hasPayload:a,isAnimationActive:o,offset:l,position:u,reverseDirection:c,useTranslate3d:h,viewBox:f,wrapperStyle:d,lastBoundingBox:p,innerRef:g,hasPortalFromProps:m}=this.props,{cssClasses:y,cssProperties:v}=function(e){var t,r,i,{allowEscapeViewBox:n,coordinate:s,offsetTopLeft:a,position:o,reverseDirection:l,tooltipBox:u,useTranslate3d:c,viewBox:h}=e;return{cssProperties:t=u.height>0&&u.width>0&&s?function(e){var{translateX:t,translateY:r,useTranslate3d:i}=e;return{transform:i?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}({translateX:r=yo({allowEscapeViewBox:n,coordinate:s,key:"x",offsetTopLeft:a,position:o,reverseDirection:l,tooltipDimension:u.width,viewBox:h,viewBoxDimension:h.width}),translateY:i=yo({allowEscapeViewBox:n,coordinate:s,key:"y",offsetTopLeft:a,position:o,reverseDirection:l,tooltipDimension:u.height,viewBox:h,viewBoxDimension:h.height}),useTranslate3d:c}):ya,cssClasses:function(e){var{coordinate:t,translateX:r,translateY:i}=e;return(0,ea.clsx)(ys,{["".concat(ys,"-right")]:eW(r)&&t&&eW(t.x)&&r>=t.x,["".concat(ys,"-left")]:eW(r)&&t&&eW(t.x)&&r<t.x,["".concat(ys,"-bottom")]:eW(i)&&t&&eW(t.y)&&i>=t.y,["".concat(ys,"-top")]:eW(i)&&t&&eW(t.y)&&i<t.y})}({translateX:r,translateY:i,coordinate:s})}}({allowEscapeViewBox:t,coordinate:s,offsetTopLeft:l,position:u,reverseDirection:c,tooltipBox:{height:p.height,width:p.width},useTranslate3d:h,viewBox:f}),b=m?{}:yu(yu({transition:o&&e?"transform ".concat(r,"ms ").concat(i):void 0},v),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&a?"visible":"hidden",position:"absolute",top:0,left:0}),x=yu(yu({},b),{},{visibility:!this.state.dismissed&&e&&a?"visible":"hidden"},d);return yn.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:y,style:x,ref:g},n)}}var yf=e.i(92809),yd=["x","y","top","left","width","height","className"];function yp(){return(yp=Object.assign.bind()).apply(null,arguments)}function yg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}var ym=e=>{var{x:t=0,y:r=0,top:i=0,left:n=0,width:s=0,height:a=0,className:o}=e,l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yg(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({x:t,y:r,top:i,left:n,width:s,height:a},function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,yd));return eW(t)&&eW(r)&&eW(s)&&eW(a)&&eW(i)&&eW(n)?Q.createElement("path",yp({},ta(l),{className:(0,ea.clsx)("recharts-cross",o),d:"M".concat(t,",").concat(i,"v").concat(a,"M").concat(n,",").concat(r,"h").concat(s)})):null},yy=["radius"],yv=["radius"];function yb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yb(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yb(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function y_(){return(y_=Object.assign.bind()).apply(null,arguments)}function yw(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var yk=(e,t,r,i,n)=>{var s,a=Math.min(Math.abs(r)/2,Math.abs(i)/2),o=i>=0?1:-1,l=r>=0?1:-1,u=+(i>=0&&r>=0||i<0&&r<0);if(a>0&&n instanceof Array){for(var c=[0,0,0,0],h=0;h<4;h++)c[h]=n[h]>a?a:n[h];s="M".concat(e,",").concat(t+o*c[0]),c[0]>0&&(s+="A ".concat(c[0],",").concat(c[0],",0,0,").concat(u,",").concat(e+l*c[0],",").concat(t)),s+="L ".concat(e+r-l*c[1],",").concat(t),c[1]>0&&(s+="A ".concat(c[1],",").concat(c[1],",0,0,").concat(u,",\n        ").concat(e+r,",").concat(t+o*c[1])),s+="L ".concat(e+r,",").concat(t+i-o*c[2]),c[2]>0&&(s+="A ".concat(c[2],",").concat(c[2],",0,0,").concat(u,",\n        ").concat(e+r-l*c[2],",").concat(t+i)),s+="L ".concat(e+l*c[3],",").concat(t+i),c[3]>0&&(s+="A ".concat(c[3],",").concat(c[3],",0,0,").concat(u,",\n        ").concat(e,",").concat(t+i-o*c[3])),s+="Z"}else if(a>0&&n===+n&&n>0){var f=Math.min(a,n);s="M ".concat(e,",").concat(t+o*f,"\n            A ").concat(f,",").concat(f,",0,0,").concat(u,",").concat(e+l*f,",").concat(t,"\n            L ").concat(e+r-l*f,",").concat(t,"\n            A ").concat(f,",").concat(f,",0,0,").concat(u,",").concat(e+r,",").concat(t+o*f,"\n            L ").concat(e+r,",").concat(t+i-o*f,"\n            A ").concat(f,",").concat(f,",0,0,").concat(u,",").concat(e+r-l*f,",").concat(t+i,"\n            L ").concat(e+l*f,",").concat(t+i,"\n            A ").concat(f,",").concat(f,",0,0,").concat(u,",").concat(e,",").concat(t+i-o*f," Z")}else s="M ".concat(e,",").concat(t," h ").concat(r," v ").concat(i," h ").concat(-r," Z");return s},yP={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},yS=e=>{let t,r;var i=n2(e,yP),n=(0,Q.useRef)(null),[s,a]=(0,Q.useState)(-1);(0,Q.useEffect)(()=>{if(n.current&&n.current.getTotalLength)try{var e=n.current.getTotalLength();e&&a(e)}catch(e){}},[]);var{x:o,y:l,width:u,height:c,radius:h,className:f}=i,{animationEasing:d,animationDuration:p,animationBegin:g,isAnimationActive:m,isUpdateAnimationActive:y}=i,v=(0,Q.useRef)(u),b=(0,Q.useRef)(c),x=(0,Q.useRef)(o),_=(0,Q.useRef)(l),w=dx((0,Q.useMemo)(()=>({x:o,y:l,width:u,height:c,radius:h}),[o,l,u,c,h]),"rectangle-");if(o!==+o||l!==+l||u!==+u||c!==+c||0===u||0===c)return null;var k=(0,ea.clsx)("recharts-rectangle",f);if(!y){var P=ta(i),{radius:S}=P,E=yw(P,yy);return Q.createElement("path",y_({},E,{radius:"number"==typeof h?h:void 0,className:k,d:yk(o,l,u,c,h)}))}var A=v.current,M=b.current,T=x.current,C=_.current,O="0px ".concat(-1===s?1:s,"px"),I="".concat(s,"px 0px"),L=(t=["strokeDasharray"],r="string"==typeof d?d:void 0,t.map(e=>"".concat(e.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase()))," ").concat(p,"ms ").concat(r)).join(","));return Q.createElement(dX,{animationId:w,key:w,canBegin:s>0,duration:p,easing:d,isActive:y,begin:g},e=>{var t,r=eZ(A,u,e),s=eZ(M,c,e),a=eZ(T,o,e),f=eZ(C,l,e);n.current&&(v.current=r,b.current=s,x.current=a,_.current=f),t=m?e>0?{transition:L,strokeDasharray:I}:{strokeDasharray:O}:{strokeDasharray:I};var d=ta(i),{radius:p}=d,g=yw(d,yv);return Q.createElement("path",y_({},g,{radius:"number"==typeof h?h:void 0,className:k,d:yk(a,f,r,s,h),ref:n,style:yx(yx({},t),i.style)}))})};function yE(e){var{cx:t,cy:r,radius:i,startAngle:n,endAngle:s}=e;return{points:[t$(t,r,i,n),t$(t,r,i,s)],cx:t,cy:r,radius:i,startAngle:n,endAngle:s}}function yA(){return(yA=Object.assign.bind()).apply(null,arguments)}var yM=e=>{var{cx:t,cy:r,radius:i,angle:n,sign:s,isExternal:a,cornerRadius:o,cornerIsExternal:l}=e,u=o*(a?1:-1)+i,c=Math.asin(o/u)/tU,h=l?n:n+s*c,f=t$(t,r,u,h);return{center:f,circleTangency:t$(t,r,i,h),lineTangency:t$(t,r,u*Math.cos(c*tU),l?n-s*c:n),theta:c}},yT=e=>{var{cx:t,cy:r,innerRadius:i,outerRadius:n,startAngle:s,endAngle:a}=e,o=eU(a-s)*Math.min(Math.abs(a-s),359.999),l=s+o,u=t$(t,r,n,s),c=t$(t,r,n,l),h="M ".concat(u.x,",").concat(u.y,"\n    A ").concat(n,",").concat(n,",0,\n    ").concat(+(Math.abs(o)>180),",").concat(+(s>l),",\n    ").concat(c.x,",").concat(c.y,"\n  ");if(i>0){var f=t$(t,r,i,s),d=t$(t,r,i,l);h+="L ".concat(d.x,",").concat(d.y,"\n            A ").concat(i,",").concat(i,",0,\n            ").concat(+(Math.abs(o)>180),",").concat(+(s<=l),",\n            ").concat(f.x,",").concat(f.y," Z")}else h+="L ".concat(t,",").concat(r," Z");return h},yC={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},yO=e=>{var t,r=n2(e,yC),{cx:i,cy:n,innerRadius:s,outerRadius:a,cornerRadius:o,forceCornerRadius:l,cornerIsExternal:u,startAngle:c,endAngle:h,className:f}=r;if(a<s||c===h)return null;var d=(0,ea.clsx)("recharts-sector",f),p=a-s,g=eK(o,p,0,!0);return t=g>0&&360>Math.abs(c-h)?(e=>{var{cx:t,cy:r,innerRadius:i,outerRadius:n,cornerRadius:s,forceCornerRadius:a,cornerIsExternal:o,startAngle:l,endAngle:u}=e,c=eU(u-l),{circleTangency:h,lineTangency:f,theta:d}=yM({cx:t,cy:r,radius:n,angle:l,sign:c,cornerRadius:s,cornerIsExternal:o}),{circleTangency:p,lineTangency:g,theta:m}=yM({cx:t,cy:r,radius:n,angle:u,sign:-c,cornerRadius:s,cornerIsExternal:o}),y=o?Math.abs(l-u):Math.abs(l-u)-d-m;if(y<0)return a?"M ".concat(f.x,",").concat(f.y,"\n        a").concat(s,",").concat(s,",0,0,1,").concat(2*s,",0\n        a").concat(s,",").concat(s,",0,0,1,").concat(-(2*s),",0\n      "):yT({cx:t,cy:r,innerRadius:i,outerRadius:n,startAngle:l,endAngle:u});var v="M ".concat(f.x,",").concat(f.y,"\n    A").concat(s,",").concat(s,",0,0,").concat(+(c<0),",").concat(h.x,",").concat(h.y,"\n    A").concat(n,",").concat(n,",0,").concat(+(y>180),",").concat(+(c<0),",").concat(p.x,",").concat(p.y,"\n    A").concat(s,",").concat(s,",0,0,").concat(+(c<0),",").concat(g.x,",").concat(g.y,"\n  ");if(i>0){var{circleTangency:b,lineTangency:x,theta:_}=yM({cx:t,cy:r,radius:i,angle:l,sign:c,isExternal:!0,cornerRadius:s,cornerIsExternal:o}),{circleTangency:w,lineTangency:k,theta:P}=yM({cx:t,cy:r,radius:i,angle:u,sign:-c,isExternal:!0,cornerRadius:s,cornerIsExternal:o}),S=o?Math.abs(l-u):Math.abs(l-u)-_-P;if(S<0&&0===s)return"".concat(v,"L").concat(t,",").concat(r,"Z");v+="L".concat(k.x,",").concat(k.y,"\n      A").concat(s,",").concat(s,",0,0,").concat(+(c<0),",").concat(w.x,",").concat(w.y,"\n      A").concat(i,",").concat(i,",0,").concat(+(S>180),",").concat(+(c>0),",").concat(b.x,",").concat(b.y,"\n      A").concat(s,",").concat(s,",0,0,").concat(+(c<0),",").concat(x.x,",").concat(x.y,"Z")}else v+="L".concat(t,",").concat(r,"Z");return v})({cx:i,cy:n,innerRadius:s,outerRadius:a,cornerRadius:Math.min(g,p/2),forceCornerRadius:l,cornerIsExternal:u,startAngle:c,endAngle:h}):yT({cx:i,cy:n,innerRadius:s,outerRadius:a,startAngle:c,endAngle:h}),Q.createElement("path",yA({},ta(r),{className:d,d:t}))};function yI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yL(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yI(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yI(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yj(){return(yj=Object.assign.bind()).apply(null,arguments)}function yN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yN(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yN(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yR(e){var t,r,i,{coordinate:n,payload:s,index:a,offset:o,tooltipAxisBandSize:l,layout:u,cursor:c,tooltipEventType:h,chartName:f}=e;if(!c||!n||"ScatterChart"!==f&&"axis"!==h)return null;if("ScatterChart"===f)r=n,i=ym;else if("BarChart"===f)t=l/2,r={stroke:"none",fill:"#ccc",x:"horizontal"===u?n.x-t:o.left+.5,y:"horizontal"===u?o.top+.5:n.y-t,width:"horizontal"===u?l:o.width-1,height:"horizontal"===u?o.height-1:l},i=yS;else if("radial"===u){var{cx:d,cy:p,radius:g,startAngle:m,endAngle:y}=yE(n);r={cx:d,cy:p,startAngle:m,endAngle:y,innerRadius:g,outerRadius:g},i=yO}else r={points:function(e,t,r){var i,n,s,a;if("horizontal"===e)s=i=t.x,n=r.top,a=r.top+r.height;else if("vertical"===e)a=n=t.y,i=r.left,s=r.left+r.width;else if(null!=t.cx&&null!=t.cy)if("centric"!==e)return yE(t);else{var{cx:o,cy:l,innerRadius:u,outerRadius:c,angle:h}=t,f=t$(o,l,u,h),d=t$(o,l,c,h);i=f.x,n=f.y,s=d.x,a=d.y}return[{x:i,y:n},{x:s,y:a}]}(u,n,o)},i=ti;var v="object"==typeof c&&"className"in c?c.className:void 0,b=yD(yD(yD(yD({stroke:"#ccc",pointerEvents:"none"},o),r),e6(c)),{},{payload:s,payloadIndex:a,className:(0,ea.clsx)("recharts-tooltip-cursor",v)});return(0,Q.isValidElement)(c)?(0,Q.cloneElement)(c,b):(0,Q.createElement)(i,b)}function yz(e){var t,r,i,n=(t=tZ(uV),r=tZ(fk),i=tZ(fx),nt(yL(yL({},t),{},{scale:i}),r)),s=nD(),a=tZ(nR),o=tZ(uj);return Q.createElement(yR,yj({},e,{coordinate:e.coordinate,index:e.index,payload:e.payload,offset:s,layout:a,tooltipAxisBandSize:n,chartName:o}))}function yF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yF(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yU(e){return e.dataKey}var y$=[],yV={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!tf.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function yW(e){var t,r,i,n,s,a,o,l,u,c=n2(e,yV),{active:h,allowEscapeViewBox:f,animationDuration:d,animationEasing:p,content:g,filterNull:m,isAnimationActive:y,offset:v,payloadUniqBy:b,position:x,reverseDirection:_,useTranslate3d:w,wrapperStyle:k,cursor:P,shared:S,trigger:E,defaultIndex:A,portal:M,axisId:T}=c,C=tq(),O="number"==typeof A?String(A):A;(0,Q.useEffect)(()=>{C(hL({shared:S,trigger:E,axisId:T,active:h,defaultIndex:O}))},[C,S,E,T,h,O]);var I=nj(),L=gg(),j=tZ(e=>hA(e,S)),{activeIndex:N,isActive:D}=tZ(e=>dh(e,j,E,O)),R=tZ(e=>dc(e,j,E,O)),z=tZ(e=>du(e,j,E,O)),F=tZ(e=>dl(e,j,E,O)),B=(0,Q.useContext)(gL),U=null!=h?h:D,[$,V]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,r]=(0,Q.useState)({height:0,left:0,top:0,width:0}),i=(0,Q.useCallback)(e=>{if(null!=e){var i=e.getBoundingClientRect(),n={height:i.height,left:i.left,top:i.top,width:i.width};(Math.abs(n.height-t.height)>1||Math.abs(n.left-t.left)>1||Math.abs(n.top-t.top)>1||Math.abs(n.width-t.width)>1)&&r({height:n.height,left:n.left,top:n.top,width:n.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,i]}([R,U]),W="axis"===j?z:void 0;t=tZ(e=>((e,t,r)=>{if(null!=t){var i=hZ(e);return"axis"===t?"hover"===r?i.axisInteraction.hover.dataKey:i.axisInteraction.click.dataKey:"hover"===r?i.itemInteraction.hover.dataKey:i.itemInteraction.click.dataKey}})(e,j,E)),r=tZ(uR),i=tZ(uN),n=tZ(uD),a=null==(s=tZ(gM))?void 0:s.active,o=nj(),(0,Q.useEffect)(()=>{if(!a&&null!=i&&null!=r){var e=hB({active:U,coordinate:F,dataKey:t,index:N,label:"number"==typeof W?String(W):W,sourceViewBox:o});gS.emit(gE,i,e,r)}},[a,F,t,N,W,r,i,n,U,o]);var G=null!=M?M:B;if(null==G)return null;var q=null!=R?R:y$;U||(q=y$),m&&q.length&&(l=R.filter(e=>null!=e.value&&(!0!==e.hide||c.includeHidden)),q=!0===b?(0,yf.default)(l,yU):"function"==typeof b?(0,yf.default)(l,b):l);var H=q.length>0,K=Q.createElement(yh,{allowEscapeViewBox:f,animationDuration:d,animationEasing:p,isAnimationActive:y,active:U,coordinate:F,hasPayload:H,offset:v,position:x,reverseDirection:_,useTranslate3d:w,viewBox:I,wrapperStyle:k,lastBoundingBox:$,innerRef:V,hasPortalFromProps:!!M},(u=yB(yB({},c),{},{payload:q,label:W,active:U,coordinate:F,accessibilityLayer:L}),Q.isValidElement(g)?Q.cloneElement(g,u):"function"==typeof g?Q.createElement(g,u):Q.createElement(yi,u)));return Q.createElement(Q.Fragment,null,(0,m7.createPortal)(K,G),U&&Q.createElement(yz,{cursor:P,tooltipEventType:j,coordinate:F,payload:R,index:N}))}var yG=["dangerouslySetInnerHTML","ticks"],yq=["id"],yH=["domain"],yK=["domain"];function yY(){return(yY=Object.assign.bind()).apply(null,arguments)}function yZ(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function yX(e){var t=tq();return(0,Q.useLayoutEffect)(()=>(t(fB(e)),()=>{t(fU(e))}),[e,t]),null}var yJ=e=>{var{xAxisId:t,className:r}=e,i=tZ(np),n=nm(),s="xAxis",a=tZ(e=>ht(e,s,t,n)),o=tZ(e=>hb(e,s,t,n)),l=tZ(e=>hl(e,t)),u=tZ(e=>hh(e,t)),c=tZ(e=>uQ(e,t));if(null==l||null==u||null==c)return null;var{dangerouslySetInnerHTML:h,ticks:f}=e,d=yZ(e,yG),{id:p}=c,g=yZ(c,yq);return Q.createElement(mc,yY({},d,g,{scale:a,x:u.x,y:u.y,width:l.width,height:l.height,className:(0,ea.clsx)("recharts-".concat(s," ").concat(s),r),viewBox:i,ticks:o}))},yQ={allowDataOverflow:uJ.allowDataOverflow,allowDecimals:uJ.allowDecimals,allowDuplicatedCategory:uJ.allowDuplicatedCategory,height:uJ.height,hide:!1,mirror:uJ.mirror,orientation:uJ.orientation,padding:uJ.padding,reversed:uJ.reversed,scale:uJ.scale,tickCount:uJ.tickCount,type:uJ.type,xAxisId:0},y0=Q.memo(e=>{var t,r,i,n,s,a=n2(e,yQ);return Q.createElement(Q.Fragment,null,Q.createElement(yX,{interval:null!=(t=a.interval)?t:"preserveEnd",id:a.xAxisId,scale:a.scale,type:a.type,padding:a.padding,allowDataOverflow:a.allowDataOverflow,domain:a.domain,dataKey:a.dataKey,allowDuplicatedCategory:a.allowDuplicatedCategory,allowDecimals:a.allowDecimals,tickCount:a.tickCount,includeHidden:null!=(r=a.includeHidden)&&r,reversed:a.reversed,ticks:a.ticks,height:a.height,orientation:a.orientation,mirror:a.mirror,hide:a.hide,unit:a.unit,name:a.name,angle:null!=(i=a.angle)?i:0,minTickGap:null!=(n=a.minTickGap)?n:5,tick:null==(s=a.tick)||s,tickFormatter:a.tickFormatter}),Q.createElement(yJ,a))},(e,t)=>{var{domain:r}=e,i=yZ(e,yH),{domain:n}=t;return!!g5(i,yZ(t,yK))&&(Array.isArray(r)&&2===r.length&&Array.isArray(n)&&2===n.length?r[0]===n[0]&&r[1]===n[1]:g5({domain:r},{domain:n}))});y0.displayName="XAxis";var y1=["dangerouslySetInnerHTML","ticks"],y2=["id"],y3=["domain"],y4=["domain"];function y6(){return(y6=Object.assign.bind()).apply(null,arguments)}function y5(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function y8(e){var t=tq();return(0,Q.useLayoutEffect)(()=>(t(f$(e)),()=>{t(fV(e))}),[e,t]),null}var y7=e=>{var{yAxisId:t,className:r,width:i,label:n}=e,s=(0,Q.useRef)(null),a=(0,Q.useRef)(null),o=tZ(np),l=nm(),u=tq(),c="yAxis",h=tZ(e=>ht(e,c,t,l)),f=tZ(e=>hd(e,t)),d=tZ(e=>hf(e,t)),p=tZ(e=>hb(e,c,t,l)),g=tZ(e=>u2(e,t));if((0,Q.useLayoutEffect)(()=>{if(!("auto"!==i||!f||st(n)||(0,Q.isValidElement)(n))&&null!=g){var e=s.current;if(e){var r=e.getCalculatedWidth();Math.round(f.width)!==Math.round(r)&&u(fq({id:t,width:r}))}}},[p,f,u,n,t,i,g]),null==f||null==d||null==g)return null;var{dangerouslySetInnerHTML:m,ticks:y}=e,v=y5(e,y1),{id:b}=g,x=y5(g,y2);return Q.createElement(mc,y6({},v,x,{ref:s,labelRef:a,scale:h,x:d.x,y:d.y,tickTextProps:"auto"===i?{width:void 0}:{width:i},width:f.width,height:f.height,className:(0,ea.clsx)("recharts-".concat(c," ").concat(c),r),viewBox:o,ticks:p}))},y9={allowDataOverflow:u1.allowDataOverflow,allowDecimals:u1.allowDecimals,allowDuplicatedCategory:u1.allowDuplicatedCategory,hide:!1,mirror:u1.mirror,orientation:u1.orientation,padding:u1.padding,reversed:u1.reversed,scale:u1.scale,tickCount:u1.tickCount,type:u1.type,width:u1.width,yAxisId:0},ve=Q.memo(e=>{var t,r,i,n,s,a=n2(e,y9);return Q.createElement(Q.Fragment,null,Q.createElement(y8,{interval:null!=(t=a.interval)?t:"preserveEnd",id:a.yAxisId,scale:a.scale,type:a.type,domain:a.domain,allowDataOverflow:a.allowDataOverflow,dataKey:a.dataKey,allowDuplicatedCategory:a.allowDuplicatedCategory,allowDecimals:a.allowDecimals,tickCount:a.tickCount,padding:a.padding,includeHidden:null!=(r=a.includeHidden)&&r,reversed:a.reversed,ticks:a.ticks,width:a.width,orientation:a.orientation,mirror:a.mirror,hide:a.hide,unit:a.unit,name:a.name,angle:null!=(i=a.angle)?i:0,minTickGap:null!=(n=a.minTickGap)?n:5,tick:null==(s=a.tick)||s,tickFormatter:a.tickFormatter}),Q.createElement(y7,a))},(e,t)=>{var{domain:r}=e,i=y5(e,y3),{domain:n}=t;return!!g5(i,y5(t,y4))&&(Array.isArray(r)&&2===r.length&&Array.isArray(n)&&2===n.length?r[0]===n[0]&&r[1]===n[1]:g5({domain:r},{domain:n}))});ve.displayName="YAxis";let vt=1,vr=1;class vi{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:r=1/0,rate:i=1,repeat:n=1}=e,s=vt++,a={time:0,delay:t,duration:r,rate:i,repeat:n};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(e){for(let[t,r]of(this.channels.delete(e),this.animations))r.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;let t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){for(let t of(this.time=Math.max(0,e),this.channels.values()))this._setChannelTime(t,this.time);for(let e of this.animations.values()){let{animation:t,channel:r}=e;t.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let r=vr++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function vn(e,t){if(!e)throw Error(t||"shadertools: assertion failed.")}let vs={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function va(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}let vo={vertex:`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`\
#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},vl=/void\s+main\s*\([^)]*\)\s*\{\n?/,vu=/}\n?[^{}]*$/,vc=[],vh="__LUMA_INJECT_DECLARATIONS__";function vf(e,t,r,i=!1){let n="vertex"===t;for(let t in r){let i=r[t];i.sort((e,t)=>e.order-t.order),vc.length=i.length;for(let e=0,t=i.length;e<t;++e)vc[e]=i[e].injection;let s=`${vc.join("\n")}
`;switch(t){case"vs:#decl":n&&(e=e.replace(vh,s));break;case"vs:#main-start":n&&(e=e.replace(vl,e=>e+s));break;case"vs:#main-end":n&&(e=e.replace(vu,e=>s+e));break;case"fs:#decl":n||(e=e.replace(vh,s));break;case"fs:#main-start":n||(e=e.replace(vl,e=>e+s));break;case"fs:#main-end":n||(e=e.replace(vu,e=>s+e));break;default:e=e.replace(t,e=>e+s)}}return e=e.replace(vh,""),i&&(e=e.replace(/\}\s*$/,e=>e+vo[t])),e}function vd(e){e.map(e=>(function(e){var t;if(e.instance)return;vd(e.dependencies||[]);let{propTypes:r={},deprecations:i=[],inject:n={}}=e,s={normalizedInjections:function(e){let t={vertex:{},fragment:{}};for(let r in e){let i=e[r];"string"==typeof i&&(i={order:0,injection:i}),t[function(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw Error(t)}}(r)][r]=i}return t}(n),parsedDeprecations:((t=i).forEach(e=>{"function"===e.type?e.regex=RegExp(`\\b${e.old}\\(`):e.regex=RegExp(`${e.type} ${e.old};`)}),t)};r&&(s.propValidators=function(e){let t={};for(let[r,i]of Object.entries(e))t[r]=function(e){let t=va(e);if("object"!==t)return{value:e,...vs[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...vs[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=va(e.value),{...e,...vs[t],type:t}):{type:"object",value:null};throw Error("props")}(i);return t}(r)),e.instance=s;let a={};r&&(a=Object.entries(r).reduce((e,[t,r])=>{let i=r?.value;return i&&(e[t]=i),e},{})),e.defaultUniforms={...e.defaultUniforms,...a}})(e))}function vp(e,t,r){e.deprecations?.forEach(e=>{e.regex?.test(t)&&(e.deprecated?r.deprecated(e.old,e.new)():r.removed(e.old,e.new)())})}function vg(e){vd(e);let t={},r={};!function e(t){let{modules:r,level:i,moduleMap:n,moduleDepth:s}=t;if(i>=5)throw Error("Possible loop in shader dependency graph");for(let e of r)n[e.name]=e,(void 0===s[e.name]||s[e.name]<i)&&(s[e.name]=i);for(let t of r)t.dependencies&&e({modules:t.dependencies,level:i+1,moduleMap:n,moduleDepth:s})}({modules:e,level:0,moduleMap:t,moduleDepth:r});let i=Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e]);return vd(i),i}let vm=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],vy=[...vm,[vx("attribute"),"in $1"],[vx("varying"),"out $1"]],vv=[...vm,[vx("varying"),"in $1"]];function vb(e,t){for(let[r,i]of t)e=e.replace(r,i);return e}function vx(e){return RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function v_(e,t){let r="";for(let i in e){let n=e[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),t[i]){let e=t[i];for(let t of(e.sort((e,t)=>e.order-t.order),e))r+=`  ${t.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+="}\n"}return r}function vw(e){let t={vertex:{},fragment:{}};for(let r of e){let e,i;"string"!=typeof r?i=(e=r).hook:(e={},i=r);let[n,s]=(i=i.trim()).split(":"),a=i.replace(/\(.+/,""),o=Object.assign(e,{signature:s});switch(n){case"vs":t.vertex[a]=o;break;case"fs":t.fragment[a]=o;break;default:throw Error(n)}}return t}let vk=`

${vh}
`,vP=`\
precision highp float;
`;function vS(e,t){let{source:r,stage:i,language:n="glsl",modules:s,defines:a={},hookFunctions:o=[],inject:l={},prologue:u=!0,log:c}=t;vn("string"==typeof r,"shader source must be a string");let h="glsl"===n?({name:function(e,t="unnamed"){let r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return r?r[1]:t}(r,void 0),language:"glsl",version:function(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&"#version"===r[0]){let e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw Error(`Invalid GLSL version ${t}`);return t}(r)}).version:-1,f=e.shaderLanguageVersion,d=100===h?"#version 100":"#version 300 es",p=r.split("\n").slice(1).join("\n"),g={};s.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,a);let m="";switch(n){case"wgsl":break;case"glsl":m=u?`\
${d}

// ----- PROLOGUE -------------------------
#define SHADER_TYPE_${i.toUpperCase()}

${function(e){switch(e?.gpu.toLowerCase()){case"apple":return`\
#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`\
#define AMD_GPU
`;default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}(e)}
${"fragment"===i?vP:""}

// ----- APPLICATION DEFINES -------------------------

${function(e={}){let t="";for(let r in e){let i=e[r];(i||Number.isFinite(i))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}(g)}

`:`${d}
`}let y=vw(o),v={},b={},x={};for(let e in l){let t="string"==typeof l[e]?{injection:l[e],order:0}:l[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],n=r[3];i?"decl"===n?b[e]=[t]:x[e]=[t]:v[e]=[t]}else x[e]=[t]}for(let e of s){c&&vp(e,p,c),m+=vA(e,i);let t=e.instance?.normalizedInjections[i]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?b:x;i[e]=i[e]||[],i[e].push(t[e])}else v[e]=v[e]||[],v[e].push(t[e])}}return m+="// ----- MAIN SHADER SOURCE -------------------------",m+=vk,m=vf(m,i,b)+v_(y[i],v)+p,m=vf(m,i,x),"glsl"===n&&h!==f&&(m=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return vb(e,vy);case"fragment":return vb(e,vv);default:throw Error(t)}}(m,i)),m.trim()}function vE(e){return function(t){let r={};for(let i of e){let e=i.getUniforms?.(t,r);Object.assign(r,e)}return r}}function vA(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:vn(!1)}if(!e.name)throw Error("Shader module must have a name");let i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`\
// ----- MODULE ${e.name} ---------------

`;return"wgsl"!==t&&(n+=`#define MODULE_${i}
`),n+=`${r}
`}let vM=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,vT=/^\s*\#\s*endif\s*$/;class vC{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return vC.defaultShaderAssembler=vC.defaultShaderAssembler||new vC,vC.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){var t;let r,i=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:a}=(r=vg((t={...e,source:e.source,modules:i,hookFunctions:n}).modules||[]),{source:function(e,t){let{source:r,stage:i,modules:n,hookFunctions:s=[],inject:a={},log:o}=t;vn("string"==typeof r,"shader source must be a string");let l="",u=vw(s),c={},h={},f={};for(let e in a){let t="string"==typeof a[e]?{injection:a[e],order:0}:a[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],n=r[3];i?"decl"===n?h[e]=[t]:f[e]=[t]:c[e]=[t]}else f[e]=[t]}for(let e of n){o&&vp(e,r,o),l+=vA(e,"wgsl");let t=e.injections?.[i]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?h:f;i[e]=i[e]||[],i[e].push(t[e])}else c[e]=c[e]||[],c[e].push(t[e])}}return l+=vk,l=vf(l,i,h)+v_(u[i],c)+r,l=vf(l,i,f)}(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:r}),getUniforms:vE(r)});return{source:"wgsl"===e.platformInfo.shaderLanguage?function(e,t){let r=e.split("\n"),i=[],n=!0;for(let e of r){let t=e.match(vM),r=e.match(vT);t?(t[1],n=!1):r?n=!0:n&&i.push(e)}return i.join("\n")}(s):s,getUniforms:a,modules:i}}assembleGLSLShaderPair(e){let t=this._getModuleList(e.modules),r=this._hookFunctions;return{...function(e){let{vs:t,fs:r}=e,i=vg(e.modules||[]);return{vs:vS(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:vS(e.platformInfo,{...e,source:r,stage:"fragment",modules:i}),getUniforms:vE(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){let t=Array(this._defaultModules.length+e.length),r={},i=0;for(let e=0,n=this._defaultModules.length;e<n;++e){let n=this._defaultModules[e],s=n.name;t[i++]=n,r[s]=!0}for(let n=0,s=e.length;n<s;++n){let s=e[n],a=s.name;r[a]||(t[i++]=s,r[a]=!0)}return t.length=i,vd(t),t}}var vO=e.i(12828);let vI=`\
precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,vL=`\
// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;(w=$||($={}))[w.POINT=0]="POINT",w[w.DIRECTIONAL=1]="DIRECTIONAL";let vj={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:$.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:vL,vs:vI,fs:vI,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...vj.defaultUniforms};e.lights&&(e={...e,...function(e){let t={pointLights:[],directionalLights:[]};for(let r of e||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r)}return t}(e.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:n}=e||{};if(!(r||i&&i.length>0||n&&n.length>0))return{...vj.defaultUniforms,enabled:0};let s={...vj.defaultUniforms,...t,...function({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let i={};i.ambientColor=vN(e);let n=0;for(let e of t){i.lightType=$.POINT;let t=n;i[`lightColor${t}`]=vN(e),i[`lightPosition${t}`]=e.position,i[`lightAttenuation${t}`]=e.attenuation||[1,0,0],n++}for(let e of r){i.lightType=$.DIRECTIONAL;let t=n;i[`lightColor${t}`]=vN(e),i[`lightDirection${t}`]=e.direction,n++}return n>5&&vO.log.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=t.length,i}({ambientLight:r,pointLights:i,directionalLights:n})};return void 0!==e.enabled&&(s.enabled=+!!e.enabled),s}};function vN(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(e=>e*r/255)}let vD=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,vR=`\
#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,vz=`\
struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,vF={props:{},name:"gouraudMaterial",vs:vR.replace("phongMaterial","gouraudMaterial"),fs:vD.replace("phongMaterial","gouraudMaterial"),source:vz.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[vj],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...vF.defaultUniforms,...t}}},vB={name:"phongMaterial",dependencies:[vj],source:vz,vs:vD,fs:vR,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...vB.defaultUniforms,...t}}},vU=`\
uniform layerUniforms {
  uniform float opacity;
} layer;
`,v$={name:"layer",vs:vU,fs:vU,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},vV={name:"color",dependencies:[],source:`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},vW="#define SMOOTH_EDGE_RADIUS 0.5",vG={name:"geometry",source:`\
const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,vs:`\
${vW}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs:`\
${vW}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`},vq=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,vH="undefined"!=typeof Float32Array?Float32Array:Array,vK=Math.random;function vY(e){return e>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e)}function vZ(){let e=new vH(16);return vH!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function vX(e){let t=new vH(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function vJ(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vQ(e,t,r,i,n,s,a,o,l,u,c,h,f,d,p,g){let m=new vH(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=l,m[9]=u,m[10]=c,m[11]=h,m[12]=f,m[13]=d,m[14]=p,m[15]=g,m}function v0(e,t,r,i,n,s,a,o,l,u,c,h,f,d,p,g,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=f,e[12]=d,e[13]=p,e[14]=g,e[15]=m,e}function v1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v2(e,t){if(e===t){let r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function v3(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=r*o-i*a,b=r*l-n*a,x=r*u-s*a,_=i*l-n*o,w=i*u-s*o,k=n*u-s*l,P=c*g-h*p,S=c*m-f*p,E=c*y-d*p,A=h*m-f*g,M=h*y-d*g,T=f*y-d*m,C=v*T-b*M+x*A+_*E-w*S+k*P;return C?(C=1/C,e[0]=(o*T-l*M+u*A)*C,e[1]=(n*M-i*T-s*A)*C,e[2]=(g*k-m*w+y*_)*C,e[3]=(f*w-h*k-d*_)*C,e[4]=(l*E-a*T-u*S)*C,e[5]=(r*T-n*E+s*S)*C,e[6]=(m*x-p*k-y*b)*C,e[7]=(c*k-f*x+d*b)*C,e[8]=(a*M-o*E+u*P)*C,e[9]=(i*E-r*M-s*P)*C,e[10]=(p*w-g*x+y*v)*C,e[11]=(h*x-c*w-d*v)*C,e[12]=(o*S-a*A-l*P)*C,e[13]=(r*A-i*S+n*P)*C,e[14]=(g*b-p*_-m*v)*C,e[15]=(c*_-h*b+f*v)*C,e):null}function v4(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=r*o-i*a,b=r*l-n*a,x=r*u-s*a,_=i*l-n*o,w=i*u-s*o,k=n*u-s*l,P=c*g-h*p,S=c*m-f*p,E=c*y-d*p,A=h*m-f*g,M=h*y-d*g,T=f*y-d*m;return e[0]=o*T-l*M+u*A,e[1]=n*M-i*T-s*A,e[2]=g*k-m*w+y*_,e[3]=f*w-h*k-d*_,e[4]=l*E-a*T-u*S,e[5]=r*T-n*E+s*S,e[6]=m*x-p*k-y*b,e[7]=c*k-f*x+d*b,e[8]=a*M-o*E+u*P,e[9]=i*E-r*M-s*P,e[10]=p*w-g*x+y*v,e[11]=h*x-c*w-d*v,e[12]=o*S-a*A-l*P,e[13]=r*A-i*S+n*P,e[14]=g*b-p*_-m*v,e[15]=c*_-h*b+f*v,e}function v6(e){let t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15],y=t*a-r*s,v=t*o-i*s,b=r*o-i*a,x=u*p-c*d,_=u*g-h*d,w=c*g-h*p;return l*(t*w-r*_+i*x)-n*(s*w-a*_+o*x)+m*(u*b-c*v+h*y)-f*(d*b-p*v+g*y)}function v5(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],g=t[12],m=t[13],y=t[14],v=t[15],b=r[0],x=r[1],_=r[2],w=r[3];return e[0]=b*i+x*o+_*h+w*g,e[1]=b*n+x*l+_*f+w*m,e[2]=b*s+x*u+_*d+w*y,e[3]=b*a+x*c+_*p+w*v,b=r[4],x=r[5],_=r[6],w=r[7],e[4]=b*i+x*o+_*h+w*g,e[5]=b*n+x*l+_*f+w*m,e[6]=b*s+x*u+_*d+w*y,e[7]=b*a+x*c+_*p+w*v,b=r[8],x=r[9],_=r[10],w=r[11],e[8]=b*i+x*o+_*h+w*g,e[9]=b*n+x*l+_*f+w*m,e[10]=b*s+x*u+_*d+w*y,e[11]=b*a+x*c+_*p+w*v,b=r[12],x=r[13],_=r[14],w=r[15],e[12]=b*i+x*o+_*h+w*g,e[13]=b*n+x*l+_*f+w*m,e[14]=b*s+x*u+_*d+w*y,e[15]=b*a+x*c+_*p+w*v,e}function v8(e,t,r){let i,n,s,a,o,l,u,c,h,f,d,p,g=r[0],m=r[1],y=r[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*y+t[12],e[13]=t[1]*g+t[5]*m+t[9]*y+t[13],e[14]=t[2]*g+t[6]*m+t[10]*y+t[14],e[15]=t[3]*g+t[7]*m+t[11]*y+t[15]):(i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=i*g+o*m+h*y+t[12],e[13]=n*g+l*m+f*y+t[13],e[14]=s*g+u*m+d*y+t[14],e[15]=a*g+c*m+p*y+t[15]),e}function v7(e,t,r){let i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function v9(e,t,r,i){let n,s,a,o,l,u,c,h,f,d,p,g,m,y,v,b,x,_,w,k,P,S,E,A,M=i[0],T=i[1],C=i[2],O=Math.sqrt(M*M+T*T+C*C);return O<1e-6?null:(M*=O=1/O,T*=O,C*=O,s=Math.sin(r),a=1-(n=Math.cos(r)),o=t[0],l=t[1],u=t[2],c=t[3],h=t[4],f=t[5],d=t[6],p=t[7],g=t[8],m=t[9],y=t[10],v=t[11],b=M*M*a+n,x=T*M*a+C*s,_=C*M*a-T*s,w=M*T*a-C*s,k=T*T*a+n,P=C*T*a+M*s,S=M*C*a+T*s,E=T*C*a-M*s,A=C*C*a+n,e[0]=o*b+h*x+g*_,e[1]=l*b+f*x+m*_,e[2]=u*b+d*x+y*_,e[3]=c*b+p*x+v*_,e[4]=o*w+h*k+g*P,e[5]=l*w+f*k+m*P,e[6]=u*w+d*k+y*P,e[7]=c*w+p*k+v*P,e[8]=o*S+h*E+g*A,e[9]=l*S+f*E+m*A,e[10]=u*S+d*E+y*A,e[11]=c*S+p*E+v*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function be(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],u=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+u*i,e[5]=a*n+c*i,e[6]=o*n+h*i,e[7]=l*n+f*i,e[8]=u*n-s*i,e[9]=c*n-a*i,e[10]=h*n-o*i,e[11]=f*n-l*i,e}function bt(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],u=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-u*i,e[1]=a*n-c*i,e[2]=o*n-h*i,e[3]=l*n-f*i,e[8]=s*i+u*n,e[9]=a*i+c*n,e[10]=o*i+h*n,e[11]=l*i+f*n,e}function br(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],u=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+u*i,e[1]=a*n+c*i,e[2]=o*n+h*i,e[3]=l*n+f*i,e[4]=u*n-s*i,e[5]=c*n-a*i,e[6]=h*n-o*i,e[7]=f*n-l*i,e}function bi(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function bn(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bs(e,t,r){let i,n,s,a=r[0],o=r[1],l=r[2],u=Math.sqrt(a*a+o*o+l*l);return u<1e-6?null:(a*=u=1/u,o*=u,l*=u,n=Math.sin(t),s=1-(i=Math.cos(t)),e[0]=a*a*s+i,e[1]=o*a*s+l*n,e[2]=l*a*s-o*n,e[3]=0,e[4]=a*o*s-l*n,e[5]=o*o*s+i,e[6]=l*o*s+a*n,e[7]=0,e[8]=a*l*s+o*n,e[9]=o*l*s-a*n,e[10]=l*l*s+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ba(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bo(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bl(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bu(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,l=n+n,u=s+s,c=i*o,h=i*l,f=i*u,d=n*l,p=n*u,g=s*u,m=a*o,y=a*l,v=a*u;return e[0]=1-(d+g),e[1]=h+v,e[2]=f-y,e[3]=0,e[4]=h-v,e[5]=1-(c+g),e[6]=p+m,e[7]=0,e[8]=f+y,e[9]=p-m,e[10]=1-(c+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bc(e,t){let r=new vH(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=i*i+n*n+s*s+a*a;return h>0?(r[0]=(o*a+c*i+l*s-u*n)*2/h,r[1]=(l*a+c*n+u*i-o*s)*2/h,r[2]=(u*a+c*s+o*n-l*i)*2/h):(r[0]=(o*a+c*i+l*s-u*n)*2,r[1]=(l*a+c*n+u*i-o*s)*2,r[2]=(u*a+c*s+o*n-l*i)*2),bu(e,t,r),e}function bh(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function bf(e,t){let r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(s*s+a*a+o*o),e[2]=Math.sqrt(l*l+u*u+c*c),e}function bd(e,t){let r=new vH(3);bf(r,t);let i=1/r[0],n=1/r[1],s=1/r[2],a=t[0]*i,o=t[1]*n,l=t[2]*s,u=t[4]*i,c=t[5]*n,h=t[6]*s,f=t[8]*i,d=t[9]*n,p=t[10]*s,g=a+c+p,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(h-d)/m,e[1]=(f-l)/m,e[2]=(o-u)/m):a>c&&a>p?(m=2*Math.sqrt(1+a-c-p),e[3]=(h-d)/m,e[0]=.25*m,e[1]=(o+u)/m,e[2]=(f+l)/m):c>p?(m=2*Math.sqrt(1+c-a-p),e[3]=(f-l)/m,e[0]=(o+u)/m,e[1]=.25*m,e[2]=(h+d)/m):(m=2*Math.sqrt(1+p-a-c),e[3]=(o-u)/m,e[0]=(f+l)/m,e[1]=(h+d)/m,e[2]=.25*m),e}function bp(e,t,r,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];let n=i[0],s=i[1],a=i[2],o=i[4],l=i[5],u=i[6],c=i[8],h=i[9],f=i[10];r[0]=Math.sqrt(n*n+s*s+a*a),r[1]=Math.sqrt(o*o+l*l+u*u),r[2]=Math.sqrt(c*c+h*h+f*f);let d=1/r[0],p=1/r[1],g=1/r[2],m=n*d,y=s*p,v=a*g,b=o*d,x=l*p,_=u*g,w=c*d,k=h*p,P=f*g,S=m+x+P,E=0;return S>0?(E=2*Math.sqrt(S+1),e[3]=.25*E,e[0]=(_-k)/E,e[1]=(w-v)/E,e[2]=(y-b)/E):m>x&&m>P?(E=2*Math.sqrt(1+m-x-P),e[3]=(_-k)/E,e[0]=.25*E,e[1]=(y+b)/E,e[2]=(w+v)/E):x>P?(E=2*Math.sqrt(1+x-m-P),e[3]=(w-v)/E,e[0]=(y+b)/E,e[1]=.25*E,e[2]=(_+k)/E):(E=2*Math.sqrt(1+P-m-x),e[3]=(y-b)/E,e[0]=(w+v)/E,e[1]=(_+k)/E,e[2]=.25*E),e}function bg(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=t[3],l=n+n,u=s+s,c=a+a,h=n*l,f=n*u,d=n*c,p=s*u,g=s*c,m=a*c,y=o*l,v=o*u,b=o*c,x=i[0],_=i[1],w=i[2];return e[0]=(1-(p+m))*x,e[1]=(f+b)*x,e[2]=(d-v)*x,e[3]=0,e[4]=(f-b)*_,e[5]=(1-(h+m))*_,e[6]=(g+y)*_,e[7]=0,e[8]=(d+v)*w,e[9]=(g-y)*w,e[10]=(1-(h+p))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bm(e,t,r,i,n){let s=t[0],a=t[1],o=t[2],l=t[3],u=s+s,c=a+a,h=o+o,f=s*u,d=s*c,p=s*h,g=a*c,m=a*h,y=o*h,v=l*u,b=l*c,x=l*h,_=i[0],w=i[1],k=i[2],P=n[0],S=n[1],E=n[2],A=(1-(g+y))*_,M=(d+x)*_,T=(p-b)*_,C=(d-x)*w,O=(1-(f+y))*w,I=(m+v)*w,L=(p+b)*k,j=(m-v)*k,N=(1-(f+g))*k;return e[0]=A,e[1]=M,e[2]=T,e[3]=0,e[4]=C,e[5]=O,e[6]=I,e[7]=0,e[8]=L,e[9]=j,e[10]=N,e[11]=0,e[12]=r[0]+P-(A*P+C*S+L*E),e[13]=r[1]+S-(M*P+O*S+j*E),e[14]=r[2]+E-(T*P+I*S+N*E),e[15]=1,e}function by(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,u=r*a,c=i*a,h=i*o,f=n*a,d=n*o,p=n*l,g=s*a,m=s*o,y=s*l;return e[0]=1-h-p,e[1]=c+y,e[2]=f-m,e[3]=0,e[4]=c-y,e[5]=1-u-p,e[6]=d+g,e[7]=0,e[8]=f+m,e[9]=d-g,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bv(e,t,r,i,n,s,a){let o=1/(r-t),l=1/(n-i),u=1/(s-a);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(a+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*u,e[15]=0,e}function bb(e,t,r,i,n){let s=1/Math.tan(t/2);if(e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(i-n);e[10]=(n+i)*t,e[14]=2*n*i*t}else e[10]=-1,e[14]=-2*i;return e}function bx(e,t,r,i,n){let s=1/Math.tan(t/2);if(e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(i-n);e[10]=n*t,e[14]=n*i*t}else e[10]=-1,e[14]=-i;return e}function b_(e,t,r,i){let n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),u=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-((a-o)*l*.5),e[9]=(n-s)*u*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function bw(e,t,r,i,n,s,a){let o=1/(t-r),l=1/(i-n),u=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(a+s)*u,e[15]=1,e}function bk(e,t,r,i,n,s,a){let o=1/(t-r),l=1/(i-n),u=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=s*u,e[15]=1,e}function bP(e,t,r,i){let n,s,a,o,l,u,c,h,f,d,p=t[0],g=t[1],m=t[2],y=i[0],v=i[1],b=i[2],x=r[0],_=r[1],w=r[2];return 1e-6>Math.abs(p-x)&&1e-6>Math.abs(g-_)&&1e-6>Math.abs(m-w)?v1(e):(n=1/Math.sqrt((h=p-x)*h+(f=g-_)*f+(d=m-w)*d),h*=n,f*=n,d*=n,(n=Math.sqrt((s=v*d-b*f)*s+(a=b*h-y*d)*a+(o=y*f-v*h)*o))?(s*=n=1/n,a*=n,o*=n):(s=0,a=0,o=0),(n=Math.sqrt((l=f*o-d*a)*l+(u=d*s-h*o)*u+(c=h*a-f*s)*c))?(l*=n=1/n,u*=n,c*=n):(l=0,u=0,c=0),e[0]=s,e[1]=l,e[2]=h,e[3]=0,e[4]=a,e[5]=u,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(s*p+a*g+o*m),e[13]=-(l*p+u*g+c*m),e[14]=-(h*p+f*g+d*m),e[15]=1,e)}function bS(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=i[0],l=i[1],u=i[2],c=n-r[0],h=s-r[1],f=a-r[2],d=c*c+h*h+f*f;d>0&&(c*=d=1/Math.sqrt(d),h*=d,f*=d);let p=l*f-u*h,g=u*c-o*f,m=o*h-l*c;return(d=p*p+g*g+m*m)>0&&(p*=d=1/Math.sqrt(d),g*=d,m*=d),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=h*m-f*g,e[5]=f*p-c*m,e[6]=c*g-h*p,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e}function bE(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function bA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function bM(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function bT(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function bC(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function bO(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function bI(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function bL(e,t){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=t[0],b=t[1],x=t[2],_=t[3],w=t[4],k=t[5],P=t[6],S=t[7],E=t[8],A=t[9],M=t[10],T=t[11],C=t[12],O=t[13],I=t[14],L=t[15];return Math.abs(r-v)<=1e-6*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-x)<=1e-6*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-_)<=1e-6*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-w)<=1e-6*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-k)<=1e-6*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(l-P)<=1e-6*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(u-S)<=1e-6*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-E)<=1e-6*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-A)<=1e-6*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-M)<=1e-6*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(d-T)<=1e-6*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(p-C)<=1e-6*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-O)<=1e-6*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(m-I)<=1e-6*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(y-L)<=1e-6*Math.max(1,Math.abs(y),Math.abs(L))}e.s(["add",()=>bM,"adjoint",()=>v4,"clone",()=>vX,"copy",()=>vJ,"create",()=>vZ,"decompose",()=>bp,"determinant",()=>v6,"equals",()=>bL,"exactEquals",()=>bI,"frob",()=>bA,"fromQuat",()=>by,"fromQuat2",()=>bc,"fromRotation",()=>bs,"fromRotationTranslation",()=>bu,"fromRotationTranslationScale",()=>bg,"fromRotationTranslationScaleOrigin",()=>bm,"fromScaling",()=>bn,"fromTranslation",()=>bi,"fromValues",()=>vQ,"fromXRotation",()=>ba,"fromYRotation",()=>bo,"fromZRotation",()=>bl,"frustum",()=>bv,"getRotation",()=>bd,"getScaling",()=>bf,"getTranslation",()=>bh,"identity",()=>v1,"invert",()=>v3,"lookAt",()=>bP,"mul",0,v5,"multiply",()=>v5,"multiplyScalar",()=>bC,"multiplyScalarAndAdd",()=>bO,"ortho",0,bw,"orthoNO",()=>bw,"orthoZO",()=>bk,"perspective",0,bb,"perspectiveFromFieldOfView",()=>b_,"perspectiveNO",()=>bb,"perspectiveZO",()=>bx,"rotate",()=>v9,"rotateX",()=>be,"rotateY",()=>bt,"rotateZ",()=>br,"scale",()=>v7,"set",()=>v0,"str",()=>bE,"sub",0,bT,"subtract",()=>bT,"targetTo",()=>bS,"translate",()=>v8,"transpose",()=>v2],32664);var bj=e.i(32664),bj=bj;function bN(){let e=new vH(4);return vH!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function bD(e){let t=new vH(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bR(e,t,r,i){let n=new vH(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function bz(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function bF(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function bB(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function bU(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function b$(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function bV(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function bW(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function bG(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function bq(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function bH(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function bK(e,t){return e[0]=vY(t[0]),e[1]=vY(t[1]),e[2]=vY(t[2]),e[3]=vY(t[3]),e}function bY(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function bZ(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function bX(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function bJ(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function bQ(e){let t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function b0(e){let t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function b1(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function b2(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function b3(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a,e}function b4(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function b6(e,t,r,i){let n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],c=t[0],h=t[1],f=t[2],d=t[3];return e[0]=h*u-f*l+d*o,e[1]=-(c*u)+f*a-d*s,e[2]=c*l-h*a+d*n,e[3]=-(c*o)+h*s-f*n,e}function b5(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function b8(e,t){let r,i,n,s,a,o;t=void 0===t?1:t;do a=(r=2*vK()-1)*r+(i=2*vK()-1)*i;while(a>=1)do o=(n=2*vK()-1)*n+(s=2*vK()-1)*s;while(o>=1)let l=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*s*l,e}function b7(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function b9(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],u=r[3],c=u*i+o*s-l*n,h=u*n+l*i-a*s,f=u*s+a*n-o*i,d=-a*i-o*n-l*s;return e[0]=c*u+-(d*a)+-(h*l)- -(f*o),e[1]=h*u+-(d*o)+-(f*a)- -(c*l),e[2]=f*u+-(d*l)+-(c*o)- -(h*a),e[3]=t[3],e}function xe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function xt(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function xr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function xi(e,t){let r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=1e-6*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=1e-6*Math.max(1,Math.abs(s),Math.abs(u))}let xn=(h=bN(),function(e,t,r,i,n,s){let a,o;for(t||(t=4),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)h[0]=e[a],h[1]=e[a+1],h[2]=e[a+2],h[3]=e[a+3],n(h,h,s),e[a]=h[0],e[a+1]=h[1],e[a+2]=h[2],e[a+3]=h[3];return e});e.s(["add",()=>bB,"ceil",()=>bW,"clone",()=>bD,"copy",()=>bz,"create",()=>bN,"cross",()=>b6,"dist",0,bX,"distance",()=>bX,"div",0,bV,"divide",()=>bV,"dot",()=>b4,"equals",()=>xi,"exactEquals",()=>xr,"floor",()=>bG,"forEach",0,xn,"fromValues",()=>bR,"inverse",()=>b2,"len",0,bQ,"length",()=>bQ,"lerp",()=>b5,"max",()=>bH,"min",()=>bq,"mul",0,b$,"multiply",()=>b$,"negate",()=>b1,"normalize",()=>b3,"random",()=>b8,"round",()=>bK,"scale",()=>bY,"scaleAndAdd",()=>bZ,"set",()=>bF,"sqrDist",0,bJ,"sqrLen",0,b0,"squaredDistance",()=>bJ,"squaredLength",()=>b0,"str",()=>xt,"sub",0,bU,"subtract",()=>bU,"transformMat4",()=>b7,"transformQuat",()=>b9,"zero",()=>xe],22642);var xs=e.i(22642),xs=xs,xa=e.i(85612);let xo=new xa.Log({id:"deck"});(k=V||(V={}))[k.Start=1]="Start",k[k.Move=2]="Move",k[k.End=4]="End",k[k.Cancel=8]="Cancel",(P=W||(W={}))[P.None=0]="None",P[P.Left=1]="Left",P[P.Right=2]="Right",P[P.Up=4]="Up",P[P.Down=8]="Down",P[P.Horizontal=3]="Horizontal",P[P.Vertical=12]="Vertical",P[P.All=15]="All",(S=G||(G={}))[S.Possible=1]="Possible",S[S.Began=2]="Began",S[S.Changed=4]="Changed",S[S.Ended=8]="Ended",S[S.Recognized=8]="Recognized",S[S.Cancelled=16]="Cancelled",S[S.Failed=32]="Failed";let xl="manipulation",xu="none",xc="pan-x",xh="pan-y";class xf{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));var t=e.join(" ");if(t.includes(xu))return xu;let r=t.includes(xc),i=t.includes(xh);return r&&i?xu:r||i?r?xc:xh:t.includes(xl)?xl:"auto"}}function xd(e){return e.trim().split(/\s+/g)}function xp(e,t,r){if(e)for(let i of xd(t))e.addEventListener(i,r,!1)}function xg(e,t,r){if(e)for(let i of xd(t))e.removeEventListener(i,r,!1)}function xm(e){return(e.ownerDocument||e).defaultView}function xy(e){let t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,i=0,n=0;for(;n<t;)r+=e[n].clientX,i+=e[n].clientY,n++;return{x:Math.round(r/t),y:Math.round(i/t)}}function xv(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:xy(t),deltaX:e.deltaX,deltaY:e.deltaY}}function xb(e,t){let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function xx(e,t){let r=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(r*r+i*i)}function x_(e,t){let r=t.clientX-e.clientX;return 180*Math.atan2(t.clientY-e.clientY,r)/Math.PI}function xw(e,t){return e===t?W.None:Math.abs(e)>=Math.abs(t)?e<0?W.Left:W.Right:t<0?W.Up:W.Down}function xk(e,t,r){return{x:t/e||0,y:r/e||0}}class xP{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){var r;let i,n,s,a,o;r=this.manager,i=t.pointers.length,n=t.changedPointers.length,s=e&V.Start&&i-n==0,a=e&(V.End|V.Cancel)&&i-n==0,t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e,o=function(e,t){var r,i;let n,s,a,o,l,{session:u}=e,{pointers:c}=t,{length:h}=c;u.firstInput||(u.firstInput=xv(t)),h>1&&!u.firstMultiple?u.firstMultiple=xv(t):1===h&&(u.firstMultiple=!1);let{firstInput:f,firstMultiple:d}=u,p=d?d.center:f.center,g=t.center=xy(c);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-f.timeStamp,n=g.x-p.x,t.angle=180*Math.atan2(g.y-p.y,n)/Math.PI,t.distance=xb(p,g);let{deltaX:m,deltaY:y}=(s=t.center,a=u.offsetDelta,o=u.prevDelta,l=u.prevInput,(t.eventType===V.Start||l?.eventType===V.End)&&(o=u.prevDelta={x:l?.deltaX||0,y:l?.deltaY||0},a=u.offsetDelta={x:s.x,y:s.y}),{deltaX:o.x+(s.x-a.x),deltaY:o.y+(s.y-a.y)});t.deltaX=m,t.deltaY=y,t.offsetDirection=xw(t.deltaX,t.deltaY);let v=xk(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=v.x,t.overallVelocityY=v.y,t.overallVelocity=Math.abs(v.x)>Math.abs(v.y)?v.x:v.y,t.scale=d?(r=d.pointers,xx(c[0],c[1])/xx(r[0],r[1])):1,t.rotation=d?(i=d.pointers,x_(c[1],c[0])-x_(i[1],i[0])):0,t.maxPointers=u.prevInput?t.pointers.length>u.prevInput.maxPointers?t.pointers.length:u.prevInput.maxPointers:t.pointers.length;let b=e.element;return function(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}(t.srcEvent.target,b)&&(b=t.srcEvent.target),t.target=b,!function(e,t){let r,i,n,s,a=e.lastInterval||t,o=t.timeStamp-a.timeStamp;if(t.eventType!==V.Cancel&&(o>25||void 0===a.velocity)){let l=t.deltaX-a.deltaX,u=t.deltaY-a.deltaY,c=xk(o,l,u);i=c.x,n=c.y,r=Math.abs(c.x)>Math.abs(c.y)?c.x:c.y,s=xw(l,u),e.lastInterval=t}else r=a.velocity,i=a.velocityX,n=a.velocityY,s=a.direction;t.velocity=r,t.velocityX=i,t.velocityY=n,t.direction=s}(u,t),t}(r,t),r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}init(){xp(this.element,this.evEl,this.domHandler),xp(this.target,this.evTarget,this.domHandler),xp(xm(this.element),this.evWin,this.domHandler)}destroy(){xg(this.element,this.evEl,this.domHandler),xg(this.target,this.evTarget,this.domHandler),xg(xm(this.element),this.evWin,this.domHandler)}}let xS={pointerdown:V.Start,pointermove:V.Move,pointerup:V.End,pointercancel:V.Cancel,pointerout:V.Cancel};class xE extends xP{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:t}=this,r=!1,i=xS[e.type],n=e.pointerType,s="touch"===n,a=t.findIndex(t=>t.pointerId===e.pointerId);i&V.Start&&(e.buttons||s)?a<0&&(t.push(e),a=t.length-1):i&(V.End|V.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:n,srcEvent:e}),r&&t.splice(a,1))}}let xA=["","webkit","Moz","MS","ms","o"],xM={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class xT{constructor(e,t){this.options={...xM,...t,cssProps:{...xM.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new xE(this),this.touchAction=new xf(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){let t,{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let{recognizers:i}=this,{curRecognizer:n}=r;(!n||n&&n.state&G.Recognized)&&(n=r.curRecognizer=null);let s=0;for(;s<i.length;)t=i[s],2!==r.stopped&&(!n||t===n||t.canRecognizeWith(n))?t.recognize(e):t.reset(),!n&&t.state&(G.Began|G.Changed|G.Ended)&&(n=r.curRecognizer=t),s++}get(e){let{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(let t of e)this.add(t);return this}let t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let t of e)this.remove(t);return this}let t="string"==typeof e?this.get(e):e;if(t){let{recognizers:e}=this,r=e.indexOf(t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;let{handlers:r}=this;for(let i of xd(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;let{handlers:r}=this;for(let i of xd(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){let r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<r.length;)r[i](t),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:t}=this;if(t){for(let[r,i]of Object.entries(this.options.cssProps)){let n=function(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let i of xA){let n=i?i+r:t;if(n in e)return n}}(t.style,r);e?(this.oldCssProps[n]=t.style[n],t.style[n]=i):t.style[n]=this.oldCssProps[n]||""}e||(this.oldCssProps={})}}}let xC=1;function xO(e){return e&G.Cancelled?"cancel":e&G.Ended?"end":e&G.Changed?"move":e&G.Began?"start":""}class xI{constructor(e){this.options=e,this.id=xC++,this.state=G.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.recognizeWith(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRecognizeWith(t);return this}return(t="string"==typeof e?this.manager.get(e):e)&&delete this.simultaneous[t.id],this}requireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.requireFailure(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{requireFail:r}=this;return -1===r.indexOf(t)&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRequireFailure(t);return this}if(t="string"==typeof e?this.manager.get(e):e){let e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:t}=this;t<G.Ended&&this.manager.emit(this.options.event+xO(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=G.Ended&&this.manager.emit(this.options.event+xO(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=G.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(G.Failed|G.Possible)))return!1;e++}return!0}recognize(e){let t={...e};if(!this.options.enable){this.reset(),this.state=G.Failed;return}this.state&(G.Recognized|G.Cancelled|G.Failed)&&(this.state=G.Possible),this.state=this.process(t),this.state&(G.Began|G.Changed|G.Ended|G.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class xL extends xI{attrTest(e){let t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){let{state:t}=this,{eventType:r}=e,i=t&(G.Began|G.Changed),n=this.attrTest(e);return i&&(r&V.Cancel||!n)?t|G.Cancelled:i||n?r&V.End?t|G.Ended:t&G.Began?t|G.Changed:G.Began:G.Failed}}class xj extends xI{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[xl]}process(e){let{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&V.Start&&0===this.count)return this.failTimeout();if(i&&n&&r){if(e.eventType!==V.End)return this.failTimeout();let r=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||xb(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&r?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=G.Recognized,this.tryEmit(this._input)},t.interval),G.Began):G.Recognized}return G.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=G.Failed},this.options.interval),G.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===G.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}let xN=["","start","move","end","cancel","up","down","left","right"];class xD extends xL{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:W.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,t=[];return e&W.Horizontal&&t.push(xh),e&W.Vertical&&t.push(xc),t}getEventNames(){return xN.map(e=>this.options.event+e)}directionTest(e){let{options:t}=this,r=!0,{distance:i}=e,{direction:n}=e,s=e.deltaX,a=e.deltaY;return n&t.direction||(t.direction&W.Horizontal?(n=0===s?W.None:s<0?W.Left:W.Right,r=s!==this.pX,i=Math.abs(e.deltaX)):(n=0===a?W.None:a<0?W.Up:W.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=n,r&&i>t.threshold&&!!(n&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&G.Began)||!(this.state&G.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let t=W[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}let xR=["","start","move","end","cancel","in","out"];class xz{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}let xF="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";"undefined"!=typeof window?window:e.g,e.g;let xB=-1!==xF.indexOf("firefox");class xU extends xz{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(xB&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}let x$=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class xV extends xz{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,x$.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){x$.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}let xW=["keydown","keyup"];class xG extends xz{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=e=>{let t=e.target||e.srcElement;("INPUT"!==t.tagName||"text"!==t.type)&&"TEXTAREA"!==t.tagName&&(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",xW.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){xW.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class xq extends xz{constructor(e,t,r){super(e,t,r),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}let xH={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},xK={srcElement:"root",priority:0};class xY{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;let t=this._normalizeEvent(e),r=e.srcEvent.target;for(;r&&r!==t.rootElement;){if(this._emit(t,r),t.handled)return;r=r.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,n=!1){let{handlers:s,handlersByElement:a}=this,o={...xK,...r},l=a.get(o.srcElement);l||(l=[],a.set(o.srcElement,l));let u={type:e,handler:t,srcElement:o.srcElement,priority:o.priority};i&&(u.once=!0),n&&(u.passive=!0),s.push(u),this._active=this._active||!u.passive;let c=l.length-1;for(;c>=0&&!(l[c].priority>=u.priority);)c--;l.splice(c+1,0,u)}remove(e,t){let{handlers:r,handlersByElement:i}=this;for(let n=r.length-1;n>=0;n--){let s=r[n];if(s.type===e&&s.handler===t){r.splice(n,1);let e=i.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&i.delete(s.srcElement)}}this._active=r.some(e=>!e.passive)}_emit(e,t){let r=this.handlersByElement.get(t);if(r){let t=!1,i=()=>{e.handled=!0},n=()=>{e.handled=!0,t=!0},s=[];for(let a=0;a<r.length;a++){let{type:o,handler:l,once:u}=r[a];if(l({...e,type:o,stopPropagation:i,stopImmediatePropagation:n}),u&&s.push(r[a]),t)break}for(let e=0;e<s.length;e++){let{type:t,handler:r}=s[e];this.remove(t,r)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...function(e){let t=xH[e.srcEvent.type];if(!t)return null;let{buttons:r,button:i}=e.srcEvent,n=!1,s=!1,a=!1;return 2===t?(n=!!(1&r),s=!!(4&r),a=!!(2&r)):(n=0===i,s=1===i,a=2===i),{leftButton:n,middleButton:s,rightButton:a}}(e),...function(e,t){let r=e.center;if(!r)return null;let i=t.getBoundingClientRect(),n=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1,a={x:(r.x-i.left-t.clientLeft)/n,y:(r.y-i.top-t.clientTop)/s};return{center:r,offsetCenter:a}}(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}class xZ{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!e)return;for(const t of(this.manager=new xT(e,this.options),this.options.recognizers)){const{recognizer:e,recognizeWith:r,requireFailure:i}=function(e){let t;if("recognizer"in e)return e;let r=Array.isArray(e)?[...e]:[e];return{recognizer:t="function"==typeof r[0]?new(r.shift())(r.shift()||{}):r.shift(),recognizeWith:"string"==typeof r[0]?[r[0]]:r[0],requireFailure:"string"==typeof r[1]?[r[1]]:r[1]}}(t);this.manager.add(e),r&&e.recognizeWith(r),i&&e.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new xU(e,this._onOtherEvent,{enable:!1}),this.moveInput=new xV(e,this._onOtherEvent,{enable:!1}),this.keyInput=new xG(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new xq(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:r}=this;if(!r)return;let i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,n){if("string"!=typeof e){for(let[s,a]of(r=t,Object.entries(e)))this._addEventHandler(s,a,r,i,n);return}let{manager:s,events:a}=this;if(!s)return;let o=a.get(e);!o&&(o=new xY(this,this._getRecognizerName(e)||e),a.set(e,o),s&&s.on(e,o.handleEvent)),o.add(e,t,r,i,n),o.isEmpty()||this._toggleRecognizer(o.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(let[t,r]of Object.entries(e))this._removeEventHandler(t,r);return}let{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){let{recognizerName:e}=i,t=!1;for(let i of r.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}let xX={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(xX,"IDENTITY",{get:()=>(xo.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});let xJ={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},xQ={common:0,meters:1,pixels:2},x0={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},x1={multipan:[xD,{threshold:10,direction:W.Vertical,pointers:2}],pinch:[class extends xL{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[xu]}getEventNames(){return xR.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&G.Began))}emit(e){if(1!==e.scale){let t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[xD,{threshold:1},["pinch"],["multipan"]],dblclick:[xj,{event:"dblclick",taps:2}],click:[xj,{event:"click"},null,["dblclick"]]};function x2(e){let t,r={};return i=>{for(let n in i)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}(i[n],r[n])){t=e(i),r=i;break}return t}}let x3=[0,0,0,0],x4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],x6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],x5=[0,0,0],x8=[0,0,0],x7=x2(function({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:u}=function(e,t,r){let{viewMatrixUncentered:i,projectionMatrix:n}=e,{viewMatrix:s,viewProjectionMatrix:a}=e,o=x3,l=x3,u=e.cameraPosition,{geospatialOrigin:c,shaderCoordinateOrigin:h,offsetMode:f}=x9(e,t,r);return f&&(l=e.projectPosition(c||h),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,o=xs.transformMat4([],l,a),s=i||s,a=bj.multiply([],n,s),a=bj.multiply([],a,x4)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:c}}(e,r,i),c=e.getDistanceScales(),h=[e.width*t,e.height*t],f=xs.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:a.slice(0,3),center:n,pseudoMeters:!!e._pseudoMeters,viewportSize:h,devicePixelRatio:t,focalDistance:f,commonUnitsPerMeter:c.unitsPerMeter,commonUnitsPerWorldUnit:c.unitsPerMeter,commonUnitsPerWorldUnit2:x5,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:x6,cameraPosition:o};if(u){let t=e.getDistanceScales(u);switch(r){case xX.METER_OFFSETS:d.commonUnitsPerWorldUnit=t.unitsPerMeter,d.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case xX.LNGLAT:case xX.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=t.unitsPerMeter),d.commonUnitsPerWorldUnit=t.unitsPerDegree,d.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case xX.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return d});function x9(e,t,r=x8){let i;r.length<3&&(r=[r[0],r[1],0]);let n=r,s=!0;switch(i=t===xX.LNGLAT_OFFSETS||t===xX.METER_OFFSETS?r:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case xJ.WEB_MERCATOR:(t===xX.LNGLAT||t===xX.CARTESIAN)&&(i=[0,0,0],s=!1);break;case xJ.WEB_MERCATOR_AUTO_OFFSET:t===xX.LNGLAT?n=i:t===xX.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case xJ.IDENTITY:(n=e.position.map(Math.fround))[2]=n[2]||0;break;case xJ.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}let _e=Object.keys(xX).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${xX[e]};`).join(""),_t=Object.keys(xJ).map(e=>`const PROJECTION_MODE_${e}: i32 = ${xJ[e]};`).join(""),_r=Object.keys(xQ).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${xQ[e]};`).join(""),_i=`\
${_e}
${_t}
${_r}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,_n=`\
${_i}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,_s=Object.keys(xX).map(e=>`const int COORDINATE_SYSTEM_${e} = ${xX[e]};`).join(""),_a=Object.keys(xJ).map(e=>`const int PROJECTION_MODE_${e} = ${xJ[e]};`).join(""),_o=Object.keys(xQ).map(e=>`const int UNIT_${e.toUpperCase()} = ${xQ[e]};`).join(""),_l={},_u={name:"project",dependencies:[{name:"fp32",vs:vq},vG],source:_n,vs:`\
${_s}
${_a}
${_o}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,getUniforms:function(e=_l){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:i=xX.DEFAULT,coordinateOrigin:n=x8,autoWrapLongitude:s=!1}){i===xX.DEFAULT&&(i=e.isGeospatial?xX.LNGLAT:xX.CARTESIAN);let a=x7({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n});return a.wrapLongitude=s,a.modelMatrix=r||x6,a}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},_c={name:"project32",dependencies:[_u],source:`\
// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs:`\
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};let _h=globalThis.mathgl.config;function _f(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _d(e,t,r){return function(e,t,r){if(_f(e)){r=r||(e.clone?e.clone():Array(e.length));for(let i=0;i<r.length&&i<e.length;++i){let n="number"==typeof e?e:e[i];r[i]=t(n,i,r)}return r}return t(e)}(e,e=>Math.max(t,Math.min(r,e)))}function _p(e,t,r){return _f(e)?e.map((e,i)=>_p(e,t[i],r)):r*t+(1-r)*e}function _g(e,t,r){let i=_h.EPSILON;r&&(_h.EPSILON=r);try{if(e===t)return!0;if(_f(e)&&_f(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!_g(e[r],t[r]))return!1;return!0}if(e&&e.equals)return e.equals(t);if(t&&t.equals)return t.equals(e);if("number"==typeof e&&"number"==typeof t)return Math.abs(e-t)<=_h.EPSILON*Math.max(1,Math.abs(e),Math.abs(t));return!1}finally{_h.EPSILON=i}}class _m extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:_f(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_h)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+function(e,{precision:t=_h.precision}={}){return e=Math.round(e/_h.EPSILON)*_h.EPSILON,`${parseFloat(e.toPrecision(t))}`}(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!_g(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(void 0===r)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){let n=e[i],s="number"==typeof t?t:t[i];this[i]=n+r*(s-n)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(_h.debug&&!this.validate())throw Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function _y(e){if(!Number.isFinite(e))throw Error(`Invalid number ${JSON.stringify(e)}`);return e}function _v(e,t,r=""){if(_h.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function _b(e,t){if(!e)throw Error(`math.gl assertion ${t}`)}class _x extends _m{get x(){return this[0]}set x(e){this[0]=_y(e)}get y(){return this[1]}set y(e){this[1]=_y(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){let i=this[r]-e[r];t+=i*i}return _y(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return _y(t)}normalize(){let e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return _b(e>=0&&e<this.ELEMENTS,"index is out of range"),_y(this[e])}setComponent(e,t){return _b(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}function __(){let e=new vH(3);return vH!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _w(e){let t=new vH(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _k(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function _P(e,t,r){let i=new vH(3);return i[0]=e,i[1]=t,i[2]=r,i}function _S(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _E(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function _A(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function _M(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function _T(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function _C(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function _O(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _I(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function _L(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function _j(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function _N(e,t){return e[0]=vY(t[0]),e[1]=vY(t[1]),e[2]=vY(t[2]),e}function _D(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function _R(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function _z(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function _F(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function _B(e){let t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function _U(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function _$(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function _V(e,t){let r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function _W(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _G(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a,e}function _q(e,t,r,i){let n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function _H(e,t,r,i){let n=Math.acos(Math.min(Math.max(_W(t,r),-1),1)),s=Math.sin(n),a=Math.sin((1-i)*n)/s,o=Math.sin(i*n)/s;return e[0]=a*t[0]+o*r[0],e[1]=a*t[1]+o*r[1],e[2]=a*t[2]+o*r[2],e}function _K(e,t,r,i,n,s){let a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,u=a*(s-1),c=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+i[0]*u+n[0]*c,e[1]=t[1]*o+r[1]*l+i[1]*u+n[1]*c,e[2]=t[2]*o+r[2]*l+i[2]*u+n[2]*c,e}function _Y(e,t,r,i,n,s){let a=1-s,o=a*a,l=s*s,u=o*a,c=3*s*o,h=3*l*a,f=l*s;return e[0]=t[0]*u+r[0]*c+i[0]*h+n[0]*f,e[1]=t[1]*u+r[1]*c+i[1]*h+n[1]*f,e[2]=t[2]*u+r[2]*c+i[2]*h+n[2]*f,e}function _Z(e,t){t=void 0===t?1:t;let r=2*vK()*Math.PI,i=2*vK()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function _X(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,e}function _J(e,t,r){let i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function _Q(e,t,r){let i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],u=t[2],c=n*u-s*l,h=s*o-i*u,f=i*l-n*o,d=n*f-s*h,p=s*c-i*f,g=i*h-n*c,m=2*a;return c*=m,h*=m,f*=m,d*=2,p*=2,g*=2,e[0]=o+c+d,e[1]=l+h+p,e[2]=u+f+g,e}function _0(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function _1(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function _2(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function _3(e,t){let r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt((r*r+i*i+n*n)*(s*s+a*a+o*o));return Math.acos(Math.min(Math.max(l&&_W(e,t)/l,-1),1))}function _4(e){return e[0]=0,e[1]=0,e[2]=0,e}function _6(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function _5(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function _8(e,t){let r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}let _7=(f=__(),function(e,t,r,i,n,s){let a,o;for(t||(t=3),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)f[0]=e[a],f[1]=e[a+1],f[2]=e[a+2],n(f,f,s),e[a]=f[0],e[a+1]=f[1],e[a+2]=f[2];return e});function _9(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s||1;return e[0]=(r[0]*i+r[4]*n+r[8]*s)/a,e[1]=(r[1]*i+r[5]*n+r[9]*s)/a,e[2]=(r[2]*i+r[6]*n+r[10]*s)/a,e}function we(e,t,r){let i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[3]*n+r[6]*s,e[1]=r[1]*i+r[4]*n+r[7]*s,e[2]=r[2]*i+r[5]*n+r[8]*s,e[3]=t[3],e}e.s(["add",()=>_A,"angle",()=>_3,"bezier",()=>_Y,"ceil",()=>_O,"clone",()=>_w,"copy",()=>_S,"create",()=>__,"cross",()=>_G,"dist",0,_z,"distance",()=>_z,"div",0,_C,"divide",()=>_C,"dot",()=>_W,"equals",()=>_8,"exactEquals",()=>_5,"floor",()=>_I,"forEach",0,_7,"fromValues",()=>_P,"hermite",()=>_K,"inverse",()=>_$,"len",0,_k,"length",()=>_k,"lerp",()=>_q,"max",()=>_j,"min",()=>_L,"mul",0,_T,"multiply",()=>_T,"negate",()=>_U,"normalize",()=>_V,"random",()=>_Z,"rotateX",()=>_0,"rotateY",()=>_1,"rotateZ",()=>_2,"round",()=>_N,"scale",()=>_D,"scaleAndAdd",()=>_R,"set",()=>_E,"slerp",()=>_H,"sqrDist",0,_F,"sqrLen",0,_B,"squaredDistance",()=>_F,"squaredLength",()=>_B,"str",()=>_6,"sub",0,_M,"subtract",()=>_M,"transformMat3",()=>_J,"transformMat4",()=>_X,"transformQuat",()=>_Q,"zero",()=>_4],93311);let wt=[0,0,0];class wr extends _x{static get ZERO(){return t||Object.freeze(t=new wr(0,0,0)),t}constructor(e=0,t=0,r=0){super(-0,-0,-0),1==arguments.length&&_f(e)?this.copy(e):(_h.debug&&(_y(e),_y(t),_y(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return _h.debug&&(_y(e.x),_y(e.y),_y(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=_y(e)}angle(e){return _3(this,e)}cross(e){return _G(this,this,e),this.check()}rotateX({radians:e,origin:t=wt}){return _0(this,this,t,e),this.check()}rotateY({radians:e,origin:t=wt}){return _1(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=wt}){return _2(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return _X(this,this,e),this.check()}transformAsVector(e){return _9(this,this,e),this.check()}transformByMatrix3(e){return _J(this,this,e),this.check()}transformByMatrix2(e){let t,r;return t=this[0],r=this[1],this[0]=e[0]*t+e[2]*r,this[1]=e[1]*t+e[3]*r,this[2]=this[2],this.check()}transformByQuaternion(e){return _Q(this,this,e),this.check()}}class wi extends _m{toString(){let e="[";if(_h.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+"]"}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=_y(r),this}getColumn(e,t=Array(this.RANK).fill(-0)){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[r+e];return t}setColumn(e,t){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)this[r+e]=t[e];return this}}function wn(){let e=new vH(2);return vH!=Float32Array&&(e[0]=0,e[1]=0),e}function ws(e){let t=new vH(2);return t[0]=e[0],t[1]=e[1],t}function wa(e,t){let r=new vH(2);return r[0]=e,r[1]=t,r}function wo(e,t){return e[0]=t[0],e[1]=t[1],e}function wl(e,t,r){return e[0]=t,e[1]=r,e}function wu(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function wc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function wh(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function wf(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function wd(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function wp(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function wg(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function wm(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function wy(e,t){return e[0]=vY(t[0]),e[1]=vY(t[1]),e}function wv(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function wb(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function wx(e,t){let r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function w_(e,t){let r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function ww(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function wk(e){let t=e[0],r=e[1];return t*t+r*r}function wP(e,t){return e[0]=-t[0],e[1]=-t[1],e}function wS(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function wE(e,t){let r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function wA(e,t){return e[0]*t[0]+e[1]*t[1]}function wM(e,t,r){let i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function wT(e,t,r,i){let n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function wC(e,t){t=void 0===t?1:t;let r=2*vK()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function wO(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function wI(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function wL(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function wj(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function wN(e,t,r,i){let n=t[0]-r[0],s=t[1]-r[1],a=Math.sin(i),o=Math.cos(i);return e[0]=n*o-s*a+r[0],e[1]=n*a+s*o+r[1],e}function wD(e,t){let r=e[0],i=e[1],n=t[0],s=t[1],a=Math.sqrt((r*r+i*i)*(n*n+s*s));return Math.acos(Math.min(Math.max(a&&(r*n+i*s)/a,-1),1))}function wR(e){return e[0]=0,e[1]=0,e}function wz(e){return`vec2(${e[0]}, ${e[1]})`}function wF(e,t){return e[0]===t[0]&&e[1]===t[1]}function wB(e,t){let r=e[0],i=e[1],n=t[0],s=t[1];return Math.abs(r-n)<=1e-6*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}let wU=(d=wn(),function(e,t,r,i,n,s){let a,o;for(t||(t=2),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)d[0]=e[a],d[1]=e[a+1],n(d,d,s),e[a]=d[0],e[a+1]=d[1];return e});e.s(["add",()=>wu,"angle",()=>wD,"ceil",()=>wd,"clone",()=>ws,"copy",()=>wo,"create",()=>wn,"cross",()=>wM,"dist",0,wx,"distance",()=>wx,"div",0,wf,"divide",()=>wf,"dot",()=>wA,"equals",()=>wB,"exactEquals",()=>wF,"floor",()=>wp,"forEach",0,wU,"fromValues",()=>wa,"inverse",()=>wS,"len",0,ww,"length",()=>ww,"lerp",()=>wT,"max",()=>wm,"min",()=>wg,"mul",0,wh,"multiply",()=>wh,"negate",()=>wP,"normalize",()=>wE,"random",()=>wC,"rotate",()=>wN,"round",()=>wy,"scale",()=>wv,"scaleAndAdd",()=>wb,"set",()=>wl,"sqrDist",0,w_,"sqrLen",0,wk,"squaredDistance",()=>w_,"squaredLength",()=>wk,"str",()=>wz,"sub",0,wc,"subtract",()=>wc,"transformMat2",()=>wO,"transformMat2d",()=>wI,"transformMat3",()=>wL,"transformMat4",()=>wj,"zero",()=>wR],60113),(E=q||(q={}))[E.COL0ROW0=0]="COL0ROW0",E[E.COL0ROW1=1]="COL0ROW1",E[E.COL0ROW2=2]="COL0ROW2",E[E.COL0ROW3=3]="COL0ROW3",E[E.COL1ROW0=4]="COL1ROW0",E[E.COL1ROW1=5]="COL1ROW1",E[E.COL1ROW2=6]="COL1ROW2",E[E.COL1ROW3=7]="COL1ROW3",E[E.COL2ROW0=8]="COL2ROW0",E[E.COL2ROW1=9]="COL2ROW1",E[E.COL2ROW2=10]="COL2ROW2",E[E.COL2ROW3=11]="COL2ROW3",E[E.COL3ROW0=12]="COL3ROW0",E[E.COL3ROW1=13]="COL3ROW1",E[E.COL3ROW2=14]="COL3ROW2",E[E.COL3ROW3=15]="COL3ROW3";let w$=45*Math.PI/180,wV=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class wW extends wi{static get IDENTITY(){return i||Object.freeze(i=new wW),i}static get ZERO(){return r||Object.freeze(r=new wW([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),r}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return q}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,n,s,a,o,l,u,c,h,f,d,p,g){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=n,this[5]=s,this[6]=a,this[7]=o,this[8]=l,this[9]=u,this[10]=c,this[11]=h,this[12]=f,this[13]=d,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,r,i,n,s,a,o,l,u,c,h,f,d,p,g){return this[0]=e,this[1]=n,this[2]=l,this[3]=f,this[4]=t,this[5]=s,this[6]=u,this[7]=d,this[8]=r,this[9]=a,this[10]=c,this[11]=p,this[12]=i,this[13]=o,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(wV)}fromObject(e){return this.check()}fromQuaternion(e){return by(this,e),this.check()}frustum(e){var t,r,i,n,s,a;let{left:o,right:l,bottom:u,top:c,near:h=.1,far:f=500}=e;return f===1/0?(t=this,r=o,i=l,n=u,s=c,a=h,t[0]=2*a/(i-r),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a/(s-n),t[6]=0,t[7]=0,t[8]=(i+r)/(i-r),t[9]=(s+n)/(s-n),t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0):bv(this,o,l,u,c,h,f),this.check()}lookAt(e){let{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return bP(this,t,r,i),this.check()}ortho(e){let{left:t,right:r,bottom:i,top:n,near:s=.1,far:a=500}=e;return bw(this,t,r,i,n,s,a),this.check()}orthographic(e){let{fovy:t=w$,aspect:r=1,focalDistance:i=1,near:n=.1,far:s=500}=e;wG(t);let a=i*Math.tan(t/2),o=a*r;return this.ortho({left:-o,right:o,bottom:-a,top:a,near:n,far:s})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:n=500}=e;return wG(t),bb(this,t,r,i,n),this.check()}determinant(){return v6(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],n=1/r[1],s=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*n,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*n,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],n=1/r[1],s=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*n,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*n,e[8]=this[10]*s,e}transpose(){return v2(this,this),this.check()}invert(){return v3(this,this),this.check()}multiplyLeft(e){return v5(this,e,this),this.check()}multiplyRight(e){return v5(this,this,e),this.check()}rotateX(e){return be(this,this,e),this.check()}rotateY(e){return bt(this,this,e),this.check()}rotateZ(e){return br(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return v9(this,this,e,t),this.check()}scale(e){return v7(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return v8(this,this,e),this.check()}transform(e,t){return 4===e.length?(_v(t=b7(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let r,{length:i}=e;switch(i){case 2:r=wj(t||[-0,-0],e,this);break;case 3:r=_X(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return _v(r,e.length),r}transformAsVector(e,t){let r;switch(e.length){case 2:var i;let n,s,a;i=t||[-0,-0],n=e[0],s=e[1],a=this[3]*n+this[7]*s||1,i[0]=(this[0]*n+this[4]*s)/a,i[1]=(this[1]*n+this[5]*s)/a,r=i;break;case 3:r=_9(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return _v(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}function wG(e){if(e>2*Math.PI)throw Error("expected radians")}var xs=xs;function wq(e,t){let r=xs.transformMat4([],t,e);return xs.scale(r,r,1/r[3]),r}function wH(e,t){let r=e%t;return r<0?t+r:r}function wK(e,t,r){return e<t?t:e>r?r:e}let wY=Math.log2||function(e){return Math.log(e)*Math.LOG2E};var bj=bj,wZ=e.i(60113),wZ=wZ,wX=e.i(93311),wX=wX;function wJ(e,t){if(!e)throw Error(t||"@math.gl/web-mercator: assertion failed.")}let wQ=Math.PI,w0=wQ/4,w1=wQ/180,w2=180/wQ;function w3(e){let[t,r]=e;wJ(Number.isFinite(t)),wJ(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=512*(wQ+Math.log(Math.tan(w0+r*w1*.5)))/(2*wQ);return[512*(t*w1+wQ)/(2*wQ),i]}function w4(e){let[t,r]=e,i=2*(Math.atan(Math.exp(r/512*(2*wQ)-wQ))-w0);return[(t/512*(2*wQ)-wQ)*w2,i*w2]}function w6(e){return 512/4003e4/Math.cos(e*w1)}function w5(e){let{latitude:t,longitude:r,highPrecision:i=!1}=e;wJ(Number.isFinite(t)&&Number.isFinite(r));let n=Math.cos(t*w1),s=512/360/n,a=512/4003e4/n,o={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[512/360,s,a],degreesPerUnit:[1/(512/360),1/s,1/a]};if(i){let e=w1*Math.tan(t*w1)/n,r=512/4003e4*e,i=r/s*a;o.unitsPerDegree2=[0,512/360*e/2,r],o.unitsPerMeter2=[i,0,i]}return o}function w8(e,t){let[r,i,n]=e,[s,a,o]=t,{unitsPerMeter:l,unitsPerMeter2:u}=w5({longitude:r,latitude:i,highPrecision:!0}),c=w3(e);c[0]+=s*(l[0]+u[0]*a),c[1]+=a*(l[1]+u[1]*a);let h=w4(c);return Number.isFinite(n)||Number.isFinite(o)?[h[0],h[1],(n||0)+(o||0)]:h}function w7(e){return 2*Math.atan(.5/e)*w2}function w9(e){return .5/Math.tan(.5*e*w1)}function ke(e,t){let[r,i,n=0]=e;return wJ(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),wq(t,[r,i,n,1])}function kt(e,t,r=0){let[i,n,s]=e;if(wJ(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return wq(t,[i,n,s,1]);let a=wq(t,[i,n,0,1]),o=wq(t,[i,n,1,1]),l=a[2],u=o[2];return wZ.lerp([],a,o,l===u?0:((r||0)-l)/(u-l))}var wZ=wZ;let kr=Math.PI/180;function ki(e,t,r){let{pixelUnprojectionMatrix:i}=e,n=wq(i,[t,0,1,1]),s=wq(i,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),o=w4(wZ.lerp([],n,s,a));return o.push(r),o}var bj=bj,wZ=wZ,wX=wX,wZ=wZ;let kn=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,ks=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,ka=`
${kn}
${ks}
`,ko=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,kl=`
${kn}
${ko}
`,ku=x2(function({viewport:e,center:t}){return new wW(e.viewProjectionMatrix).invert().transform(t)}),kc=x2(function({viewport:e,shadowMatrices:t}){let r=[],i=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,s=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>(function(e,t){let[r,i,n]=e,s=kt([r,i,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]})(e,i));for(let i of t){let t=i.clone().translate(new wr(e.center).negate()),n=s.map(e=>t.transform(e)),a=new wW().ortho({left:Math.min(...n.map(e=>e[0])),right:Math.max(...n.map(e=>e[0])),bottom:Math.min(...n.map(e=>e[1])),top:Math.max(...n.map(e=>e[1])),near:Math.min(...n.map(e=>-e[2])),far:Math.max(...n.map(e=>-e[2]))});r.push(a.multiplyRight(i))}return r}),kh=[0,0,0,1],kf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],kd={name:"shadow",dependencies:[_u],vs:ka,fs:kl,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let i=_u.getUniforms(r),n=ku({viewport:r.viewport,center:i.center}),s=[],a=kc({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let t=0;t<e.shadowMatrices.length;t++){let e=a[t],o=e.clone().translate(new wr(r.viewport.center).negate());i.coordinateSystem===xX.LNGLAT&&i.projectionMode===xJ.WEB_MERCATOR?(a[t]=o,s[t]=n):(a[t]=e.clone().multiplyRight(kf),s[t]=o.transform(n))}let o={drawShadowMap:!!e.drawToShadowMap,useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||kh,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let e=0;e<a.length;e++)o[`viewProjectionMatrix${e}`]=a[e],o[`projectCenter${e}`]=s[e];for(let t=0;t<2;t++)o[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return o},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},kp={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:function(e={},t){let r={};if(void 0===e.highlightedObjectColor||(null===e.highlightedObjectColor?r.isHighlightActive=!1:(r.isHighlightActive=!0,r.highlightedObjectColor=e.highlightedObjectColor.slice(0,3))),e.highlightColor){let t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),r.highlightColor=t}return void 0!==e.isActive&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),void 0!==e.useFloatColors&&(r.useFloatColors=!!e.useFloatColors),r}},kg={...kp,defaultUniforms:{...kp.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},km=[vG],ky=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],kv=[],kb=Symbol.for("component"),kx=Symbol.for("propTypes"),k_=Symbol.for("deprecatedProps"),kw=Symbol.for("asyncPropDefaults"),kk=Symbol.for("asyncPropOriginal"),kP=Symbol.for("asyncPropResolved"),kS={};function kE(e){kS=e}function kA(e,t,r,i){xo.level>0&&kS[e]&&kS[e].call(null,t,r,i)}function kM(e,t=()=>!0){return Array.isArray(e)?function e(t,r,i){let n=-1;for(;++n<t.length;){let s=t[n];Array.isArray(s)?e(s,r,i):r(s)&&i.push(s)}return i}(e,t,[]):t(e)?[e]:[]}e.i(23635);var kT=e.i(9685);let kC=e=>null!==e&&"object"==typeof e,kO=e=>kC(e)&&e.constructor===({}).constructor,kI=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,kL=e=>"undefined"!=typeof Blob&&e instanceof Blob,kj=e=>{let t,r;return t=e,"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||kC(t)&&"function"==typeof t.tee&&"function"==typeof t.cancel&&"function"==typeof t.getReader||kC(r=e)&&"function"==typeof r.read&&"function"==typeof r.pipe&&"boolean"==typeof r.readable};function kN(e,t){if(!e)throw Error(t||"loader assertion failed.")}function kD(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function kR(e){let t;return kN(e,"null loader"),kN(kD(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let kz={};class kF extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}let kB=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,kU=/^([-\w.]+\/[-\w.+]+)/;function k$(e,t){return e.toLowerCase()===t.toLowerCase()}function kV(e){let t=kB.exec(e);return t?t[1]:""}let kW=/\?.*/;function kG(e){return e.replace(kW,"")}function kq(e){return kI(e)?e.url:kL(e)?e.name||"":"string"==typeof e?e:""}function kH(e){if(kI(e)){let t,r=e.headers.get("content-type")||"",i=kG(e.url);return((t=kU.exec(r))?t[1]:r)||kV(i)}return kL(e)?e.type||"":"string"==typeof e?kV(e):""}async function kK(e){var t;if(kI(e))return e;let r={},i=kI(t=e)?t.headers["content-length"]||-1:kL(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1;i>=0&&(r["content-length"]=String(i));let n=kq(e),s=kH(e);s&&(r["content-type"]=s);let a=await kX(e);a&&(r["x-first-bytes"]=a),"string"==typeof e&&(e=new TextEncoder().encode(e));let o=new Response(e,{headers:r});return Object.defineProperty(o,"url",{value:n}),o}async function kY(e){if(!e.ok)throw await kZ(e)}async function kZ(e){let t=function(e){if(e.length<50)return e;let t=e.slice(e.length-15),r=e.substr(0,32);return`${r}...${t}`}(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:e.statusText,url:e.url,response:e};try{let t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new kF(r,i)}async function kX(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise(e=>{let r=new FileReader;r.onload=t=>e(t?.target?.result),r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){let t=function(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}async function kJ(e,t){if("string"==typeof e){var r;let i=function(e){for(let t in kz)if(e.startsWith(t)){let r=kz[t];e=e.replace(t,r)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return!((r=i).startsWith("http:")||r.startsWith("https:"))&&!i.startsWith("data:")&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(i,t):await fetch(i,t)}return await kK(e)}let kQ="4.3.3",k0=kQ[0]>="0"&&kQ[0]<="9"?`v${kQ}`:"",k1=(p=new xa.Log({id:"loaders.gl"}),globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=p,globalThis.loaders.version=k0,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=p,p),k2=new xa.Log({id:"loaders.gl"});class k3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}let k4={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};k4.self||k4.window||k4.global,k4.window||k4.self||k4.global,k4.global||k4.self||k4.window,k4.document;let k6=("object"!=typeof tX.default||"[object process]"!==String(tX.default),!0),k5=void 0!==tX.default&&tX.default.version&&/v([0-9]*)/.exec(tX.default.version);k5&&parseFloat(k5[1]);let k8={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:k6,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},k7={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function k9(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Pe(){let e=k9();return e.globalOptions=e.globalOptions||{...k8},e.globalOptions}function Pt(e,t,r,i,n){let s=t||"Top level",a=t?`${t}.`:"";for(let o in e){let l=!t&&kC(e[o]),u="baseUri"===o&&!t,c="workerUrl"===o&&t;if(!(o in r)&&!u&&!c){if(o in i)k2.warn(`${s} loader option '${a}${o}' no longer supported, use '${i[o]}'`)();else if(!l){let e=function(e,t){let r=e.toLowerCase(),i="";for(let n of t)for(let t in n.options){if(e===t)return`Did you mean '${n.id}.${t}'?`;let s=t.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(i=i||`Did you mean '${n.id}.${t}'?`)}return i}(o,n);k2.warn(`${s} loader option '${a}${o}' not recognized. ${e}`)()}}}}function Pr(e,t){for(let r in t)r in t&&(kO(t[r])&&kO(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r])}function Pi(e,t){let r=Pe(),i=e||r;return"function"==typeof i.fetch?i.fetch:kC(i.fetch)?e=>kJ(e,i.fetch):t?.fetch?t?.fetch:kJ}let Pn={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};Pn.self||Pn.window||Pn.global,Pn.window||Pn.self||Pn.global,Pn.global||Pn.self||Pn.window,Pn.document;let Ps="object"!=typeof tX.default||"[object process]"!==String(tX.default)||!0,Pa="undefined"!=typeof window&&void 0!==window.orientation,Po=void 0!==tX.default&&tX.default.version&&/v([0-9]*)/.exec(tX.default.version);Po&&parseFloat(Po[1]);class Pl{terminate(){}}function Pu(e,t){if(!e)throw Error(t||"loaders.gl assertion failed.")}let Pc=new Map;function Ph(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Pf(e){return!!e&&!!(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}let Pd=()=>{};class Pp{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&Ps||!Ps}constructor(e){const{name:t,source:r,url:i}=e;Pu(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=Pd,this.onError=e=>console.log(e),this.worker=Ps?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Pd,this.onError=Pd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||function e(t,r=!0,i){let n=i||new Set;if(t){if(Pf(t))n.add(t);else if(Pf(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(r&&"object"==typeof t)for(let i in t)e(t[i],r,n)}return void 0===i?Array.from(n):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),Error(t)}_createBrowserWorker(){var e,t,r;let i;this._loadableURL=(Pu((e={source:this.source,url:this.url}).source&&!e.url||!e.source&&e.url),(i=Pc.get(e.source||e.url))||(e.url&&(i=(t=e.url).startsWith("http")?Ph((r=t,`\
try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`)):t,Pc.set(e.url,i)),e.source&&(i=Ph(e.source),Pc.set(e.source,i))),Pu(i),i);let n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(Error("No data received"))},n.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},n.onmessageerror=e=>console.error(e),n}_createNodeWorker(){let e;if(this.url)e=new Pl(this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`,{eval:!1});else if(this.source)e=new Pl(this.source,{eval:!0});else throw Error("no worker");return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class Pg{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Pu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Pu(this.isRunning),this.isRunning=!1,this._reject(e)}}class Pm{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Pp.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,r)=>e.done(r),r=(e,t)=>e.error(t)){let i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let r=new Pg(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ps||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this._getMaxConcurrency()?(this.count++,new Pp({name:`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`,source:this.source,url:this.url})):null}_getMaxConcurrency(){return Pa?this.maxMobileConcurrency:this.maxConcurrency}}let Py={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Pv{props;workerPools=new Map;static _workerFarm;static isSupported(){return Pp.isSupported()}static getWorkerFarm(e={}){return Pv._workerFarm=Pv._workerFarm||new Pv({}),Pv._workerFarm.setProps(e),Pv._workerFarm}constructor(e){this.props={...Py},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){for(let t of(this.props={...this.props,...e},this.workerPools.values()))t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:r,url:i}=e,n=this.workerPools.get(t);return n||((n=new Pm({name:t,source:r,url:i})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}let Pb=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);async function Px(e,t,r,i,n){let s=e.id,a=function(e,t={}){let r=t[e.id]||{},i=Ps?`${e.id}-worker.js`:`${e.id}-worker-node.js`,n=r.workerUrl;if(n||"compression"!==e.id||(n=t.workerUrl),"test"===t._workerType&&(n=Ps?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let t=e.version;"latest"===t&&(t="latest");let r=t?`@${t}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${r}/dist/${i}`}return Pu(n),n}(e,r),o=Pv.getWorkerFarm(r).getWorkerPool({name:s,url:a});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let l=await o.startJob("process-on-worker",P_.bind(null,n));l.postMessage("process",{input:t,options:r,context:i});let u=await l.result;return await u.result}async function P_(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(Error(i.error));break;case"process":let{id:n,input:s,options:a}=i;try{let r=await e(s,a);t.postMessage("done",{id:n,result:r})}catch(r){let e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:n,error:e})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}async function Pw(e){let t=[];for await(let r of e)t.push(r);return function(...e){var t=e;let r=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),i=new Uint8Array(r.reduce((e,t)=>e+t.byteLength,0)),n=0;for(let e of r)i.set(e,n),n+=e.byteLength;return i.buffer}(...t)}async function*Pk(e,t){let r=t?.chunkSize||1048576,i=0;for(;i<e.size;){let t=i+r,n=await e.slice(i,t).arrayBuffer();i=t,yield n}}function PP(e){if(e&&"object"==typeof e&&e.isBuffer||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e)return new TextEncoder().encode(e).buffer;if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw Error("toArrayBuffer")}function PS(e,t){return k6?PE(e,t):PA(e,t)}async function*PE(e,t){let r,i=e.getReader();try{for(;;){let e=r||i.read();t?._streamReadAhead&&(r=i.read());let{done:n,value:s}=await e;if(n)return;yield PP(s)}}catch(e){i.releaseLock()}}async function*PA(e,t){for await(let t of e)yield PP(t)}let PM="Cannot convert supplied data type";async function PT(e,t,r){let i,n,s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s){let r;var a=e;if(t.text&&"string"==typeof a)return a;if((r=a)&&"object"==typeof r&&r.isBuffer&&(a=a.buffer),a instanceof ArrayBuffer){let e=a;return t.text&&!t.binary?new TextDecoder("utf8").decode(e):e}if(ArrayBuffer.isView(a)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(a);let e=a.buffer,r=a.byteLength||a.length;return(0!==a.byteOffset||r!==e.byteLength)&&(e=e.slice(a.byteOffset,a.byteOffset+r)),e}throw Error(PM)}if(kL(e)&&(e=await kK(e)),kI(e)){let r=e;return await kY(r),t.binary?await r.arrayBuffer():await r.text()}if(kj(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){let r=t?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<e.length;){let t=Math.min(e.length-i,r),s=e.slice(i,i+t);i+=t,yield n.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){let{chunkSize:r=262144}=t,i=0;for(;i<e.byteLength;){let t=Math.min(e.byteLength-i,r),n=new ArrayBuffer(t),s=new Uint8Array(e,i,t);new Uint8Array(n).set(s),i+=t,yield n}}(e,t);if(kL(e))return Pk(e,t);if(kj(e))return PS(e,t);if(kI(e))return PS(e.body,t);throw Error("makeIterator")}(e,r)),(i=e)&&"function"==typeof i[Symbol.iterator]||(n=e)&&"function"==typeof n[Symbol.asyncIterator])return Pw(e);throw Error(PM)}function PC(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function PO(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function PI(...e){return(e=e.map((t,r)=>(r&&(t=t.replace(RegExp("^/"),"")),r!==e.length-1&&(t=t.replace(RegExp("/$"),"")),t))).join("/")}function PL(...e){let t,r=[];for(let t=0;t<e.length;t++)r[t]=e[t];let i="",n=!1;for(let e=r.length-1;e>=-1&&!n;e--){let s;e>=0?s=r[e]:(void 0===t&&(t=function(){if(void 0!==tX.default&&void 0!==tX.default.cwd)return tX.default.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}()),s=t),0!==s.length&&(i=`${s}/${i}`,n=s.charCodeAt(0)===Pj)}return(i=function(e,t){let r,i="",n=-1,s=0,a=!1;for(let o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(r===Pj)break;else r=Pj;if(r===Pj){if(n===o-1||1===s);else if(n!==o-1&&2===s){if(i.length<2||!a||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){let e=i.length-1,t=e;for(;t>=0&&i.charCodeAt(t)!==Pj;--t);if(t!==e){i=-1===t?"":i.slice(0,t),n=o,s=0,a=!1;continue}}else if(2===i.length||1===i.length){i="",n=o,s=0,a=!1;continue}}t&&(i.length>0?i+="/..":i="..",a=!0)}else{let t=e.slice(n+1,o);i.length>0?i+=`/${t}`:i=t,a=!1}n=o,s=0}else 46===r&&-1!==s?++s:s=-1}return i}(i,!n),n)?`/${i}`:i.length>0?i:"."}let Pj=47;e.s(["dirname",()=>PO,"filename",()=>PC,"join",()=>PI,"resolve",()=>PL],73276);var PN=e.i(73276),PN=PN,PN=PN;let PD=()=>{let e=k9();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},PR=/\.([^.]+)$/;async function Pz(e,t=[],r,i){if(!PB(e))return null;let n=PF(e,t,{...r,nothrow:!0},i);if(n)return n;if(kL(e)&&(n=PF(e=await e.slice(0,10).arrayBuffer(),t,r,i)),!n&&!r?.nothrow)throw Error(PU(e));return n}function PF(e,t=[],r,i){var n,s,a,o,l,u;let c,h,f,d,p,g,m;if(!PB(e))return null;if(t&&!Array.isArray(t))return kR(t);let y=[];t&&(y=y.concat(t)),r?.ignoreRegisteredLoaders||y.push(...PD()),function(e){for(let t of e)kR(t)}(y);let v=(n=e,s=y,a=r,o=i,c=kq(n),h=kH(n),f=kG(c)||o?.url,d=null,p="",a?.mimeType&&(d=P$(s,a?.mimeType),p=`match forced by supplied MIME type ${a?.mimeType}`),d=d||(l=s,(m=(g=(u=f)&&PR.exec(u))&&g[1])?function(e,t){for(let r of(t=t.toLowerCase(),e))for(let e of r.extensions)if(e.toLowerCase()===t)return r;return null}(l,m):null),p=p||(d?`matched url ${f}`:""),d=d||P$(s,h),p=p||(d?`matched MIME type ${h}`:""),d=d||function(e,t){if(!t)return null;for(let r of e)if("string"==typeof t){if(function(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(PV(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&PV(t,0,r))return r;return null}(s,n),p=p||(d?`matched initial data ${PW(n)}`:""),a?.fallbackMimeType&&(d=d||P$(s,a?.fallbackMimeType),p=p||(d?`matched fallback MIME type ${h}`:"")),p&&k1.log(1,`selectLoader selected ${d?.name}: ${p}.`),d);if(!v&&!r?.nothrow)throw Error(PU(e));return v}function PB(e){return!(e instanceof Response)||204!==e.status}function PU(e){let t=kq(e),r=kH(e),i="No valid loader found (";i+=(t?`${PN.filename(t)}, `:"no url provided, ")+`MIME type: ${r?`"${r}"`:"not provided"}, `;let n=e?PW(e):"";return i+((n?` first bytes: "${n}"`:"first bytes: not available")+")")}function P$(e,t){for(let r of e)if(r.mimeTypes?.some(e=>k$(t,e))||k$(t,`application/x.${r.id}`))return r;return null}function PV(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(r=>(function(e,t,r,i){if(i instanceof ArrayBuffer)return function(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let i=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==n[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":let n=PG(e,t,i.length);return i===n;default:return!1}})(e,t,0,r))}function PW(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?PG(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?PG(e,0,t):""}function PG(e,t,r){if(e.byteLength<t+r)return"";let i=new DataView(e),n="";for(let e=0;e<r;e++)n+=String.fromCharCode(i.getUint8(t+e));return n}async function Pq(e,t,r,i){var n,s,a,o,l,u,c;let h;!t||Array.isArray(t)||kD(t)||(i=void 0,r=t,t=void 0),e=await e,r=r||{};let f=kq(e),d=function(e,t){let r;if(e&&!Array.isArray(e))return e;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:void 0}(t,i),p=await Pz(e,d,r);if(!p)return null;return function(e,t){for(let r of(Pt(e,null,k8,k7,t),t)){let i=e&&e[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Pt(i,r.id,n,s,t)}}(n=r,s=Array.isArray(s=(s=d)||[])?s:[s]),i=function(e,t,r){if(r)return r;let i={fetch:Pi(t,e),...e};if(i.url){let e,t=kG(i.url);i.baseUrl=t,e=i.url.match(kW),i.queryString=e&&e[0],i.filename=PN.filename(t),i.baseUrl=PN.dirname(t)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:f,_parse:Pq,loaders:d},(a=p,o=n,l=f,u=h={...a.options||{}},!(c=l)||"baseUri"in u||(u.baseUri=c),null===h.log&&(h.log=new k3),Pr(h,Pe()),Pr(h,o),r=h),i||null),await PH(p,e,r,i)}async function PH(e,t,r,i){var n;if(!function(e,t=Pb){Pu(e,"no worker provided");e.version}(e),r=function e(t,r,i=0){if(i>3)return r;let n={...t};for(let[t,s]of Object.entries(r))s&&"object"==typeof s&&!Array.isArray(s)?n[t]=e(n[t]||{},r[t],i+1):n[t]=r[t];return n}(e.options||{},r),kI(t)){let e=t,{ok:r,redirected:n,status:s,statusText:a,type:o,url:l}=e;i.response={headers:Object.fromEntries(e.headers.entries()),ok:r,redirected:n,status:s,statusText:a,type:o,url:l}}if(t=await PT(t,e,r),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,r,i);if(n=r,Pv.isSupported()&&(Ps||n?._nodeWorkers)&&e.worker&&n?.worker)return await Px(e,t,r,i,Pq);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,i);if(e.parse)return await e.parse(t,r,i);throw Pu(!e.parseSync),Error(`${e.id} loader - no parser found and worker is disabled`)}async function PK(e,t,r,i){let n,s;Array.isArray(t)||kD(t)?(n=t,s=r):(n=[],s=t);let a=Pi(s),o=e;return"string"==typeof e&&(o=await a(e)),kL(e)&&(o=await a(e)),Array.isArray(n),await Pq(o,n,s)}class PY{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let r=++this._loadCount,i=e;for(let t of("string"==typeof e&&(i=PK(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e),this._subscribers))t.onChange(this.getData())}}class PZ{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let n=this._resources[e];n?n.setData(t,r):(n=new PY(e,t,this._context),this._resources[e]=n),n.persistent=i}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let e in t){let r=t[e],i=this._resources[r.resourceId];i&&i.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){let{_resources:n,protocol:s}=this;e.startsWith(s)&&(n[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));let a=n[e];if(this._track(r,i,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,r,i){let n=this._consumers,s=n[e]=n[e]||{},a=s[t],o=a&&a.resourceId&&this._resources[a.resourceId];o&&(o.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},s[t]=a,r.subscribe(a))}_prune(){for(let e of(this._pruneRequest=null,Object.keys(this._resources))){let t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}let PX=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:n=0,copy:s=!1,initialize:a=!1,maxCount:o}){let l=i||e&&e.constructor||Float32Array,u=t*r+n;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let c=1/0;o&&(c=o*r+n);let h=this._allocate(l,u,a,c);return e&&s?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,r,i){let n=Math.max(Math.ceil(t*this.opts.overAlloc),1);n>i&&(n=i);let s=this._pool,a=e.BYTES_PER_ELEMENT*n,o=s.findIndex(e=>e.byteLength>=a);if(o>=0){let t=new e(s.splice(o,1)[0],0,n);return r&&t.fill(0),t}return new e(n)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:r}=e,{byteLength:i}=r,n=t.findIndex(e=>e.byteLength>=i);n<0?t.push(r):(n>0||t.length<this.opts.poolSize)&&t.splice(n,0,r),t.length>this.opts.poolSize&&t.shift()}};function PJ(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}let PQ=new wr;function P0(e,t,r,i){PQ.set(e,t,r);let n=PQ.len();return{distance:i/n,normal:new wr(-e/n,-t/n,-r/n)}}function P1(e,t){let{size:r=1,startIndex:i=0}=t,s=void 0!==t.endIndex?t.endIndex:e.length,a=(s-i)/r;n=PX.allocate(n,a,{type:Float32Array,size:2*r});let o=i,l=0;for(;o<s;){for(let t=0;t<r;t++){let i=e[o++];n[l+t]=i,n[l+t+r]=i-Math.fround(i)}l+=2*r}return n.subarray(0,a*r*2)}function P2(e){let t=null,r=!1;for(let i of e)i&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}var bj=bj;let P3=Math.PI/180,P4=PJ(),P6=[0,0,0],P5={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class P8{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||P5,this.focalDistance=e.focalDistance||1,this.position=e.position||P6,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?xJ.WEB_MERCATOR:xJ.WEB_MERCATOR_AUTO_OFFSET:xJ.IDENTITY}equals(e){return e instanceof P8&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&_g(e.projectionMatrix,this.projectionMatrix)&&_g(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){let r=ke(this.projectPosition(e),this.pixelProjectionMatrix),[i,n]=r,s=t?n:this.height-n;return 2===e.length?[i,s]:[i,s,r[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let[i,n,s]=e,a=t?n:this.height-n,o=r&&r*this.distanceScales.unitsPerMeter[2],l=kt([i,a,s],this.pixelUnprojectionMatrix,o),[u,c,h]=this.unprojectPosition(l);return Number.isFinite(s)?[u,c,h]:Number.isFinite(r)?[u,c,r]:[u,c]}projectPosition(e){let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){let[t,r]=this.unprojectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){let t=w3(e);return t[1]=_d(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?w4(e):e}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],n[0],s[0]),Math.min(r[1],i[1],n[1],s[1]),Math.max(r[0],i[0],n[0],s[0]),Math.max(r[1],i[1],n[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?w5({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){var e;return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,{left:P0((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:P0(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:P0(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:P0(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:P0(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:P0(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){let{latitude:t}=e;return wJ(Number.isFinite(t)),wY(4003e4*Math.cos(t*w1))-9}({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||w5({latitude:r,longitude:t}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:n,modelMatrix:s}=e,a=P6;if(n&&(a=s?new wW(s).transformAsVector(n,[]):n),this.isGeospatial){let e=this.projectPosition([t,r,0]);this.center=new wr(a).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(a)}_initMatrices(e){var t;let{viewMatrix:r=P4,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:l=1e3,padding:u=null,focalDistance:c=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new wW().multiplyRight(r).translate(new wr(this.center).negate()),this.projectionMatrix=i||function({width:e,height:t,orthographic:r,fovyRadians:i,focalDistance:n,padding:s,near:a,far:o}){let l=e/t,u=r?new wW().orthographic({fovy:i,aspect:l,focalDistance:n,near:a,far:o}):new wW().perspective({fovy:i,aspect:l,near:a,far:o});if(s){let{left:r=0,right:i=0,top:n=0,bottom:a=0}=s,o=_d((r+e-i)/2,0,e)-e/2,l=_d((n+t-a)/2,0,t)-t/2;u[8]-=2*o/e,u[9]+=2*l/t}return u}({width:this.width,height:this.height,orthographic:n,fovyRadians:s||a*P3,focalDistance:c,padding:u,near:o,far:l});let h=PJ();bj.multiply(h,h,this.projectionMatrix),bj.multiply(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=bj.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(t=this.viewMatrixInverse)[12],t[13],t[14]];let f=PJ(),d=PJ();bj.scale(f,f,[this.width/2,-this.height/2,1]),bj.translate(f,f,[1,-1,0]),bj.multiply(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=bj.invert(PJ(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||xo.warn("Pixel project matrix not invertible")()}}P8.displayName="Viewport";let P7=P8;class P9{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{kA("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:r,stats:i,viewport:n,timeline:s}=t||{};this.layers=[],this.resourceManager=new PZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:function(e){let t=vC.getDefaultShaderAssembler();for(let e of km)t.addDefaultModule(e);for(let r of(t._hookFunctions.length=0,"glsl"===e?ky:kv))t.addShaderHook(r);return t}(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[v$],renderPass:void 0,stats:i||new kT.Stats({id:"deck.gl"}),viewport:n||new P7({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new vi,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){for(let e of(this.resourceManager.finalize(),this.layers))this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;for(let r of(e.clearRedrawFlags&&(this._needsRedraw=!1),this.layers)){let i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){kA("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;let r=kM(e,Boolean);for(let e of r)e.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,r=t.findIndex(t=>t.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){let r={};for(let t of e)r[t.id]?xo.warn(`Multiple old layers with same id ${t.id}`)():r[t.id]=t;if(this._defaultShaderModulesChanged){for(let t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let n=!1;for(let e of i)if(e.hasUniformTransition()){n=`Uniform transition in ${e}`;break}this._needsUpdate=n,this.layers=i}_updateSublayersRecursively(e,t,r){for(let i of e){i.context=this.context;let e=t[i.id];null===e&&xo.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let n=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),n=i.isComposite?i.getSubLayers():null}catch(e){this._handleError("matching",e,i)}n&&this._updateSublayersRecursively(n,t,r)}}_finalizeOldLayers(e){for(let t in e){let r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function Se(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Se(e[i],t[i],r-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){let i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let n of i)if(!t.hasOwnProperty(n)||!Se(e[n],t[n],r-1))return!1;return!0}return!1}class St{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t="string"==typeof e?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){let r=this.getViewports(),i={x:e[0],y:e[1]};for(let n=r.length-1;n>=0;--n){let s=r[n];if(s.containsPixel(i)){let r=e.slice();return r[0]-=s.x,r[1]-=s.y,s.unproject(r,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=kM(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(Se(e,this.viewState,3)||this.setNeedsUpdate("viewState changed"),this.viewState=e):xo.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new t.type({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,r,i){let n=e.controller;if(n&&r){let s={...t,...n,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return i&&i.constructor===n.type||(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){let n=e[i],s=this.getViewState(n),a=n.makeViewport({viewState:s,width:this.width,height:this.height}),o=t[n.id],l=!!n.controller;l&&!o&&(r=!0),(r||!l)&&o&&(o.finalize(),o=null),this.controllers[n.id]=this._updateController(n,s,a,o),a&&this._viewports.unshift(a)}for(let e in t){let r=t[e];r&&!this.controllers[e]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((r,i)=>!e[i].equals(t[i]))}}let Sr=/([0-9]+\.?[0-9]*)(%|px)/;function Si(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=Sr.exec(e);if(t&&t.length>=3){let e="%"===t[2],r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw Error(`Could not parse position string ${e}`)}}function Sn(e,t){return e.relative?Math.round(e.position*t):e.position}class Ss{constructor(e){const{id:t,x:r=0,y:i=0,width:n="100%",height:s="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Si(r),this._y=Si(i),this._width=Si(n),this._height=Si(s),this._padding=a&&{left:Si(a.left||0),right:Si(a.right||0),top:Si(a.top||0),bottom:Si(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&Se(this.props,e.props,2)}clone(e){return new this.constructor({...this.props,...e})}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);let i=this.getDimensions({width:e,height:t});return i.height&&i.width?new(this.getViewportType(r))({...r,...this.props,...i}):null}getViewStateId(){let{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){let r={x:Sn(this._x,e),y:Sn(this._y,t),width:Sn(this._width,e),height:Sn(this._height,t)};return this._padding&&(r.padding={left:Sn(this._padding.left,e),top:Sn(this._padding.top,t),right:Sn(this._padding.right,e),bottom:Sn(this._padding.bottom,t)}),r}get controller(){let e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}var wZ=wZ;class Sa extends P7{constructor(e={}){let t;const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:l=1.01,nearZ:u,farZ:c,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:p=0,position:g,padding:m,legacyMeterSizes:y=!1}=e;let{width:v,height:b,altitude:x=1.5}=e;const _=Math.pow(2,n);v=v||1,b=b||1;let w=null;if(f)t=w7(x=f[5]/2);else{let i;if(e.fovy?x=w9(t=e.fovy):t=w7(x),m){const{top:e=0,bottom:t=0}=m;i=[0,_d((e+b-t)/2,0,b)-b/2]}w=function(e){let{width:t,height:r,altitude:i,pitch:n=0,offset:s,center:a,scale:o,nearZMultiplier:l=1,farZMultiplier:u=1}=e,{fovy:c=w7(1.5)}=e;void 0!==i&&(c=w7(i));let h=c*w1,f=n*w1,d=w9(c),p=d;a&&(p+=a[2]*o/Math.cos(f)/r);let g=h*(.5+(s?s[1]:0)/r),m=Math.sin(g)*p/Math.sin(wK(Math.PI/2-f-g,.01,Math.PI-.01));return{fov:h,aspect:t/r,focalDistance:d,near:l,far:Math.min((Math.sin(f)*m+p)*u,10*p)}}({width:v,height:b,scale:_,center:g&&[0,0,g[2]*w6(r)],offset:i,pitch:s,fovy:t,nearZMultiplier:o,farZMultiplier:l}),Number.isFinite(u)&&(w.near=u),Number.isFinite(c)&&(w.far=c)}let k=function(e){let{height:t,pitch:r,bearing:i,altitude:n,scale:s,center:a}=e,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];bj.translate(o,o,[0,0,-n]),bj.rotateX(o,o,-r*w1),bj.rotateZ(o,o,i*w1);let l=s/t;return bj.scale(o,o,[l,l,l]),a&&bj.translate(o,o,wX.negate([],a)),o}({height:b,pitch:s,bearing:a,scale:_,altitude:x});p&&(k=new wW().translate([512*p,0,0]).multiplyLeft(k)),super({...e,width:v,height:b,viewMatrix:k,longitude:i,latitude:r,zoom:n,...w,fovy:t,focalDistance:x}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=a,this.altitude=x,this.fovy=t,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let e=t;e<=r;e++){let t=e?new Sa({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*w6(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,r]=this.unprojectFlat(e),i=(e[2]||0)/w6(r);return[t,r,i]}addMetersToLngLat(e,t){return w8(e,t)}panByPosition(e,t){let r=kt(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),n=wZ.add([],i,wZ.negate([],r)),s=wZ.add([],this.center,n),[a,o]=this.unprojectFlat(s);return{longitude:a,latitude:o}}getBounds(e={}){let t=function(e,t=0){let r,i,{width:n,height:s,unproject:a}=e,o={targetZ:t},l=a([0,s],o),u=a([n,s],o);return(e.fovy?.5*e.fovy*kr:Math.atan(.5/e.altitude))>(90-e.pitch)*kr-.01?(r=ki(e,0,t),i=ki(e,n,t)):(r=a([0,0],o),i=a([n,0],o)),[l,u,i,r]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:r,height:i}=this,{longitude:n,latitude:s,zoom:a}=function(e){let{width:t,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:a=[0,0]}=e,[[o,l],[u,c]]=i,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(wJ(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),f=w3([o,wK(c,-85.051129,85.051129)]),d=w3([u,wK(l,-85.051129,85.051129)]),p=[Math.max(Math.abs(d[0]-f[0]),n),Math.max(Math.abs(d[1]-f[1]),n)],g=[t-h.left-h.right-2*Math.abs(a[0]),r-h.top-h.bottom-2*Math.abs(a[1])];wJ(g[0]>0&&g[1]>0);let m=g[0]/p[0],y=g[1]/p[1],v=(h.right-h.left)/2/m,b=(h.top-h.bottom)/2/y,x=w4([(d[0]+f[0])/2+v,(d[1]+f[1])/2+b]),_=Math.min(s,wY(Math.abs(Math.min(m,y))));return wJ(Number.isFinite(_)),{longitude:x[0],latitude:x[1],zoom:_}}({width:r,height:i,bounds:e,...t});return new Sa({width:r,height:i,longitude:n,latitude:s,zoom:a})}}Sa.displayName="WebMercatorViewport";class So{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}let Sl=()=>{},Su=e=>e;class Sc{constructor(e){this._onTransitionUpdate=e=>{let{time:t,settings:{interpolator:r,startProps:i,endProps:n,duration:s,easing:a}}=e,o=a(t/s),l=r.interpolateProps(i,n,o);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new So(e.timeline),this.onViewStateChange=e.onViewStateChange||Sl,this.onStateChange=e.onStateChange||Sl}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){let{interruption:e,endProps:t}=this.transition.settings;i={...r,...2===e?t:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||"auto"===t)&&!!r}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&!!this.propsInTransition&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){let r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),n=t.transitionInterpolator,s=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0===s)return;let a=n.initializeProps(e,i);this.propsInTransition={};let o={duration:s,easing:t.transitionEasing||Su,interpolator:n,interruption:t.transitionInterruption||1,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Sh(e,t){if(!e)throw Error(t||"deck.gl: assertion failed.")}class Sf{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(let r of this._propsToCompare)if(!(r in e)||!(r in t)||!_g(e[r],t[r]))return!1;return!0}initializeProps(e,t){let r={},i={};for(let n of this._propsToExtract)(n in e||n in t)&&(r[n]=e[n],i[n]=t[n]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{let r=e[t];Sh(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}let Sd=["longitude","latitude","zoom","bearing","pitch"],Sp=["longitude","latitude","zoom"];class Sg extends Sf{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Sd,required:Sp},super(r.transitionProps),this.opts=r}initializeProps(e,t){let r=super.initializeProps(e,t),{makeViewport:i,around:n}=this.opts;if(i&&n){let s=i(e),a=i(t),o=s.unproject(n);r.start.around=n,Object.assign(r.end,{around:a.project(o),aroundPosition:o,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){let i={};for(let n of this._propsToExtract)i[n]=_p(e[n]||0,t[n]||0,r);if(t.aroundPosition&&this.opts.makeViewport){let n=this.opts.makeViewport({...t,...i});Object.assign(i,n.panByPosition(t.aroundPosition,_p(e.around,t.around,r)))}return i}}let Sm={transitionDuration:0},Sy=e=>1-(1-e)*(1-e),Sv=["wheel"],Sb=["panstart","panmove","panend"],Sx=["pinchstart","pinchmove","pinchend"],S_=["multipanstart","multipanmove","multipanend"],Sw=["dblclick"],Sk=["keydown"],SP={};class SS{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Sc({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){let{width:r,height:i}=this.props;if(t&&t.handled)return!1;let n=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return n&&t&&t.stopPropagation(),n}isFunctionKeyPressed(e){let{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:300*(!0===t);let{scrollZoom:r=!0,dragPan:i=!0,dragRotate:n=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:o=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Sv,u&&r),this.toggleEvents(Sb,u),this.toggleEvents(Sx,u&&(a||o)),this.toggleEvents(S_,u&&o),this.toggleEvents(Sw,u&&s),this.toggleEvents(Sk,u&&l),this.scrollZoom=r,this.dragPan=i,this.dragRotate=n,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=o,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,r={}){let i={...e.getViewportProps(),...t},n=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),n){let e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(r=!r);let i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,Sm,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Sm,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],n=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sy},{isDragging:!1,isPanning:!0})}else{let e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Sm,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],n=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sy},{isDragging:!1,isRotating:!0})}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:r=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:n}=e,s=2/(1+Math.exp(-Math.abs(n*r)));n<0&&0!==s&&(s=1/s);let a=i?{...this._getTransitionProps({around:t}),transitionDuration:250}:Sm,o=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(o,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Sm,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Sm,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],n=this.controllerState.rotate({pos:i});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sy},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return SP._startPinchRotation=e.rotation,SP._lastPinchEvent=e,this.updateViewport(r,Sm,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){let{rotation:r}=e;t=t.rotate({deltaAngleX:SP._startPinchRotation-r})}return this.updateViewport(t,Sm,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),SP._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:r}=SP;if(this.touchZoom&&t&&r&&e.scale!==r.scale){let i=this.getCenter(e),n=this.controllerState.rotateEnd(),s=Math.log2(e.scale),a=(s-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),o=Math.pow(2,s+a*t/2);n=n.zoom({pos:i,scale:o}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Sy},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return SP._startPinchRotation=null,SP._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){let t;if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:a}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this,l={};switch(e.srcEvent.code){case"Minus":t=r?o.zoomOut(i).zoomOut(i):o.zoomOut(i),l.isZooming=!0;break;case"Equal":t=r?o.zoomIn(i).zoomIn(i):o.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":r?(t=o.rotateLeft(s),l.isRotating=!0):(t=o.moveLeft(n),l.isPanning=!0);break;case"ArrowRight":r?(t=o.rotateRight(s),l.isRotating=!0):(t=o.moveRight(n),l.isPanning=!0);break;case"ArrowUp":r?(t=o.rotateUp(a),l.isRotating=!0):(t=o.moveUp(n),l.isPanning=!0);break;case"ArrowDown":r?(t=o.rotateDown(a),l.isRotating=!0):(t=o.moveDown(n),l.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),l),!0}_getTransitionProps(e){let{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Sg({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Sm}}class SE{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class SA extends SE{constructor(e){const{width:t,height:r,latitude:i,longitude:n,zoom:s,bearing:a=0,pitch:o=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:c=20,minZoom:h=0,maxPitch:f=60,minPitch:d=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:b,normalize:x=!0}=e;Sh(Number.isFinite(n)),Sh(Number.isFinite(i)),Sh(Number.isFinite(s)),super({width:t,height:r,latitude:i,longitude:n,zoom:s,bearing:a,pitch:o,altitude:l,maxZoom:c,minZoom:h,maxPitch:f,minPitch:d,normalize:x,position:u},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:b}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){let i,{startRotatePos:n,startBearing:s,startPitch:a}=this.getState();return n&&void 0!==s&&void 0!==a?(i=e?this._getNewRotation(e,n,a,s):{bearing:s+t,pitch:a+r},this._getUpdatedState(i)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:n}=this.getState();if(n||(i=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),o=i+Math.log2(r);o=_d(o,a,s);let l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:n}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(n-t.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}applyConstraints(e){let{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=_d(i,r,t);let{maxPitch:n,minPitch:s,pitch:a}=e;e.pitch=_d(a,s,n);let{normalize:o=!0}=e;return o&&Object.assign(e,function(e){let{width:t,height:r,pitch:i=0}=e,{longitude:n,latitude:s,zoom:a,bearing:o=0}=e;(n<-180||n>180)&&(n=wH(n+180,360)-180),(o<-180||o>180)&&(o=wH(o+180,360)-180);let l=wY(r/512);if(a<=l)a=l,s=0;else{let e=r/2/Math.pow(2,a),t=w4([0,e])[1];if(s<t)s=t;else{let t=w4([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:r,longitude:n,latitude:s,zoom:a,pitch:i,bearing:o}}(e)),e}_zoomFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){let n=e[0]-t[0],s=e[1]-t[1],a=e[1],o=t[1],{width:l,height:u}=this.getViewportProps(),c=0;s>0?Math.abs(u-o)>5&&(c=s/(o-u)*1.2):s<0&&o>5&&(c=1-a/o),c=_d(c,-1,1);let{minPitch:h,maxPitch:f}=this.getViewportProps(),d=r;return c>0?d=r+c*(f-r):c<0&&(d=r-c*(h-r)),{pitch:d,bearing:i+n/l*180}}}class SM extends SS{constructor(){super(...arguments),this.ControllerState=SA,this.transition={transitionDuration:300,transitionInterpolator:new Sg({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),t&&t.height===e.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class ST extends Ss{constructor(e={}){super(e)}getViewportType(){return Sa}get ControllerType(){return SM}}ST.displayName="MapView";let SC=[255,255,255],SO=0;class SI{constructor(e={}){this.type="ambient";const{color:t=SC}=e,{intensity:r=1}=e;this.id=e.id||`ambient-${SO++}`,this.color=t,this.intensity=r}}let SL=[255,255,255],Sj=[0,0,-1],SN=0;class SD{constructor(e={}){this.type="directional";const{color:t=SL}=e,{intensity:r=1}=e,{direction:i=Sj}=e,{_shadow:n=!1}=e;this.id=e.id||`directional-${SN++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new wr(i).normalize().toArray(),this.shadow=n}getProjectedLight(e){return this}}class SR{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Sz extends SR{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,n=e.clearColor??(!!i&&[0,0,0,0]),s=e.colorMask??15,a={viewport:[0,0,t,r]};e.colorMask&&(a.colorMask=s),e.scissorRect&&(a.scissorRect=e.scissorRect);let o=this.device.beginRenderPass({framebuffer:e.target,parameters:a,clearColor:n,clearDepth:!!i&&1,clearStencil:!!i&&0});try{return this._drawLayers(o,e)}finally{o.end(),this.device.submit()}}_drawLayers(e,t){let{target:r,shaderModuleProps:i,viewports:n,views:s,onViewportActive:a,clearStack:o=!0}=t;t.pass=t.pass||"unknown",o&&(this._lastRenderIndex=-1);let l=[];for(let o of n){let n=s&&s[o.id];a?.(o);let u=this._getDrawLayerParams(o,t);for(let s of o.subViewports||[o]){let a=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:s,view:n,pass:t.pass,layers:t.layers},u);l.push(a)}}return l}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:n,cullRect:s,effects:a,shaderModuleProps:o},l=!1){let u=[],c=function e(t=0,r={}){let i={},n=(s,a)=>{let o,l=s.props._offset,u=s.id,c=s.parent&&s.parent.id;if(!c||c in r||n(s.parent,!1),c in i){let t=i[c]=i[c]||e(r[c],r);o=t(s,a),i[u]=t}else Number.isFinite(l)?(o=l+(r[c]||0),i[u]=null):o=t;return a&&o>=t&&(t=o+1),r[u]=o,o};return n}(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:s},f={};for(let i=0;i<t.length;i++){let s=t[i],d=this._shouldDrawLayer(s,h,n,f),p={shouldDrawLayer:d};d&&!l&&(p.shouldDrawLayer=!0,p.layerRenderIndex=c(s,d),p.shaderModuleProps=this._getShaderModuleProps(s,a,r,o),p.layerParameters={...s.context.deck?.props.parameters,...this.getLayerParameters(s,i,e)}),u[i]=p}return u}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:n,viewport:s,view:a},o){let l=function(e,{shaderModuleProps:t,target:r,viewport:i}){let n=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),a=r?r.height:s;return[i.x*n,a-(i.y+i.height)*n,i.width*n,i.height*n]}(this.device,{shaderModuleProps:r,target:n,viewport:s});if(a){let{clear:e,clearColor:t,clearDepth:r,clearStencil:i}=a.props;if(e){let e=[0,0,0,0],s=1,a=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==r&&(s=r),void 0!==i&&(a=i),this.device.beginRenderPass({framebuffer:n,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:s,clearStencil:a}).end()}}let u={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let r=0;r<t.length;r++){let n=t[r],a=o[r],{shouldDrawLayer:l}=a;if(l&&n.props.pickable&&u.pickableCount++,n.isComposite&&u.compositeCount++,n.isDrawable&&a.shouldDrawLayer){let{layerRenderIndex:t,shaderModuleProps:r,layerParameters:o}=a;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),r.project&&(r.project.viewport=s),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:r,uniforms:{layerIndex:t},parameters:o})}catch(e){n.raiseError(e,`drawing ${n} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let n=e.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(t))return!1;t.layer=n,n=n.parent}if(r){let e=t.layer.id;if(e in i||(i[e]=r(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){let n=this.device.canvasContext.cssToDeviceRatio(),s=e.internalState?.propsInTransition||e.props,a={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:n,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(let r of t)SF(a,r.getShaderModuleProps?.(e,a));return SF(a,this.getShaderModuleProps(e,t,a),i)}}function SF(e,...t){for(let r of t)if(r)for(let t in r)e[t]?Object.assign(e[t],r[t]):e[t]=r[t];return e}class SB extends Sz{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],n=i.width*r,s=i.height*r;(n!==t.width||s!==t.height)&&t.resize({width:n,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}let SU={color:[255,255,255],intensity:1},S$=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],SV=[0,0,0,200/255];class SW{constructor(e={}){this.id="lighting-effect",this.shadowColor=SV,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(kd),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){for(let t in this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[],e){let r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:n,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){let r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},n=e.props.material;return{shadow:r,lighting:i,phongMaterial:n,gouraudMaterial:n}}cleanup(e){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(kd))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let r=new wW().lookAt({eye:new wr(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let r=new SB(e);this.shadowPasses[t]=r}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:r}=this;e||0!==t.length||0!==r.length||(this.ambientLight=new SI(SU),this.directionalLights.push(new SD(S$[0]),new SD(S$[1])))}}let SG=new SW;class Sq{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){let r=t.findIndex(t=>(t.order??1/0)-(e.order??1/0)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&!Se(e.effects,this.effects,1)&&this._setEffects(e.effects)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let e of this.effects)t[e.id]=e;let r=[];for(let i of e){let e=t[i.id],n=i;e&&e!==i?e.setProps?(e.setProps(i.props),n=e):e.cleanup(this._context):e||i.setup(this._context),r.push(n),delete t[i.id]}for(let e in t)t[e].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(e=>e instanceof SW)||this._resolvedEffects.push(SG),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class SH extends Sz{shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}let SK={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class SY extends Sz{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,pickingFBO:s,deviceRect:{x:a,y:o,width:l,height:u},cullRect:c,effects:h,pass:f="picking",pickZ:d,shaderModuleProps:p}){this.pickZ=d;let g=this._resetColorEncoder(d),m=super.render({target:s,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,cullRect:c,effects:h?.filter(e=>e.useInPicking),pass:f,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:[a,o,l,u]});return this._colorEncoderState=null,{decodePickingColor:g&&SZ.bind(null,g),stats:m}}shouldDrawLayer(e){let{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){let i={...e.props.parameters},{pickable:n,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:n&&s.includes("draw")&&(Object.assign(i,SK),i.blend=!0,i.blendColor=function(e,t,r){let i,{byLayer:n,byAlpha:s}=e,a=n.get(t);return a?(a.viewports.push(r),i=a.a):(i=n.size+1)<=255?(a={a:i,layer:t,viewports:[r]},n.set(t,a),s[i]=a):(xo.warn("Too many pickable layers, only picking the first 255")(),i=0),[0,0,0,i/255]}(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function SZ(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}class SX{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new SH(e),this.pickLayersPass=new SY(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);let i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);let n=t.render({...r,target:i});r.effects&&(this.lastPostProcessEffect&&(r.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(r.effects,r)),this.renderCount++,kA("deckRenderer.renderLayers",this,n,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){for(let r of(this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{},e))t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[r,i]=t;for(let n of(0===e.length&&[0,1].map(t=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:r,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))}),e))n.resize(t)}_postRender(e,t){let{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(let n of e)if(n.postRender){i.target=n.id===this.lastPostProcessEffect?t.target:void 0;let e=n.postRender(i);i.inputBuffer=e,i.swapBuffer=e===r[0]?r[1]:r[0]}}}let SJ={pickedColor:null,pickedObjectIndex:-1};function SQ({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:s}){let{x:a,y:o,width:l,height:u}=s,c=n*n,h=-1,f=0;for(let t=0;t<u;t++){let n=t+o-i,s=n*n;if(s>c)f+=4*l;else for(let t=0;t<l;t++){if(e[f+3]-1>=0){let e=t+a-r,i=e*e+s;i<=c&&(c=i,h=f)}f+=4}}if(h>=0){let r=e.slice(h,h+4),i=t(r);if(i){let e=Math.floor(h/4/l),t=h/4-e*l;return{...i,pickedColor:r,pickedX:a+t,pickedY:o+e}}xo.error("Picked non-existent layer. Is picking buffer corrupt?")()}return SJ}function S0({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){let n=e.slice(i,i+4),s=n.join(",");if(!r.has(s)){let e=t(n);e?r.set(s,{...e,color:n}):xo.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function S1({pickInfo:e,viewports:t,pixelRatio:r,x:i,y:n,z:s}){let a,o=t[0];if(t.length>1&&(o=function(e,t){for(let r=e.length-1;r>=0;r--){let i=e[r];if(i.containsPixel(t))return i}return e[0]}(e?.pickedViewports||t,{x:i,y:n})),o){let e=[i-o.x,n-o.y];void 0!==s&&(e[2]=s),a=o.unproject(e)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function S2(e){let{pickInfo:t,lastPickedInfo:r,mode:i,layers:n}=e,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,l=a?[a]:[];if("hover"===i){let e=r.index,t=r.layerId,i=a?a.props.id:null;if(i!==t||o!==e){if(i!==t){let e=n.find(e=>e.props.id===t);e&&l.unshift(e)}r.layerId=i,r.index=o,r.info=null}}let u=S1(e),c=new Map;return c.set(null,u),l.forEach(e=>{let t={...u};e===a&&(t.color=s,t.index=o,t.picked=!0);let n=(t=S3({layer:e,info:t,mode:i})).layer;e===a&&"hover"===i&&(r.info=t),c.set(n.id,t),"hover"===i&&n.updateAutoHighlight(t)}),c}function S3({layer:e,info:t,mode:r}){for(;e&&t;){let i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:i}),e=e.parent}return t}class S4{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new SY(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},n=this.lastPickedInfo.info){let s=n&&n.layer&&n.layer.id,a=n&&n.viewport&&n.viewport.id,o=s?r.find(e=>e.id===s):null,l=a&&i.find(e=>e.id===a)||i[0],u=l&&l.unproject([e-l.x,t-l.y]);return{...n,x:e,y:t,viewport:l,coordinate:u,layer:o}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;let t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:r,x:i,y:n,radius:s=0,depth:a=1,mode:o="query",unproject3D:l,onViewportActive:u,effects:c}){let h,f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===r.length)return{result:[],emptyInfo:S1({viewports:r,x:i,y:n,pixelRatio:f})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*f),{width:y,height:v}=this.pickingFBO,b=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:y,deviceHeight:v}),x={x:i-s,y:n-s,width:2*s+1,height:2*s+1},_=[],w=new Set;for(let e=0;e<a;e++){let s,p;if((s=b?SQ({...this._drawAndSample({layers:d,views:t,viewports:r,onViewportActive:u,deviceRect:b,cullRect:x,effects:c,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:b}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[s.pickedLayer],views:t,viewports:r,onViewportActive:u,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:x,effects:c,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(s.pickedLayer&&e+1<a&&(w.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),(h=S2({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:o,layers:d,viewports:r,x:i,y:n,z:p,pixelRatio:f})).values()))t.layer&&_.push(t);if(!s.pickedColor)break}for(let e of w)e.restorePickingColors();return{result:_,emptyInfo:h.get(null)}}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:n,radius:s=0,depth:a=1,mode:o="query",unproject3D:l,onViewportActive:u,effects:c}){let h,f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===r.length)return{result:[],emptyInfo:S1({viewports:r,x:i,y:n,pixelRatio:f})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*f),{width:y,height:v}=this.pickingFBO,b=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:y,deviceHeight:v}),x={x:i-s,y:n-s,width:2*s+1,height:2*s+1},_=[],w=new Set;for(let e=0;e<a;e++){let s,p;if((s=b?SQ({...this._drawAndSample({layers:d,views:t,viewports:r,onViewportActive:u,deviceRect:b,cullRect:x,effects:c,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:b}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[s.pickedLayer],views:t,viewports:r,onViewportActive:u,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:x,effects:c,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(s.pickedLayer&&e+1<a&&(w.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),(h=S2({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:o,layers:d,viewports:r,x:i,y:n,z:p,pixelRatio:f})).values()))t.layer&&_.push(t);if(!s.pickedColor)break}for(let e of w)e.restorePickingColors();return{result:_,emptyInfo:h.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:r,x:i,y:n,width:s=1,height:a=1,mode:o="query",maxObjects:l=null,onViewportActive:u,effects:c}){let h=this._getPickable(e);if(!h||0===r.length)return[];this._resizeBuffer();let f=this.device.canvasContext.cssToDeviceRatio(),d=this.device.canvasContext.cssToDevicePixels([i,n],!0),p=d.x,g=d.y+d.height,m=this.device.canvasContext.cssToDevicePixels([i+s,n+a],!0),y=m.x+m.width,v=m.y,b=this._drawAndSample({layers:h,views:t,viewports:r,onViewportActive:u,deviceRect:{x:p,y:v,width:y-p,height:g-v},cullRect:{x:i,y:n,width:s,height:a},effects:c,pass:`picking:${o}`}),x=S0(b),_=new Map,w=[],k=Number.isFinite(l);for(let e=0;e<x.length&&(!k||!(w.length>=l));e++){let t=x[e],r={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:n,pixelRatio:f},s=(r=S3({layer:t.pickedLayer,info:r,mode:o})).layer.id;_.has(s)||_.set(s,new Set);let a=_.get(s),l=r.object??r.index;a.has(l)||(a.add(l),w.push(r))}return w}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:n,width:s=1,height:a=1,mode:o="query",maxObjects:l=null,onViewportActive:u,effects:c}){let h=this._getPickable(e);if(!h||0===r.length)return[];this._resizeBuffer();let f=this.device.canvasContext.cssToDeviceRatio(),d=this.device.canvasContext.cssToDevicePixels([i,n],!0),p=d.x,g=d.y+d.height,m=this.device.canvasContext.cssToDevicePixels([i+s,n+a],!0),y=m.x+m.width,v=m.y,b=this._drawAndSample({layers:h,views:t,viewports:r,onViewportActive:u,deviceRect:{x:p,y:v,width:y-p,height:g-v},cullRect:{x:i,y:n,width:s,height:a},effects:c,pass:`picking:${o}`}),x=S0(b),_=new Map,w=[],k=Number.isFinite(l);for(let e=0;e<x.length&&(!k||!(w.length>=l));e++){let t=x[e],r={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:n,pixelRatio:f},s=(r=S3({layer:t.pickedLayer,info:r,mode:o})).layer.id;_.has(s)||_.set(s,new Set);let a=_.get(s),l=r.object??r.index;a.has(l)||(a.add(l),w.push(r))}return w}async _drawAndSampleAsync({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:n,cullRect:s,effects:a,pass:o},l=!1){let u=l?this.depthFBO:this.pickingFBO,c={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:n,cullRect:s,effects:a,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of a)e.useInPicking&&(c.preRenderStats[e.id]=e.preRender(c));let{decodePickingColor:h}=this.pickLayersPass.render(c),{x:f,y:d,width:p,height:g}=n,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:f,sourceY:d,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:n,cullRect:s,effects:a,pass:o},l=!1){let u=l?this.depthFBO:this.pickingFBO,c={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:n,cullRect:s,effects:a,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of a)e.useInPicking&&(c.preRenderStats[e.id]=e.preRender(c));let{decodePickingColor:h}=this.pickLayersPass.render(c),{x:f,y:d,width:p,height:g}=n,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:f,sourceY:d,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:n}){let s=Math.max(0,e-r),a=Math.max(0,t-r),o=Math.min(i,e+r+1)-s,l=Math.min(n,t+r+1)-a;return o<=0||l<=0?null:{x:s,y:a,width:o,height:l}}}let S6={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},S5="__root";class S8{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!Se(e.widgets,this.widgets,1)){let t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(let e of this.getWidgets())this._removeWidget(e);for(let e in this.defaultWidgets.length=0,this.resolvedWidgets.length=0,this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){let r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(let i of this.getWidgets()){let{viewId:n}=i;if(n){let e=r[n];e&&(i.onViewportChange&&i.onViewportChange(e),i.onRedraw?.({viewports:[e],layers:t}))}else{if(i.onViewportChange)for(let t of e)i.onViewportChange(t);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(let r of this.getWidgets()){let{viewId:i}=r;i&&i!==e.viewport?.id||r.onHover?.(e,t)}}onEvent(e,t){let r=x0[t.type];if(r)for(let i of this.getWidgets()){let{viewId:n}=i;n&&n!==e.viewport?.id||i[r]?.(e,t)}}_setWidgets(e){let t={};for(let e of this.resolvedWidgets)t[e.id]=e;for(let e of(this.resolvedWidgets.length=0,this.defaultWidgets))t[e.id]=null,this.resolvedWidgets.push(e);for(let r of e){let e=t[r.id];e?e.viewId!==r.viewId||e.placement!==r.placement?(this._removeWidget(e),this._addWidget(r)):r!==e&&(e.setProps(r.props),r=e):this._addWidget(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(let e in t){let r=t[e];r&&this._removeWidget(r)}this.widgets=e}_addWidget(e){let{viewId:t=null,placement:r="top-left"}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,r).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){let r=e||S5,i=this.containers[r];i||((i=document.createElement("div")).style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let n=i.querySelector(`.${t}`);return n||((n=globalThis.document.createElement("div")).className=t,n.style.position="absolute",n.style.zIndex="2",Object.assign(n.style,S6[t]),i.append(n)),n}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let r in this.containers){let i=this.lastViewports[r]||null,n=r===S5||i,s=this.containers[r];n?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}}function S7(e,t){t&&Object.entries(t).map(([t,r])=>{t.startsWith("--")?e.style.setProperty(t,r):e.style[t]=r})}class S9{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){let t=this.props,r=this.rootElement;if(r&&t.className!==e.className&&(t.className&&r.classList.remove(t.className),e.className&&r.classList.add(e.className)),r&&!Se(t.style,e.style,1)){var i;(i=t.style)&&Object.keys(i).map(e=>{e.startsWith("--")?r.style.removeProperty(e):r.style[e]=""}),S7(r,e.style)}Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){let e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),S7(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}S9.defaultProps={id:"widget",style:{},className:""};let Ee={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Et extends S9{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){let e=document.createElement("div");return e.className=this.className,Object.assign(e.style,Ee),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;let i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){let i=this.rootElement;if(i){if("string"==typeof e)i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}Et.defaultProps={...S9.defaultProps};let Er=globalThis.loaders?.parseImageNode,Ei="undefined"!=typeof Image,En="undefined"!=typeof ImageBitmap,Es=!!k6||!!Er,Ea=/^data:image\/svg\+xml/,Eo=/\.svg((\?|#).*)?$/;function El(e){return e&&(Ea.test(e)||Eo.test(e))}function Eu(e,t){if(El(t))throw Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Ec(e,t,r){let i=function(e,t){if(El(t)){let t=new TextDecoder().decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return Eu(e,t)}(e,r),n=self.URL||self.webkitURL,s="string"!=typeof i&&n.createObjectURL(i);try{return await Eh(s||i,t)}finally{s&&n.revokeObjectURL(s)}}async function Eh(e,t){let r=new Image;return(r.src=e,t.image&&t.image.decode&&r.decode)?(await r.decode(),r):await new Promise((e,t)=>{try{r.onload=()=>e(r),r.onerror=e=>{let r=e instanceof Error?e.message:"error";t(Error(r))}}catch(e){t(e)}})}let Ef={},Ed=!0;async function Ep(e,t,r){let i;i=El(r)?await Ec(e,t,r):Eu(e,r);let n=t&&t.imagebitmap;return await Eg(i,n)}async function Eg(e,t=null){if((function(e){for(let t in e||Ef)return!1;return!0}(t)||!Ed)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Ed=!1}return await createImageBitmap(e)}function Em(e){var t,r;let i,n,s,a,o=Ey(e);return((i=Ey(o)).byteLength>=24&&0x89504e47===i.getUint32(0,!1)?{mimeType:"image/png",width:i.getUint32(16,!1),height:i.getUint32(20,!1)}:null)||function(e){let t=Ey(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;let{tableMarkers:r,sofMarkers:i}=function(){let e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=2;for(;n+9<t.byteLength;){let e=t.getUint16(n,!1);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(n+5,!1),width:t.getUint16(n+7,!1)};if(!r.has(e))break;n+=2,n+=t.getUint16(n,!1)}return null}(o)||((n=Ey(o)).byteLength>=10&&0x47494638===n.getUint32(0,!1)?{mimeType:"image/gif",width:n.getUint16(6,!0),height:n.getUint16(8,!0)}:null)||((s=Ey(o)).byteLength>=14&&16973===s.getUint16(0,!1)&&s.getUint32(2,!0)===s.byteLength?{mimeType:"image/bmp",width:s.getUint32(18,!0),height:s.getUint32(22,!0)}:null)||((a=!function(e,t,r=0){let i=[...t].map(e=>e.charCodeAt(0));for(let t=0;t<i.length;++t)if(i[t]!==e[t+r])return!1;return!0}(r=new Uint8Array((t=o)instanceof DataView?t.buffer:t),"ftyp",4)||(96&r[8])==0?null:function(e){switch(String.fromCharCode(...e.slice(8,12)).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(r))?{mimeType:a.mimeType,width:0,height:0}:null)}function Ey(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw Error("toDataView")}async function Ev(e,t){let{mimeType:r}=Em(e)||{},i=globalThis.loaders?.parseImageNode;return kN(i),await i(e,r)}let Eb={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function e(e,t,r){let i,n=((t=t||{}).image||{}).type||"auto",{url:s}=r||{};switch(function(e){switch(e){case"auto":case"data":if(En)return"imagebitmap";if(Ei)return"image";if(Es)return"data";throw Error("Install '@loaders.gl/polyfills' to parse images under Node.js");default:return!function(e){switch(e){case"auto":return En;case"imagebitmap":case"image":case"data":return;default:throw Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":i=await Ep(e,t,s);break;case"image":i=await Ec(e,t,s);break;case"data":i=await Ev(e,t);break;default:kN(!1)}return"data"===n&&(i=function(e){switch(function(e){var t;let r=(t=e,"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null);if(!r)throw Error("Not an image");return r}(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw Error("getImageData")}}(i)),i},tests:[e=>!!Em(new DataView(e))],options:{image:{type:"auto",decode:!0}}},Ex={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){let t=e[0],r=e[e.length-1];return"{"===t&&"}"===r||"["===t&&"]"===r},parseTextSync:JSON.parse},E_=function(){let e="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);if(!t){xo.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:xo,_registerLoggers:kE};var r=[Ex,[Eb,{imagebitmap:{premultiplyAlpha:"none"}}]];let t=PD();for(let e of r=Array.isArray(r)?r:[r]){let r=kR(e);t.find(e=>r===e)||t.unshift(r)}}return e}();var Ew=e.i(9900),Ek=e.i(4819);let EP="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class ES{static defaultProps={...Ew.Device.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=Ek.lumaStats;log=vO.log;VERSION="9.2.3";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw vO.log.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),vO.log.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),Error("luma.gl - multiple versions detected: see console log");vO.log.error("This version of luma.gl has already been initialized")()}vO.log.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(e={}){let t={...ES.defaultProps,...e},r=this.selectAdapter(t.type,t.adapters);if(!r)throw Error(EP);return t.waitForPageLoad&&await r.pageLoaded,await r.create(t)}async attachDevice(e,t){let r=this._getTypeFromHandle(e,t.adapters),i=r&&this.selectAdapter(r,t.adapters);if(!i)throw Error(EP);return await i?.attach?.(e,t)}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){return Array.from(this._getAdapterMap(e)).map(([,e])=>e).filter(e=>e.isSupported?.()).map(e=>e.type)}getBestAvailableAdapterType(e=[]){let t=this._getAdapterMap(e);for(let e of["webgpu","webgl","null"])if(t.get(e)?.isSupported?.())return e;return null}selectAdapter(e,t=[]){let r=e;"best-available"===e&&(r=this.getBestAvailableAdapterType(t));let i=this._getAdapterMap(t);return r&&i.get(r)||null}enforceWebGL2(e=!0,t=[]){let r=this._getAdapterMap(t).get("webgl");r||vO.log.warn("enforceWebGL2: webgl adapter not found")(),r?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(ES.defaultProps,e)}_getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let r of e)t.set(r.type,r);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||e?.queue?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?vO.log.warn("WebGL1 is not supported",e)():vO.log.warn("Unknown handle type",e)(),null)}}let EE=new ES;var EA=e.i(40021);class EM{get pageLoaded(){return EC||(EC=ET&&"complete"===document.readyState||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),EC}}let ET=(0,EA.isBrowser)()&&"undefined"!=typeof document,EC=null,EO={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}};var EI=e.i(31934),EL=e.i(7784);let Ej=new class extends EM{type="webgl";constructor(){super(),Ew.Device.defaultProps={...Ew.Device.defaultProps,...EI.DEFAULT_SPECTOR_PROPS}}enforceWebGL2(e){!function(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){let e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");let t={...EO,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:{drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067},OES_vertex_array_object:{VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)},ANGLE_instanced_arrays:{VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)}},r=e.getExtension;e.getExtension=function(i){let n=r.call(e,i);return n||(i in t?t[i]:null)};let i=e.getSupportedExtensions;e.getSupportedExtensions=function(){let r=i.apply(e)||[];return r?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return!!("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&vO.log.warn("WebGL1 is not supported",e)(),!1)}async attach(t,r={}){var i;let{WebGLDevice:n}=await e.A(76084);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(i=t,!("undefined"!=typeof WebGL2RenderingContext&&i instanceof WebGL2RenderingContext||i&&Number.isFinite(i._version)))throw Error("Invalid WebGL2RenderingContext");let s=!0===r.createCanvasContext?{}:r.createCanvasContext;return new n({...r,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...s}})}async create(t={}){let{WebGLDevice:r}=await e.A(76084);vO.log.groupCollapsed(1,"WebGLDevice created")();try{let e=[];for(let r of((t.debugWebGL||t.debug)&&e.push((0,EL.loadWebGLDeveloperTools)()),t.debugSpectorJS&&e.push((0,EI.loadSpectorJS)(t)),await Promise.allSettled(e)))"rejected"===r.status&&vO.log.error(`Failed to initialize debug libraries ${r.reason}`)();let i=new r(t),n=`\
${i._reused?"Reusing":"Created"} device with WebGL2 ${i.props.debug?"debug ":""}context: \
${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return vO.log.probe(1,n)(),vO.log.table(1,i.info)(),i}finally{vO.log.groupEnd(1)()}}},EN=0;class ED{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:EE.stats.get(`animation-loop-${EN++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...ED.defaultAnimationLoopProps,...e},!(e=this.props).device)throw Error("No device provided");this.stats=e.stats||new kT.Stats({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;if(this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),!this._running)return null;return!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this}catch(t){let e=t instanceof Error?t:Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){if(this._running){var e;this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60))}}_cancelAnimationFrame(){if(null!==this._animationFrameId){var e;e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null}}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw Error("loop");let t=e?.canvas,r=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:r,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1],r=1,i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function ER(){}let Ez={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ER,onWebGLInitialized:ER,onResize:ER,onViewStateChange:ER,onInteractionStateChange:ER,onBeforeRender:ER,onAfterRender:ER,onLoad:ER,onError:e=>xo.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class EF{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new kT.Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{let{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;let r=e.offsetCenter;if(!r)return;t.x=r.x,t.y=r.y,t.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{let t=x0[e.type],r=e.offsetCenter;if(!t||!r||!this.layerManager)return;let i=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:i,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:s}=n,a=s&&(s[t]||s.props[t]),o=this.props[t],l=!1;a&&(l=a.call(s,n,e)),l||(o?.(n,e),this.widgetManager.onEvent(n,e))},this._onPointerDown=e=>{if(this.device?.type==="webgpu")return;let t=e.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...Ez,...e},(e=this.props).viewState&&e.initialViewState&&xo.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&xo.error("WebGL1 context not supported.")(),t=Ej.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&PX.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&xo.removed("onLayerHover","onHover")(),"onLayerClick"in e&&xo.removed("onLayerClick","onClick")(),e.initialViewState&&!Se(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),xo.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),void 0!==e.useDevicePixels&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;let t=this.device.canvasContext.canvas,r={target:t,contentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],devicePixelContentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],borderBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}]};this.device.canvasContext._handleResize([r])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t||r||i||n||s}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});(t=e||t)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return Sh(this.viewManager),this.viewManager.views}getViewports(e){return Sh(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){Sh(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();let n=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),n}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&Sh(t=document.getElementById(t)),t||((t=document.createElement("canvas")).id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:r}=e;if(t||0===t){let e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(r||0===r){let t=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){let{gl:r,onError:i}=t;return new ED({device:e,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){let t=this.props.deviceProps?.createCanvasContext,r={adapters:[],...e.deviceProps};r.adapters.includes(Ej)||r.adapters.push(Ej);let i={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return EE.createDevice({_reuseDevices:!0,type:"webgl",...r,createCanvasContext:{...i,..."object"==typeof t?t:void 0,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new ST({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,n=!1;for(let r of t)i=r,n=r.layer?.onHover(r,e.event)||n;n||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);let t=new vi;for(let e in t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new xZ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(x1).map(e=>{let[t,r,i,n]=x1[e],s=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...r,...s,event:e}),recognizeWith:i,requestFailure:n}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),x0)this.eventManager.on(e,this._onEvent);this.viewManager=new St({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let r=this.viewManager.getViewports()[0];this.layerManager=new P9(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new Sq({deck:this,device:this.device}),this.deckRenderer=new SX(this.device),this.deckPicker=new S4(this.device),this.widgetManager=new S8({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Et),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});let n={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(n),"screen"===n.pass&&this.widgetManager.onRedraw({viewports:n.viewports,layers:n.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),xo.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},!this.props.viewState&&this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let r=EE.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}EF.defaultProps=Ez,EF.VERSION=E_;let EB="undefined"!=typeof window?Q.useLayoutEffect:Q.useEffect;function EU(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}var E$=e.i(6145),EV=e.i(95002),EW=e.i(44135);let EG=EW.getDataType;function Eq(e,t,r){let i="webgpu"===r&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function EH(e){return e.stride||e.size*e.bytesPerElement}function EK(e,t){t.offset&&xo.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=EH(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*r+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:r}}class EY{constructor(e,t,r){let i;this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,s="float64"===n;let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||Array(this.size).fill(0),i=s?"float32":!n&&t.isIndexed?"uint32":n||"float32";let o=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return(0,EW.getTypedArrayConstructor)(e)}}(n||i);this.doublePrecision=s,s&&!1===t.fp64&&(o=Float32Array),this.value=null,this.settings={...t,defaultType:o,defaultValue:a,logicalType:n,type:i,normalized:i.includes("norm"),size:this.size,bytesPerElement:o.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*EH(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),PX.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let r={};if(this.state.constant){let i=this.value;if(t){let n=EK(this.getAccessor(),t),s=n.offset/i.BYTES_PER_ELEMENT,a=n.size||this.size;r[e]=i.subarray(s,s+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){let r=this.getAccessor(),i=[],n={name:this.id,byteStride:EH(r),attributes:i};if(this.doublePrecision){let n,s={high:n=EK(r,t||{}),low:{...n,offset:n.offset+4*r.size}};i.push(Eq(e,{...r,...s.high},this.device.type),Eq(`${e}64Low`,{...r,...s.low},this.device.type))}else if(t){let n=EK(r,t);i.push(Eq(e,{...r,...n},this.device.type))}else i.push(Eq(e,r,this.device.type));return n}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:r,size:i}=this,n=r*i;if(t&&n&&t.length>=n){let r=Array(i).fill(1/0),s=Array(i).fill(-1/0);for(let e=0;e<n;)for(let n=0;n<i;n++){let i=t[e++];i<r[n]&&(r[n]=i),i>s[n]&&(s[n]=i)}e=[r,s]}}return this.state.bounds=e,e}setData(e){let t,{state:r}=this;t=ArrayBuffer.isView(e)?{value:e}:e instanceof E$.Buffer?{buffer:e}:e;let i={...this.settings,...t};if(ArrayBuffer.isView(t.value)){if(!t.type)if(this.doublePrecision&&t.value instanceof Float64Array)i.type="float32";else{let e=EG(t.value);i.type=i.normalized?e.replace("int","norm"):e}i.bytesPerElement=t.value.BYTES_PER_ELEMENT,i.stride=EH(i)}if(r.bounds=null,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),!(!r.constant||!this._areValuesEqual(e,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(t.buffer)r.externalBuffer=t.buffer,r.constant=!1,this.value=t.value||null;else if(t.value){this._checkExternalBuffer(t);let e=t.value;r.externalBuffer=null,r.constant=!1,this.value=e;let{buffer:n}=this,s=EH(i),a=(i.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=P1(e,i)),this.settings.isIndexed){let t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}let o=e.byteLength+a+2*s;(!n||n.byteLength<o)&&(n=this._createBuffer(o)),n.write(e,a)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?P1(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:r}=this,i=r.allocatedValue,n=PX.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=n;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<n.byteLength+s)&&(a=this._createBuffer(n.byteLength+s),t&&i&&a.write(i instanceof Float64Array?P1(i,this):i,s)),r.allocatedValue=n,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw Error(`Attribute ${this.id} value is not TypedArray`);let r=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof r||!this.settings.normalized||"normalized"in e||xo.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,r){let{defaultValue:i,size:n}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let e=n;for(;--e>=0;)t[r+e]=i[e];return t}switch(n){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=n;for(;--s>=0;)t[r+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?E$.Buffer.INDEX:E$.Buffer.VERTEX)|E$.Buffer.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}let EZ=[],EX=[];function EJ(e,t=0,r=1/0){let i=EZ,n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(EX.length=e.length,i=EX):i=EZ,(t>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),n.index=t-1),{iterable:i,objectInfo:n}}function EQ(e){return e&&e[Symbol.asyncIterator]}function E0(e,t){let{size:r,stride:i,offset:n,startIndices:s,nested:a}=t,o=e.BYTES_PER_ELEMENT,l=i?i/o:r,u=n?n/o:0,c=Math.floor((e.length-u)/l);return(t,{index:i,target:n})=>{let o;if(!s){let t=i*l+u;for(let i=0;i<r;i++)n[i]=e[t+i];return n}let h=s[i],f=s[i+1]||c;if(a){o=Array(f-h);for(let t=h;t<f;t++){let i=t*l+u;n=Array(r);for(let t=0;t<r;t++)n[t]=e[i+t];o[t-h]=n}}else if(l===r)o=e.subarray(h*r+u,f*r+u);else{o=new e.constructor((f-h)*r);let t=0;for(let i=h;i<f;i++){let n=i*l+u;for(let i=0;i<r;i++)o[t++]=e[n+i]}}return o}}let E1=[],E2=[[0,1/0]],E3={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function E4(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...E3[r],...t,...e,type:r}}class E6 extends EY{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:E2}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,r;(t=this.state).layoutChanged||(r=this.getAccessor(),t.layoutChanged=e.type!==r.type||e.size!==r.size||EH(e)!==EH(r)||(e.offset||0)!==(r.offset||0)),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,r=this.settings.transition;return E4(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:e=0,endRow:r=1/0}=t;this.state.updateRanges=function(e,t){if(e===E2||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],i=e.length,n=0;for(let s=0;s<i;s++){let i=e[s];i[1]<t[0]?(r.push(i),n=s+1):i[0]>t[1]?r.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return r.splice(n,0,t),r}(this.state.updateRanges,[e,r])}else this.state.updateRanges=E2}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=E1}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:r}=this;return!r.noAlloc&&!!r.update&&(super.allocate(e,t.updateRanges!==E2),!0)}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:n},settings:{update:s,noAlloc:a}}=this,o=!0;if(s){for(let[a,o]of n)s.call(i,this,{data:t,startRow:a,endRow:o,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[t,r]of n){let i=Number.isFinite(t)?this.getVertexOffset(t):0,n=Number.isFinite(r)?this.getVertexOffset(r):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:n})}this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e,t){let r="webgpu"===this.device.type;if(r||void 0===t||"function"==typeof t){if(r&&"function"!=typeof t){let e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}let i=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e),!0)):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let n=e;Sh(ArrayBuffer.isView(n.value),`invalid ${i.accessor}`);let s=!!n.size&&n.size!==this.size;return r.binaryAccessor=E0(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if("dynamic"===i?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(let e in t){let i=super._getBufferLayout(e,t[e]);r.attributes.push(...i.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:n,numInstances:s}){if(e.constant&&"webgpu"!==this.context.device.type)return;let{settings:a,state:o,value:l,size:u,startIndices:c}=e,{accessor:h,transform:f}=a,d=o.binaryAccessor||("function"==typeof h?h:n[h]);"function"!=typeof d&&"string"==typeof h&&(d=()=>n[h]),Sh("function"==typeof d,`accessor "${h}" is not a function`);let p=e.getVertexOffset(r),{iterable:g,objectInfo:m}=EJ(t,r,i);for(let t of g){m.index++;let r=d(t,m);if(f&&(r=f.call(this,r)),c){let t=(m.index<c.length-1?c[m.index+1]:s)-c[m.index];if(r&&Array.isArray(r[0])){let t=p;for(let i of r)e._normalizeValue(i,l,t),t+=u}else r&&r.length>u?l.set(r,p):(e._normalizeValue(r,m.target,0),function({target:e,source:t,start:r=0,count:i=1}){let n=t.length,s=i*n,a=0;for(let i=r;a<n;a++)e[i++]=t[a];for(;a<s;)a<s-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+s-a),a=s)}({target:l,source:m.target,start:p,count:t}));p+=t*u}else e._normalizeValue(r,l,p),p+=u}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw Error(`Illegal attribute generated for ${this.id}`)}}}let E5=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,E8=`#version 300 es
${E5}`;var E7=e.i(25458),E9=e.i(96204),Ae=e.i(88396),At=e.i(49494);function Ar(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:ArrayBuffer.isView(e)&&!(e instanceof DataView)}class Ai{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(t=>"uniform"===t.type&&t.name===e?.name);if(!t)throw Error(e?.name);for(const e of t.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(let[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){!function(e,t,r=16){if(e!==t||!Ar(e))return!1;if(Ar(t)&&e.length===t.length){for(let r=0;r<e.length;++r)if(t[r]!==e[r])return!1}return!0}(this.uniforms[e],t)&&(this.uniforms[e]=Ar(t)?t.slice():t,this.modifiedUniforms[e]=!0,this.modified=!0)}}var An=e.i(72288),As=e.i(53746);class Aa{layout={};byteLength;constructor(e,t={}){let r=0;for(const[i,n]of Object.entries(e)){const{type:e,components:s}=(0,An.getVariableShaderTypeInfo)(n),a=s*(t?.[i]??1),o=r=(0,EW.alignTo)(r,a);r+=a,this.layout[i]={type:e,size:a,offset:o}}const i=4*(r+=(4-r%4)%4);this.byteLength=Math.max(i,1024)}getData(e){let t=(0,As.getScratchArrayBuffer)(this.byteLength),r={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(let[t,i]of Object.entries(e)){let e=this.layout[t];if(!e){vO.log.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}let{type:n,size:s,offset:a}=e,o=r[n];if(1===s){if("number"!=typeof i&&"boolean"!=typeof i){vO.log.warn(`Supplied value for single component uniform ${t} is not a number: ${i}`)();continue}o[a]=Number(i)}else{if(!Ar(i)){vO.log.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${i}`)();continue}o.set(i,a)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}class Ao{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,r]of Object.entries(e)){const e=new Aa(r.uniformTypes??{},r.uniformSizes??{});this.uniformBufferLayouts.set(t,e);const i=new Ai({name:t});i.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(t,i)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);let i=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:E$.Buffer.UNIFORM|E$.Buffer.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return n.write(s),n}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:E$.Buffer.UNIFORM|E$.Buffer.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let r=this.updateUniformBuffer(t);e||=r}return e&&vO.log.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||=t.needsRedraw;let n=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(n);let s=this.uniformBlocks.get(e)?.getAllUniforms();vO.log.log(4,`Writing to uniform buffer ${String(e)}`,n,s)()}return i}}var Al=e.i(65880);class Au{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Ac{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ah extends Au{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Af extends Au{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Ad extends Au{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ap extends Au{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}(A=H||(H={}))[A.Uniform=0]="Uniform",A[A.Storage=1]="Storage",A[A.Texture=2]="Texture",A[A.Sampler=3]="Sampler",A[A.StorageTexture=4]="StorageTexture";class Ag{constructor(e,t,r,i,n,s,a){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=n,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Am{constructor(e,t){this.name=e,this.type=t}}class Ay{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class Av{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class Ab{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class Ax{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class A_{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class Aw{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let Ak=new Float32Array(1),AP=new Int32Array(Ak.buffer),AS=new Uint16Array(1),AE=new Uint32Array(1),AA=new Float32Array(AE.buffer,0,1);function AM(e){return AE[0]=112+(e>>6&31)<<23|(63&e)<<17,AA[0]}function AT(e,t,r,i){let n=[0,0,0,0];for(let s=0;s<i;++s)switch(r){case"8unorm":n[s]=e[t]/255,t++;break;case"8snorm":n[s]=e[t]/255*2-1,t++;break;case"8uint":n[s]=e[t],t++;break;case"8sint":n[s]=e[t]-127,t++;break;case"16uint":n[s]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":n[s]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":n[s]=function(e){var t=(32768&e)>>15,r=(31744&e)>>10,i=1023&e;return 0==r?(t?-1:1)*6103515625e-14*(i/1024):31==r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/1024)}(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":n[s]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":n[s]=new Float32Array(e.buffer,t,1)[0],t+=4}return n}function AC(e,t,r,i,n){for(let s=0;s<i;++s)switch(r){case"8unorm":e[t]=255*n[s],t++;break;case"8snorm":e[t]=.5*(n[s]+1)*255,t++;break;case"8uint":e[t]=n[s],t++;break;case"8sint":e[t]=n[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=n[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=n[s],t+=2;break;case"16float":{let r=function(e){Ak[0]=e;let t=AP[0],r=t>>31&1,i=t>>23&255,n=8388607&t;if(255===i)return AS[0]=r<<15|31744|512*(0!==n),AS[0];if(0===i){if(0===n)return AS[0]=r<<15,AS[0];n|=8388608;let e=113;for(;!(8388608&n);)n<<=1,e--;return n&=8388607,(i=127-e)>0?(n=(n>>126-i)+(n>>127-i&1),AS[0]=r<<15|i<<10|n>>13):AS[0]=r<<15,AS[0]}return(i=i-127+15)>=31?AS[0]=r<<15|31744:i<=0?i<-10?AS[0]=r<<15:(n=(8388608|n)>>1-i,AS[0]=r<<15|n>>13):(n>>=13,AS[0]=r<<15|i<<10|n),AS[0]}(n[s]);new Uint16Array(e.buffer,t,1)[0]=r,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=n[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=n[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=n[s],t+=4}return n}let AO={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class AI{constructor(){this.id=AI._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){for(let r of(t(AL.instance),e))r instanceof Array?this.searchBlock(r,t):r.search(t);t(Aj.instance)}}constEvaluate(e,t){throw Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}AI._id=0;class AL extends AI{}AL.instance=new AL;class Aj extends AI{}Aj.instance=new Aj;let AN=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class AD extends AI{constructor(){super()}}class AR extends AD{constructor(e,t,r,i,n,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=n,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(let t of this.attributes)e(t);for(let t of(e(this),this.args))e(t);this.searchBlock(this.body,e)}}class Az extends AD{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class AF extends AD{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class AB extends AD{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class AU extends AD{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;null==(t=this.init)||t.search(e),null==(r=this.condition)||r.search(e),null==(i=this.increment)||i.search(e),this.searchBlock(this.body,e)}}class A$ extends AD{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"var"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class AV extends AD{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;null==(t=this.value)||t.search(e)}}class AW extends AD{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"let"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class AG extends AD{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}(M=K||(K={})).increment="++",M.decrement="--",(T=K||(K={})).parse=function(e){if("parse"==e)throw Error("Invalid value for IncrementOperator");return T[e]};class Aq extends AD{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(C=Y||(Y={})).assign="=",C.addAssign="+=",C.subtractAssin="-=",C.multiplyAssign="*=",C.divideAssign="/=",C.moduloAssign="%=",C.andAssign="&=",C.orAssign="|=",C.xorAssign="^=",C.shiftLeftAssign="<<=",C.shiftRightAssign=">>=",(Y||(Y={})).parse=function(e){if("parse"==e)throw Error("Invalid value for AssignOperator");return e};class AH extends AD{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class AK extends AD{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return AN.has(this.name)}search(e){for(let t of this.args)t.search(e);e(this)}}class AY extends AD{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null==(t=this.continuing)||t.search(e)}}class AZ extends AD{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){for(let t of(e(this),this.cases))t.search(e)}}class AX extends AD{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class AJ extends AD{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null==(t=this.value)||t.search(e)}}class AQ extends AD{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class A0 extends AD{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class A1 extends AD{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class A2 extends AD{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class A3 extends AD{constructor(){super()}get astNodeType(){return"discard"}}class A4 extends AD{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class A6 extends AD{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class A5 extends AD{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let r=1;r<e.length;++r){let i=A5._priority.get(t.name);A5._priority.get(e[r].name)<i&&(t=e[r])}return"x32"===t.name?A5.i32:t}getTypeName(){return this.name}}A5.x32=new A5("x32"),A5.f32=new A5("f32"),A5.i32=new A5("i32"),A5.u32=new A5("u32"),A5.f16=new A5("f16"),A5.bool=new A5("bool"),A5.void=new A5("void"),A5._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class A8 extends A5{constructor(e){super(e)}}class A7 extends A5{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return -1}search(e){for(let t of this.members)e(t)}}class A9 extends A5{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}A9.vec2f=new A9("vec2",A5.f32,null),A9.vec3f=new A9("vec3",A5.f32,null),A9.vec4f=new A9("vec4",A5.f32,null),A9.vec2i=new A9("vec2",A5.i32,null),A9.vec3i=new A9("vec3",A5.i32,null),A9.vec4i=new A9("vec4",A5.i32,null),A9.vec2u=new A9("vec2",A5.u32,null),A9.vec3u=new A9("vec3",A5.u32,null),A9.vec4u=new A9("vec4",A5.u32,null),A9.vec2h=new A9("vec2",A5.f16,null),A9.vec3h=new A9("vec3",A5.f16,null),A9.vec4h=new A9("vec4",A5.f16,null),A9.vec2b=new A9("vec2",A5.bool,null),A9.vec3b=new A9("vec3",A5.bool,null),A9.vec4b=new A9("vec4",A5.bool,null),A9.mat2x2f=new A9("mat2x2",A5.f32,null),A9.mat2x3f=new A9("mat2x3",A5.f32,null),A9.mat2x4f=new A9("mat2x4",A5.f32,null),A9.mat3x2f=new A9("mat3x2",A5.f32,null),A9.mat3x3f=new A9("mat3x3",A5.f32,null),A9.mat3x4f=new A9("mat3x4",A5.f32,null),A9.mat4x2f=new A9("mat4x2",A5.f32,null),A9.mat4x3f=new A9("mat4x3",A5.f32,null),A9.mat4x4f=new A9("mat4x4",A5.f32,null),A9.mat2x2h=new A9("mat2x2",A5.f16,null),A9.mat2x3h=new A9("mat2x3",A5.f16,null),A9.mat2x4h=new A9("mat2x4",A5.f16,null),A9.mat3x2h=new A9("mat3x2",A5.f16,null),A9.mat3x3h=new A9("mat3x3",A5.f16,null),A9.mat3x4h=new A9("mat3x4",A5.f16,null),A9.mat4x2h=new A9("mat4x2",A5.f16,null),A9.mat4x3h=new A9("mat4x3",A5.f16,null),A9.mat4x4h=new A9("mat4x4",A5.f16,null),A9.mat2x2i=new A9("mat2x2",A5.i32,null),A9.mat2x3i=new A9("mat2x3",A5.i32,null),A9.mat2x4i=new A9("mat2x4",A5.i32,null),A9.mat3x2i=new A9("mat3x2",A5.i32,null),A9.mat3x3i=new A9("mat3x3",A5.i32,null),A9.mat3x4i=new A9("mat3x4",A5.i32,null),A9.mat4x2i=new A9("mat4x2",A5.i32,null),A9.mat4x3i=new A9("mat4x3",A5.i32,null),A9.mat4x4i=new A9("mat4x4",A5.i32,null),A9.mat2x2u=new A9("mat2x2",A5.u32,null),A9.mat2x3u=new A9("mat2x3",A5.u32,null),A9.mat2x4u=new A9("mat2x4",A5.u32,null),A9.mat3x2u=new A9("mat3x2",A5.u32,null),A9.mat3x3u=new A9("mat3x3",A5.u32,null),A9.mat3x4u=new A9("mat3x4",A5.u32,null),A9.mat4x2u=new A9("mat4x2",A5.u32,null),A9.mat4x3u=new A9("mat4x3",A5.u32,null),A9.mat4x4u=new A9("mat4x4",A5.u32,null);class Me extends A5{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Mt extends A5{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Mr extends A5{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Mi extends AI{constructor(){super(),this.postfix=null}}class Mn extends Mi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Ms extends Mi{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Ma extends Mi{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return AN.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(let t of this.args)t.search(e);e(this)}}class Mo extends Mi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Ml extends Mi{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){let t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Mu extends Mi{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof ME}get isVector(){return this.value instanceof MA||this.value instanceof MM}get scalarValue(){return this.value instanceof ME?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof MA||this.value instanceof MM?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Mc extends Mi{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Mh extends Mi{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Mf extends Mi{constructor(){super()}}class Md extends Mf{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Mp extends Mf{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?A5.f32:"u32"===e.name||"u32"===t.name?A5.u32:A5.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Mg extends AI{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Mm extends Mi{constructor(){super()}get astNodeType(){return"default"}}class My extends Mg{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Mv extends Mg{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Mb extends AI{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class Mx extends AI{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class M_ extends AI{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class Mw extends AI{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Mk{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Mk._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Mk._id=0;class MP extends Mk{constructor(){super(new Au("void",null),null)}toString(){return"void"}}MP.void=new MP;class MS extends Mk{constructor(e){super(new Ad("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class ME extends Mk{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new ME(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ME(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ME(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof ME))return void console.error("SetDataValue: Invalid value",t);let n=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?n=Math.floor(n):"bool"===this.typeInfo.name&&(n=+!!n),this.data[0]=n}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}class MA extends Mk{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new MA(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new MA(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new MA(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof Mn?console.error("TODO: Set vector postfix"):t instanceof MA?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ap)i=this.typeInfo.format||i;else{let t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let n=this;for(;null!==t&&null!==n;){if(t instanceof Mh){let s=t.index,a=-1;if(s instanceof Mu){if(!(s.value instanceof ME))return console.error(`GetSubData: Invalid array index ${s.value}`),null;a=s.value.value}else{let t=e.evalExpression(s,r);if(!(t instanceof ME))return console.error("GetSubData: Unknown index type",s),null;a=t.value}if(a<0||a>=n.data.length)return console.error("GetSubData: Index out of range",a),null;if(n.data instanceof Float32Array)return new ME(new Float32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);if(n.data instanceof Int32Array)return new ME(new Int32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);if(n.data instanceof Uint32Array)return new ME(new Uint32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);throw"GetSubData: Invalid data type"}if(!(t instanceof Mn))return console.error("GetSubData: Unknown postfix",t),null;{let r=t.value.toLowerCase();if(1===r.length){let e=0;if("x"===r||"r"===r)e=0;else if("y"===r||"g"===r)e=1;else if("z"===r||"b"===r)e=2;else{if("w"!==r&&"a"!==r)return console.error(`GetSubData: Unknown member ${r}`),null;e=3}if(this.data instanceof Float32Array)return new ME(new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this);if(this.data instanceof Int32Array)return new ME(new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this);if(this.data instanceof Uint32Array)return new ME(new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this)}let s=[];for(let e of r)"x"===e||"r"===e?s.push(this.data[0]):"y"===e||"g"===e?s.push(this.data[1]):"z"===e||"b"===e?s.push(this.data[2]):"w"===e||"a"===e?s.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);n=function(e,t,r){let i=t.length;return 2===i?"f32"===r?new MA(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===r||"bool"===r?new MA(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===r?new MA(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===r?new MA(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):3===i?"f32"===r?new MA(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===r||"bool"===r?new MA(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===r?new MA(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===r?new MA(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):4===i?"f32"===r?new MA(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===r||"bool"===r?new MA(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===r?new MA(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===r?new MA(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}(e,s,i.name)}t=t.postfix}return n}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class MM extends Mk{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new MM(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof Mn?console.error("TODO: Set matrix postfix"):t instanceof MM?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(null===t)return this;let i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ap)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof Mh){let n,s=t.index,a=-1;if(s instanceof Mu){if(!(s.value instanceof ME))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;a=s.value.value}else{let t=e.evalExpression(s,r);if(!(t instanceof ME))return console.error("GetDataValue: Unknown index type",s),null;a=t.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;let o=i.endsWith("h")?"h":"f";if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)n=new MA(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)n=new MA(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return console.error(`GetDataValue: Unknown type ${i}`),null;n=new MA(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?n.getSubData(e,t.postfix,r):n}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class MT extends Mk{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){return new MT(new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size)).buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(null===t)return void console.log("setDataValue: NULL data.");let n=this.offset,s=this.typeInfo;for(;r;){if(r instanceof Mh)if(s instanceof Af){let t=r.index;if(t instanceof Mu){if(!(t.value instanceof ME))return void console.error(`SetDataValue: Invalid index type ${t.value}`);n+=t.value.value*s.stride}else{let r=e.evalExpression(t,i);if(!(r instanceof ME))return void console.error("SetDataValue: Unknown index type",t);n+=r.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(r instanceof Mn))return void console.error("SetDataValue: Unknown postfix type",r);{let e=r.value;if(s instanceof Ah){let t=!1;for(let r of s.members)if(r.name===e){n+=r.offset,s=r.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(s instanceof Au){let r=s.getTypeName(),i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);i=3}if(!(t instanceof ME))return void console.error("SetDataValue: Invalid value",t);let a=t.value;return"vec2f"===r?void(new Float32Array(this.buffer,n,2)[i]=a):"vec3f"===r?void(new Float32Array(this.buffer,n,3)[i]=a):"vec4f"===r?void(new Float32Array(this.buffer,n,4)[i]=a):"vec2i"===r?void(new Int32Array(this.buffer,n,2)[i]=a):"vec3i"===r?void(new Int32Array(this.buffer,n,3)[i]=a):"vec4i"===r?void(new Int32Array(this.buffer,n,4)[i]=a):"vec2u"===r?void(new Uint32Array(this.buffer,n,2)[i]=a):"vec3u"===r?void(new Uint32Array(this.buffer,n,3)[i]=a):"vec4u"===r?void(new Uint32Array(this.buffer,n,4)[i]=a):void console.error(`SetDataValue: Type ${r} is not a struct`)}}}r=r.postfix}this.setData(e,t,s,n,i)}setData(e,t,r,i,n){let s=r.getTypeName();if("f32"!==s&&"f16"!==s)if("i32"!==s&&"atomic<i32>"!==s&&"x32"!==s)if("u32"!==s&&"atomic<u32>"!==s)if("bool"!==s){if("vec2f"===s||"vec2h"===s){let e=new Float32Array(this.buffer,i,2);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===s||"vec3h"===s){let e=new Float32Array(this.buffer,i,3);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===s||"vec4h"===s){let e=new Float32Array(this.buffer,i,4);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===s){let e=new Int32Array(this.buffer,i,2);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===s){let e=new Int32Array(this.buffer,i,3);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===s){let e=new Int32Array(this.buffer,i,4);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===s){let e=new Uint32Array(this.buffer,i,2);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===s){let e=new Uint32Array(this.buffer,i,3);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===s){let e=new Uint32Array(this.buffer,i,4);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===s){let e=new Uint32Array(this.buffer,i,2);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===s){let e=new Uint32Array(this.buffer,i,3);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===s){let e=new Uint32Array(this.buffer,i,4);return void(t instanceof MA?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===s||"mat2x2h"===s){let e=new Float32Array(this.buffer,i,4);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===s||"mat2x3h"===s){let e=new Float32Array(this.buffer,i,6);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===s||"mat2x4h"===s){let e=new Float32Array(this.buffer,i,8);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===s||"mat3x2h"===s){let e=new Float32Array(this.buffer,i,6);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===s||"mat3x3h"===s){let e=new Float32Array(this.buffer,i,9);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===s||"mat3x4h"===s){let e=new Float32Array(this.buffer,i,12);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===s||"mat4x2h"===s){let e=new Float32Array(this.buffer,i,8);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===s||"mat4x3h"===s){let e=new Float32Array(this.buffer,i,12);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===s||"mat4x4h"===s){let e=new Float32Array(this.buffer,i,16);return void(t instanceof MM?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof MT){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",s,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else t instanceof ME&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof ME&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof ME&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof ME&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,n,s;if(null===t)return this;let a=this.offset,o=this.typeInfo;for(;t;){if(t instanceof Mh){let i=t.index,n=i instanceof Mi?e.evalExpression(i,r):i,s=0;if(n instanceof ME?s=n.value:"number"==typeof n?s=n:console.error("GetDataValue: Invalid index type",i),o instanceof Af)a+=s*o.stride,o=o.format;else{let t=o.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(a+=16*s,o=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${o.getTypeName()} is not an array`)}}else{if(!(t instanceof Mn))return console.error("GetDataValue: Unknown postfix type",t),null;{let r=t.value;if(o instanceof Ah){let e=!1;for(let t of o.members)if(t.name===r){a+=t.offset,o=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${r} not found`),null}else if(o instanceof Au){let t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(r.length>0&&r.length<5){let i="f",n=[];for(let s=0;s<r.length;++s){let o=r[s].toLowerCase(),l=0;if("x"===o||"r"===o)l=0;else if("y"===o||"g"===o)l=1;else if("z"===o||"b"===o)l=2;else{if("w"!==o&&"a"!==o)return console.error(`Unknown member ${r}`),null;l=3}if(1===r.length){if(t.endsWith("f"))return this.buffer.byteLength<a+4*l+4?(console.log("Insufficient buffer data"),null):new ME(new Float32Array(this.buffer,a+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new ME(new Float32Array(this.buffer,a+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new ME(new Int32Array(this.buffer,a+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new ME(new Int32Array(this.buffer,a+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new ME(new Uint32Array(this.buffer,a+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)n.push(new Float32Array(this.buffer,a,2)[l]);else if("vec3f"===t){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let e=new Float32Array(this.buffer,a,3);n.push(e[l])}else if("vec4f"===t)n.push(new Float32Array(this.buffer,a,4)[l]);else if("vec2i"===t)i="i",n.push(new Int32Array(this.buffer,a,2)[l]);else if("vec3i"===t)i="i",n.push(new Int32Array(this.buffer,a,3)[l]);else if("vec4i"===t)i="i",n.push(new Int32Array(this.buffer,a,4)[l]);else if("vec2u"===t){i="u";let e=new Uint32Array(this.buffer,a,2);n.push(e[l])}else"vec3u"===t?(i="u",n.push(new Uint32Array(this.buffer,a,3)[l])):"vec4u"===t&&(i="u",n.push(new Uint32Array(this.buffer,a,4)[l]))}return 2===n.length?o=e.getTypeInfo(`vec2${i}`):3===n.length?o=e.getTypeInfo(`vec3${i}`):4===n.length?o=e.getTypeInfo(`vec4${i}`):console.error(`GetDataValue: Invalid vector length ${n.length}`),new MA(n,o,null)}return console.error(`GetDataValue: Unknown member ${r}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}let l=o.getTypeName();return"f32"===l?new ME(new Float32Array(this.buffer,a,1),o,this):"i32"===l?new ME(new Int32Array(this.buffer,a,1),o,this):"u32"===l?new ME(new Uint32Array(this.buffer,a,1),o,this):"vec2f"===l?new MA(new Float32Array(this.buffer,a,2),o,this):"vec3f"===l?new MA(new Float32Array(this.buffer,a,3),o,this):"vec4f"===l?new MA(new Float32Array(this.buffer,a,4),o,this):"vec2i"===l?new MA(new Int32Array(this.buffer,a,2),o,this):"vec3i"===l?new MA(new Int32Array(this.buffer,a,3),o,this):"vec4i"===l?new MA(new Int32Array(this.buffer,a,4),o,this):"vec2u"===l?new MA(new Uint32Array(this.buffer,a,2),o,this):"vec3u"===l?new MA(new Uint32Array(this.buffer,a,3),o,this):"vec4u"===l?new MA(new Uint32Array(this.buffer,a,4),o,this):o instanceof Ap&&"atomic"===o.name?"u32"===(null==(i=o.format)?void 0:i.name)?new ME(new Uint32Array(this.buffer,a,1)[0],o.format,this):"i32"===(null==(n=o.format)?void 0:n.name)?new ME(new Int32Array(this.buffer,a,1)[0],o.format,this):(console.error(`GetDataValue: Invalid atomic format ${null==(s=o.format)?void 0:s.name}`),null):new MT(this.buffer,o,a,this)}toString(){let e="";if(this.typeInfo instanceof Af)if("f32"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("i32"===this.typeInfo.format.name){let t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("u32"===this.typeInfo.format.name){let t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("vec2f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if("vec3f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if("vec4f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Ah?e+="{...}":e="[...]";return e}}class MC extends Mk{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new MC(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>0?null!=(e=r[0])?e:0:r instanceof Object&&null!=(t=r.width)?t:0}get height(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>1?null!=(e=r[1])?e:0:r instanceof Object&&null!=(t=r.height)?t:0}get depthOrArrayLayers(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>2?null!=(e=r[2])?e:0:r instanceof Object&&null!=(t=r.depthOrArrayLayers)?t:0}get format(){var e;return this.descriptor&&null!=(e=this.descriptor.format)?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!=(e=this.descriptor.sampleCount)?e:1}get mipLevelCount(){var e;return this.descriptor&&null!=(e=this.descriptor.mipLevelCount)?e:1}get dimension(){var e;return this.descriptor&&null!=(e=this.descriptor.dimension)?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){let e=AO[this.format];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=AO[this.format];return!!e&&e.isDepthStencil}getGpuSize(){let e=this.format,t=AO[e],r=this.width;if(!e||r<=0||!t)return -1;let i=this.height,n=this.depthOrArrayLayers,s=this.dimension;return r/t.blockWidth*("1d"===s?1:i/t.blockHeight)*t.bytesPerBlock*n}getPixel(e,t,r=0,i=0){let n=this.texelByteSize,s=this.bytesPerRow,a=this.height;return function(e,t,r,i,n,s,a,o,l){let u=i*(a>>=n)*(s>>=n)+r*a+t*o;switch(l){case"r8unorm":return[AT(e,u,"8unorm",1)[0]];case"r8snorm":return[AT(e,u,"8snorm",1)[0]];case"r8uint":return[AT(e,u,"8uint",1)[0]];case"r8sint":return[AT(e,u,"8sint",1)[0]];case"rg8unorm":{let t=AT(e,u,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{let t=AT(e,u,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{let t=AT(e,u,"8uint",2);return[t[0],t[1]]}case"rg8sint":{let t=AT(e,u,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let t=AT(e,u,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{let t=AT(e,u,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{let t=AT(e,u,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{let t=AT(e,u,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let t=AT(e,u,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[AT(e,u,"16uint",1)[0]];case"r16sint":return[AT(e,u,"16sint",1)[0]];case"r16float":return[AT(e,u,"16float",1)[0]];case"rg16uint":{let t=AT(e,u,"16uint",2);return[t[0],t[1]]}case"rg16sint":{let t=AT(e,u,"16sint",2);return[t[0],t[1]]}case"rg16float":{let t=AT(e,u,"16float",2);return[t[0],t[1]]}case"rgba16uint":{let t=AT(e,u,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{let t=AT(e,u,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{let t=AT(e,u,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[AT(e,u,"32uint",1)[0]];case"r32sint":return[AT(e,u,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[AT(e,u,"32float",1)[0]];case"rg32uint":{let t=AT(e,u,"32uint",2);return[t[0],t[1]]}case"rg32sint":{let t=AT(e,u,"32sint",2);return[t[0],t[1]]}case"rg32float":{let t=AT(e,u,"32float",2);return[t[0],t[1]]}case"rgba32uint":{let t=AT(e,u,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{let t=AT(e,u,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{let t=AT(e,u,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{var c;let t=new Uint32Array(e.buffer,u,1)[0];return[AM(2047&t),AM((4192256&t)>>11),(c=(0xffc00000&t)>>22,AE[0]=112+(c>>5&31)<<23|(31&c)<<18,AA[0]),1]}}return null}(new Uint8Array(this.data[i]),e,t,r,i,a,s,n,this.format)}setPixel(e,t,r,i,n){let s=this.texelByteSize,a=this.bytesPerRow,o=this.height;!function(e,t,r,i,n,s,a,o,l,u){let c=i*(a>>=n)*(s>>=n)+r*a+t*o;switch(l){case"r8unorm":return AC(e,c,"8unorm",1,u);case"r8snorm":return AC(e,c,"8snorm",1,u);case"r8uint":return AC(e,c,"8uint",1,u);case"r8sint":return AC(e,c,"8sint",1,u);case"rg8unorm":return AC(e,c,"8unorm",2,u);case"rg8snorm":return AC(e,c,"8snorm",2,u);case"rg8uint":return AC(e,c,"8uint",2,u);case"rg8sint":return AC(e,c,"8sint",2,u);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return AC(e,c,"8unorm",4,u);case"rgba8snorm":return AC(e,c,"8snorm",4,u);case"rgba8uint":return AC(e,c,"8uint",4,u);case"rgba8sint":return AC(e,c,"8sint",4,u);case"r16uint":return AC(e,c,"16uint",1,u);case"r16sint":return AC(e,c,"16sint",1,u);case"r16float":return AC(e,c,"16float",1,u);case"rg16uint":return AC(e,c,"16uint",2,u);case"rg16sint":return AC(e,c,"16sint",2,u);case"rg16float":return AC(e,c,"16float",2,u);case"rgba16uint":return AC(e,c,"16uint",4,u);case"rgba16sint":return AC(e,c,"16sint",4,u);case"rgba16float":return AC(e,c,"16float",4,u);case"r32uint":return AC(e,c,"32uint",1,u);case"r32sint":return AC(e,c,"32sint",1,u);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return AC(e,c,"32float",1,u);case"rg32uint":return AC(e,c,"32uint",2,u);case"rg32sint":return AC(e,c,"32sint",2,u);case"rg32float":return AC(e,c,"32float",2,u);case"rgba32uint":return AC(e,c,"32uint",4,u);case"rgba32sint":return AC(e,c,"32sint",4,u);case"rgba32float":return AC(e,c,"32float",4,u);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(this.data[i]),e,t,r,i,o,a,s,this.format,n)}}(O=Z||(Z={}))[O.token=0]="token",O[O.keyword=1]="keyword",O[O.reserved=2]="reserved";class MO{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class MI{}MI.none=new MO("",Z.reserved,""),MI.eof=new MO("EOF",Z.token,""),MI.reserved={asm:new MO("asm",Z.reserved,"asm"),bf16:new MO("bf16",Z.reserved,"bf16"),do:new MO("do",Z.reserved,"do"),enum:new MO("enum",Z.reserved,"enum"),f16:new MO("f16",Z.reserved,"f16"),f64:new MO("f64",Z.reserved,"f64"),handle:new MO("handle",Z.reserved,"handle"),i8:new MO("i8",Z.reserved,"i8"),i16:new MO("i16",Z.reserved,"i16"),i64:new MO("i64",Z.reserved,"i64"),mat:new MO("mat",Z.reserved,"mat"),premerge:new MO("premerge",Z.reserved,"premerge"),regardless:new MO("regardless",Z.reserved,"regardless"),typedef:new MO("typedef",Z.reserved,"typedef"),u8:new MO("u8",Z.reserved,"u8"),u16:new MO("u16",Z.reserved,"u16"),u64:new MO("u64",Z.reserved,"u64"),unless:new MO("unless",Z.reserved,"unless"),using:new MO("using",Z.reserved,"using"),vec:new MO("vec",Z.reserved,"vec"),void:new MO("void",Z.reserved,"void")},MI.keywords={array:new MO("array",Z.keyword,"array"),atomic:new MO("atomic",Z.keyword,"atomic"),bool:new MO("bool",Z.keyword,"bool"),f32:new MO("f32",Z.keyword,"f32"),i32:new MO("i32",Z.keyword,"i32"),mat2x2:new MO("mat2x2",Z.keyword,"mat2x2"),mat2x3:new MO("mat2x3",Z.keyword,"mat2x3"),mat2x4:new MO("mat2x4",Z.keyword,"mat2x4"),mat3x2:new MO("mat3x2",Z.keyword,"mat3x2"),mat3x3:new MO("mat3x3",Z.keyword,"mat3x3"),mat3x4:new MO("mat3x4",Z.keyword,"mat3x4"),mat4x2:new MO("mat4x2",Z.keyword,"mat4x2"),mat4x3:new MO("mat4x3",Z.keyword,"mat4x3"),mat4x4:new MO("mat4x4",Z.keyword,"mat4x4"),ptr:new MO("ptr",Z.keyword,"ptr"),sampler:new MO("sampler",Z.keyword,"sampler"),sampler_comparison:new MO("sampler_comparison",Z.keyword,"sampler_comparison"),struct:new MO("struct",Z.keyword,"struct"),texture_1d:new MO("texture_1d",Z.keyword,"texture_1d"),texture_2d:new MO("texture_2d",Z.keyword,"texture_2d"),texture_2d_array:new MO("texture_2d_array",Z.keyword,"texture_2d_array"),texture_3d:new MO("texture_3d",Z.keyword,"texture_3d"),texture_cube:new MO("texture_cube",Z.keyword,"texture_cube"),texture_cube_array:new MO("texture_cube_array",Z.keyword,"texture_cube_array"),texture_multisampled_2d:new MO("texture_multisampled_2d",Z.keyword,"texture_multisampled_2d"),texture_storage_1d:new MO("texture_storage_1d",Z.keyword,"texture_storage_1d"),texture_storage_2d:new MO("texture_storage_2d",Z.keyword,"texture_storage_2d"),texture_storage_2d_array:new MO("texture_storage_2d_array",Z.keyword,"texture_storage_2d_array"),texture_storage_3d:new MO("texture_storage_3d",Z.keyword,"texture_storage_3d"),texture_depth_2d:new MO("texture_depth_2d",Z.keyword,"texture_depth_2d"),texture_depth_2d_array:new MO("texture_depth_2d_array",Z.keyword,"texture_depth_2d_array"),texture_depth_cube:new MO("texture_depth_cube",Z.keyword,"texture_depth_cube"),texture_depth_cube_array:new MO("texture_depth_cube_array",Z.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new MO("texture_depth_multisampled_2d",Z.keyword,"texture_depth_multisampled_2d"),texture_external:new MO("texture_external",Z.keyword,"texture_external"),u32:new MO("u32",Z.keyword,"u32"),vec2:new MO("vec2",Z.keyword,"vec2"),vec3:new MO("vec3",Z.keyword,"vec3"),vec4:new MO("vec4",Z.keyword,"vec4"),bitcast:new MO("bitcast",Z.keyword,"bitcast"),block:new MO("block",Z.keyword,"block"),break:new MO("break",Z.keyword,"break"),case:new MO("case",Z.keyword,"case"),continue:new MO("continue",Z.keyword,"continue"),continuing:new MO("continuing",Z.keyword,"continuing"),default:new MO("default",Z.keyword,"default"),diagnostic:new MO("diagnostic",Z.keyword,"diagnostic"),discard:new MO("discard",Z.keyword,"discard"),else:new MO("else",Z.keyword,"else"),enable:new MO("enable",Z.keyword,"enable"),fallthrough:new MO("fallthrough",Z.keyword,"fallthrough"),false:new MO("false",Z.keyword,"false"),fn:new MO("fn",Z.keyword,"fn"),for:new MO("for",Z.keyword,"for"),function:new MO("function",Z.keyword,"function"),if:new MO("if",Z.keyword,"if"),let:new MO("let",Z.keyword,"let"),const:new MO("const",Z.keyword,"const"),loop:new MO("loop",Z.keyword,"loop"),while:new MO("while",Z.keyword,"while"),private:new MO("private",Z.keyword,"private"),read:new MO("read",Z.keyword,"read"),read_write:new MO("read_write",Z.keyword,"read_write"),return:new MO("return",Z.keyword,"return"),requires:new MO("requires",Z.keyword,"requires"),storage:new MO("storage",Z.keyword,"storage"),switch:new MO("switch",Z.keyword,"switch"),true:new MO("true",Z.keyword,"true"),alias:new MO("alias",Z.keyword,"alias"),type:new MO("type",Z.keyword,"type"),uniform:new MO("uniform",Z.keyword,"uniform"),var:new MO("var",Z.keyword,"var"),override:new MO("override",Z.keyword,"override"),workgroup:new MO("workgroup",Z.keyword,"workgroup"),write:new MO("write",Z.keyword,"write"),r8unorm:new MO("r8unorm",Z.keyword,"r8unorm"),r8snorm:new MO("r8snorm",Z.keyword,"r8snorm"),r8uint:new MO("r8uint",Z.keyword,"r8uint"),r8sint:new MO("r8sint",Z.keyword,"r8sint"),r16uint:new MO("r16uint",Z.keyword,"r16uint"),r16sint:new MO("r16sint",Z.keyword,"r16sint"),r16float:new MO("r16float",Z.keyword,"r16float"),rg8unorm:new MO("rg8unorm",Z.keyword,"rg8unorm"),rg8snorm:new MO("rg8snorm",Z.keyword,"rg8snorm"),rg8uint:new MO("rg8uint",Z.keyword,"rg8uint"),rg8sint:new MO("rg8sint",Z.keyword,"rg8sint"),r32uint:new MO("r32uint",Z.keyword,"r32uint"),r32sint:new MO("r32sint",Z.keyword,"r32sint"),r32float:new MO("r32float",Z.keyword,"r32float"),rg16uint:new MO("rg16uint",Z.keyword,"rg16uint"),rg16sint:new MO("rg16sint",Z.keyword,"rg16sint"),rg16float:new MO("rg16float",Z.keyword,"rg16float"),rgba8unorm:new MO("rgba8unorm",Z.keyword,"rgba8unorm"),rgba8unorm_srgb:new MO("rgba8unorm_srgb",Z.keyword,"rgba8unorm_srgb"),rgba8snorm:new MO("rgba8snorm",Z.keyword,"rgba8snorm"),rgba8uint:new MO("rgba8uint",Z.keyword,"rgba8uint"),rgba8sint:new MO("rgba8sint",Z.keyword,"rgba8sint"),bgra8unorm:new MO("bgra8unorm",Z.keyword,"bgra8unorm"),bgra8unorm_srgb:new MO("bgra8unorm_srgb",Z.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new MO("rgb10a2unorm",Z.keyword,"rgb10a2unorm"),rg11b10float:new MO("rg11b10float",Z.keyword,"rg11b10float"),rg32uint:new MO("rg32uint",Z.keyword,"rg32uint"),rg32sint:new MO("rg32sint",Z.keyword,"rg32sint"),rg32float:new MO("rg32float",Z.keyword,"rg32float"),rgba16uint:new MO("rgba16uint",Z.keyword,"rgba16uint"),rgba16sint:new MO("rgba16sint",Z.keyword,"rgba16sint"),rgba16float:new MO("rgba16float",Z.keyword,"rgba16float"),rgba32uint:new MO("rgba32uint",Z.keyword,"rgba32uint"),rgba32sint:new MO("rgba32sint",Z.keyword,"rgba32sint"),rgba32float:new MO("rgba32float",Z.keyword,"rgba32float"),static_assert:new MO("static_assert",Z.keyword,"static_assert")},MI.tokens={decimal_float_literal:new MO("decimal_float_literal",Z.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new MO("hex_float_literal",Z.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new MO("int_literal",Z.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new MO("uint_literal",Z.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new MO("name",Z.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new MO("ident",Z.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new MO("and",Z.token,"&"),and_and:new MO("and_and",Z.token,"&&"),arrow:new MO("arrow ",Z.token,"->"),attr:new MO("attr",Z.token,"@"),forward_slash:new MO("forward_slash",Z.token,"/"),bang:new MO("bang",Z.token,"!"),bracket_left:new MO("bracket_left",Z.token,"["),bracket_right:new MO("bracket_right",Z.token,"]"),brace_left:new MO("brace_left",Z.token,"{"),brace_right:new MO("brace_right",Z.token,"}"),colon:new MO("colon",Z.token,":"),comma:new MO("comma",Z.token,","),equal:new MO("equal",Z.token,"="),equal_equal:new MO("equal_equal",Z.token,"=="),not_equal:new MO("not_equal",Z.token,"!="),greater_than:new MO("greater_than",Z.token,">"),greater_than_equal:new MO("greater_than_equal",Z.token,">="),shift_right:new MO("shift_right",Z.token,">>"),less_than:new MO("less_than",Z.token,"<"),less_than_equal:new MO("less_than_equal",Z.token,"<="),shift_left:new MO("shift_left",Z.token,"<<"),modulo:new MO("modulo",Z.token,"%"),minus:new MO("minus",Z.token,"-"),minus_minus:new MO("minus_minus",Z.token,"--"),period:new MO("period",Z.token,"."),plus:new MO("plus",Z.token,"+"),plus_plus:new MO("plus_plus",Z.token,"++"),or:new MO("or",Z.token,"|"),or_or:new MO("or_or",Z.token,"||"),paren_left:new MO("paren_left",Z.token,"("),paren_right:new MO("paren_right",Z.token,")"),semicolon:new MO("semicolon",Z.token,";"),star:new MO("star",Z.token,"*"),tilde:new MO("tilde",Z.token,"~"),underscore:new MO("underscore",Z.token,"_"),xor:new MO("xor",Z.token,"^"),plus_equal:new MO("plus_equal",Z.token,"+="),minus_equal:new MO("minus_equal",Z.token,"-="),times_equal:new MO("times_equal",Z.token,"*="),division_equal:new MO("division_equal",Z.token,"/="),modulo_equal:new MO("modulo_equal",Z.token,"%="),and_equal:new MO("and_equal",Z.token,"&="),or_equal:new MO("or_equal",Z.token,"|="),xor_equal:new MO("xor_equal",Z.token,"^="),shift_right_equal:new MO("shift_right_equal",Z.token,">>="),shift_left_equal:new MO("shift_left_equal",Z.token,"<<=")},MI.simpleTokens={"@":MI.tokens.attr,"{":MI.tokens.brace_left,"}":MI.tokens.brace_right,":":MI.tokens.colon,",":MI.tokens.comma,"(":MI.tokens.paren_left,")":MI.tokens.paren_right,";":MI.tokens.semicolon},MI.literalTokens={"&":MI.tokens.and,"&&":MI.tokens.and_and,"->":MI.tokens.arrow,"/":MI.tokens.forward_slash,"!":MI.tokens.bang,"[":MI.tokens.bracket_left,"]":MI.tokens.bracket_right,"=":MI.tokens.equal,"==":MI.tokens.equal_equal,"!=":MI.tokens.not_equal,">":MI.tokens.greater_than,">=":MI.tokens.greater_than_equal,">>":MI.tokens.shift_right,"<":MI.tokens.less_than,"<=":MI.tokens.less_than_equal,"<<":MI.tokens.shift_left,"%":MI.tokens.modulo,"-":MI.tokens.minus,"--":MI.tokens.minus_minus,".":MI.tokens.period,"+":MI.tokens.plus,"++":MI.tokens.plus_plus,"|":MI.tokens.or,"||":MI.tokens.or_or,"*":MI.tokens.star,"~":MI.tokens.tilde,_:MI.tokens.underscore,"^":MI.tokens.xor,"+=":MI.tokens.plus_equal,"-=":MI.tokens.minus_equal,"*=":MI.tokens.times_equal,"/=":MI.tokens.division_equal,"%=":MI.tokens.modulo_equal,"&=":MI.tokens.and_equal,"|=":MI.tokens.or_equal,"^=":MI.tokens.xor_equal,">>=":MI.tokens.shift_right_equal,"<<=":MI.tokens.shift_left_equal},MI.regexTokens={decimal_float_literal:MI.tokens.decimal_float_literal,hex_float_literal:MI.tokens.hex_float_literal,int_literal:MI.tokens.int_literal,uint_literal:MI.tokens.uint_literal,ident:MI.tokens.ident},MI.storage_class=[MI.keywords.function,MI.keywords.private,MI.keywords.workgroup,MI.keywords.uniform,MI.keywords.storage],MI.access_mode=[MI.keywords.read,MI.keywords.write,MI.keywords.read_write],MI.sampler_type=[MI.keywords.sampler,MI.keywords.sampler_comparison],MI.sampled_texture_type=[MI.keywords.texture_1d,MI.keywords.texture_2d,MI.keywords.texture_2d_array,MI.keywords.texture_3d,MI.keywords.texture_cube,MI.keywords.texture_cube_array],MI.multisampled_texture_type=[MI.keywords.texture_multisampled_2d],MI.storage_texture_type=[MI.keywords.texture_storage_1d,MI.keywords.texture_storage_2d,MI.keywords.texture_storage_2d_array,MI.keywords.texture_storage_3d],MI.depth_texture_type=[MI.keywords.texture_depth_2d,MI.keywords.texture_depth_2d_array,MI.keywords.texture_depth_cube,MI.keywords.texture_depth_cube_array,MI.keywords.texture_depth_multisampled_2d],MI.texture_external_type=[MI.keywords.texture_external],MI.any_texture_type=[...MI.sampled_texture_type,...MI.multisampled_texture_type,...MI.storage_texture_type,...MI.depth_texture_type,...MI.texture_external_type],MI.texel_format=[MI.keywords.r8unorm,MI.keywords.r8snorm,MI.keywords.r8uint,MI.keywords.r8sint,MI.keywords.r16uint,MI.keywords.r16sint,MI.keywords.r16float,MI.keywords.rg8unorm,MI.keywords.rg8snorm,MI.keywords.rg8uint,MI.keywords.rg8sint,MI.keywords.r32uint,MI.keywords.r32sint,MI.keywords.r32float,MI.keywords.rg16uint,MI.keywords.rg16sint,MI.keywords.rg16float,MI.keywords.rgba8unorm,MI.keywords.rgba8unorm_srgb,MI.keywords.rgba8snorm,MI.keywords.rgba8uint,MI.keywords.rgba8sint,MI.keywords.bgra8unorm,MI.keywords.bgra8unorm_srgb,MI.keywords.rgb10a2unorm,MI.keywords.rg11b10float,MI.keywords.rg32uint,MI.keywords.rg32sint,MI.keywords.rg32float,MI.keywords.rgba16uint,MI.keywords.rgba16sint,MI.keywords.rgba16float,MI.keywords.rgba32uint,MI.keywords.rgba32sint,MI.keywords.rgba32float],MI.const_literal=[MI.tokens.int_literal,MI.tokens.uint_literal,MI.tokens.decimal_float_literal,MI.tokens.hex_float_literal,MI.keywords.true,MI.keywords.false],MI.literal_or_ident=[MI.tokens.ident,MI.tokens.int_literal,MI.tokens.uint_literal,MI.tokens.decimal_float_literal,MI.tokens.hex_float_literal,MI.tokens.name],MI.element_count_expression=[MI.tokens.int_literal,MI.tokens.uint_literal,MI.tokens.ident],MI.template_types=[MI.keywords.vec2,MI.keywords.vec3,MI.keywords.vec4,MI.keywords.mat2x2,MI.keywords.mat2x3,MI.keywords.mat2x4,MI.keywords.mat3x2,MI.keywords.mat3x3,MI.keywords.mat3x4,MI.keywords.mat4x2,MI.keywords.mat4x3,MI.keywords.mat4x4,MI.keywords.atomic,MI.keywords.bitcast,...MI.any_texture_type],MI.attribute_name=[MI.tokens.ident,MI.keywords.block,MI.keywords.diagnostic],MI.assignment_operators=[MI.tokens.equal,MI.tokens.plus_equal,MI.tokens.minus_equal,MI.tokens.times_equal,MI.tokens.division_equal,MI.tokens.modulo_equal,MI.tokens.and_equal,MI.tokens.or_equal,MI.tokens.xor_equal,MI.tokens.shift_right_equal,MI.tokens.shift_left_equal],MI.increment_operators=[MI.tokens.plus_plus,MI.tokens.minus_minus];class ML{constructor(e,t,r,i,n){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=n}toString(){return this.lexeme}isTemplateType(){return -1!=MI.template_types.indexOf(this.type)}isArrayType(){return this.type==MI.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Mj{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ML(MI.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0&&!this._isAtEnd();)if("\n"==(e=this._advance()))this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),0==--t))break}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++);return!0}}let t=MI.simpleTokens[e];if(t)return this._addToken(t),!0;let r=MI.none,i=this._isAlpha(e),n="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){let t=MI.keywords[e];if(t)return this._addToken(t),!0}if(i||n)return this._addToken(MI.tokens.ident),!0;for(;;){let t=this._findType(e),i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(MI.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(MI.tokens.minus_minus),!0;let r=this._tokens.length-1;if((-1!=MI.literal_or_ident.indexOf(this._tokens[r].type)||this._tokens[r].type==MI.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,r=this._tokens.length-1;for(let t=0;t<5&&r>=0&&-1===MI.assignment_operators.indexOf(this._tokens[r].type);++t,--r)if(this._tokens[r].type===MI.tokens.less_than){r>0&&this._tokens[r-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===MI.none){let i=e,n=0;for(let e=0;e<2;++e)if(i+=this._peekAhead(e),(t=this._findType(i))!==MI.none){n=e;break}if(t===MI.none)return r!==MI.none&&(this._current--,this._addToken(r),!0);e=i,this._current+=n+1}if(r=t,this._isAtEnd())break;e+=this._advance()}return r!==MI.none&&(this._addToken(r),!0)}_findType(e){for(let t in MI.regexTokens){let r=MI.regexTokens[t];if(this._match(e,r.rule))return r}return MI.literalTokens[e]||MI.none}_match(e,t){let r=t.exec(e);return r&&0==r.index&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"	"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"	"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new ML(e,t,this._line,this._start,this._current))}}function MN(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}let MD=new Float32Array(1),MR=new Uint32Array(MD.buffer),Mz=new Uint32Array(MD.buffer),MF=new Int32Array(1),MB=new Float32Array(MF.buffer),MU=new Uint32Array(MF.buffer),M$=new Uint32Array(1),MV=new Float32Array(M$.buffer),MW=new Int32Array(M$.buffer);function MG(e,t,r){if(t===r)return e;if("f32"===t){if("i32"===r||"x32"===r)return MD[0]=e,MR[0];if("u32"===r)return MD[0]=e,Mz[0]}else if("i32"===t||"x32"===t){if("f32"===r)return MF[0]=e,MB[0];if("u32"===r)return MF[0]=e,MU[0]}else if("u32"===t){if("f32"===r)return M$[0]=e,MV[0];if("i32"===r||"x32"===r)return M$[0]=e,MW[0]}return console.error(`Unsupported cast from ${t} to ${r}`),e}class Mq{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class MH{constructor(e,t){this.align=e,this.size=t}}class MK{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Aw,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(let t of e)t instanceof AR&&this._functions.set(t.name,new Mq(t));for(let t of e)if(t instanceof A7){let e=this.getTypeInfo(t,null);e instanceof Ah&&this.structs.push(e)}for(let t of e)if(t instanceof A2)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof AV){let e=this._getAttributeNum(t.attributes,"id",0),r=null!=t.type?this.getTypeInfo(t.type,t.attributes):null;this.overrides.push(new Ab(t.name,r,t.attributes,e));continue}if(this._isUniformVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=new Ag(t.name,i,e,r,t.attributes,H.Uniform,t.access);n.access||(n.access="read"),this.uniforms.push(n);continue}if(this._isStorageVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(i),s=new Ag(t.name,i,e,r,t.attributes,n?H.StorageTexture:H.Storage,t.access);s.access||(s.access="read"),this.storage.push(s);continue}if(this._isTextureVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(i),s=new Ag(t.name,i,e,r,t.attributes,n?H.StorageTexture:H.Texture,t.access);s.access||(s.access="read"),n?this.storage.push(s):this.textures.push(s);continue}if(this._isSamplerVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=new Ag(t.name,i,e,r,t.attributes,H.Sampler,t.access);this.samplers.push(n);continue}}for(let t of e)if(t instanceof AR){let e=this._getAttribute(t,"vertex"),r=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),n=e||r||i,s=new A_(t.name,null==n?void 0:n.name,t.attributes);s.attributes=t.attributes,s.startLine=t.startLine,s.endLine=t.endLine,this.functions.push(s),this._functions.get(t.name).info=s,n&&(this._functions.get(t.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(t,!!n),s.inputs=this._getInputs(t.args),s.outputs=this._getOutputs(t.returnType),this.entry[n.name].push(s)),s.arguments=t.args.map(e=>new Ax(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),s.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(let e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(let e of this._functions.values())e.node.search(t=>{var r,i,n;if(t instanceof Mw){if(t.value)if(MN(t.value))for(let i of t.value)for(let t of this.overrides)i===t.name&&(null==(r=e.info)||r.overrides.push(t));else for(let r of this.overrides)t.value===r.name&&(null==(i=e.info)||i.overrides.push(r))}else if(t instanceof Mo)for(let r of this.overrides)t.name===r.name&&(null==(n=e.info)||n.overrides.push(r))});for(let e of this.uniforms)this._markStructsInUse(e.type);for(let e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(e){for(let t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(let t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(let t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(let i of e.calls){let e=null==(r=this._functions.get(i.name))?void 0:r.info;e&&t.add(e)}}findResource(e,t,r){if(r){for(let i of this.entry.compute)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}for(let i of this.entry.vertex)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}for(let i of this.entry.fragment)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}}for(let r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(let r of this.storage)if(r.group==e&&r.binding==t)return r;for(let r of this.textures)if(r.group==e&&r.binding==t)return r;for(let r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(let t of this.uniforms)if(t.name==e)return t;for(let t of this.storage)if(t.name==e)return t;for(let t of this.textures)if(t.name==e)return t;for(let t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){let t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){let r=[],i=this,n=[];return e.search(s=>{if(s instanceof AL)n.push({});else if(s instanceof Aj)n.pop();else if(s instanceof A$)t&&null!==s.type&&this._markStructsFromAST(s.type),n.length>0&&(n[n.length-1][s.name]=s);else if(s instanceof Ms)t&&null!==s.type&&this._markStructsFromAST(s.type);else if(s instanceof AW)t&&null!==s.type&&this._markStructsFromAST(s.type),n.length>0&&(n[n.length-1][s.name]=s);else if(s instanceof Mo){if(n.length>0&&n[n.length-1][s.name])return;let e=i._findResource(s.name);e&&r.push(e)}else if(s instanceof Ma){let n=i._functions.get(s.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=i._findResources(n.node,t)),r.push(...n.resources))}else if(s instanceof AK){let n=i._functions.get(s.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=i._findResources(n.node,t)),r.push(...n.resources))}}),[...new Map(r.map(e=>[e.name,e])).values()]}getBindGroups(){let e=[];function t(t,r){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),r>=e[t].length&&(e[t].length=r+1)}for(let r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t){if(void 0===t&&(t=[]),e instanceof A7)this._getStructOutputs(e,t);else{let r=this._getOutputInfo(e);null!==r&&t.push(r)}return t}_getStructOutputs(e,t){for(let r of e.members)if(r.type instanceof A7)this._getStructOutputs(r.type,t);else{let e=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(null!==e){let i=this.getTypeInfo(r.type,r.type.attributes),n=this._parseInt(e.value),s=new Av(r.name,i,e.name,n);t.push(s)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Av("",r,t.name,i)}return null}_getInputs(e,t){for(let r of(void 0===t&&(t=[]),e))if(r.type instanceof A7)this._getStructInputs(r.type,t);else{let e=this._getInputInfo(r);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(let r of e.members)if(r.type instanceof A7)this._getStructInputs(r.type,t);else{let e=this._getInputInfo(r);null!==e&&t.push(e)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),n=this._parseInt(t.value),s=new Ay(e.name,i,t.name,n);return null!==r&&(s.interpolation=this._parseString(r.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Am(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let t of this.structs)if(t.name==e)return t;for(let t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Me){let r=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new Ad(e.name,r,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Mt){let r=e.format?this.getTypeInfo(e.format,e.attributes):null,i=new Af(e.name,t);return i.format=r,i.count=e.count,this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof A7){let r=new Ah(e.name,t);for(let t of(r.startLine=e.startLine,r.endLine=e.endLine,e.members)){let e=this.getTypeInfo(t.type,t.attributes);r.members.push(new Ac(t.name,e,t.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Mr){let r=e.format instanceof A5,i=e.format?r?this.getTypeInfo(e.format,null):new Au(e.format,null):null,n=new Ap(e.name,i,t,e.access);return this._types.set(e,n),this._updateTypeInfo(n),n}if(e instanceof A9){let r=e.format?this.getTypeInfo(e.format,null):null,i=new Ap(e.name,r,t,e.access);return this._types.set(e,i),this._updateTypeInfo(i),i}let r=new Au(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;let n=this._getTypeSize(e);if(e.size=null!=(t=null==n?void 0:n.size)?t:0,e instanceof Af&&e.format){let t=this._getTypeSize(e.format);e.stride=Math.max(null!=(r=null==t?void 0:t.size)?r:0,null!=(i=null==t?void 0:t.align)?i:0),this._updateTypeInfo(e.format)}e instanceof Ad&&this._updateTypeInfo(e.format),e instanceof Ah&&this._updateStructInfo(e)}_updateStructInfo(e){let t=0,r=0,i=0,n=0;for(let s=0,a=e.members.length;s<a;++s){let a=e.members[s],o=this._getTypeSize(a);if(!o)continue;null!=this._getAlias(a.type.name)||a.type;let l=o.align,u=o.size;t=this._roundUp(l,t+r),r=u,i=t,n=Math.max(n,l),a.offset=t,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(n,i+r),e.align=n}_getTypeSize(e){var t,r;if(null==e)return null;let i=this._getAttributeNum(e.attributes,"size",0),n=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ac&&(e=e.type),e instanceof Au){let t=this._getAlias(e.name);null!==t&&(e=t)}{let r=MK._typeInfo[e.name];if(void 0!==r){let s="f16"===(null==(t=e.format)?void 0:t.name)?2:1;return new MH(Math.max(n,r.align/s),Math.max(i,r.size/s))}}{let t=MK._typeInfo[e.name.substring(0,e.name.length-1)];if(t){let r="h"===e.name[e.name.length-1]?2:1;return new MH(Math.max(n,t.align/r),Math.max(i,t.size/r))}}if(e instanceof Af){let t=e,s=8,a=8,o=this._getTypeSize(t.format);return null!==o&&(a=o.size,s=o.align),a=t.count*this._getAttributeNum(null!=(r=null==e?void 0:e.attributes)?r:null,"stride",this._roundUp(s,a)),i&&(a=i),new MH(Math.max(n,s),Math.max(i,a))}if(e instanceof Ah){let t=0,r=0,s=0,a=0,o=0;for(let r of e.members){let e=this._getTypeSize(r.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+a),a=e.size,o=s)}return r=this._roundUp(t,o+a),new MH(Math.max(n,t),Math.max(i,r))}return null}_isUniformVar(e){return e instanceof A$&&"uniform"==e.storage}_isStorageVar(e){return e instanceof A$&&"storage"==e.storage}_isTextureVar(e){return e instanceof A$&&null!==e.type&&-1!=MK._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof A$&&null!==e.type&&-1!=MK._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){if(!e||!e.attributes)return null;for(let r of e.attributes)if(r.name==t)return r;return null}_getAttributeNum(e,t,r){if(null===e)return r;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:r;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}MK._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},MK._textureTypes=MI.any_texture_type.map(e=>e.name),MK._samplerTypes=MI.sampler_type.map(e=>e.name);let MY=0;class MZ{constructor(e,t,r){this.id=MY++,this.name=e,this.value=t,this.node=r}clone(){return new MZ(this.name,this.value,this.node)}}class MX{constructor(e){this.id=MY++,this.name=e.name,this.node=e}clone(){return new MX(this.node)}}class MJ{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=MY++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!=(t=this.variables.get(e))?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!=(t=this.functions.get(e))?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new MZ(e,t,null!=r?r:null))}setVariable(e,t,r){let i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;let r=this.getVariable(e);return null!=(t=null==r?void 0:r.value)?t:null}clone(){return new MJ(this)}}class MQ{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class M0{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){let r=this.exec.evalExpression(e.args[0],t),i=!0;if(r instanceof MA)return r.data.forEach(e=>{e||(i=!1)}),new ME(+!!i,this.getTypeInfo("bool"));throw Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MA)return new ME(+!!r.data.some(e=>e),this.getTypeInfo("bool"));throw Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){let r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof ME))throw Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.evalExpression(r,t);if(i instanceof MT&&0===i.typeInfo.size){let e=i.typeInfo;return new ME(i.buffer.byteLength/e.stride,this.getTypeInfo("u32"))}return new ME(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.abs(e)),r.typeInfo):new ME(Math.abs(r.value),r.typeInfo)}Acos(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.acos(e)),r.typeInfo):new ME(Math.acos(r.value),r.typeInfo)}Acosh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.acosh(e)),r.typeInfo):new ME(Math.acosh(r.value),r.typeInfo)}Asin(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.asin(e)),r.typeInfo):new ME(Math.asin(r.value),r.typeInfo)}Asinh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.asinh(e)),r.typeInfo):new ME(Math.asinh(r.value),r.typeInfo)}Atan(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.atan(e)),r.typeInfo):new ME(Math.atan(r.value),r.typeInfo)}Atanh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.atanh(e)),r.typeInfo):new ME(Math.atanh(r.value),r.typeInfo)}Atan2(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>Math.atan2(e,i.data[t])),r.typeInfo):new ME(Math.atan2(r.value,i.value),r.typeInfo)}Ceil(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.ceil(e)),r.typeInfo):new ME(Math.ceil(r.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MA&&i instanceof MA&&n instanceof MA?new MA(r.data.map((e,t)=>this._clamp(e,i.data[t],n.data[t])),r.typeInfo):new ME(this._clamp(r.value,i.value,n.value),r.typeInfo)}Cos(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.cos(e)),r.typeInfo):new ME(Math.cos(r.value),r.typeInfo)}Cosh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.cosh(e)),r.typeInfo):new ME(Math.cos(r.value),r.typeInfo)}CountLeadingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.clz32(e)),r.typeInfo):new ME(Math.clz32(r.value),r.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>this._countOneBits(e)),r.typeInfo):new ME(this._countOneBits(r.value),r.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>this._countTrailingZeros(e)),r.typeInfo):new ME(this._countTrailingZeros(r.value),r.typeInfo)}Cross(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MA&&i instanceof MA){if(3!==r.data.length||3!==i.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let t=r.data,n=i.data;return new MA([t[1]*n[2]-n[1]*t[2],t[2]*n[0]-n[2]*t[0],t[0]*n[1]-n[0]*t[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){let r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof MA?new MA(r.data.map(e=>e*i),r.typeInfo):new ME(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MM){let e=r.data,t=r.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new ME(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new ME(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new ME(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MA&&i instanceof MA){let e=0;for(let t=0;t<r.data.length;++t)e+=(r.data[t]-i.data[t])*(r.data[t]-i.data[t]);return new ME(Math.sqrt(e),this.getTypeInfo("f32"))}return new ME(Math.abs(r.value-i.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new ME(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.exp(e)),r.typeInfo):new ME(Math.exp(r.value),r.typeInfo)}Exp2(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.pow(2,e)),r.typeInfo):new ME(Math.pow(2,r.value),r.typeInfo)}ExtractBits(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let s=i.value,a=n.value;return r instanceof MA?new MA(r.data.map(e=>e>>s&(1<<a)-1),r.typeInfo):"i32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name?(console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null):new ME(r.value>>s&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MA&&i instanceof MA&&n instanceof MA?new MA(0>this._dot(i.data,n.data)?Array.from(r.data):r.data.map(e=>-e),r.typeInfo):(console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null)}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>this._firstLeadingBit(e)),r.typeInfo):new ME(this._firstLeadingBit(r.value),r.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>this._firstTrailingBit(e)),r.typeInfo):new ME(this._firstTrailingBit(r.value),r.typeInfo)}Floor(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.floor(e)),r.typeInfo):new ME(Math.floor(r.value),r.typeInfo)}Fma(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MA&&i instanceof MA&&n instanceof MA?r.data.length!==i.data.length||r.data.length!==n.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new MA(r.data.map((e,t)=>e*i.data[t]+n.data[t]),r.typeInfo):new ME(r.value*i.value+n.value,r.typeInfo)}Fract(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>e-Math.floor(e)),r.typeInfo):new ME(r.value-Math.floor(r.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let a=n.value,o=(1<<s.value)-1<<a,l=~o;return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>e&l|i.data[t]<<a&o),r.typeInfo):new ME(r.value&l|i.value<<a&o,r.typeInfo)}InverseSqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>1/Math.sqrt(e)),r.typeInfo):new ME(1/Math.sqrt(r.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MA){let e=0;return r.data.forEach(t=>{e+=t*t}),new ME(Math.sqrt(e),this.getTypeInfo("f32"))}return new ME(Math.abs(r.value),r.typeInfo)}Log(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.log(e)),r.typeInfo):new ME(Math.log(r.value),r.typeInfo)}Log2(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.log2(e)),r.typeInfo):new ME(Math.log2(r.value),r.typeInfo)}Max(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>Math.max(e,i.data[t])),r.typeInfo):new ME(Math.max(r.value,i.value),r.typeInfo)}Min(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>Math.min(e,i.data[t])),r.typeInfo):new ME(Math.min(r.value,i.value),r.typeInfo)}Mix(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MA&&i instanceof MA&&n instanceof MA?new MA(r.data.map((e,t)=>r.data[t]*(1-n.data[t])+i.data[t]*n.data[t]),r.typeInfo):new ME(r.value*(1-n.value)+i.value*n.value,r.typeInfo)}Modf(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>e%i.data[t]),r.typeInfo):new ME(r.value%i.value,r.typeInfo)}Normalize(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MA){let i=this.Length(e,t).value;return new MA(r.data.map(e=>e/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MA&&i instanceof MA?new MA(r.data.map((e,t)=>Math.pow(e,i.data[t])),r.typeInfo):new ME(Math.pow(r.value,i.value),r.typeInfo)}QuantizeToF16(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>e),r.typeInfo):new ME(r.value,r.typeInfo)}Radians(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>e*Math.PI/180),r.typeInfo):new ME(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MA&&i instanceof MA){let e=this._dot(r.data,i.data);return new MA(r.data.map((t,r)=>t-2*e*i.data[r]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if(r instanceof MA&&i instanceof MA&&n instanceof ME){let e=this._dot(i.data,r.data);return new MA(r.data.map((t,r)=>{let s=1-n.value*n.value*(1-e*e);if(s<0)return 0;let a=Math.sqrt(s);return n.value*t-(n.value*e+a)*i.data[r]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.round(e)),r.typeInfo):new ME(Math.round(r.value),r.typeInfo)}Saturate(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.min(Math.max(e,0),1)),r.typeInfo):new ME(Math.min(Math.max(r.value,0),1),r.typeInfo)}Sign(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.sign(e)),r.typeInfo):new ME(Math.sign(r.value),r.typeInfo)}Sin(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.sin(e)),r.typeInfo):new ME(Math.sin(r.value),r.typeInfo)}Sinh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.sinh(e)),r.typeInfo):new ME(Math.sinh(r.value),r.typeInfo)}_smoothstep(e,t,r){let i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return n instanceof MA&&r instanceof MA&&i instanceof MA?new MA(n.data.map((e,t)=>this._smoothstep(r.data[t],i.data[t],e)),n.typeInfo):new ME(this._smoothstep(r.value,i.value,n.value),n.typeInfo)}Sqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.sqrt(e)),r.typeInfo):new ME(Math.sqrt(r.value),r.typeInfo)}Step(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return i instanceof MA&&r instanceof MA?new MA(i.data.map((e,t)=>e<r.data[t]?0:1),i.typeInfo):new ME(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.tan(e)),r.typeInfo):new ME(Math.tan(r.value),r.typeInfo)}Tanh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.tanh(e)),r.typeInfo):new ME(Math.tanh(r.value),r.typeInfo)}_getTransposeType(e){let t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){let r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof MM))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let i=this._getTransposeType(r.typeInfo);if("mat2x2"===r.typeInfo.name||"mat2x2f"===r.typeInfo.name||"mat2x2h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===r.typeInfo.name||"mat2x3f"===r.typeInfo.name||"mat2x3h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===r.typeInfo.name||"mat2x4f"===r.typeInfo.name||"mat2x4h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===r.typeInfo.name||"mat3x2f"===r.typeInfo.name||"mat3x2h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===r.typeInfo.name||"mat3x3f"===r.typeInfo.name||"mat3x3h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===r.typeInfo.name||"mat3x4f"===r.typeInfo.name||"mat3x4h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===r.typeInfo.name||"mat4x2f"===r.typeInfo.name||"mat4x2h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===r.typeInfo.name||"mat4x3f"===r.typeInfo.name||"mat4x3h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===r.typeInfo.name||"mat4x4f"===r.typeInfo.name||"mat4x4h"===r.typeInfo.name){let e=r.data;return new MM([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MA?new MA(r.data.map(e=>Math.trunc(e)),r.typeInfo):new ME(Math.trunc(r.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){let r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Mo){let n=r.name,s=t.getVariableValue(n);if(s instanceof MC){if(i<0||i>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let t=s.getMipLevelSize(i),r=s.dimension;return"1d"===r?new ME(t[0],this.getTypeInfo("u32")):"3d"===r?new MA(t,this.getTypeInfo("vec3u")):"2d"===r?new MA(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${r} not found. Line ${e.line}`),null)}return console.error(`Texture ${n} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){let r=e.args[0],i=this.exec.evalExpression(e.args[1],t),n=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof MA)||2!==i.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Mo){let s=r.name,a=t.getVariableValue(s);if(a instanceof MC){let t=Math.floor(i.data[0]),r=Math.floor(i.data[1]);if(t<0||t>=a.width||r<0||r>=a.height)return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;let o=a.getPixel(t,r,0,n);return null===o?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new MA(o,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){let r=e.args[0];if(r instanceof Mo){let i=r.name,n=t.getVariableValue(i);return n instanceof MC?new ME(n.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){let r=e.args[0];if(r instanceof Mo){let i=r.name,n=t.getVariableValue(i);return n instanceof MC?new ME(n.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){let r=e.args[0];if(r instanceof Mo){let i=r.name,n=t.getVariableValue(i);return n instanceof MC?new ME(n.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){let r=e.args[0],i=this.exec.evalExpression(e.args[1],t),n=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,s=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==s.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof MA)||2!==i.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Mo){let a=r.name,o=t.getVariableValue(a);if(o instanceof MC){let t=o.getMipLevelSize(0),r=Math.floor(i.data[0]),l=Math.floor(i.data[1]);return r<0||r>=t[0]||l<0||l>=t[1]?console.error(`Texture ${a} out of bounds. Line ${e.line}`):o.setPixel(r,l,0,n,Array.from(s)),null}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t);return o instanceof ME&&a instanceof ME&&(o.value=a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value+=a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicSub(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value-=a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicMax(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=Math.max(o.value,a.value)),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicMin(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=Math.min(o.value,a.value)),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicAnd(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=o.value&a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicOr(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=o.value|a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicXor(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=o.value^a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicExchange(e,t){let r=e.args[0];r instanceof Md&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new ME(o.value,o.typeInfo);return o instanceof ME&&a instanceof ME&&(o.value=a.value),n.value instanceof MT&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}let M1={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},M2={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class M3 extends MQ{constructor(e,t){var r;super(),this.ast=null!=e?e:[],this.reflection=new MK,this.reflection.updateAST(this.ast),this.context=null!=(r=null==t?void 0:t.clone())?r:new MJ,this.builtins=new M0(this),this.typeInfo={bool:this.getTypeInfo(A5.bool),i32:this.getTypeInfo(A5.i32),u32:this.getTypeInfo(A5.u32),f32:this.getTypeInfo(A5.f32),f16:this.getTypeInfo(A5.f16),vec2f:this.getTypeInfo(A9.vec2f),vec2u:this.getTypeInfo(A9.vec2u),vec2i:this.getTypeInfo(A9.vec2i),vec2h:this.getTypeInfo(A9.vec2h),vec3f:this.getTypeInfo(A9.vec3f),vec3u:this.getTypeInfo(A9.vec3u),vec3i:this.getTypeInfo(A9.vec3i),vec3h:this.getTypeInfo(A9.vec3h),vec4f:this.getTypeInfo(A9.vec4f),vec4u:this.getTypeInfo(A9.vec4u),vec4i:this.getTypeInfo(A9.vec4i),vec4h:this.getTypeInfo(A9.vec4h),mat2x2f:this.getTypeInfo(A9.mat2x2f),mat2x3f:this.getTypeInfo(A9.mat2x3f),mat2x4f:this.getTypeInfo(A9.mat2x4f),mat3x2f:this.getTypeInfo(A9.mat3x2f),mat3x3f:this.getTypeInfo(A9.mat3x3f),mat3x4f:this.getTypeInfo(A9.mat3x4f),mat4x2f:this.getTypeInfo(A9.mat4x2f),mat4x3f:this.getTypeInfo(A9.mat4x3f),mat4x4f:this.getTypeInfo(A9.mat4x4f)}}getVariableValue(e){var t,r;let i=null!=(r=null==(t=this.context.getVariable(e))?void 0:t.value)?r:null;if(null===i)return null;if(i instanceof ME)return i.value;if(i instanceof MA||i instanceof MM)return Array.from(i.data);if(i instanceof MT&&i.typeInfo instanceof Af){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){let n=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,n),this._execStatements(this.ast,n);let s=n.getFunction(e);if(!s)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}let a=t[0],o=t[1],l=t[2],u=this.getTypeInfo("vec3u");n.setVariable("@num_workgroups",new MA(t,u));let c=this.reflection.getFunctionInfo(e);for(let t in null===c&&console.error(`Function ${e} not found in reflection data`),r)for(let e in r[t]){let i=r[t][e];n.variables.forEach(r=>{var n;let s=r.node;if(null==s?void 0:s.attributes){let a=null,o=null;for(let e of s.attributes)"binding"===e.name?a=e.value:"group"===e.name&&(o=e.value);if(e==a&&t==o){let a=!1;for(let i of c.resources)if(i.name===r.name&&i.group===parseInt(t)&&i.binding===parseInt(e)){a=!0;break}a&&(void 0!==i.texture&&void 0!==i.descriptor?r.value=new MC(i.texture,this.getTypeInfo(s.type),i.descriptor,null!=(n=i.texture.view)?n:null):void 0!==i.uniform?r.value=new MT(i.uniform,this.getTypeInfo(s.type)):r.value=new MT(i,this.getTypeInfo(s.type)))}}})}for(let e=0;e<l;++e)for(let t=0;t<o;++t)for(let r=0;r<a;++r)n.setVariable("@workgroup_id",new MA([r,t,e],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[r,t,e],n)}execStatement(e,t){if(e instanceof AJ)return this.evalExpression(e.value,t);if(e instanceof A4){if(e.condition){let r=this.evalExpression(e.condition,t);if(!(r instanceof ME))throw Error("Invalid break-if condition");if(!r.value)return null}return M3._breakObj}if(e instanceof A6)return M3._continueObj;if(e instanceof AW)this._let(e,t);else if(e instanceof A$)this._var(e,t);else if(e instanceof AG)this._const(e,t);else if(e instanceof AR)this._function(e,t);else{if(e instanceof AX)return this._if(e,t);if(e instanceof AZ)return this._switch(e,t);if(e instanceof AU)return this._for(e,t);if(e instanceof AF)return this._while(e,t);if(e instanceof AY)return this._loop(e,t);if(e instanceof AB){let r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof AH)this._assign(e,t);else if(e instanceof Aq)this._increment(e,t);else{if(e instanceof A7)return null;if(e instanceof AV){let r=e.name;null===t.getVariable(r)&&t.setVariable(r,new ME(0,this.getTypeInfo("u32")))}else if(e instanceof AK)this._call(e,t);else{if(e instanceof A1||e instanceof A2)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Mp?this._evalBinaryOp(e,t):e instanceof Mu?this._evalLiteral(e,t):e instanceof Mo?this._evalVariable(e,t):e instanceof Ma?this._evalCall(e,t):e instanceof Ms?this._evalCreate(e,t):e instanceof Ml?this._evalConst(e,t):e instanceof Mc?this._evalBitcast(e,t):e instanceof Md?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof A5){let t=this.reflection.getTypeInfo(e);if(null!==t)return t}let r=null!=(t=this.typeInfo[e])?t:null;return null!==r||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(let r in e){let i=e[r],n=this.reflection.getOverrideInfo(r);null!==n?(null===n.type&&(n.type=this.getTypeInfo("u32")),"u32"===n.type.name||"i32"===n.type.name||"f32"===n.type.name||"f16"===n.type.name?t.setVariable(r,new ME(i,n.type)):"bool"===n.type.name?t.setVariable(r,new ME(+!!i,n.type)):"vec2"===n.type.name||"vec3"===n.type.name||"vec4"===n.type.name||"vec2f"===n.type.name||"vec3f"===n.type.name||"vec4f"===n.type.name||"vec2i"===n.type.name||"vec3i"===n.type.name||"vec4i"===n.type.name||"vec2u"===n.type.name||"vec3u"===n.type.name||"vec4u"===n.type.name||"vec2h"===n.type.name||"vec3h"===n.type.name||"vec4h"===n.type.name?t.setVariable(r,new MA(i,n.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){let i=[1,1,1];for(let t of e.node.attributes)if("workgroup_size"===t.name){if(t.value.length>0){let e=r.getVariableValue(t.value[0]);i[0]=e instanceof ME?e.value:parseInt(t.value[0])}if(t.value.length>1){let e=r.getVariableValue(t.value[1]);i[1]=e instanceof ME?e.value:parseInt(t.value[1])}if(t.value.length>2){let e=r.getVariableValue(t.value[2]);i[2]=e instanceof ME?e.value:parseInt(t.value[2])}}let n=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new MA(i,n));let a=i[0],o=i[1],l=i[2];for(let u=0,c=0;u<l;++u)for(let l=0;l<o;++l)for(let o=0;o<a;++o,++c){let a=[o,l,u],h=[o+t[0]*i[0],l+t[1]*i[1],u+t[2]*i[2]];r.setVariable("@local_invocation_id",new MA(a,n)),r.setVariable("@global_invocation_id",new MA(h,n)),r.setVariable("@local_invocation_index",new ME(c,s)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(let r of e.node.args)for(let e of r.attributes)if("builtin"===e.name){let i=`@${e.value}`,n=t.getVariable(i);void 0!==n&&t.variables.set(r.name,n)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Md;)e=e.right;return e instanceof Mo?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(let r of e){if(r instanceof Array){let e=t.clone(),i=this._execStatements(r,e);if(i)return i;continue}let e=this.execStatement(r,t);if(e)return e}return null}_call(e,t){let r=t.clone();r.currentFunctionName=e.name;let i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){let n=i.node.args[t],s=this.evalExpression(e.args[t],r);r.setVariable(n.name,s,n)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){let r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?"++"===e.operator?i.value instanceof ME?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):"--"===e.operator?i.value instanceof ME?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Mo){let r=this.getVariableName(e,t),i=t.getVariable(r);return null===i?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof Md){if("*"===e.operator){let r=this._getVariableData(e.right,t);return r instanceof MS?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator)return new MS(this._getVariableData(e.right,t))}return null}_assign(e,t){let r=null,i="<var>",n=null;if(e.variable instanceof Md){let r=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),n=e.operator;if("="===n){if(r instanceof ME||r instanceof MA||r instanceof MM){if(i instanceof ME||i instanceof MA||i instanceof MM&&r.data.length===i.data.length)return void r.data.set(i.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(r instanceof MT&&i instanceof MT&&r.buffer.byteLength-r.offset>=i.buffer.byteLength-i.offset)return void(r.buffer.byteLength%4==0?new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(r.buffer,r.offset,r.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===n)return r instanceof ME||r instanceof MA||r instanceof MM?i instanceof ME||i instanceof MA||i instanceof MM?void r.data.set(i.data.map((e,t)=>r.data[t]+e)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===n)return(r instanceof ME||r instanceof MA||r instanceof MM)&&(i instanceof ME||i instanceof MA||i instanceof MM)?void r.data.set(i.data.map((e,t)=>r.data[t]-e)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Md){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);let n=t.getVariable(i);if(!(n&&n.value instanceof MS))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=n.value.reference;let s=e.variable.postfix;if(!s){let t=e.variable.right;for(;t instanceof Md;){if(t.postfix){s=t.postfix;break}t=t.right}}s&&(r=r.getSubData(this,s,t))}}else{n=e.variable.postfix,i=this.getVariableName(e.variable,t);let s=t.getVariable(i);if(null===s)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=s.value}if(r instanceof MS&&(r=r.reference),null===r)return void console.error(`Variable ${i} not found. Line ${e.line}`);let s=this.evalExpression(e.value,t),a=e.operator;if("="!==a){let i=r.getSubData(this,n,t);if(i instanceof MA&&s instanceof ME){let t=i.data,r=s.value;if("+="===a)for(let e=0;e<t.length;++e)t[e]+=r;else if("-="===a)for(let e=0;e<t.length;++e)t[e]-=r;else if("*="===a)for(let e=0;e<t.length;++e)t[e]*=r;else if("/="===a)for(let e=0;e<t.length;++e)t[e]/=r;else if("%="===a)for(let e=0;e<t.length;++e)t[e]%=r;else if("&="===a)for(let e=0;e<t.length;++e)t[e]&=r;else if("|="===a)for(let e=0;e<t.length;++e)t[e]|=r;else if("^="===a)for(let e=0;e<t.length;++e)t[e]^=r;else if("<<="===a)for(let e=0;e<t.length;++e)t[e]<<=r;else if(">>="===a)for(let e=0;e<t.length;++e)t[e]>>=r;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(i instanceof MA&&s instanceof MA){let t=i.data,r=s.data;if(t.length!==r.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===a)for(let e=0;e<t.length;++e)t[e]+=r[e];else if("-="===a)for(let e=0;e<t.length;++e)t[e]-=r[e];else if("*="===a)for(let e=0;e<t.length;++e)t[e]*=r[e];else if("/="===a)for(let e=0;e<t.length;++e)t[e]/=r[e];else if("%="===a)for(let e=0;e<t.length;++e)t[e]%=r[e];else if("&="===a)for(let e=0;e<t.length;++e)t[e]&=r[e];else if("|="===a)for(let e=0;e<t.length;++e)t[e]|=r[e];else if("^="===a)for(let e=0;e<t.length;++e)t[e]^=r[e];else if("<<="===a)for(let e=0;e<t.length;++e)t[e]<<=r[e];else if(">>="===a)for(let e=0;e<t.length;++e)t[e]>>=r[e];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(i instanceof ME&&s instanceof ME))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===a?i.value+=s.value:"-="===a?i.value-=s.value:"*="===a?i.value*=s.value:"/="===a?i.value/=s.value:"%="===a?i.value%=s.value:"&="===a?i.value&=s.value:"|="===a?i.value|=s.value:"^="===a?i.value^=s.value:"<<="===a?i.value<<=s.value:">>="===a?i.value>>=s.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof MT&&r.setDataValue(this,i,n,t))}if(r instanceof MT)r.setDataValue(this,s,n,t);else if(n){if(!(r instanceof MA||r instanceof MM))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(n instanceof Mh){let a=this.evalExpression(n.index,t).value;if(r instanceof MA){if(!(s instanceof ME))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[a]=s.value}else{if(!(r instanceof MM))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{let a=this.evalExpression(n.index,t).value;if(a<0||!(s instanceof MA))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{let t=r.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(a<2&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(a<2&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(a<2&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(a<3&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(a<3&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(a<3&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(a<4&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(a<4&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||!(a<4&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}}}}}else if(n instanceof Mn){let t=n.value;if(!(r instanceof MA))return void console.error(`Invalid assignment to ${t}. Variable ${i} is not a vector. Line ${e.line}`);if(s instanceof ME){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);if("x"===t)r.data[0]=s.value;else if("y"===t){if(r.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[1]=s.value}else if("z"===t){if(r.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[2]=s.value}else if("w"===t){if(r.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[3]=s.value}}else{if(!(s instanceof MA))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(t.length!==s.data.length)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);for(let n=0;n<t.length;++n){let a=t[n];if("x"===a||"r"===a)r.data[0]=s.data[n];else if("y"===a||"g"===a){if(s.data.length<2)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[1]=s.data[n]}else if("z"===a||"b"===a){if(s.data.length<3)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[2]=s.data[n]}else{if("w"!==a&&"a"!==a||s.data.length<4)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[3]=s.data[n]}}}}}else r instanceof ME&&s instanceof ME?r.value=s.value:r instanceof MA&&s instanceof MA||r instanceof MM&&s instanceof MM?r.data.set(s.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){let r=new MX(e);t.functions.set(e.name,r)}_const(e,t){let r=null;null!==e.value&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(null!==e.value){if(null===(r=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Md||(r=r.clone())}else{let i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){let i=new Ms(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(null!==e.value){if(null===(r=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Md||(r=r.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof Mt||e.type instanceof A7||e.type instanceof A9){let i=new Ms(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof ME))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(let n of e.cases)if(n instanceof My)for(let s of n.selectors){if(s instanceof Mm){i=n;continue}let a=this.evalExpression(s,t);if(!(a instanceof ME))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(n.body,t)}else n instanceof Mv&&(i=n);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof ME))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(let r of e.elseif){let i=this.evalExpression(r.condition,t);if(!(i instanceof ME))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof ME?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===M3._breakObj)break;if(null!==r&&r!==M3._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){let r=this._execStatements(e.body,t);if(r===M3._breakObj)break;if(r===M3._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===M3._breakObj)break}else if(null!==r)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===M3._breakObj)break;if(r!==M3._continueObj&&null!==r)return r}return null}_evalBitcast(e,t){let r=this.evalExpression(e.value,t),i=e.type;if(r instanceof ME)return new ME(MG(r.value,r.typeInfo.name,i.name),this.getTypeInfo(i));if(r instanceof MA){let t=r.typeInfo.getTypeName(),n="";if(t.endsWith("f"))n="f32";else if(t.endsWith("i"))n="i32";else if(t.endsWith("u"))n="u32";else if(t.endsWith("b"))n="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;n="f16"}let s=i.getTypeName(),a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;a="f16"}return new MA(function(e,t,r){if(t===r)return e;let i=Array(e.length);for(let n=0;n<e.length;n++)i[n]=MG(e[n],t,r);return i}(Array.from(r.data),n,a),this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Ms){if(null===e.type)return MP.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}let i=e instanceof Ms?e.type.name:e.name,n=e instanceof Ms?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===n)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(0===n.size)return null;let s=new MT(new ArrayBuffer(n.size),n,0);if(n instanceof Ah){if(e.args)for(let r=0;r<e.args.length;++r){let i=n.members[r],a=e.args[r],o=this.evalExpression(a,t);s.setData(this,o,i.type,i.offset,t)}}else if(n instanceof Af){let i=0;if(e.args)for(let a=0;a<e.args.length;++a){let o=e.args[a],l=this.evalExpression(o,t);null===n.format&&("x32"===(null==(r=l.typeInfo)?void 0:r.name)?n.format=this.getTypeInfo("i32"):n.format=l.typeInfo),s.setData(this,l,n.format,i,t),i+=n.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Ms?s.getSubData(this,e.postfix,t):s}_evalLiteral(e,t){let r=this.getTypeInfo(e.type),i=r.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new ME(e.scalarValue,r):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){let r=t.getVariableValue(e.name);return null===r?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let r=1;r<e.length;++r){let i=M3._priority.get(t.name);M3._priority.get(e[r].name)<i&&(t=e[r])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){let r=this.evalExpression(e.right,t);if("&"===e.operator)return new MS(r);if("*"===e.operator)return r instanceof MS?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);let i=r instanceof ME?r.value:r instanceof MA?Array.from(r.data):null;switch(e.operator){case"+":if(MN(i))return new MA(i.map((e,t)=>+e),r.typeInfo);return new ME(+i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"-":if(MN(i))return new MA(i.map((e,t)=>-e),r.typeInfo);return new ME(-i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"!":if(MN(i))return new MA(i.map((e,t)=>+!e),r.typeInfo);return new ME(+!i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"~":if(MN(i))return new MA(i.map((e,t)=>~e),r.typeInfo);return new ME(~i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]))}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){let r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),n=r instanceof ME?r.value:r instanceof MA||r instanceof MM?Array.from(r.data):null,s=i instanceof ME?i.value:i instanceof MA||i instanceof MM?Array.from(i.data):null;switch(e.operator){case"+":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e+s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e+s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n+e),i.typeInfo);return new ME(n+s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"-":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e-s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e-s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n-e),i.typeInfo);return new ME(n-s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"*":if(MN(n)&&MN(s)){if(r instanceof MM&&i instanceof MM){let t=function(e,t,r,i){if(void 0===M2[t.name]||void 0===M2[i.name])return null;let n=M2[t.name][0],s=M2[t.name][1],a=M2[i.name][0];if(n!==M2[i.name][1])return null;let o=Array(a*s);for(let t=0;t<s;t++)for(let i=0;i<a;i++){let l=0;for(let a=0;a<n;a++)l+=e[a*s+t]*r[i*n+a];o[t*a+i]=l}return o}(n,r.typeInfo,s,i.typeInfo);if(null===t)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let a=M2[i.typeInfo.name][0],o=M2[r.typeInfo.name][1];return new MM(t,this.getTypeInfo(`mat${a}x${o}f`))}if(r instanceof MM&&i instanceof MA){let t=function(e,t,r,i){if(void 0===M2[t.name]||void 0===M1[i.name])return null;let n=M2[t.name][0],s=M2[t.name][1];if(n!==r.length)return null;let a=Array(s);for(let t=0;t<s;t++){let i=0;for(let a=0;a<n;a++)i+=e[a*s+t]*r[a];a[t]=i}return a}(n,r.typeInfo,s,i.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new MA(t,i.typeInfo)}if(r instanceof MA&&i instanceof MM){let t=function(e,t,r,i){if(void 0===M1[t.name]||void 0===M2[i.name])return null;let n=M2[i.name][0],s=M2[i.name][1];if(s!==e.length)return null;let a=[];for(let t=0;t<n;t++){let i=0;for(let a=0;a<s;a++)i+=e[a]*r[a*n+t];a[t]=i}return a}(n,r.typeInfo,s,i.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new MA(t,r.typeInfo)}if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e*s[t]),r.typeInfo)}if(MN(n)){let e=n.map((e,t)=>e*s);return r instanceof MM?new MM(e,r.typeInfo):new MA(e,r.typeInfo)}if(MN(s)){let e=s.map((e,t)=>n*e);return i instanceof MM?new MM(e,i.typeInfo):new MA(e,i.typeInfo)}return new ME(n*s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"%":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e%s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e%s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n%e),i.typeInfo);return new ME(n%s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"/":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e/s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e/s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n/e),i.typeInfo);return new ME(n/s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"&":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e&s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e&s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n&e),i.typeInfo);return new ME(n&s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"|":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e|s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e|s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n|e),i.typeInfo);return new ME(n|s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"^":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e^s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e^s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n^e),i.typeInfo);return new ME(n^s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"<<":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e<<s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e<<s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n<<e),i.typeInfo);return new ME(n<<s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case">>":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e>>s[t]),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e>>s),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n>>e),i.typeInfo);return new ME(n>>s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case">":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e>s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e>s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n>e)),i.typeInfo);return new ME(+(n>s),this.getTypeInfo("bool"));case"<":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e<s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e<s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n<e)),i.typeInfo);return new ME(+(n<s),this.getTypeInfo("bool"));case"==":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e===s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e==s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n==e)),i.typeInfo);return new ME(+(n===s),this.getTypeInfo("bool"));case"!=":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e!==s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e!==s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n!==e)),i.typeInfo);return new ME(+(n!==s),this.getTypeInfo("bool"));case">=":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e>=s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e>=s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n>=e)),i.typeInfo);return new ME(+(n>=s),this.getTypeInfo("bool"));case"<=":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>+(e<=s[t])),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>+(e<=s)),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>+(n<=e)),i.typeInfo);return new ME(+(n<=s),this.getTypeInfo("bool"));case"&&":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e&&s[t]?1:0),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e&&s?1:0),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n&&e?1:0),i.typeInfo);return new ME(n&&s?1:0,this.getTypeInfo("bool"));case"||":if(MN(n)&&MN(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MA(n.map((e,t)=>e||s[t]?1:0),r.typeInfo)}if(MN(n))return new MA(n.map((e,t)=>e||s?1:0),r.typeInfo);if(MN(s))return new MA(s.map((e,t)=>n||e?1:0),i.typeInfo);return new ME(n||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;let r=t.clone();r.currentFunctionName=e.name;let i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let t=0;t<i.node.args.length;++t){let n=i.node.args[t],s=this.evalExpression(e.args[t],r);r.createVariable(n.name,s,n)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}let r=t.getFunction(e.name);if(r){let i=t.clone();for(let t=0;t<r.node.args.length;++t){let n=r.node.args[t],s=this.evalExpression(e.args[t],i);i.setVariable(n.name,s,n)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new ME(0,this.getTypeInfo(e.type));let r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){let r=this.getTypeInfo(e.type),i=e.type.getTypeName(),n=M1[i];if(void 0===n)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;let s=[];if(e instanceof Mu)if(e.isVector)for(let t of e.vectorValue)s.push(t);else s.push(e.scalarValue);else if(e.args)for(let r of e.args){let e=this.evalExpression(r,t);if(e instanceof MA){let t=e.data;for(let e=0;e<t.length;++e){let r=t[e];s.push(r)}}else if(e instanceof ME){let t=e.value;s.push(t)}}if(e.type instanceof A9&&null===e.type.format&&(e.type.format=A9.f32),0===s.length)return new MA(Array(n).fill(0),r).getSubData(this,e.postfix,t);if(1===s.length)for(;s.length<n;)s.push(s[0]);return s.length<n?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new MA(s.length>n?s.slice(0,n):s,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){let r=this.getTypeInfo(e.type),i=e.type.getTypeName(),n=M2[i];if(void 0===n)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;let s=[];if(e instanceof Mu)if(e.isVector)for(let t of e.vectorValue)s.push(t);else s.push(e.scalarValue);else if(e.args)for(let r of e.args){let e=this.evalExpression(r,t);e instanceof MA?s.push(...e.data):e instanceof ME?s.push(e.value):e instanceof MM&&s.push(...e.data)}return(r instanceof Ap&&null===r.format&&(r.format=this.getTypeInfo("f32")),0===s.length)?new MM(Array(n[2]).fill(0),r).getSubData(this,e.postfix,t):s.length!==n[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new MM(s,r).getSubData(this,e.postfix,t)}}M3._breakObj=new Mk(new Au("BREAK",null),null),M3._continueObj=new Mk(new Au("CONTINUE",null),null),M3._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class M4{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class M6{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new M4,this._exec=new M3,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let t=[];for(;!this._isAtEnd();){let e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(let e of this._deferArrayCountEval){let t=e.arrayType,r=e.countNode;if(r instanceof Mo){let e=r.name,i=this._context.constants.get(e);if(i)try{t.count=i.constEvaluate(this._exec)}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let e of t)e.search(e=>{e instanceof M_||e instanceof Me?e.type=this._forwardType(e.type):e instanceof Mt?e.format=this._forwardType(e.format):e instanceof A$||e instanceof AW||e instanceof AG?e.type=this._forwardType(e.type):e instanceof AR?e.returnType=this._forwardType(e.returnType):e instanceof Mb&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof A8){let t=this._getType(e.name);if(t)return t}else e instanceof Me?e.type=this._forwardType(e.type):e instanceof Mt&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){let t=new Mj(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==MI.eof}_match(e){if(e instanceof MO)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){let r=e[t];if(this._check(r))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let r=t.type,i=!1;for(let t of e){if(r===t)return!0;t===MI.tokens.name&&(i=!0)}if(i){let e=MI.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===MI.tokens.name){let e=MI.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!=(t=null==(e=this._peek())?void 0:e.line)?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(MI.tokens.semicolon)&&!this._isAtEnd(););if(this._match(MI.keywords.alias)){let e=this._type_alias();return this._consume(MI.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MI.keywords.diagnostic)){let e=this._diagnostic();return this._consume(MI.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MI.keywords.requires)){let e=this._requires_directive();return this._consume(MI.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MI.keywords.enable)){let e=this._enable_directive();return this._consume(MI.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}let e=this._attribute();if(this._check(MI.keywords.var)){let t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(MI.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MI.keywords.override)){let t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(MI.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MI.keywords.let)){let t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(MI.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MI.keywords.const)){let t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(MI.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MI.keywords.struct)){let t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(MI.keywords.fn)){let t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(MI.keywords.fn))return null;let e=this._currentLine,t=this._consume(MI.tokens.ident,"Expected function name.").toString();this._consume(MI.tokens.paren_left,"Expected '(' for function arguments.");let r=[];if(!this._check(MI.tokens.paren_right))do{if(this._check(MI.tokens.paren_right))break;let e=this._attribute(),t=this._consume(MI.tokens.name,"Expected argument name.").toString();this._consume(MI.tokens.colon,"Expected ':' for argument type.");let i=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=i,r.push(this._updateNode(new Mb(t,n,e))))}while(this._match(MI.tokens.comma))this._consume(MI.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(MI.tokens.arrow)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}let n=this._compound_statement(),s=this._currentLine;return this._updateNode(new AR(t,r,i,n,e,s),e)}_compound_statement(){let e=[];for(this._consume(MI.tokens.brace_left,"Expected '{' for block.");!this._check(MI.tokens.brace_right);){let t=this._statement();null!==t&&e.push(t)}return this._consume(MI.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(MI.tokens.semicolon)&&!this._isAtEnd(););if(this._check(MI.tokens.attr)&&this._attribute(),this._check(MI.keywords.if))return this._if_statement();if(this._check(MI.keywords.switch))return this._switch_statement();if(this._check(MI.keywords.loop))return this._loop_statement();if(this._check(MI.keywords.for))return this._for_statement();if(this._check(MI.keywords.while))return this._while_statement();if(this._check(MI.keywords.continuing))return this._continuing_statement();if(this._check(MI.keywords.static_assert))return this._static_assert_statement();if(this._check(MI.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(MI.keywords.return))e=this._return_statement();else if(this._check([MI.keywords.var,MI.keywords.let,MI.keywords.const]))e=this._variable_statement();else if(this._match(MI.keywords.discard))e=this._updateNode(new A3);else if(this._match(MI.keywords.break)){let t=this._updateNode(new A4);this._currentLoop.length>0&&(t.loopId=this._currentLoop[this._currentLoop.length-1].id),e=t,this._check(MI.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(MI.keywords.continue)){let t=this._updateNode(new A6);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);t.loopId=this._currentLoop[this._currentLoop.length-1].id,e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(MI.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(MI.keywords.static_assert))return null;let e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Az(t),e)}_while_statement(){if(!this._match(MI.keywords.while))return null;let e=this._updateNode(new AF(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(MI.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(MI.keywords.continuing))return null;let t=this._currentLine,r=this._compound_statement();return this._updateNode(new AB(r,e),t)}_for_statement(){if(!this._match(MI.keywords.for))return null;this._consume(MI.tokens.paren_left,"Expected '('.");let e=this._updateNode(new AU(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(MI.tokens.semicolon)?null:this._for_init(),this._consume(MI.tokens.semicolon,"Expected ';'."),e.condition=this._check(MI.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(MI.tokens.semicolon,"Expected ';'."),e.increment=this._check(MI.tokens.paren_right)?null:this._for_increment(),this._consume(MI.tokens.paren_right,"Expected ')'."),this._check(MI.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(MI.keywords.var)){let e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(MI.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new A$(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(MI.keywords.let)){let e=this._currentLine,t=this._consume(MI.tokens.name,"Expected name for let.").toString(),r=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}this._consume(MI.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return this._updateNode(new AW(t,r,null,null,i),e)}if(this._match(MI.keywords.const)){let e=this._currentLine,t=this._consume(MI.tokens.name,"Expected name for const.").toString(),r=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}this._consume(MI.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return null===r&&i instanceof Mu&&(r=i.type),this._updateNode(new AG(t,r,null,null,i),e)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(MI.increment_operators))return this._current=e,null;let r=this._consume(MI.increment_operators,"Expected increment operator");return this._updateNode(new Aq(r.type===MI.tokens.plus_plus?K.increment:K.decrement,t))}_assignment_statement(){let e=null,t=this._currentLine;if(this._check(MI.tokens.brace_right))return null;let r=this._match(MI.tokens.underscore);if(r||(e=this._unary_expression()),!r&&null==e)return null;let i=this._consume(MI.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return this._updateNode(new AH(Y.parse(i.lexeme),e,n),t)}_func_call_statement(){if(!this._check(MI.tokens.ident))return null;let e=this._currentLine,t=this._current,r=this._consume(MI.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new AK(r.lexeme,i),e)}_loop_statement(){if(!this._match(MI.keywords.loop))return null;this._check(MI.tokens.attr)&&this._attribute(),this._consume(MI.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new AY([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof AB){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(MI.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(MI.keywords.switch))return null;let e=this._updateNode(new AZ(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(MI.tokens.attr)&&this._attribute(),this._consume(MI.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(MI.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],t=!1;for(;this._check([MI.keywords.default,MI.keywords.case]);){if(this._match(MI.keywords.case)){let r=this._case_selectors();for(let e of r)if(e instanceof Mm){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(MI.tokens.colon),this._check(MI.tokens.attr)&&this._attribute(),this._consume(MI.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(MI.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new My(r,i)))}if(this._match(MI.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(MI.tokens.colon),this._check(MI.tokens.attr)&&this._attribute(),this._consume(MI.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(MI.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Mv(r)))}}return e}_case_selectors(){let e=[];for(this._match(MI.keywords.default)?e.push(this._updateNode(new Mm)):e.push(this._shift_expression());this._match(MI.tokens.comma);)this._match(MI.keywords.default)?e.push(this._updateNode(new Mm)):e.push(this._shift_expression());return e}_case_body(){if(this._match(MI.keywords.fallthrough))return this._consume(MI.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);let t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(MI.keywords.if))return null;let e=this._currentLine,t=this._optional_paren_expression();this._check(MI.tokens.attr)&&this._attribute();let r=this._compound_statement(),i=[];this._match_elseif()&&(this._check(MI.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(MI.keywords.else)&&(this._check(MI.tokens.attr)&&this._attribute(),n=this._compound_statement()),this._updateNode(new AX(t,r,i,n),e)}_match_elseif(){return this._tokens[this._current].type===MI.keywords.else&&this._tokens[this._current+1].type===MI.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new Mx(t,r))),this._match_elseif()&&(this._check(MI.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(MI.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new AJ(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(MI.tokens.or_or);)e=this._updateNode(new Mp(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(MI.tokens.and_and);)e=this._updateNode(new Mp(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(MI.tokens.or);)e=this._updateNode(new Mp(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(MI.tokens.xor);)e=this._updateNode(new Mp(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(MI.tokens.and);)e=this._updateNode(new Mp(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([MI.tokens.equal_equal,MI.tokens.not_equal])?this._updateNode(new Mp(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([MI.tokens.less_than,MI.tokens.greater_than,MI.tokens.less_than_equal,MI.tokens.greater_than_equal]);)e=this._updateNode(new Mp(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([MI.tokens.shift_left,MI.tokens.shift_right]);)e=this._updateNode(new Mp(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([MI.tokens.plus,MI.tokens.minus]);)e=this._updateNode(new Mp(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([MI.tokens.star,MI.tokens.forward_slash,MI.tokens.modulo]);)e=this._updateNode(new Mp(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([MI.tokens.minus,MI.tokens.bang,MI.tokens.tilde,MI.tokens.star,MI.tokens.and])?this._updateNode(new Md(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(MI.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(MI.tokens.bracket_right,"Expected ']'.");let t=this._updateNode(new Mh(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(MI.tokens.period)){let e=this._consume(MI.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new Mn(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return A5.void;case"bool":return A5.bool;case"i32":return A5.i32;case"u32":return A5.u32;case"f32":return A5.f32;case"f16":return A5.f16;case"vec2f":return A9.vec2f;case"vec3f":return A9.vec3f;case"vec4f":return A9.vec4f;case"vec2i":return A9.vec2i;case"vec3i":return A9.vec3i;case"vec4i":return A9.vec4i;case"vec2u":return A9.vec2u;case"vec3u":return A9.vec3u;case"vec4u":return A9.vec4u;case"vec2h":return A9.vec2h;case"vec3h":return A9.vec3h;case"vec4h":return A9.vec4h;case"mat2x2f":return A9.mat2x2f;case"mat2x3f":return A9.mat2x3f;case"mat2x4f":return A9.mat2x4f;case"mat3x2f":return A9.mat3x2f;case"mat3x3f":return A9.mat3x3f;case"mat3x4f":return A9.mat3x4f;case"mat4x2f":return A9.mat4x2f;case"mat4x3f":return A9.mat4x3f;case"mat4x4f":return A9.mat4x4f;case"mat2x2h":return A9.mat2x2h;case"mat2x3h":return A9.mat2x3h;case"mat2x4h":return A9.mat2x4h;case"mat3x2h":return A9.mat3x2h;case"mat3x3h":return A9.mat3x3h;case"mat3x4h":return A9.mat3x4h;case"mat4x2h":return A9.mat4x2h;case"mat4x3h":return A9.mat4x3h;case"mat4x4h":return A9.mat4x4h;case"mat2x2i":return A9.mat2x2i;case"mat2x3i":return A9.mat2x3i;case"mat2x4i":return A9.mat2x4i;case"mat3x2i":return A9.mat3x2i;case"mat3x3i":return A9.mat3x3i;case"mat3x4i":return A9.mat3x4i;case"mat4x2i":return A9.mat4x2i;case"mat4x3i":return A9.mat4x3i;case"mat4x4i":return A9.mat4x4i;case"mat2x2u":return A9.mat2x2u;case"mat2x3u":return A9.mat2x3u;case"mat2x4u":return A9.mat2x4u;case"mat3x2u":return A9.mat3x2u;case"mat3x3u":return A9.mat3x3u;case"mat3x4u":return A9.mat3x4u;case"mat4x2u":return A9.mat4x2u;case"mat4x3u":return A9.mat4x3u;case"mat4x4u":return A9.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-0x80000000||e>0x7fffffff)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>0xffffffff))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(MI.tokens.ident)){let e=this._previous().toString();if(this._check(MI.tokens.paren_left)){let t=this._argument_expression_list(),r=this._getType(e);return null!==r?this._updateNode(new Ms(r,t)):this._updateNode(new Ma(e,t))}if(this._context.constants.has(e)){let t=this._context.constants.get(e);return this._updateNode(new Ml(e,t.value))}return this._updateNode(new Mo(e))}if(this._match(MI.tokens.int_literal)){let e=this._previous().toString(),t=e.endsWith("i")||e.endsWith("i")?A5.i32:e.endsWith("u")||e.endsWith("U")?A5.u32:A5.x32,r=parseInt(e);return this._validateTypeRange(r,t),this._updateNode(new Mu(new ME(r,this._exec.getTypeInfo(t)),t))}if(this._match(MI.tokens.uint_literal)){let e=parseInt(this._previous().toString());return this._validateTypeRange(e,A5.u32),this._updateNode(new Mu(new ME(e,this._exec.getTypeInfo(A5.u32)),A5.u32))}if(this._match([MI.tokens.decimal_float_literal,MI.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));let r=parseFloat(e);this._validateTypeRange(r,t?A5.f16:A5.f32);let i=t?A5.f16:A5.f32;return this._updateNode(new Mu(new ME(r,this._exec.getTypeInfo(i)),i))}if(this._match([MI.keywords.true,MI.keywords.false])){let e=this._previous().toString()===MI.keywords.true.rule;return this._updateNode(new Mu(new ME(+!!e,this._exec.getTypeInfo(A5.bool)),A5.bool))}if(this._check(MI.tokens.paren_left))return this._paren_expression();if(this._match(MI.keywords.bitcast)){this._consume(MI.tokens.less_than,"Expected '<'.");let e=this._type_decl();this._consume(MI.tokens.greater_than,"Expected '>'.");let t=this._paren_expression();return this._updateNode(new Mc(e,t))}let e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Ms(e,t))}_argument_expression_list(){if(!this._match(MI.tokens.paren_left))return null;let e=[];do{if(this._check(MI.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(MI.tokens.comma))return this._consume(MI.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(MI.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(MI.tokens.paren_right),e}_paren_expression(){this._consume(MI.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(MI.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(MI.keywords.struct))return null;let e=this._currentLine,t=this._consume(MI.tokens.ident,"Expected name for struct.").toString();this._consume(MI.tokens.brace_left,"Expected '{' for struct body.");let r=[];for(;!this._check(MI.tokens.brace_right);){let e=this._attribute(),t=this._consume(MI.tokens.name,"Expected variable name.").toString();this._consume(MI.tokens.colon,"Expected ':' for struct member type.");let i=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=i),this._check(MI.tokens.brace_right)?this._match(MI.tokens.comma):this._consume(MI.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new M_(t,n,e)))}this._consume(MI.tokens.brace_right,"Expected '}' after struct body.");let i=this._currentLine,n=this._updateNode(new A7(t,r,e,i),e);return this._context.structs.set(t,n),n}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(MI.tokens.equal)&&(e.value=this._const_expression()),null!==e.type&&e.value instanceof Mu){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Mu&&(e.type="x32"===e.value.type.name?A5.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(MI.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(MI.keywords.const))return null;let t=this._consume(MI.tokens.name,"Expected variable name"),r=this._currentLine,i=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}let n=null;this._consume(MI.tokens.equal,"const declarations require an assignment");let s=this._short_circuit_or_expression();try{let e=[A5.f32],r=s.constEvaluate(this._exec,e);r instanceof ME&&this._validateTypeRange(r.value,e[0]),e[0]instanceof A9&&null===e[0].format&&r.typeInfo instanceof Ap&&null!==r.typeInfo.format&&("f16"===r.typeInfo.format.name?e[0].format=A5.f16:"f32"===r.typeInfo.format.name?e[0].format=A5.f32:"i32"===r.typeInfo.format.name?e[0].format=A5.i32:"u32"===r.typeInfo.format.name?e[0].format=A5.u32:"bool"===r.typeInfo.format.name?e[0].format=A5.bool:console.error(`TODO: impelement template format type ${r.typeInfo.format.name}`)),n=this._updateNode(new Mu(r,e[0])),this._exec.context.setVariable(t.toString(),r)}catch(e){n=s}if(null!==i&&n instanceof Mu){if("x32"!==n.type.name&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i,n.isScalar&&this._validateTypeRange(n.scalarValue,n.type)}else null===i&&n instanceof Mu&&(i=null!=(e=null==n?void 0:n.type)?e:A5.f32)===A5.x32&&(i=A5.i32);let a=this._updateNode(new AG(t.toString(),i,"","",n),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(MI.keywords.let))return null;let e=this._currentLine,t=this._consume(MI.tokens.name,"Expected variable name"),r=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}let i=null;if(this._match(MI.tokens.equal)&&(i=this._const_expression()),null!==r&&i instanceof Mu){if("x32"!==i.type.name&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else null===r&&i instanceof Mu&&(r="x32"===i.type.name?A5.i32:i.type);return i instanceof Mu&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new AW(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(MI.keywords.var))return null;let e=this._currentLine,t="",r="";this._match(MI.tokens.less_than)&&(t=this._consume(MI.storage_class,"Expected storage_class.").toString(),this._match(MI.tokens.comma)&&(r=this._consume(MI.access_mode,"Expected access_mode.").toString()),this._consume(MI.tokens.greater_than,"Expected '>'."));let i=this._consume(MI.tokens.name,"Expected variable name"),n=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(n=this._type_decl())&&(n.attributes=e)}return this._updateNode(new A$(i.toString(),n,t,r,null),e)}_override_decl(){if(!this._match(MI.keywords.override))return null;let e=this._consume(MI.tokens.name,"Expected variable name"),t=null;if(this._match(MI.tokens.colon)){let e=this._attribute();null!=(t=this._type_decl())&&(t.attributes=e)}return this._updateNode(new AV(e.toString(),t,null))}_diagnostic(){this._consume(MI.tokens.paren_left,"Expected '('");let e=this._consume(MI.tokens.ident,"Expected severity control name.");this._consume(MI.tokens.comma,"Expected ','");let t=this._consume(MI.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(MI.tokens.period)&&(t+=`.${this._consume(MI.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(MI.tokens.paren_right,"Expected ')'"),this._updateNode(new A1(e.toString(),t))}_enable_directive(){let e=this._consume(MI.tokens.ident,"identity expected.");return this._updateNode(new AQ(e.toString()))}_requires_directive(){let e=[this._consume(MI.tokens.ident,"identity expected.").toString()];for(;this._match(MI.tokens.comma);){let t=this._consume(MI.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new A0(e))}_type_alias(){let e=this._consume(MI.tokens.ident,"identity expected.");this._consume(MI.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let r=this._updateNode(new A2(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([MI.tokens.ident,...MI.texel_format,MI.keywords.bool,MI.keywords.f32,MI.keywords.i32,MI.keywords.u32])){let e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){let t=this._updateNode(new A8(e));return this._forwardTypeCount++,t}return this._updateNode(new A5(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(MI.template_types)){let e=this._advance().toString(),t=null,r=null;return this._match(MI.tokens.less_than)&&(t=this._type_decl(),r=null,this._match(MI.tokens.comma)&&(r=this._consume(MI.access_mode,"Expected access_mode for pointer").toString()),this._consume(MI.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new A9(e,t,r))}if(this._match(MI.keywords.ptr)){let e=this._previous().toString();this._consume(MI.tokens.less_than,"Expected '<' for pointer.");let t=this._consume(MI.storage_class,"Expected storage_class for pointer");this._consume(MI.tokens.comma,"Expected ',' for pointer.");let r=this._type_decl(),i=null;return this._match(MI.tokens.comma)&&(i=this._consume(MI.access_mode,"Expected access_mode for pointer").toString()),this._consume(MI.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Me(e,t.toString(),r,i))}let t=this._attribute();if(this._match(MI.keywords.array)){let e=null,r=-1,i=this._previous(),n=null;if(this._match(MI.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(MI.tokens.comma)){n=this._shift_expression();try{t=n.constEvaluate(this._exec).toString(),n=null}catch(e){t="1"}}this._consume(MI.tokens.greater_than,"Expected '>' for array."),r=t?parseInt(t):0}let s=this._updateNode(new Mt(i.toString(),t,e,r));return n&&this._deferArrayCountEval.push({arrayType:s,countNode:n}),s}return null}_texture_sampler_types(){if(this._match(MI.sampler_type)||this._match(MI.depth_texture_type))return this._updateNode(new Mr(this._previous().toString(),null,null));if(this._match(MI.sampled_texture_type)||this._match(MI.multisampled_texture_type)){let e=this._previous();this._consume(MI.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(MI.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Mr(e.toString(),t,null))}if(this._match(MI.storage_texture_type)){let e=this._previous();this._consume(MI.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(MI.texel_format,"Invalid texel format.").toString();this._consume(MI.tokens.comma,"Expected ',' after texel format.");let r=this._consume(MI.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(MI.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Mr(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(MI.tokens.attr);){let t=this._consume(MI.attribute_name,"Expected attribute name"),r=this._updateNode(new Mw(t.toString(),null));if(this._match(MI.tokens.paren_left)){if(r.value=this._consume(MI.literal_or_ident,"Expected attribute value").toString(),this._check(MI.tokens.comma)){this._advance();do{let e=this._consume(MI.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(e)}while(this._match(MI.tokens.comma))}this._consume(MI.tokens.paren_right,"Expected ')'")}e.push(r)}return 0==e.length?null:e}}class M5 extends MK{constructor(e){super(),e&&this.update(e)}update(e){let t=(new M6).parse(e);this.updateAST(t)}}function M8(e){return e?.format?`${e.name}<${e.format.name}>`:e.name}var M7=e.i(36932);let M9={};function Te(e="id"){M9[e]=M9[e]||1;let t=M9[e]++;return`${e}-${t}`}class Tt{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Te("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&E$.Buffer.INDEX))throw Error("Index buffer must have INDEX usage")}destroy(){for(let e of(this.indices?.destroy(),Object.values(this.attributes)))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}var Tr=e.i(81905);class Ti extends Tr.Resource{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Ti.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Tr.Resource.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Tn{static defaultProps={...At.RenderPipeline.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Tn(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);let t={...At.RenderPipeline.defaultProps,...e},r=this._renderPipelineCache,i=this._hashRenderPipeline(t),n=r[i]?.pipeline;return n?(r[i].useCount++,this.debug&&vO.log.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):((n=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:Te("unnamed-cached")})).hash=i,r[i]={pipeline:n,useCount:1},this.debug&&vO.log.warn(`${this}: ${n} created, count=${r[i].useCount}`)()),n}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);let t={...Ti.defaultProps,...e},r=this._computePipelineCache,i=this._hashComputePipeline(t),n=r[i]?.pipeline;return n?(r[i].useCount++,this.debug&&vO.log.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):((n=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0})).hash=i,r[i]={pipeline:n,useCount:1},this.debug&&vO.log.warn(`${this}: ${n} created, count=${r[i].useCount}`)()),n}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._getCache(e),r=e.hash;t[r].useCount--,0===t[r].useCount?(this._destroyPipeline(e),this.debug&&vO.log.warn(`${this}: ${e} released and destroyed`)()):t[r].useCount<0?(vO.log.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[r].useCount=0):this.debug&&vO.log.warn(`${this}: ${e} released, count=${t[r].useCount}`)()}_destroyPipeline(e){let t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Ti&&(t=this._computePipelineCache),e instanceof At.RenderPipeline&&(t=this._renderPipelineCache),!t)throw Error(`${this}`);if(!t[e.hash])throw Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){let{type:t}=this.device,r=this._getHash(e.shader.source);return`${t}/C/${r}`}_hashRenderPipeline(e){let t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout)),{type:n}=this.device;if("webgl"===n)return`${n}/R/${t}/${r}V-BL${i}`;{let s=this._getHash(JSON.stringify(e.parameters));return`${n}/R/${t}/${r}V-T${e.topology}P${s}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}var Ts=e.i(45453);class Ta{static defaultProps={...Ts.Shader.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Ta(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);let t=this._hashShader(e),r=this._cache[t];if(r)r.useCount++,this.debug&&vO.log.warn(`${this}: Reusing shader ${r.shader.id} count=${r.useCount}`)();else{let i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:1},this.debug&&vO.log.warn(`${this}: Created new shader ${i.id}`)()}return r.shader}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._hashShader(e),r=this._cache[t];if(r)if(r.useCount--,0===r.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],r.shader.destroy(),this.debug&&vO.log.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else if(r.useCount<0)throw Error(`ShaderFactory: Shader ${e.id} released too many times`);else this.debug&&vO.log.warn(`${this}: Releasing shader ${e.id} count=${r.useCount}`)()}_hashShader(e){return`${e.stage}:${e.source}`}}let To=null,Tl=null;class Tu{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){let r=[...e];for(let e of t){let t=r.findIndex(t=>t.name===e.name);t<0?r.push(e):r[t]=e}return r}getBufferIndex(e){let t=this.bufferLayouts.findIndex(t=>t.name===e);return -1===t&&vO.log.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}class Tc{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){for(const r of(Object.assign(this.options,t),vg(Object.values(e).filter(e=>e.dependencies))))e[r.name]=r;for(const[t,r]of(vO.log.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={},Object.entries(e)))this._addModule(r),r.name&&t!==r.name&&!this.options.disableWarnings&&vO.log.warn(`Module name: ${t} vs ${r.name}`)()}destroy(){}setProps(e){for(let t of Object.keys(e)){let r=e[t]||{},i=this.modules[t];if(!i){this.options.disableWarnings||vO.log.warn(`Module ${t} not found`)();continue}let n=this.moduleUniforms[t],s=this.moduleBindings[t],{uniforms:a,bindings:o}=function(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let i=e[r];(!ArrayBuffer.isView(i)||i instanceof DataView)&&(Array.isArray(i)?0!==i.length&&"number"!=typeof i[0]:1)&&"number"!=typeof i&&"boolean"!=typeof i?t.bindings[r]=i:t.uniforms[r]=i}),t}(i.getUniforms?.(r,n)||r);this.moduleUniforms[t]={...n,...a},this.moduleBindings[t]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,r]of Object.entries(this.moduleUniforms))for(let[i,n]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(n)};return e}_addModule(e){let t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}async function Th(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:""+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}let Tf=["+X","-X","+Y","-Y","+Z","-Z"],Td=["+X","-X","+Y","-Y","+Z","-Z"];class Tp{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const r=Te("async-texture");this.props={...Tp.defaultProps,id:r,...t},this.id=this.props.id,t={...t},"string"==typeof t?.data&&"2d"===t.dimension&&(t.data=Th(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){let t=e.data,r=await Tg(t).then(void 0,this.rejectReady);if(this.destroyed)return;let i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(r);if(!i)throw Error("Texture size could not be determined");let n={...i,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(n.width,n.height);if(n.mipLevels="auto"===this.props.mipLevels?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,r);break;case"2d":this._setTexture2DData(r);break;case"3d":this._setTexture3DData(this.texture,r);break;case"2d-array":this._setTextureArrayData(this.texture,r);break;case"cube":this._setTextureCubeData(this.texture,r);break;case"cube-array":this._setTextureCubeArrayData(this.texture,r)}this.props.mipmaps&&this.generateMipmaps(),vO.log.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Ae.Sampler?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){return ArrayBuffer.isView(e?.data)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){let t=Object.values(e)[0];return{width:t.width,height:t.height}}throw Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw Error("Texture not initialized");let r=this._normalizeTextureData(e);r.length>1&&!1!==this.props.mipmaps&&vO.log.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let e=0;e<r.length;e++){let i=r[e];this.device.isExternalImage(i)?this.texture.copyExternalImage({image:i,depth:t,mipLevel:e,flipY:!0}):this.texture.copyImageData({data:i.data,mipLevel:e})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw Error(this.id);for(let[e,r]of Object.entries(t)){let t=Td.indexOf(e);this._setTexture2DData(r,t)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeArrayData(e,t){throw Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,r,i=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&vO.log.warn(`${this.id} has mipmap and multiple LODs.`)();let n=Tf.indexOf(r);this._setTexture2DData(t,n)}_normalizeTextureData(e){let t=this.texture;return ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e]}static defaultProps={...E7.Texture.defaultProps,data:null,mipmaps:!1}}async function Tg(e){if(Array.isArray(e=await e))return await Promise.all(e.map(Tg));if(e&&"object"==typeof e&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),i=Object.keys(t),n={};for(let e=0;e<i.length;e++)n[i[e]]=r[e];return n}return e}class Tm{static defaultProps={...At.RenderPipeline.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:vC.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Tm.defaultProps,...t},t=this.props,this.id=t.id||Te("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(e=>[e.name,e])||[]),i=t.shaderInputs||new Tc(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const n=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:n,...this.props,modules:s});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=function(e){let t,r={attributes:[],bindings:[]};try{t=function(e){try{return new M5(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&t?.message&&(e+=`: ${t.message} `),"object"==typeof t&&t?.token&&(e+=t.token.line||""),Error(e,{cause:t})}}(e)}catch(e){return vO.log.error(e.message)(),r}for(let e of t.uniforms){let t=[];for(let r of e.type?.members||[])t.push({name:r.name,type:M8(r.type)});r.bindings.push({type:"uniform",name:e.name,group:e.group,location:e.binding,members:t})}for(let e of t.textures)r.bindings.push({type:"texture",name:e.name,group:e.group,location:e.binding});for(let e of t.samplers)r.bindings.push({type:"sampler",name:e.name,group:e.group,location:e.binding});let i=t.entry.vertex[0],n=i?.inputs.length||0;for(let e=0;e<n;e++){let t=i.inputs[e];if("location"===t.locationType){let e=M8(t.type);r.attributes.push({name:t.name,location:Number(t.location),type:e})}}return r}(this.source)}else{const{vs:e,fs:t,getUniforms:r}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:n,...this.props,modules:s});this.vs=e,this.fs=t,this._getModuleUniforms=r}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Tn.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Ta.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t,r=this._areBindingsLoading();if(r)return vO.log.info(2,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings});let{indexBuffer:i}=this.vertexArray,n=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&function(e,t){if(t instanceof Tt)return t;let r=function(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:E$.Buffer.INDEX,data:r})}(e,t),{attributes:i,bufferLayout:n}=function(e,t){let r=[],i={};for(let[n,s]of Object.entries(t.attributes)){let t=n;switch(n){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(s){i[t]=e.createBuffer({data:s.value,id:`${n}-buffer`});let{value:a,size:o,normalized:l}=s;r.push({name:t,format:(0,M7.getVertexFormatFromAttribute)(a,o,l)})}}return{attributes:i,bufferLayout:r,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new Tt({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:r,attributes:i})}(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");let e=new Tu(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let t=new Tu(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){!function e(t,r,i){if(t===r)return!0;if(!i||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n],i-1))return!1;return!0}if(Array.isArray(r))return!1;if("object"==typeof t&&"object"==typeof r){let n=Object.keys(t),s=Object.keys(r);if(n.length!==s.length)return!1;for(let s of n)if(!r.hasOwnProperty(s)||!e(t[s],r[s],i-1))return!1;return!0}return!1}(e,this.parameters,2)&&(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){for(let[r,i]of(this.shaderInputs=e,this._uniformStore=new Ao(this.shaderInputs.modules),Object.entries(this.shaderInputs.modules))){var t;if((t=i).uniformTypes&&!function(e){for(let t in e)return!1;return!0}(t.uniformTypes)){let e=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=e}}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){var r,i;let n,s,a=t?.disableWarnings??this.props.disableWarnings;e.indices&&vO.log.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=(r=this.pipeline.shaderLayout,i=this.bufferLayout,n=Object.fromEntries(r.attributes.map(e=>[e.name,e.location])),(s=i.slice()).sort((e,t)=>{let r=e.attributes?e.attributes.map(e=>e.attribute):[e.name],i=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...r.map(e=>n[e]))-Math.min(...i.map(e=>n[e]))}),s);let o=new Tu(this.bufferLayout);for(let[t,r]of Object.entries(e)){let e=o.getBufferLayout(t);if(!e){a||vO.log.warn(`Model(${this.id}): Missing layout for buffer "${t}".`)();continue}let i=o.getAttributeNamesForBuffer(e),n=!1;for(let e of i){let t=this._attributeInfos[e];if(t){let e="webgpu"===this.device.type?o.getBufferIndex(t.bufferName):t.location;this.vertexArray.setBuffer(e,r),n=!0}}n||a||vO.log.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${t}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[r,i]of Object.entries(e)){let e=this._attributeInfos[r];e?this.vertexArray.setConstantWebGL(e.location,i):(t?.disableWarnings??this.props.disableWarnings)||vO.log.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof Tp&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[t,r]of Object.entries(this.bindings))r instanceof Tp?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof E9.TextureView?e=Math.max(e,t.texture.updateTimestamp):t instanceof E$.Buffer||t instanceof E7.Texture?e=Math.max(e,t.updateTimestamp):t instanceof Tp?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Ae.Sampler||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(t=>t.name===e)||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(vO.log.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=(0,Al.getAttributeInfosFromLayouts)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=vO.log.level>3?0:1e4;vO.log.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,vO.log.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:vO.log.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=function(e,t){let r={},i="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let t of e.attributes)if(t){let e=`${t.location} ${t.name}: ${t.type}`;r[`in ${e}`]={[i]:t.stepMode||"vertex"}}for(let t of e.varyings||[]){let e=`${t.location} ${t.name}`;r[`out ${e}`]={[i]:JSON.stringify(t)}}return r}(this.pipeline.shaderLayout,this.id);vO.log.table(2,e)();let t=this.shaderInputs.getDebugTable();vO.log.table(2,t)();let r=this._getAttributeDebugTable();vO.log.table(2,this._attributeInfos)(),vO.log.table(2,r)(),vO.log.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;let r=e.props.framebuffer;r&&function(e,{id:t,minimap:r,opaque:i,top:n="0",left:s="0",rgbaScale:a=1}){To||((To=document.createElement("canvas")).id=t,To.title=t,To.style.zIndex="100",To.style.position="absolute",To.style.top=n,To.style.left=s,To.style.border="blue 5px solid",To.style.transform="scaleY(-1)",document.body.appendChild(To),Tl=To.getContext("2d")),(To.width!==e.width||To.height!==e.height)&&(To.width=e.width/2,To.height=e.height/2,To.style.width="400px",To.style.height="400px");let o=e.device.readPixelsToArrayWebGL(e),l=Tl?.createImageData(e.width,e.height);if(l){for(let e=0;e<o.length;e+=4)l.data[0+e+0]=o[e+0]*a,l.data[0+e+1]=o[e+1]*a,l.data[0+e+2]=o[e+2]*a,l.data[0+e+3]=i?255:o[e+3]*a;Tl?.putImageData(l,0,0)}}(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,r]of Object.entries(this._attributeInfos)){let i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,r="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){let r=(0,EW.getTypedArrayConstructor)(t);return(e instanceof E$.Buffer?new r(e.debugData):e).toString()}}class Ty{device;model;transformFeedback;static defaultProps={...Tm.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Ty.defaultProps){if(!Ty.isSupported(e))throw Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Tm(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||function(e){let{input:t,inputChannels:r,output:i}={};if(!t)return E8;if(!r)throw Error("inputChannels");let n=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`invalid channels: ${e}`)}}(r),s=function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw Error(`invalid channels: ${t}`)}}(t,r);return`\
#version 300 es
in ${n} ${t};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(!t)throw Error("BufferTransform#getBuffer");if(t instanceof E$.Buffer)return t.readAsync();let{buffer:r,byteOffset:i=0,byteLength:n=r.byteLength}=t;return r.readAsync(i,n)}}function Tv(e,t=[],r=0){let i=Math.fround(e),n=e-i;return t[r]=i,t[r+1]=n,t}let Tb={name:"fp64arithmetic",vs:`\

uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:Tv,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let n=4*r+i;Tv(e[4*i+r],t,2*n)}return t}};function Tx(e){let{source:t,target:r,start:i=0,size:n,getData:s}=e,a=e.end||r.length,o=t.length,l=a-i;if(o>l)return void r.set(t.subarray(0,l),i);if(r.set(t,i),!s)return;let u=o;for(;u<l;){let e=s(u,t);for(let t=0;t<n;t++)r[i+u]=e[t]||0,u++}}function T_(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`No defined attribute type for size "${e}"`)}}function Tw(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw Error("invalid type size")}}function Tk(e){e.push(e.shift())}function TP({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function TS({device:e,buffer:t,attribute:r,fromLength:i,toLength:n,fromStartIndices:s,getData:a=e=>e}){let o=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*o,u=r.byteOffset,c=r.settings.bytesPerElement<4?u/r.settings.bytesPerElement*4:u,h=r.startIndices,f=s&&h,d=r.isConstant;if(!f&&t&&i>=n)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=d?r.value:new p(r.getBuffer().readSyncWebGL(u,n*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!d){let e=a;a=(t,i)=>r.normalizeConstant(e(t,i))}let m=d?(e,t)=>a(g,t):(e,t)=>a(g.subarray(e+u,e+u+l),t),y=new Float32Array(t?t.readSyncWebGL(c,4*i).buffer:0),v=new Float32Array(n);return!function({source:e,target:t,size:r,getData:i,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return Tx({source:e,target:t,size:r,getData:i});let a=0,o=0,l=i&&((e,t)=>i(e+o,t)),u=Math.min(n.length,s.length);for(let i=1;i<u;i++){let u=n[i]*r,c=s[i]*r;Tx({source:e.subarray(a,u),target:t,start:o,end:c,size:r,getData:l}),a=u,o=c}o<t.length&&Tx({source:[],target:t,start:o,size:r,getData:l})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<v.byteLength+c)&&(t?.destroy(),t=e.createBuffer({byteLength:v.byteLength+c,usage:35050})),t.write(v,c),t}class TE{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new So(r),this.attribute=t,this.attributeInTransition=function(e){let{device:t,settings:r,value:i}=e,n=new E6(t,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){let{doublePrecision:r,settings:i,value:n,size:s}=e,a=r&&n instanceof Float64Array?2:1,o=0,{shaderAttributes:l}=e.settings;if(l)for(let e of Object.values(l))o=Math.max(o,e.vertexOffset??0);return(i.noAlloc?n.length:(t+o)*s)*a}(this.attribute,t),this.transition.start({...e,duration:r})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){for(let e of(this.cancel(),this.buffers))e.destroy();this.buffers.length=0}}let TA={name:"interpolation",vs:`\
uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},TM=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,TT=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function TC(e){return e.doublePrecision&&e.value instanceof Float64Array}let TO={name:"spring",vs:`\
uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},TI=`\
#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,TL=`\
#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`,Tj={interpolation:class extends TE{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=function(e,t){let r=t.size,i=T_(r),n=Tw(r),s=t.getBufferLayout();return TC(t)?new Ty(e,{vs:TT,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[Tb,TA],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ty(e,{vs:TM,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],modules:[TA],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();let{buffers:n,attribute:s}=this;Tk(n),n[0]=TS({device:this.device,buffer:n[0],attribute:s,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),n[1]=TP({device:this.device,source:n[0],target:n[1]}),this.setBuffer(n[1]);let{transform:a}=this,o=a.model,l=Math.floor(this.currentLength/s.size);TC(s)&&(l/=2),o.setVertexCount(l),s.isConstant?(o.setAttributes({aFrom:n[0]}),o.setConstantAttributes({aTo:s.value})):o.setAttributes({aFrom:n[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:n[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:r}=this.transition,i=r/e;t&&(i=t(i));let{model:n}=this.transform,s={time:i};n.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends TE{constructor({device:e,attribute:t,timeline:r}){var i,n;super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1}),this.framebuffer=(i=e,n=this.texture,i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[n]})),this.transform=function(e,t){let r=T_(t.size),i=Tw(t.size);return new Ty(e,{vs:TI,fs:TL,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[TO],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;super.start(e,t);let{buffers:n,attribute:s}=this;for(let t=0;t<2;t++)n[t]=TS({device:this.device,buffer:n[t],attribute:s,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});n[2]=TP({device:this.device,source:n[0],target:n[2]}),this.setBuffer(n[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:r,transition:i}=this,n=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});let s={stiffness:n.stiffness,damping:n.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Tk(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class TN{constructor(e,{id:t,timeline:r}){if(!e)throw Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){for(let i in this.numInstances=r||1,e){let r=e[i],n=r.getTransitionSetting(t);n&&this._updateAttribute(i,r,n)}for(let r in this.transitions){let i=e[r];i&&i.getTransitionSetting(t)||this._removeTransition(r)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(let e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){let i=this.transitions[e],n=!i||i.type!==r.type;if(n){i&&this._removeTransition(e);let s=Tj[r.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(xo.error(`unsupported transition type '${r.type}'`)(),n=!1)}(n||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}let TD="attributeManager.invalidate";class TR{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=x2(P2),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new TN(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let r=this._invalidateTrigger(e,t);kA(TD,this,e,r)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);kA(TD,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:n={},buffers:s={},context:a={}}){let o=!1;for(let i in kA("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){let l=this.attributes[i],u=l.settings.accessor;l.startIndices=r,l.numInstances=t,n[i]&&xo.removed(`props.${i}`,`data.attributes.${i}`)(),l.setExternalBuffer(s[i])||l.setBinaryValue("string"==typeof u?s[u]:void 0,e.startIndices)||"string"==typeof u&&!s[u]&&l.setConstantValue(a,n[u])||l.needsUpdate()&&(o=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:n,context:a})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}o&&kA("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map(e=>this.attributes[e]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(let n in t){let s=t[n];s.needsRedraw(e)&&!r.hasAttribute(n)&&(i[n]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(let r in e){let i=e[r],n={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new E6(this.device,n)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:r,updateTriggers:i}=this,n=i[e];return n&&n.forEach(e=>{let i=r[e];i&&i.setNeedsUpdate(i.id,t)}),n}_updateAttribute(e){let{attribute:t,numInstances:r}=e;(kA("attribute.updateStart",t),t.constant)?t.setConstantValue(e.context,t.value):(t.allocate(r)&&kA("attribute.allocate",t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,kA("attribute.updateEnd",t,r)))}}function Tz(e,t,r,i,n){let s=t-e;return(r-t)*n+-s*i+s+t}function TF(e,t){if(Array.isArray(e)){let r=0;for(let i=0;i<e.length;i++){let n=e[i]-t[i];r+=n*n}return Math.sqrt(r)}return Math.abs(e-t)}let TB={interpolation:class extends So{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:n}}=this,s=n(e/i);this._value=_p(t,r,s)}},spring:class extends So{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:n=e,_currValue:s=e}=this,a=function(e,t,r,i,n){if(Array.isArray(r)){let s=[];for(let a=0;a<r.length;a++)s[a]=Tz(e[a],t[a],r[a],i,n);return s}return Tz(e,t,r,i,n)}(n,s,t,r,i),o=TF(a,t),l=TF(a,s);o<1e-5&&l<1e-5&&(a=t,this.end()),this._prevValue=s,this._currValue=a}}};class TU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){let{transitions:n}=this;if(n.has(e)){let r=n.get(e),{value:i=r.settings.fromValue}=r;t=i,this.remove(e)}if(!(i=E4(i)))return;let s=TB[i.type];if(!s)return void xo.error(`unsupported transition type '${i.type}'`)();let a=new s(this.timeline);a.start({...i,fromValue:t,toValue:r}),n.set(e,a)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}}function T$({newProps:e,oldProps:t,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(t===e)return!1;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return`${n} changed shallowly`;for(let s of Object.keys(e))if(!(s in r)){if(!(s in t))return`${n}.${s} added`;let r=TV(e[s],t[s],i[s]);if(r)return`${n}.${s} ${r}`}for(let s of Object.keys(t))if(!(s in r)){if(!(s in e))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){let r=TV(e[s],t[s],i[s]);if(r)return`${n}.${s} ${r}`}}return!1}function TV(e,t,r){let i=r&&r.equal;return i&&!i(e,t,r)||!i&&(i=e&&t&&e.equals)&&!i.call(e,t)?"changed deeply":i||t===e?null:"changed shallowly"}function TW(e,t,r){let i=e.updateTriggers[r];i=null==i?{}:i;let n=t.updateTriggers[r];return T$({oldProps:n=null==n?{}:n,newProps:i,triggerName:r})}function TG(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){let e=r.modules.findIndex(e=>"project32"===e.name);e>=0&&r.modules.splice(e,1)}if("inject"in t)if(e.inject){let i={...e.inject};for(let e in t.inject)i[e]=(i[e]||"")+t.inject[e];r.inject=i}else r.inject=t.inject;return r}var wX=wX,xs=xs;let Tq=[0,0,0];function TH(e,t,r=!1){let i=t.projectPosition(e);if(r&&t instanceof Sa){let[r,n,s=0]=e,a=t.getDistanceScales([r,n]);i[2]=s*a.unitsPerMeter[2]}return i}function TK(e,{viewport:t,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:s}){let[a,o,l=0]=e;switch(r&&([a,o,l]=xs.transformMat4([],[a,o,l,1],r)),i){case xX.LNGLAT:return TH([a,o,l],t,s);case xX.LNGLAT_OFFSETS:return TH([a+n[0],o+n[1],l+(n[2]||0)],t,s);case xX.METER_OFFSETS:return TH(w8(n,[a,o,l]),t,s);case xX.CARTESIAN:default:return t.isGeospatial?[a+n[0],o+n[1],l+n[2]]:t.projectPosition([a,o,l])}}let TY={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},TZ={},TX={boolean:{validate:(e,t)=>!0,equal:(e,t,r)=>!!e==!!t},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||TQ(e)&&(3===e.length||4===e.length),equal:(e,t,r)=>Se(e,t,1)},accessor:{validate(e,t){let r=T0(e);return"function"===r||r===T0(t.value)},equal:(e,t,r)=>"function"==typeof t||Se(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||TQ(e),equal(e,t,r){let{compare:i}=r,n=Number.isInteger(i)?i:+!!i;return i?Se(e,t,n):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:i}=r,n=Number.isInteger(i)?i:+!!i;return i?Se(e,t,n):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,r)=>!r.compare&&!1!==r.ignore||e===t},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:i}=r.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let i=r.context;return i&&i.device?function(e,t,r,i){if(r instanceof E7.Texture)return r;r.constructor&&"Object"!==r.constructor.name&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let{width:s,height:a}=r.data,o=t.createTexture({...r,sampler:{...TY,...n,...i},mipLevels:t.getMipLevelCount(s,a)});return o.generateMipmapsWebGL(),TZ[o.id]=e,o}(r.id,i.device,e,{...t.parameters,...r.props.textureParameters}):null},release:(e,t,r)=>{var i;i=r.id,e&&e instanceof E7.Texture&&TZ[e.id]===i&&(e.delete(),delete TZ[e.id])}}};function TJ(e,t){return"type"in t?{name:e,...TX[t.type],...t}:"value"in t?{name:e,type:T0(t.value),...t}:{name:e,type:"object",value:t}}function TQ(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function T0(e){return TQ(e)?"array":null===e?"null":typeof e}function T1(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let T2=0;class T3{constructor(...e){this.props=function(e,t){let r;for(let e=t.length-1;e>=0;e--){let i=t[e];"extensions"in i&&(r=i.extensions)}let i=Object.create(function e(t,r){var i,n;if(!(t instanceof T4.constructor))return{};let s="_mergedDefaultProps";if(r)for(let e of r){let t=e.constructor;t&&(s+=`:${t.extensionName||t.name}`)}let a=T1(i=t,n=s)&&i[n];return a||(t[s]=function(t,r){var i;let n;if(!t.prototype)return null;let s=e(Object.getPrototypeOf(t)),a=function(e){let t={},r={},i={};for(let[n,s]of Object.entries(e)){let e=s?.deprecatedFor;if(e)i[n]=Array.isArray(e)?e:[e];else{let e=function(e,t){switch(T0(t)){case"object":return TJ(e,t);case"array":return TJ(e,{type:"array",value:t,compare:!1});case"boolean":return TJ(e,{type:"boolean",value:t});case"number":return TJ(e,{type:"number",value:t});case"function":return TJ(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}(n,s);t[n]=e,r[n]=e.value}}return{propTypes:t,defaultProps:r,deprecatedProps:i}}(function(e,t){return T1(e,t)&&e[t]}(t,"defaultProps")||{}),o=Object.assign(Object.create(null),s,a.defaultProps),l=Object.assign(Object.create(null),s?.[kx],a.propTypes),u=Object.assign(Object.create(null),s?.[k_],a.deprecatedProps);for(let t of r){let r=e(t.constructor);r&&(Object.assign(o,r),Object.assign(l,r[kx]),Object.assign(u,r[k_]))}return Object.defineProperties(o,{id:{writable:!0,value:((n=(i=t).componentName)||xo.warn(`${i.name}.componentName not specified`)(),n||i.name)}}),function(e,t){let r={},i={};for(let e in t){let n=t[e],{name:s,value:a}=n;n.async&&(r[s]=a,i[s]=function(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||EQ(t)?this[kk][e]=t:this[kP][e]=t},get(){if(this[kP]){if(e in this[kP])return this[kP][e]||this[kw][e];if(e in this[kk]){let t=this[kb]&&this[kb].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[kw][e]}}return this[kw][e]}}}(s))}e[kw]=r,e[kk]={},Object.defineProperties(e,i)}(o,l),function(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(e){let i=`${this.id}: ${r}`;for(let i of t[r])T1(this,i)||(this[i]=e);xo.deprecated(i,t[r].join("/"))()}})}(o,u),o[kx]=l,o[k_]=u,0!==r.length||T1(t,"_propTypes")||(t._propTypes=l),o}(t,r||[]))}(e.constructor,r));i[kb]=e,i[kk]={},i[kP]={};for(let e=0;e<t.length;++e){let r=t[e];for(let e in r)i[e]=r[e]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=T2++}clone(e){let{props:t}=this,r={};for(let e in t[kw])e in t[kP]?r[e]=t[kP][e]:e in t[kk]&&(r[e]=t[kk][e]);return new this.constructor({...t,...r,...e})}}T3.componentName="Component",T3.defaultProps={};let T4=T3,T6=Object.freeze({});class T5{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||T6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[kb]||this.component;let t=e[kP]||{},r=e[kk]||e,i=e[kw]||{};for(let e in t){let r=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,r),t[e]=this.getAsyncProp(e)}for(let e in r){let t=r[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise)return void this._watchPromise(e,t);if(EQ(t))return void this._resolveAsyncIterable(e,t);this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps)for(let e in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}_didAsyncInputValueChange(e,t){let r=this.asyncProps[e];return t!==r.resolvedValue&&t!==r.lastValue&&(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){let i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let r=this.asyncProps[e];if(r){r.pendingLoadCount++;let i=r.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(r,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);let r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;let i=r.pendingLoadCount,n=[],s=0;for await(let r of t){if(!this.component)return;let{dataTransform:t}=this.component.props;Object.defineProperty(n=t?t(r,n):n.concat(r),"__diff",{enumerable:!1,value:[{startRow:s,endRow:n.length}]}),s=n.length,this._setAsyncPropValue(e,n,i)}this._onResolve(e,n)}_postProcessValue(e,t){let r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let r=this.component&&this.component.props[kx];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class T8 extends T5{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){let r=this.layer;if(r){let i=r.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){let r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}let T7=Object.freeze([]),T9=x2(({oldViewport:e,viewport:t})=>e.equals(t)),Ce=new Uint8ClampedArray(0),Ct={data:{type:"data",value:T7,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:i,loadOptions:n,signal:s})=>{let{resourceManager:a}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let o=a.contains(e);return(o||n||(a.add({resourceId:e,data:PK(e,i),persistent:!1}),o=!0),o)?a.subscribe({resourceId:e,onChange:e=>r.internalState?.reloadAsyncProp(t,e),consumerId:r.id,requestId:t}):PK(e,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:xX.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-(100*e)]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Cr extends T4{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){let e=this.constructor.layerName||this.constructor.name;return`${e}({id: '${this.props.id}'})`}project(e){Sh(this.internalState);let t=this.internalState.viewport||this.context.viewport,[r,i,n]=ke(TK(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),t.pixelProjectionMatrix);return 2===e.length?[r,i]:[r,i,n]}unproject(e){return Sh(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return Sh(this.internalState),function(e,t){let{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=function(e){let{viewport:t,modelMatrix:r,coordinateOrigin:i}=e,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}=e;return n===xX.DEFAULT&&(n=t.isGeospatial?xX.LNGLAT:xX.CARTESIAN),void 0===s&&(s=n),void 0===a&&(a=i),{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:a}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:u=Tq,shaderCoordinateOrigin:c=Tq,offsetMode:h=!1}=l?x9(r,i,n):{},f=TK(e,{viewport:r,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:h});if(h){let e=r.projectPosition(u||c);wX.sub(f,f,e)}return f}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===xX.DEFAULT||e===xX.LNGLAT||e===xX.CARTESIAN}onHover(e,t){return!!this.props.onHover&&(this.props.onHover(e,t)||!1)}onClick(e,t){return!!this.props.onClick&&(this.props.onClick(e,t)||!1)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Sh(e instanceof Uint8Array);let[t,r,i]=e;return t+256*r+65536*i-1}getNumInstances(){if(Number.isFinite(this.props.numInstances))return this.props.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;var e,t,r=this.props.data;if(null===(e=r)||"object"!=typeof e)throw Error("count(): argument not an object");if("function"==typeof r.count)return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(null!==(t=r)&&"object"==typeof t&&t.constructor===Object)return Object.keys(r).length;throw Error("count(): argument not a container")}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){for(let t of(e=TG(e,{disableWarnings:!0,modules:this.context.defaultShaderModules}),this.props.extensions))e=TG(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(let e of r)t.invalidateAll(e);else t.invalidateAll();if(t){let{props:r}=e,i=this.internalState.hasPickingBuffer,n=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==n){this.internalState.hasPickingBuffer=n;let{pickingColors:e,instancePickingColors:r}=t.attributes,i=e||r;i&&(n&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||n||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(let e of this.getModels())e.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){let{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,t&&T9({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let r in e)e[r].layoutChanged()&&(t=!0);for(let r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),r=Object.create(this.props);for(let e in t)Object.defineProperty(r,e,{value:t[e]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let r=Math.floor(Ce.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>0xffffff&&xo.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")();let e=Math.floor((Ce=PX.allocate(Ce,t,{size:4,copy:!0,maxCount:Math.max(t,0xffffff)})).length/4),i=[0,0,0];for(let t=r;t<e;t++)this.encodePickingColor(t,i),Ce[4*t+0]=i[0],Ce[4*t+1]=i[1],Ce[4*t+2]=i[2],Ce[4*t+3]=0}e.value=Ce.subarray(0,4*t)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){let r=this.getAttributeManager();e.setBufferLayout(r.getBufferLayouts(e)),t=r.getAttributes()}let i=e.userData?.excludeAttributes||{},n={},s={};for(let r in t){if(i[r])continue;let a=t[r].getValue();for(let i in a){let o=a[i];o instanceof E$.Buffer?t[r].settings.isIndexed?e.setIndexBuffer(o):n[i]=o:o&&(s[i]=o)}}e.setAttributes(n),e.setConstantAttributes(s)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i,s=n&&t.attributes&&t.attributes[n.id];if(s&&s.value){let r=s.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){let t=n.getVertexOffset(e);r[t]===i[0]&&r[t+1]===i[1]&&r[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;let n=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-n),n)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ce.buffer&&(r.value=Ce.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Sh(!this.internalState),Sh(Number.isFinite(this.props.coordinateSystem)),kA("layer.initialize",this);let e=this._getAttributeManager();for(let t of(e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new T8({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(xo.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new TU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context),this.props.extensions))t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){kA("layer.matched",this,this===e);let{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(kA("layer.update",this,e),!e)return;let t=this.props,r=this.context,i=this.internalState,n=r.viewport,s=this._updateUniformTransition();i.propsInTransition=s,r.viewport=i.viewport||n,this.props=s;try{let e=this._getUpdateParams(),t=this.getModels();if(r.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(let t of this.props.extensions)t.updateState.call(this,e,t);this.setNeedsRedraw(),this._updateAttributes();let i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{r.viewport=n,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){for(let e of(kA("layer.finalize",this),this.finalizeState(this.context),this.props.extensions))e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();let n=this.props,s=this.context;this.props=this.internalState.propsInTransition||n;try{t&&this.setShaderModuleProps(t);let{getPolygonOffset:n}=this.props,a=n&&n(r)||[0,0];for(let e of(s.device instanceof EV.WebGLDevice&&s.device.setParametersWebGL({polygonOffset:a}),this.getModels()))"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(s.device instanceof EV.WebGLDevice)s.device.withParametersWebGL(i,()=>{let n={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:s};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)});else{let n={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:s};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)}}finally{this.props=n}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let r in e)if(e[r]){let i=!1;if("dataChanged"===r){let n=e[r],s=t[r];n&&Array.isArray(s)&&(t.dataChanged=Array.isArray(n)?s.concat(n):n,i=!0)}t[r]||(t[r]=e[r],i=!0),i&&kA("layer.changeFlag",this,r,e)}let r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let r,i,n,s=(r=T$({newProps:e,oldProps:t,propTypes:e[kx],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:n}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&n&&(r=n(e.data,t.data)||r),r}(e,t),n=!1,i||(n=function(e,t){if(null===t||"all"in e.updateTriggers&&TW(e,t,"all"))return{all:!0};let r={},i=!1;for(let n in e.updateTriggers)"all"!==n&&TW(e,t,n)&&(r[n]=!0,i=!0);return!!i&&r}(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:function(e,t){if(null===t)return!0;let r=t.extensions,{extensions:i}=e;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(r[e]))return!0;return!1}(e,t),transitionsChanged:function(e,t){if(!e.transitions)return!1;let r={},i=e[kx],n=!1;for(let s in e.transitions){let a=i[s],o=a&&a.type;("number"===o||"color"===o||"array"===o)&&TV(e[s],t[s],a)&&(r[s]=!0,n=!0)}return!!n&&r}(e,t)});if(s.updateTriggersChanged)for(let e in s.updateTriggersChanged)s.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(s.transitionsChanged)for(let r in s.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],e.transitions?.[r]);return this.setChangeFlags(s)}validateProps(){!function(e){let t=e[kx];for(let r in t){let i=t[r],{validate:n}=i;if(n&&!n(e[r],i))throw Error(`Invalid prop ${r}: ${e[r]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&"function"==typeof r&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new TR(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:r,oldProps:i}=e,n=this.state.model;n?.isInstanced&&n.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:o}=r;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==a||i.highlightColor!==o){let e={};Array.isArray(o)&&(e.highlightColor=o),(t||i.autoHighlight!==s||a!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=this.internalState.needsRedraw&&this.id;let r=this.getAttributeManager(),i=!!r&&r.getNeedsRedraw(e);if(t=t||i)for(let e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Cr.defaultProps=Ct,Cr.layerName="Layer";let Ci=Cr,Cn={position:"absolute",zIndex:-1};function Cs(e){return e&&"object"==typeof e&&"type"in e||!1}let Ca=(0,Q.createContext)(),Co={mixBlendMode:null};function Cl(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}let Cu=Q.forwardRef(function(e,t){let[r,i]=(0,Q.useState)(0),n=(0,Q.useRef)({control:null,version:r,forceUpdate:()=>i(e=>e+1)}).current,s=(0,Q.useRef)(null),a=(0,Q.useRef)(null),o=(0,Q.useMemo)(()=>(function({children:e,layers:t=[],views:r=null}){let i=[],n=[],s={};return Q.Children.forEach(function e(t){if("function"==typeof t)return(0,Q.createElement)(Ss,{},t);if(Array.isArray(t))return t.map(e);if(Cs(t)){if(t.type===Q.Fragment)return e(t.props.children);EU(t.type,Ss)}return t}(e),e=>{if(Cs(e)){let t=e.type;if(EU(t,Ci)){let r=function(e,t){let r={},i=e.defaultProps||{};for(let e in t)i[e]!==t[e]&&(r[e]=t[e]);return new e(r)}(t,e.props);n.push(r)}else i.push(e);if(EU(t,Ss)&&t!==Ss&&e.props.id){let r=new t(e.props);s[r.id]=r}}else e&&i.push(e)}),Object.keys(s).length>0&&(Array.isArray(r)?r.forEach(e=>{s[e.id]=e}):r&&(s[r.id]=r),r=Object.values(s)),{layers:t=n.length>0?[...n,...t]:t,children:i,views:r}})(e),[e.layers,e.views,e.children]),l=!0,u=t=>l&&e.viewState?(n.viewStateUpdateRequested=t,null):(n.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),c=t=>{l?n.interactionStateUpdateRequested=t:(n.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},h=(0,Q.useMemo)(()=>{let t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:a.current,layers:o.layers,views:o.views,onViewStateChange:u,onInteractionStateChange:c};return delete t._customRender,n.deck&&n.deck.setProps(t),t},[e]);(0,Q.useEffect)(()=>{var t;let r;return r=new(e.Deck||EF)({...t={...h,parent:s.current,canvas:a.current},_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:e=>{n.redrawReason=e;let t=r.getViewports();n.lastRenderedViewports!==t?n.forceUpdate():Cl(n)}}),n.deck=r,()=>n.deck?.finalize()},[]),EB(()=>{Cl(n);let{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=n;e&&u(e),t&&c(t),n.deck?.isInitialized&&n.deck.redraw("Initial render")}),(0,Q.useImperativeHandle)(t,()=>({get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}),[]);let f=n.deck&&n.deck.isInitialized?n.deck.getViewports():void 0,{ContextProvider:d,width:p="100%",height:g="100%",id:m,style:y}=e,{containerStyle:v,canvasStyle:b}=(0,Q.useMemo)(()=>(function({width:e,height:t,style:r}){let i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},n={left:0,top:0};if(r)for(let e in r)e in Co?n[e]=r[e]:i[e]=r[e];return{containerStyle:i,canvasStyle:n}})({width:p,height:g,style:y}),[p,g,y]);if(!n.viewStateUpdateRequested&&n.lastRenderedViewports===f||n.version!==r){n.lastRenderedViewports=f,n.version=r;let e=function({children:e,deck:t,ContextProvider:r=Ca.Provider}){let{viewManager:i}=t||{};if(!i||!i.views.length)return[];let n={},s=i.views[0].id;for(let t of e){let e=s,r=t;Cs(t)&&EU(t.type,Ss)&&(e=t.props.id||s,r=t.props.children);let a=i.getViewport(e),o=i.getViewState(e);if(a){o.padding=a.padding;let{x:t,y:i,width:s,height:l}=a;r=function e(t,r){if("function"==typeof t)return t(r);if(Array.isArray(t))return t.map(t=>e(t,r));if(Cs(t)){var i;if(i=t,i.props?.mapStyle)return r.style=Cn,(0,Q.cloneElement)(t,r);if(function(e){let t=e.type;return t&&t.deckGLViewProps}(t))return(0,Q.cloneElement)(t,r)}return t}(r,{x:t,y:i,width:s,height:l,viewport:a,viewState:o}),n[e]||(n[e]={viewport:a,children:[]}),n[e].children.push(r)}}return Object.keys(n).map(e=>{let{viewport:i,children:s}=n[e],{x:a,y:o,width:l,height:u}=i,c=`view-${e}`,h=(0,Q.createElement)("div",{key:c,id:c,style:{position:"absolute",left:a,top:o,width:l,height:u}},...s),f={deck:t,viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:r=>{r.viewId=e,t._onViewStateChange(r)},widgets:[]},d=`view-${e}-context`;return(0,Q.createElement)(r,{key:d,value:f},h)})}({children:o.children,deck:n.deck,ContextProvider:d}),t=(0,Q.createElement)("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:b});n.control=(0,Q.createElement)("div",{id:`${m||"deckgl"}-wrapper`,ref:s,style:v},[t,e])}return l=!1,n.control});class Cc{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:r=null,vertexCount:i=null}=e;for(const[i,n]of(this.id=e.id||Te("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={},Object.entries(t))){const e=ArrayBuffer.isView(n)?{value:n}:n;if(!ArrayBuffer.isView(e.value))throw Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(let t of Object.values(e)){let{value:e,size:i,constant:n}=t;!n&&e&&void 0!==i&&i>=1&&(r=Math.min(r,e.length/i))}return r}}let Ch=`\
uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Cf={name:"scatterplot",vs:Ch,fs:Ch,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Cd=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Cp=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cg=`\
// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Cm=[0,0,0,255],Cy={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Cm},getLineColor:{type:"accessor",value:Cm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Cv extends Ci{getShaders(){return super.getShaders({vs:Cd,fs:Cp,source:Cg,modules:[_c,vV,kg,Cf]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,stroked:s,filled:a,billboard:o,antialiasing:l,lineWidthUnits:u,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f}=this.props,d={stroked:s,filled:a,billboard:o,antialiasing:l,radiusUnits:xQ[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,lineWidthUnits:xQ[u],lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f},p=this.state.model;p.shaderInputs.setProps({scatterplot:d}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){let e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new Tm(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cc({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}Cv.defaultProps=Cy,Cv.layerName="ScatterplotLayer";let Cb=Math.PI/180,Cx=23.4397*Cb;function C_(e,t,r){var i,n,s,a,o,l,u;let c,h,f,d,{azimuth:p,altitude:g}=(c=Cb*t,f=function(e){var t;let r,i=(t=Cb*(357.5291+.98560028*e),r=Cb*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t)),t+r+102.9372*Cb+Math.PI);return{declination:Math.asin(0*Math.cos(Cx)+Math.sin(Cx)*Math.sin(i)),rightAscension:Math.atan2(Math.sin(i)*Math.cos(Cx)-Math.tan(0)*Math.sin(Cx),Math.cos(i))}}(h=function(e){return("number"==typeof e?e:e.getTime())/864e5-.5+2440588-2451545}(e)),{azimuth:Math.atan2(Math.sin(s=d=(i=h,n=-(Cb*r),Cb*(280.147+360.9856235*i)-n-f.rightAscension)),Math.cos(s)*Math.sin(a=c)-Math.tan(f.declination)*Math.cos(a)),altitude:(o=d,Math.asin(Math.sin(l=c)*Math.sin(u=f.declination)+Math.cos(l)*Math.cos(u)*Math.cos(o)))});return[Math.sin(p)*Math.cos(g),Math.cos(p)*Math.cos(g),-Math.sin(g)]}let Cw=new Uint32Array([0,2,1,0,3,2]),Ck=new Float32Array([0,1,0,0,1,0,1,1]),CP=`\
uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,CS={name:"bitmap",vs:CP,fs:CP,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},CE=`\
#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,CA=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,CM=`\
#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${CA}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,CT={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:xX.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class CC extends Ci{getShaders(){return super.getShaders({vs:CE,fs:CM,modules:[_c,kg,CS]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]),e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:!0},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:!0},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:!0}})}updateState({props:e,oldProps:t,changeFlags:r}){let i=this.getAttributeManager();if(r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){let e=this.state.mesh,t=this._createMesh();for(let r in this.state.model.setVertexCount(t.vertexCount),t)e&&e[r]!==t[r]&&i.invalidate(r);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;let{width:i,height:n}=t;r.index=0;let s=function(e){let[t,r,i]=e;return[(t+(15&i)/16)/256,(r+(240&i)/256)/256]}(r.color);return r.bitmap={size:{width:i,height:n},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*n)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,t=e;return CO(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),function(e,t){if(!t){var r,i,n,s=e;let t=new Float64Array(12);for(let e=0;e<s.length;e++)t[3*e+0]=s[e][0],t[3*e+1]=s[e][1],t[3*e+2]=s[e][2]||0;return{vertexCount:6,positions:t,indices:Cw,texCoords:Ck}}let a=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),o=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),l=Math.ceil(a/t)+1,u=Math.ceil(o/t)+1,c=(l-1)*(u-1)*6,h=new Uint32Array(c),f=new Float32Array(l*u*2),d=new Float64Array(l*u*3),p=0,g=0;for(let t=0;t<l;t++){let s=t/(l-1);for(let a=0;a<u;a++){let o=a/(u-1),l=(r=e,i=s,n=o,_p(_p(r[0],r[1],n),_p(r[3],r[2],n),i));d[3*p+0]=l[0],d[3*p+1]=l[1],d[3*p+2]=l[2]||0,f[2*p+0]=s,f[2*p+1]=1-o,t>0&&a>0&&(h[g++]=p-u,h[g++]=p-u-1,h[g++]=p-1,h[g++]=p-u,h[g++]=p-1,h[g++]=p),p++}}return{vertexCount:c,positions:d,indices:h,texCoords:f}}(t,this.context.viewport.resolution)}_getModel(){return new Tm(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:t}=e,{model:r,coordinateConversion:i,bounds:n,disablePicking:s}=this.state,{image:a,desaturate:o,transparentColor:l,tintColor:u}=this.props;if((!t.picking.isActive||!s)&&a&&r){let e={bitmapTexture:a,bounds:n,coordinateConversion:i,desaturate:o,tintColor:u.slice(0,3).map(e=>e/255),transparentColor:l.map(e=>e/255)};r.shaderInputs.setProps({bitmap:e}),r.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=xX,{_imageCoordinateSystem:i}=this.props;if(i!==r){let{bounds:r}=this.props;if(!CO(r))throw Error("_imageCoordinateSystem only supports rectangular bounds");let n=this.context.viewport.resolution?e:t;if((i=i===e?e:t)===e&&n===t)return{coordinateConversion:-1,bounds:r};if(i===t&&n===e){let e=w3([r[0],r[1]]),t=w3([r[2],r[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function CO(e){return Number.isFinite(e[0])}CC.layerName="BitmapLayer",CC.defaultProps=CT;class CI extends Ci{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if("function"==typeof e){let t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){let{opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:o,highlightColor:l,coordinateSystem:u,coordinateOrigin:c,wrapLongitude:h,positionFormat:f,modelMatrix:d,extensions:p,fetch:g,operation:m,_subLayerProps:y}=this.props,v={id:"",updateTriggers:{},opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:o,highlightColor:l,coordinateSystem:u,coordinateOrigin:c,wrapLongitude:h,positionFormat:f,modelMatrix:d,extensions:p,fetch:g,operation:m},b=y&&e.id&&y[e.id],x=b&&b.updateTriggers,_=e.id||"sublayer";if(b){let t=this.props[kx],r=e.type?e.type._propTypes:{};for(let e in b){let i=r[e]||t[e];i&&"accessor"===i.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}for(let t of(Object.assign(v,e,b),v.id=`${this.props.id}-${_}`,v.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...x},p)){let e=t.getSubLayerProps.call(this,t);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers,i=!r||this.needsUpdate();for(let e of(i&&(r=kM(this.renderLayers(),Boolean),this.internalState.subLayers=r),kA("compositeLayer.renderLayers",this,i,r),r))e.parent=this}}CI.layerName="CompositeLayer";let CL=CI,Cj=`\
uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,CN={name:"icon",vs:Cj,fs:Cj,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},CD=`\
#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,CR=`\
#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cz=()=>{},CF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},CB={x:0,y:0,width:0,height:0};function CU(e){return e&&(e.id||e.url)}function C$(e,t,r){for(let i=0;i<t.length;i++){let{icon:n,xOffset:s}=t[i];e[CU(n)]={...n,x:s,y:r}}}class CV{constructor(e,{onUpdate:t=Cz,onError:r=Cz}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let t=this._autoPacking?CU(e):e;return this._mapping[t]||CB}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:n}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),i&&(this._mapping=i),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),n&&(this._samplerParameters=n)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"==typeof document)return;let r=Object.values(function(e,t,r){if(!e||!t)return null;r=r||{};let i={},{iterable:n,objectInfo:s}=EJ(e);for(let e of n){s.index++;let n=t(e,s),a=CU(n);if(!n)throw Error("Icon is missing.");if(!n.url)throw Error("Icon url is missing.");i[a]||r[a]&&n.url===r[a].url||(i[a]={...n,source:e,sourceIndex:s.index})}return i}(e,t,this._mapping)||{});if(r.length>0){let{mapping:e,xOffset:t,yOffset:i,rowHeight:n,canvasHeight:s}=function({icons:e,buffer:t,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:s=0,canvasWidth:a}){let o=[];for(let l=0;l<e.length;l++){let u=e[l];if(!r[CU(u)]){let{height:e,width:l}=u;i+l+t>a&&(C$(r,o,n),i=0,n=s+n+t,s=0,o=[]),o.push({icon:u,xOffset:i}),i=i+l+t,s=Math.max(s,e)}}return o.length>0&&C$(r,o,n),{mapping:r,rowHeight:s,xOffset:i,yOffset:n,canvasWidth:a,canvasHeight:Math.pow(2,Math.ceil(Math.log2(s+n+t)))}}({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=n,this._mapping=e,this._xOffset=t,this._yOffset=i,this._canvasHeight=s,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||CF,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,r,i){let{width:n,height:s,device:a}=e,o=a.createTexture({format:"rgba8unorm",width:t,height:r,sampler:i,mipLevels:a.getMipLevelCount(t,r)}),l=a.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:e,destinationTexture:o,width:n,height:s}),l.finish(),o.generateMipmapsWebGL(),e.destroy(),o}(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||CF)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r),this._texture?.generateMipmapsWebGL()}}_loadIcons(e){let t=this._canvas.getContext("2d",{willReadFrequently:!0});for(let r of e)this._pendingCount++,PK(r.url,this._loadOptions).then(e=>{let i=CU(r),n=this._mapping[i],{x:s,y:a,width:o,height:l}=n,{image:u,width:c,height:h}=function(e,t,r,i){let n=Math.min(r/t.width,i/t.height),s=Math.floor(t.width*n),a=Math.floor(t.height*n);return 1===n?{image:t,width:s,height:a}:(e.canvas.height=a,e.canvas.width=s,e.clearRect(0,0,s,a),e.drawImage(t,0,0,t.width,t.height,0,0,s,a),{image:e.canvas,width:s,height:a})}(t,e,o,l);this._texture?.copyExternalImage({image:u,x:s+(o-c)/2,y:a+(l-h)/2,width:c,height:h}),n.width=c,n.height=h,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(e=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:e})}).finally(()=>{this._pendingCount--})}}let CW=[0,0,0,255],CG={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:CW},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Cq extends Ci{getShaders(){return super.getShaders({vs:CD,fs:CR,modules:[_c,kg,CN]})}initializeState(){this.state={iconManager:new CV(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:CW},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:t,oldProps:r,changeFlags:i}=e,n=this.getAttributeManager(),{iconAtlas:s,iconMapping:a,data:o,getIcon:l,textureParameters:u}=t,{iconManager:c}=this.state;if("string"==typeof s)return;let h=s||this.internalState.isAsyncPropLoading("iconAtlas");c.setProps({loadOptions:t.loadOptions,autoPacking:!h,iconAtlas:s,iconMapping:h?a:null,textureParameters:u}),h?r.iconMapping!==t.iconMapping&&n.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&c.packIcons(o,l),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:t,sizeBasis:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:s,billboard:a,alphaCutoff:o}=this.props,{iconManager:l}=this.state,u=l.getTexture();if(u){let e=this.state.model,l={iconsTexture:u,iconsTextureDim:[u.width,u.height],sizeUnits:xQ[s],sizeScale:t,sizeBasis:+("height"===r),sizeMinPixels:i,sizeMaxPixels:n,billboard:a,alphaCutoff:o};e.shaderInputs.setProps({icon:l}),e.draw(this.context.renderPass)}}_getModel(){return new Tm(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let t=this.getCurrentLayer()?.props.onIconError;t?t(e):xo.error(e.error.message)()}getInstanceOffset(e){let{width:t,height:r,anchorX:i=t/2,anchorY:n=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-n]}getInstanceColorMode(e){return+!!this.state.iconManager.getIconMapping(e).mask}getInstanceIconFrame(e){let{x:t,y:r,width:i,height:n}=this.state.iconManager.getIconMapping(e);return[t,r,i,n]}}Cq.defaultProps=CG,Cq.layerName="IconLayer";let CH=Cq,CK=`\
uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,CY={name:"sdf",vs:CK,fs:CK,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},CZ=`\
#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,CX=[];class CJ extends CH{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,CY],fs:CZ}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:r})=>this.encodePickingColor(t,r)}})}updateState(e){super.updateState(e);let{props:t,oldProps:r}=e,{outlineColor:i}=t;i!==r.outlineColor&&((i=i.map(e=>e/255))[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&xo.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:n}=this.state,s=i?Math.max(r,.75*(1-i)):-1,a=this.state.model,o={buffer:.75,outlineBuffer:s,gamma:r,enabled:!!t,outlineColor:n};if(a.shaderInputs.setProps({sdf:o}),super.draw(e),t&&i){let{iconManager:e}=this.state;e.getTexture()&&(a.shaderInputs.setProps({sdf:{...o,outlineBuffer:.75}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(e=>super.getInstanceOffset(e)):CX}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(e=>super.getInstanceIconFrame(e)):CX}}CJ.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},CJ.layerName="MultiIconLayer";class CQ{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:n="sans-serif",fontWeight:s="normal",fontStyle:a="normal",lang:o=null}={}){this.buffer=t,this.cutoff=i,this.radius=r,this.lang=o;const l=this.size=e+4*t,u=this._createCanvas(l),c=this.ctx=u.getContext("2d",{willReadFrequently:!0});c.font=`${a} ${s} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:n,actualBoundingBoxRight:s}=this.ctx.measureText(e),a=Math.ceil(r),o=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-n))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),u=o+2*this.buffer,c=l+2*this.buffer,h=Math.max(u*c,0),f=new Uint8ClampedArray(h),d={data:f,width:u,height:c,glyphWidth:o,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return d;let{ctx:p,buffer:g,gridInner:m,gridOuter:y}=this;this.lang&&(p.lang=this.lang),p.clearRect(g,g,o,l),p.fillText(e,g,g+a);let v=p.getImageData(g,g,o,l);y.fill(1e20,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<o;t++){let r=v.data[4*(e*o+t)+3]/255;if(0===r)continue;let i=(e+g)*u+t+g;if(1===r)y[i]=0,m[i]=1e20;else{let e=.5-r;y[i]=e>0?e*e:0,m[i]=e<0?e*e:0}}C0(y,0,0,u,c,u,this.f,this.v,this.z),C0(m,g,g,o,l,u,this.f,this.v,this.z);for(let e=0;e<h;e++){let t=Math.sqrt(y[e])-Math.sqrt(m[e]);f[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return d}}function C0(e,t,r,i,n,s,a,o,l){for(let u=t;u<t+i;u++)C1(e,r*s+u,s,n,a,o,l);for(let u=r;u<r+n;u++)C1(e,u*s+t,1,i,a,o,l)}function C1(e,t,r,i,n,s,a){s[0]=0,a[0]=-1e20,a[1]=1e20,n[0]=e[t];for(let o=1,l=0,u=0;o<i;o++){n[o]=e[t+o*r];let i=o*o;do{let e=s[l];u=(n[o]-n[e]+i-e*e)/(o-e)/2}while(u<=a[l]&&--l>-1)s[++l]=o,a[l]=u,a[l+1]=1e20}for(let o=0,l=0;o<i;o++){for(;a[l+1]<o;)l++;let i=s[l],u=o-i;e[t+o*r]=n[i]+u*u}}let C2=[];function C3(e,t,r,i){let n=0;for(let s=t;s<r;s++){let t=e[s];n+=i[t]?.layoutWidth||0}return n}function C4(e,t,r,i,n,s){let a=t,o=0;for(let l=t;l<r;l++){let t=C3(e,l,l+1,n);o+t>i&&(a<l&&s.push(l),a=l,o=0),o+=t}return o}class C6{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?this.delete(e):Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e)}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}let C5={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},C8=new C6(3);function C7(e,t,r,i){e.font=`${i} ${r}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class C9{constructor(){this.props={...C5}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let t=function(e,t){let r;r=new Set("string"==typeof t?Array.from(t):t);let i=C8.get(e);if(!i)return r;for(let e in i.mapping)r.has(e)&&r.delete(e);return r}(this._key,this.props.characterSet),r=C8.get(this._key);if(r&&0===t.size){this._atlas!==r&&(this._atlas=r);return}let i=this._generateFontAtlas(t,r);this._atlas=i,C8.set(this._key,i)}_generateFontAtlas(e,t){let{fontFamily:r,fontWeight:i,fontSize:n,buffer:s,sdf:a,radius:o,cutoff:l}=this.props,u=t&&t.data;u||((u=document.createElement("canvas")).width=1024);let c=u.getContext("2d",{willReadFrequently:!0});C7(c,r,n,i);let{mapping:h,canvasHeight:f,xOffset:d,yOffset:p}=function({characterSet:e,getFontWidth:t,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:s={},xOffset:a=0,yOffset:o=0}){let l=0,u=a,c=r+2*i;for(let a of e)if(!s[a]){let e=t(a);u+e+2*i>n&&(u=0,l++),s[a]={x:u+i,y:o+l*c+i,width:e,height:c,layoutWidth:e,layoutHeight:r},u+=e+2*i}return{mapping:s,xOffset:u,yOffset:o+l*c,canvasHeight:Math.pow(2,Math.ceil(Math.log2(o+(l+1)*c)))}}({getFontWidth:e=>c.measureText(e).width,fontHeight:1.2*n,buffer:s,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(u.height!==f){let e=c.getImageData(0,0,u.width,u.height);u.height=f,c.putImageData(e,0,0)}if(C7(c,r,n,i),a){let t=new CQ({fontSize:n,buffer:s,radius:o,cutoff:l,fontFamily:r,fontWeight:`${i}`});for(let r of e){let{data:e,width:i,height:s,glyphTop:a}=t.draw(r);h[r].width=i,h[r].layoutOffsetY=.9*n-a;let o=c.createImageData(i,s);for(let t=0;t<e.length;t++)o.data[4*t+3]=e[t];c.putImageData(o,h[r].x,h[r].y)}}else for(let t of e)c.fillText(t,h[t].x,h[t].y+s+.9*n);return{xOffset:d,yOffset:p,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){let{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:n,radius:s,cutoff:a}=this.props;return n?`${e} ${t} ${r} ${i} ${s} ${a}`:`${e} ${t} ${r} ${i}`}}let Oe=`\
uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Ot={name:"textBackground",vs:Oe,fs:Oe,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},Or=`\
#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Oi=`\
#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,On={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Os extends Ci{getShaders(){return super.getShaders({vs:Or,fs:Oi,modules:[_c,kg,Ot]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:n,sizeMaxPixels:s,getLineWidth:a}=this.props,{padding:o,borderRadius:l}=this.props;o.length<4&&(o=[o[0],o[1],o[0],o[1]]),Array.isArray(l)||(l=[l,l,l,l]);let u=this.state.model,c={billboard:t,stroked:!!a,borderRadius:l,padding:o,sizeUnits:xQ[i],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:s};u.shaderInputs.setProps({textBackground:c}),u.draw(this.context.renderPass)}_getModel(){return new Tm(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cc({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,0,1,1,1])}}}),isInstanced:!0})}}Os.defaultProps=On,Os.layerName="TextBackgroundLayer";let Oa={start:1,middle:0,end:-1},Oo={top:1,center:0,bottom:-1},Ol=[0,0,0,255],Ou={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ol},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:C5.characterSet},fontFamily:C5.fontFamily,fontWeight:C5.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ol},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:Ol},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Oc extends CL{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,i]}=this.transformParagraph(e,t),{fontSize:n}=this.state.fontAtlasManager.props;r/=n,i/=n;let{getTextAnchor:s,getAlignmentBaseline:a}=this.props;return[(Oa["function"==typeof s?s(e,t):s]-1)*r/2,(Oo["function"==typeof a?a(e,t):a]-1)*i/2,r,i]},this.getIconOffsets=(e,t)=>{let{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:n,y:s,rowWidth:a,size:[o,l]}=this.transformParagraph(e,t),u=Oa["function"==typeof r?r(e,t):r],c=Oo["function"==typeof i?i(e,t):i],h=n.length,f=Array(2*h),d=0;for(let e=0;e<h;e++){let t=(1-u)*(o-a[e])/2;f[d++]=(u-1)*o/2+t+n[e],f[d++]=(c-1)*l/2+s[e]}return f}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new C9},this.props.maxWidth>0&&xo.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:n}=this.state,s={...e,characterSet:n,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(s),!0;for(let e in s)if(s[e]!==i.props[e])return i.setProps(s),!0;return!1}_updateText(){let e,{data:t,characterSet:r}=this.props,i=t.attributes?.getText,{getText:n}=this.props,s=t.startIndices,a="auto"===r&&new Set;if(i&&s){let{texts:r,characterCount:o}=function({value:e,length:t,stride:r,offset:i,startIndices:n,characterSet:s}){let a=e.BYTES_PER_ELEMENT,o=r?r/a:1,l=i?i/a:0,u=n[t]||Math.ceil((e.length-l)/o),c=s&&new Set,h=Array(t),f=e;if(o>1||l>0){f=new e.constructor(u);for(let t=0;t<u;t++)f[t]=e[t*o+l]}for(let e=0;e<t;e++){let t=n[e],r=n[e+1]||u,i=f.subarray(t,r);h[e]=String.fromCodePoint.apply(null,i),c&&i.forEach(c.add,c)}if(c)for(let e of c)s.add(String.fromCodePoint(e));return{texts:h,characterCount:u}}({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:s,characterSet:a});e=o,n=(e,{index:t})=>r[t]}else{let{iterable:r,objectInfo:i}=EJ(t);for(let t of(s=[0],e=0,r)){i.index++;let r=Array.from(n(t,i)||"");a&&r.forEach(a.add,a),e+=r.length,s.push(e)}}this.setState({getText:n,startIndices:s,numInstances:e,characterSet:a||r})}transformParagraph(e,t){let{fontAtlasManager:r}=this.state,i=r.mapping,n=this.state.getText,{wordBreak:s,lineHeight:a,maxWidth:o}=this.props;return function(e,t,r,i,n){let s=Array.from(e),a=s.length,o=Array(a),l=Array(a),u=Array(a),c=("break-word"===r||"break-all"===r)&&isFinite(i)&&i>0,h=[0,0],f=[0,0],d=0,p=0,g=0;for(let e=0;e<=a;e++){let m=s[e];if(("\n"===m||e===a)&&(g=e),g>p){let e=c?function(e,t,r,i,n=0,s){void 0===s&&(s=e.length);let a=[];return"break-all"===t?C4(e,n,s,r,i,a):!function(e,t,r,i,n,s){let a=t,o=t,l=t,u=0;for(let c=t;c<r;c++)if(" "===e[c]?l=c+1:(" "===e[c+1]||c+1===r)&&(l=c+1),l>o){let t=C3(e,o,l,n);u+t>i&&(a<o&&(s.push(o),a=o,u=0),t>i&&(t=C4(e,o,l,i,n,s),a=s[s.length-1])),o=l,u+=t}}(e,n,s,r,i,a),a}(s,r,i,n,p,g):C2;for(let r=0;r<=e.length;r++){let i=0===r?p:e[r-1],a=r<e.length?e[r]:g;!function(e,t,r,i,n,s){let a=0,o=0;for(let s=t;s<r;s++){let t=e[s],r=i[t];r?(o||(o=r.layoutHeight),n[s]=a+r.layoutWidth/2,a+=r.layoutWidth):(xo.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),n[s]=a,a+=32)}s[0]=a,s[1]=o}(s,i,a,n,o,f);for(let e=i;e<a;e++){let t=s[e],r=n[t]?.layoutOffsetY||0;l[e]=d+f[1]/2+r,u[e]=f[0]}d+=f[1]*t,h[0]=Math.max(h[0],f[0])}p=g}"\n"===m&&(o[p]=0,l[p]=0,u[p]=0,p++)}return h[1]=d,{x:o,y:l,rowWidth:u,size:h}}(n(e,t)||"",a,s,o*r.props.fontSize,i)}renderLayers(){let{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,atlas:n,mapping:s},styleVersion:a}=this.state,{data:o,_dataDiff:l,getPosition:u,getColor:c,getSize:h,getAngle:f,getPixelOffset:d,getBackgroundColor:p,getBorderColor:g,getBorderWidth:m,backgroundBorderRadius:y,backgroundPadding:v,background:b,billboard:x,fontSettings:_,outlineWidth:w,outlineColor:k,sizeScale:P,sizeUnits:S,sizeMinPixels:E,sizeMaxPixels:A,transitions:M,updateTriggers:T}=this.props,C=this.getSubLayerClass("characters",CJ),O=this.getSubLayerClass("background",Os);return[b&&new O({getFillColor:p,getLineColor:g,getLineWidth:m,borderRadius:y,padding:v,getPosition:u,getSize:h,getAngle:f,getPixelOffset:d,billboard:x,sizeScale:P,sizeUnits:S,sizeMinPixels:E,sizeMaxPixels:A,transitions:M&&{getPosition:M.getPosition,getAngle:M.getAngle,getSize:M.getSize,getFillColor:M.getBackgroundColor,getLineColor:M.getBorderColor,getLineWidth:M.getBorderWidth,getPixelOffset:M.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:T.getPosition,getAngle:T.getAngle,getSize:T.getSize,getFillColor:T.getBackgroundColor,getLineColor:T.getBorderColor,getLineWidth:T.getBorderWidth,getPixelOffset:T.getPixelOffset,getBoundingRect:{getText:T.getText,getTextAnchor:T.getTextAnchor,getAlignmentBaseline:T.getAlignmentBaseline,styleVersion:a}}}),{data:o.attributes&&o.attributes.background?{length:o.length,attributes:o.attributes.background}:o,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new C({sdf:_.sdf,smoothing:Number.isFinite(_.smoothing)?_.smoothing:C5.smoothing,outlineWidth:w/(_.radius||C5.radius),outlineColor:k,iconAtlas:n,iconMapping:s,getPosition:u,getColor:c,getSize:h,getAngle:f,getPixelOffset:d,billboard:x,sizeScale:P*i,sizeUnits:S,sizeMinPixels:E*i,sizeMaxPixels:A*i,transitions:M&&{getPosition:M.getPosition,getAngle:M.getAngle,getColor:M.getColor,getSize:M.getSize,getPixelOffset:M.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:T.getText,getPosition:T.getPosition,getAngle:T.getAngle,getColor:T.getColor,getSize:T.getSize,getPixelOffset:T.getPixelOffset,getIconOffsets:{getTextAnchor:T.getTextAnchor,getAlignmentBaseline:T.getAlignmentBaseline,styleVersion:a}}}),{data:o,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){xo.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),C8=new C6(e)}}Oc.defaultProps=Ou,Oc.layerName="TextLayer";class Oh{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=PX,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:t,buffers:r={},getGeometry:i,geometryBuffer:n,positionFormat:s,dataChanged:a,normalize:o=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=n&&n.size||("XY"===s?2:3),this.buffers=r,this.normalize=o,n&&(Sh(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(n),o||(r.vertexPositions=n)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(let e of a)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){let t=e.value||e;return ArrayBuffer.isView(t)?E0(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){let{attributes:r,buffers:i,_attributeDefs:n,typedArrayManager:s}=this;for(let a in n)if(a in i)s.release(r[a]),r[a]=null;else{let i=n[a];i.copy=t,r[a]=s.allocate(r[a],e,i)}}_forEachGeometry(e,t,r){let{data:i,getGeometry:n}=this,{iterable:s,objectInfo:a}=EJ(i,t,r);for(let t of s)a.index++,e(n?n(t,a):null,a.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:i}=this,{data:n,geometryBuffer:s}=this,{startRow:a=0,endRow:o=1/0}=e||{},l={};if(e||(t=[0],r=[0]),this.normalize||!s)this._forEachGeometry((e,t)=>{let i=e&&this.normalizeGeometry(e);l[t]=i,r[t+1]=r[t]+(i?this.getGeometrySize(i):0)},a,o),i=r[r.length-1];else if(i=(r=n.startIndices)[n.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof E$.Buffer){let e=4*this.positionSize;i=i||s.byteLength/e}else if(s.buffer){let e=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/e}else if(s.value){let e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=i;let u={};this._forEachGeometry((e,n)=>{let s=l[n]||e;u.vertexStart=r[n],u.indexStart=t[n],u.geometrySize=(n<r.length-1?r[n+1]:i)-r[n],u.geometryIndex=n,this.updateGeometryAttributes(s,u)},a,o),this.vertexCount=t[t.length-1]}}function Of(e,t,r={}){return function(e,t={}){return Math.sign(function(e,t={}){let{start:r=0,end:i=e.length,plane:n="xy"}=t,s=t.size||2,a=0,o=Od[n[0]],l=Od[n[1]];for(let t=r,n=i-s;t<i;t+=s)a+=(e[t+o]-e[n+o])*(e[t+l]+e[n+l]),n=t;return a/2}(e,t))}(e,r)!==t&&(function(e,t){let{start:r=0,end:i=e.length,size:n=2}=t,s=(i-r)/n,a=Math.floor(s/2);for(let t=0;t<a;++t){let i=r+t*n,a=r+(s-1-t)*n;for(let t=0;t<n;++t){let r=e[i+t];e[i+t]=e[a+t],e[a+t]=r}}}(e,r),!0)}let Od={x:0,y:1,z:2};function Op(e,t){let r=t.length,i=e.length;if(i>0){let n=!0;for(let s=0;s<r;s++)if(e[i-r+s]!==t[s]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)e[i+n]=t[n];return!0}function Og(e,t){let r=t.length;for(let i=0;i<r;i++)e[i]=t[i]}function Om(e,t,r,i,n=[]){let s=i+t*r;for(let t=0;t<r;t++)n[t]=e[s+t];return n}function Oy(e,t,r,i,n=[]){let s,a;if(8&r)s=(i[3]-e[1])/(t[1]-e[1]),a=3;else if(4&r)s=(i[1]-e[1])/(t[1]-e[1]),a=1;else if(2&r)s=(i[2]-e[0])/(t[0]-e[0]),a=2;else{if(!(1&r))return null;s=(i[0]-e[0])/(t[0]-e[0]),a=0}for(let r=0;r<e.length;r++)n[r]=(1&a)===r?i[a]:s*(t[r]-e[r])+e[r];return n}function Ov(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function Ob(e,t){let r,i,{size:n=2,broken:s=!1,gridResolution:a=10,gridOffset:o=[0,0],startIndex:l=0,endIndex:u=e.length}=t||{},c=(u-l)/n,h=[],f=[h],d=Om(e,0,n,l),p=Ow(d,a,o,[]),g=[];Op(h,d);for(let t=1;t<c;t++){for(i=Ov(r=Om(e,t,n,l,r),p);i;){var m,y,v;Oy(d,r,i,p,g);let e=Ov(g,p);e&&(Oy(d,g,e,p,g),i=e),Op(h,g),Og(d,g),m=p,y=a,8&(v=i)?(m[1]+=y,m[3]+=y):4&v?(m[1]-=y,m[3]-=y):2&v?(m[0]+=y,m[2]+=y):1&v&&(m[0]-=y,m[2]-=y),s&&h.length>n&&(h=[],f.push(h),Op(h,d)),i=Ov(r,p)}Op(h,r),Og(d,r)}return s?f:f[0]}function Ox(e,t=null,r){if(!e.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:a=!1}=r||{},o=[],l=[{pos:e,types:a?Array(e.length/i).fill(1):null,holes:t||[]}],u=[[],[]],c=[];for(;l.length;){let{pos:e,types:t,holes:r}=l.shift();(function(e,t,r,i){let n=1/0,s=-1/0,a=1/0,o=-1/0;for(let i=0;i<r;i+=t){let t=e[i],r=e[i+1];n=t<n?t:n,s=t>s?t:s,a=r<a?r:a,o=r>o?r:o}i[0][0]=n,i[0][1]=a,i[1][0]=s,i[1][1]=o})(e,i,r[0]||e.length,u),c=Ow(u[0],n,s,c);let h=Ov(u[1],c);if(h){let n=O_(e,t,i,0,r[0]||e.length,c,h),s={pos:n[0].pos,types:n[0].types,holes:[]},o={pos:n[1].pos,types:n[1].types,holes:[]};l.push(s,o);for(let l=0;l<r.length;l++)(n=O_(e,t,i,r[l],r[l+1]||e.length,c,h))[0]&&(s.holes.push(s.pos.length),s.pos=Ok(s.pos,n[0].pos),a&&(s.types=Ok(s.types,n[0].types))),n[1]&&(o.holes.push(o.pos.length),o.pos=Ok(o.pos,n[1].pos),a&&(o.types=Ok(o.types,n[1].types)))}else{let i={positions:e};a&&(i.edgeTypes=t),r.length&&(i.holeIndices=r),o.push(i)}}return o}function O_(e,t,r,i,n,s,a){let o,l,u,c=(n-i)/r,h=[],f=[],d=[],p=[],g=[],m=Om(e,c-1,r,i),y=Math.sign(8&a?m[1]-s[3]:m[0]-s[2]),v=t&&t[c-1],b=0,x=0;for(let n=0;n<c;n++)o=Om(e,n,r,i,o),l=Math.sign(8&a?o[1]-s[3]:o[0]-s[2]),u=t&&t[i/r+n],l&&y&&y!==l&&(Oy(m,o,a,s,g),Op(h,g)&&d.push(v),Op(f,g)&&p.push(v)),l<=0?(Op(h,o)&&d.push(u),b-=l):d.length&&(d[d.length-1]=0),l>=0?(Op(f,o)&&p.push(u),x+=l):p.length&&(p[p.length-1]=0),Og(m,o),y=l,v=u;return[b?{pos:h,types:t&&d}:null,x?{pos:f,types:t&&p}:null]}function Ow(e,t,r,i){let n=Math.floor((e[0]-r[0])/t)*t+r[0],s=Math.floor((e[1]-r[1])/t)*t+r[1];return i[0]=n,i[1]=s,i[2]=n+t,i[3]=s+t,i}function Ok(e,t){for(let r=0;r<t.length;r++)e.push(t[r]);return e}function OP(e,t,r,i){let n,s=e[0];for(let a=r;a<i;a+=t){let t=(n=e[a])-s;(t>180||t<-180)&&(n-=360*Math.round(t/360)),e[a]=s=n}}function OS(e,t){let r,i=e.length/t;for(let n=0;n<i&&((r=e[n*t])+180)%360==0;n++);let n=-(360*Math.round(r/360));if(0!==n)for(let r=0;r<i;r++)e[r*t]+=n}class OE extends Oh{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,r,i){let n;if(Array.isArray(e[0])){n=Array(e.length*t);for(let r=0;r<e.length;r++)for(let i=0;i<t;i++)n[r*t+i]=e[r][i]||0}else n=e;return r?Ob(n,{size:t,gridResolution:r}):i?function(e,t){let{size:r=2,startIndex:i=0,endIndex:n=e.length,normalize:s=!0}=t||{},a=e.slice(i,n);OP(a,r,0,n-i);let o=Ob(a,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let e of o)OS(e,r);return o}(n,{size:t}):n}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(OA(e)){let t=0;for(let r of e)t+=this.getGeometrySize(r);return t}let t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&OA(e))for(let r of e){let e=this.getGeometrySize(r);t.geometrySize=e,this.updateGeometryAttributes(r,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){let r=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:n,geometrySize:s}=t;r.fill(0,n,n+s),i?(r[n]=4,r[n+s-2]=4):(r[n]+=1,r[n+s-2]+=2),r[n+s-1]=4}_updatePositions(e,t){let{positions:r}=this.attributes;if(!r||!e)return;let{vertexStart:i,geometrySize:n}=t,s=[,,,];for(let t=i,a=0;a<n;t++,a++)this.getPointOnPath(e,a,s),r[3*t]=s[0],r[3*t+1]=s[1],r[3*t+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){let{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);let n=t*i;return r[0]=e[n],r[1]=e[n+1],r[2]=3===i&&e[n+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(2===t||e[2]===e[r+2])}}function OA(e){return Array.isArray(e[0])}let OM=`\
uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,OT={name:"path",vs:OM,fs:OM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},OC=`\
#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OO=`\
#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OI=[0,0,0,255],OL={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:OI},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Oj={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class ON extends Ci{getShaders(){return super.getShaders({vs:OC,fs:OO,modules:[_c,kg,OT]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Oj,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Oj,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Oj,defaultValue:OI},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r)}}),this.setState({pathTesselator:new OE({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:t,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){let{pathTesselator:e}=this.state,n=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:n.getPath,buffers:n,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:t,capRounded:r,billboard:i,miterLimit:n,widthUnits:s,widthScale:a,widthMinPixels:o,widthMaxPixels:l}=this.props,u=this.state.model,c={jointType:Number(t),capType:Number(r),billboard:i,widthUnits:xQ[s],widthScale:a,miterLimit:n,widthMinPixels:o,widthMaxPixels:l};u.shaderInputs.setProps({path:c}),u.draw(this.context.renderPass)}_getModel(){return new Tm(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cc({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}ON.defaultProps=OL,ON.layerName="PathLayer";var OD=e.i(54008);let OR={isClosed:!0};function Oz(e){return"positions"in e?e.positions:e}function OF(e){return"holeIndices"in e?e.holeIndices:null}function OB(e,t,r,i,n){let s,a,o=t,l=r.length;for(let t=0;t<l;t++)for(let n=0;n<i;n++)e[o++]=r[t][n]||0;if(s=r[0],a=r[r.length-1],s[0]!==a[0]||s[1]!==a[1]||s[2]!==a[2])for(let t=0;t<i;t++)e[o++]=r[0][t]||0;return OR.start=t,OR.end=o,OR.size=i,Of(e,n,OR),o}function OU(e,t,r,i,n=0,s,a){let o=(s=s||r.length)-n;if(o<=0)return t;let l=t;for(let t=0;t<o;t++)e[l++]=r[n+t];if(!function(e,t,r,i){for(let n=0;n<t;n++)if(e[r+n]!==e[i-t+n])return!1;return!0}(r,i,n,s))for(let t=0;t<i;t++)e[l++]=r[n+t];return OR.start=t,OR.end=l,OR.size=i,Of(e,a,OR),l}function O$(e,t,r){let i=e.length/3,n=0;for(let s=0;s<i;s++){let a=(s+1)%i;n+=e[3*s+t]*e[3*a+r],n-=e[3*a+t]*e[3*s+r]}return Math.abs(n/2)}function OV(e,t,r,i){let n=e.length/3;for(let s=0;s<n;s++){let n=3*s,a=e[n+0],o=e[n+1],l=e[n+2];e[n+t]=a,e[n+r]=o,e[n+i]=l}}class OW extends Oh{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){let{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);let t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let t=function(e,t){var r,i=e;if(!Array.isArray(i=i&&i.positions||i)&&!ArrayBuffer.isView(i))throw Error("invalid polygon");let n=[],s=[];if("positions"in e){let{positions:r,holeIndices:i}=e;if(i){let e=0;for(let a=0;a<=i.length;a++)e=OU(n,e,r,t,i[a-1],i[a],0===a?1:-1),s.push(e);return s.pop(),{positions:n,holeIndices:s}}e=r}if(!Array.isArray(e[0]))return OU(n,0,e,t,0,n.length,1),n;if(!((r=e).length>=1&&r[0].length>=2&&Number.isFinite(r[0][0]))){let r=0;for(let[i,a]of e.entries())r=OB(n,r,a,t,0===i?1:-1),s.push(r);return s.pop(),{positions:n,holeIndices:s}}return OB(n,0,e,t,1),n}(e,this.positionSize);return this.opts.resolution?Ox(Oz(t),OF(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,r){let{size:i=2,normalize:n=!0,edgeTypes:s=!1}=r||{};t=t||[];let a=[],o=[],l=0,u=0;for(let n=0;n<=t.length;n++){let s=t[n]||e.length,c=u,h=function(e,t,r,i){let n=-1,s=-1;for(let a=r+1;a<i;a+=t){let t=Math.abs(e[a]);t>n&&(n=t,s=a-1)}return s}(e,i,l,s);for(let t=h;t<s;t++)a[u++]=e[t];for(let t=l;t<h;t++)a[u++]=e[t];OP(a,i,c,u),function(e,t,r,i,n=85.051129){let s=e[r],a=e[i-t];if(Math.abs(s-a)>180){let i=Om(e,0,t,r);i[0]+=360*Math.round((a-s)/360),Op(e,i),i[1]=Math.sign(i[1])*n,Op(e,i),i[0]=s,Op(e,i)}}(a,i,c,u,r?.maxLatitude),l=s,o[n]=u}o.pop();let c=Ox(a,o,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let e of c)OS(e.positions,i);return c}(Oz(t),OF(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(OG(e)){let t=0;for(let r of e)t+=this.getGeometrySize(r);return t}return Oz(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&OG(e))for(let r of e){let e=this.getGeometrySize(r);t.geometrySize=e,this.updateGeometryAttributes(r,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:i}){let{attributes:n,indexStarts:s,typedArrayManager:a}=this,o=n.indices;if(!o||!e)return;let l=i,u=function(e,t,r,i){let n=OF(e);n&&(n=n.map(e=>e/t));let s=Oz(e),a=i&&3===t;if(r){let e=s.length;s=s.slice();let i=[];for(let n=0;n<e;n+=t){i[0]=s[n],i[1]=s[n+1],a&&(i[2]=s[n+2]);let e=r(i);s[n]=e[0],s[n+1]=e[1],a&&(s[n+2]=e[2])}}if(a){let e=O$(s,0,1),t=O$(s,0,2),i=O$(s,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(r||(s=s.slice()),OV(s,0,2,1)):(r||(s=s.slice()),OV(s,2,0,1)))}return(0,OD.default)(s,n,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);o=a.allocate(o,i+u.length,{copy:!0});for(let e=0;e<u.length;e++)o[l++]=u[e]+r;s[t+1]=i+u.length,n.indices=o}_updatePositions(e,{vertexStart:t,geometrySize:r}){let{attributes:{positions:i},positionSize:n}=this;if(!i||!e)return;let s=Oz(e);for(let e=t,a=0;a<r;e++,a++){let t=s[a*n],r=s[a*n+1],o=n>2?s[a*n+2]:0;i[3*e]=t,i[3*e+1]=r,i[3*e+2]=o}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){let{positionSize:i}=this,n=this.attributes.vertexValid,s=e&&OF(e);if(e&&e.edgeTypes?n.set(e.edgeTypes,t):n.fill(1,t,t+r),s)for(let e=0;e<s.length;e++)n[t+s[e]/i-1]=0;n[t+r-1]=0}}function OG(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}let Oq=`\
uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,OH={name:"solidPolygon",vs:Oq,fs:Oq,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},OK=`\
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OY=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${OK}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,OZ=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${OK}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,OX=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OJ=[0,0,0,255],OQ={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class O0 extends Ci{getShaders(e){return super.getShaders({vs:"top"===e?OY:OZ,fs:OX,defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[_c,vF,kg,OH]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let e,{viewport:t}=this.context,{coordinateSystem:r}=this.props,{_full3d:i}=this.props;t.isGeospatial&&r===xX.DEFAULT&&(r=xX.LNGLAT),r===xX.LNGLAT&&(e=i?t.projectPosition.bind(t):t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new OW({preproject:e,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:OQ,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,stepMode:"dynamic",transition:OQ,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:OQ,accessor:"getFillColor",defaultValue:OJ},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:OQ,accessor:"getLineColor",defaultValue:OJ},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r)}})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:t,filled:r,wireframe:i,elevationScale:n}=this.props,{topModel:s,sideModel:a,wireframeModel:o,polygonTesselator:l}=this.state,u={extruded:!!t,elevationScale:n,isWireframe:!1};o&&i&&(o.setInstanceCount(l.instanceCount-1),o.shaderInputs.setProps({solidPolygon:{...u,isWireframe:!0}}),o.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:u}),a.draw(this.context.renderPass)),s&&r&&(s.setVertexCount(l.vertexCount),s.shaderInputs.setProps({solidPolygon:u}),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:t,oldProps:r,changeFlags:i}=e,n=this.getAttributeManager();(i.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&(this.state.models?.forEach(e=>e.destroy()),this.setState(this._getModels()),n.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){let{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let e,t,r,{id:i,filled:n,extruded:s}=this.props;if(n){let t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;let r=this.getAttributeManager().getBufferLayouts({isInstanced:!1});e=new Tm(this.context.device,{...t,id:`${i}-top`,topology:"triangle-list",bufferLayout:r,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(s){let e=this.getAttributeManager().getBufferLayouts({isInstanced:!0});t=new Tm(this.context.device,{...this.getShaders("side"),id:`${i}-side`,bufferLayout:e,geometry:new Cc({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),r=new Tm(this.context.device,{...this.getShaders("side"),id:`${i}-wireframe`,bufferLayout:e,geometry:new Cc({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[t,r,e].filter(Boolean),topModel:e,sideModel:t,wireframeModel:r}}calculateIndices(e){let{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){let{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}O0.defaultProps={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:OJ},getLineColor:{type:"accessor",value:OJ},material:!0},O0.layerName="SolidPolygonLayer";let O1={circle:{type:Cv,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:CH,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Oc,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},O2={type:ON,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},O3={type:O0,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function O4({type:e,props:t}){let r={};for(let i in t)r[i]=e.defaultProps[t[i]];return r}function O6(e,t){let{transitions:r,updateTriggers:i}=e.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let s in t){let a=t[s],o=e.props[s];s.startsWith("get")&&(o=e.getSubLayerAccessor(o),n.updateTriggers[a]=i[s],r&&(n.transitions[a]=r[s])),n[a]=o}return n}function O5(e,t,r={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=e.length}=r;for(let r=n;r<s;r++){let n=e[r],{geometry:s}=n;if(s)if("GeometryCollection"===s.type){xo.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");let{geometries:e}=s;for(let s=0;s<e.length;s++)O8(e[s],i,t,n,r)}else O8(s,i,t,n,r)}return i}function O8(e,t,r,i,n){let{type:s,coordinates:a}=e,{pointFeatures:o,lineFeatures:l,polygonFeatures:u,polygonOutlineFeatures:c}=t;if(!function(e,t){let r=O7[e];for(xo.assert(r,`Unknown GeoJSON type ${e}`);t&&--r>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,a))return void xo.warn(`${s} coordinates are malformed`)();switch(s){case"Point":o.push(r({geometry:e},i,n));break;case"MultiPoint":a.forEach(e=>{o.push(r({geometry:{type:"Point",coordinates:e}},i,n))});break;case"LineString":l.push(r({geometry:e},i,n));break;case"MultiLineString":a.forEach(e=>{l.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"Polygon":u.push(r({geometry:e},i,n)),a.forEach(e=>{c.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"MultiPolygon":a.forEach(e=>{u.push(r({geometry:{type:"Polygon",coordinates:e}},i,n)),e.forEach(e=>{c.push(r({geometry:{type:"LineString",coordinates:e}},i,n))})})}}let O7={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function O9(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Ie(e){return e.geometry.coordinates}let It=["points","linestrings","polygons"],Ir={...O4(O1.circle),...O4(O1.icon),...O4(O1.text),...O4(O2),...O4(O3),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Ii extends CL{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;let{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){let r=function(e,t){let r=O9(),{points:i,lines:n,polygons:s}=e,a=function(e,t){let r={points:null,lines:null,polygons:null};for(let i in r){let n=e[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(4*n.length);let s=[];for(let e=0;e<n.length;e++)t(n[e],s),r[i][4*e+0]=s[0],r[i][4*e+1]=s[1],r[i][4*e+2]=s[2],r[i][4*e+3]=255}return r}(e,t);r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:a.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open";let o=Array(s.positions.value.length/s.positions.size).fill(1);for(let e of s.primitivePolygonIndices.value)o[e-1]=0;return r.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,instanceVertexValid:{size:1,value:new Uint16Array(o)},pickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygons._normalize=!1,s.triangles&&(r.polygons.data.attributes.indices=s.triangles.value),r.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygonsOutline._pathType="open",r}(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){let r=function(e){if(Array.isArray(e))return e;switch(xo.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return xo.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this),n={},s={};if(Array.isArray(t.dataChanged)){let e=this.state.features;for(let t in e)n[t]=e[t].slice(),s[t]=[];for(let a of t.dataChanged){let t=O5(r,i,a);for(let r in e)s[r].push(function({data:e,getIndex:t,dataRange:r,replace:i}){let{startRow:n=0,endRow:s=1/0}=r,a=e.length,o=a,l=a;for(let r=0;r<a;r++){let i=t(e[r]);if(o>r&&i>=n&&(o=r),i>=s){l=r;break}}let u=o,c=l-o!==i.length?e.slice(l):void 0;for(let t=0;t<i.length;t++)e[u++]=i[t];if(c){for(let t=0;t<c.length;t++)e[u++]=c[t];e.length=u}return{startRow:o,endRow:o+i.length}}({data:n[r],getIndex:e=>e.__source.index,dataRange:a,replace:t[r]}))}}else n=O5(r,i);let a=function(e,t){let r=O9(),{pointFeatures:i,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:a}=e;return r.points.data=i,r.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),r.points.getPosition=Ie,r.lines.data=n,r.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),r.lines.getPath=Ie,r.polygons.data=s,r.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),r.polygons.getPolygon=Ie,r.polygonsOutline.data=a,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),r.polygonsOutline.getPath=Ie,r}(n,s);this.setState({features:n,featuresDiff:s,layerProps:a})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r,sourceLayer:i}=t;return t.featureType=It.find(e=>i.id.startsWith(`${this.id}-${e}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){let t=`${this.id}-points-`,r="points"===e.featureType;for(let i of this.getSubLayers())i.id.startsWith(t)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,i="polygons-fill",n=this.shouldRenderSubLayer(i,r.polygons?.data)&&this.getSubLayerClass(i,O3.type);if(n){let s=O6(this,O3.props),a=e&&t;return a||delete s.getLineColor,s.updateTriggers.lineColors=a,new n(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),r.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,i="polygons-stroke",n="linestrings",s=!e&&t&&this.shouldRenderSubLayer(i,r.polygonsOutline?.data)&&this.getSubLayerClass(i,O2.type),a=this.shouldRenderSubLayer(n,r.lines?.data)&&this.getSubLayerClass(n,O2.type);if(s||a){let e=O6(this,O2.props);return[s&&new s(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),r.polygonsOutline),a&&new a(e,this.getSubLayerProps({id:n,updateTriggers:e.updateTriggers}),r.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:t,binary:r}=this.state,{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=t.points.data.findIndex(e=>e.__source.index===i));let n=new Set(e.split("+")),s=[];for(let e of n){let n=`points-${e}`,a=O1[e],o=a&&this.shouldRenderSubLayer(n,t.points?.data)&&this.getSubLayerClass(n,a.type);if(o){let l=O6(this,a.props),u=t.points;if("text"===e&&r){let{instancePickingColors:e,...t}=u.data.attributes;u={...u,data:{...u.data,attributes:t}}}s.push(new o(l,this.getSubLayerProps({id:n,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),u))}}return s}renderLayers(){let{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){let{binary:t}=this.state;return t&&"function"==typeof e?(t,r)=>{let{data:i,index:n}=r;return e(function(e,t){if(!e)return null;let r="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[r];return -1!==r?function(e,t,r){let i={properties:{...e.properties[t]}};for(let t in e.numericProps)i.properties[t]=e.numericProps[t].value[r];return i}(e,i,r):null}(i,n),r)}:super.getSubLayerAccessor(e)}}Ii.layerName="GeoJsonLayer",Ii.defaultProps=Ir;let In={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Is{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...In,...e},this.stats=new kT.Stats({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let r={handle:e,priority:0,getPriority:t},i=new Promise(e=>(r.resolve=e,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){let{handle:t,resolve:r}=e,i=!1,n=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:n}):Promise.resolve({done:n})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){let e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let r=e[t];!this._updateRequest(r)&&(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((e,t)=>e.priority-t.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}class Ia{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:i}){let n,{index:s,id:a,bbox:o,userData:l,zoom:u}=this,c=this._loaderId;this._abortController=new AbortController;let{signal:h}=this._abortController,f=await t.scheduleRequest(this,e=>e.isSelected?1:-1);if(!f){this._isCancelled=!0;return}if(this._isCancelled)return void f.done();let d=null;try{d=await e({index:s,id:a,bbox:o,userData:l,zoom:u,signal:h})}catch(e){n=e||!0}finally{f.done()}if(c===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,n?i(n,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}var wX=wX,xs=xs;let Io=Math.PI/180,Il=180/Math.PI;class Iu extends P7{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:n=1,resolution:s=10}=e;let{latitude:a=0,height:o,altitude:l=1.5,fovy:u}=e;a=Math.max(Math.min(a,85.051129),-85.051129),o=o||1,u?l=w9(u):u=w7(l);const c=1/Math.PI/Math.cos(a*Math.PI/180)*Math.pow(2,r),h=e.nearZ??i,f=e.farZ??(l+512*c/o)*n,d=new wW().lookAt({eye:[0,-l,0],up:[0,0,1]});d.rotateX(a*Io),d.rotateZ(-t*Io),d.scale(c/o),super({...e,height:o,viewMatrix:d,longitude:t,latitude:a,zoom:r,distanceScales:function(){let e=Math.PI/180*256;return{unitsPerMeter:[4018225162502676e-20,4018225162502676e-20,4018225162502676e-20],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[e,e,4018225162502676e-20],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,24886.609375]}}(),fovy:u,focalDistance:l,near:h,far:f}),this.scale=c,this.latitude=a,this.longitude=t,this.resolution=s}get projectionMode(){return xJ.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),n=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return n[0]<this.longitude&&(n[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],n[0],i[0],s[0]),Math.min(r[1],n[1],i[1],s[1]),Math.max(r[0],n[0],i[0],s[0]),Math.max(r[1],n[1],i[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let i,[n,s,a]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:l}=this;if(Number.isFinite(a))i=Ic(l,[n,o,a,1]);else{let e=Ic(l,[n,o,-1,1]),t=Ic(l,[n,o,1,1]),s=((r||0)/6370972+1)*256,a=wX.sqrLen(wX.sub([],e,t)),u=wX.sqrLen(e),c=wX.sqrLen(t),h=(4*u*c-(a-u-c)**2)/16*4/a,f=(Math.sqrt(u-h)-Math.sqrt(Math.max(0,s*s-h)))/Math.sqrt(a);i=wX.lerp([],e,t,f)}let[u,c,h]=this.unprojectPosition(i);return Number.isFinite(a)?[u,c,h]:Number.isFinite(r)?[u,c,r]:[u,c]}projectPosition(e){let[t,r,i=0]=e,n=t*Io,s=r*Io,a=Math.cos(s),o=(i/6370972+1)*256;return[Math.sin(n)*a*o,-Math.cos(n)*a*o,Math.sin(s)*o]}unprojectPosition(e){let[t,r,i]=e,n=wX.len(e);return[Math.atan2(t,-r)*Il,Math.asin(i/n)*Il,(n/256-1)*6370972]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function Ic(e,t){let r=xs.transformMat4([],t,e);return xs.scale(r,r,1/r[3]),r}let Ih=new wr,If=new wr;class Id{constructor(e=[0,0,0],t=[0,0,0],r){r=r||Ih.copy(e).add(t).scale(.5),this.center=new wr(r),this.halfDiagonal=new wr(t).subtract(this.center),this.minimum=new wr(e),this.maximum=new wr(t)}clone(){return new Id(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:t}=this,r=If.from(e.normal),i=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),n=this.center.dot(r)+e.distance;return n-i>0?1:n+i<0?-1:0}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t,r=Ih.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0;return(t=Math.abs(r.x)-i.x)>0&&(n+=t*t),(t=Math.abs(r.y)-i.y)>0&&(n+=t*t),(t=Math.abs(r.z)-i.z)>0&&(n+=t*t),n}}var bj=bj;let Ip=new wr,Ig=new wr;class Im{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new wr,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Ip.from(t),this.center=new wr().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Im(this.center,this.radius)}union(e){let t=this.center,r=this.radius,i=e.center,n=e.radius,s=Ip.copy(i).subtract(t),a=s.magnitude();if(r>=a+n)return this.clone();if(n>=a+r)return e.clone();let o=(r+a+n)*.5;return Ig.copy(s).scale((-r+o)/a).add(t),this.center.copy(Ig),this.radius=o,this}expand(e){let t=Ip.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);let t=bj.getScaling(Ip,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){return Math.max(0,Ip.from(e).subtract(this.center).len()-this.radius)}intersectPlane(e){let t=this.center,r=this.radius,i=e.normal.dot(t)+e.distance;return i<-r?-1:i<r?0:1}}function Iy(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=r[0],d=r[1],p=r[2],g=r[3],m=r[4],y=r[5],v=r[6],b=r[7],x=r[8];return e[0]=f*i+d*a+p*u,e[1]=f*n+d*o+p*c,e[2]=f*s+d*l+p*h,e[3]=g*i+m*a+y*u,e[4]=g*n+m*o+y*c,e[5]=g*s+m*l+y*h,e[6]=v*i+b*a+x*u,e[7]=v*n+b*o+x*c,e[8]=v*s+b*l+x*h,e}function Iv(e,t,r){let i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}(I=X||(X={}))[I.COL0ROW0=0]="COL0ROW0",I[I.COL0ROW1=1]="COL0ROW1",I[I.COL0ROW2=2]="COL0ROW2",I[I.COL1ROW0=3]="COL1ROW0",I[I.COL1ROW1=4]="COL1ROW1",I[I.COL1ROW2=5]="COL1ROW2",I[I.COL2ROW0=6]="COL2ROW0",I[I.COL2ROW1=7]="COL2ROW1",I[I.COL2ROW2=8]="COL2ROW2";let Ib=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ix extends wi{static get IDENTITY(){return I_||Object.freeze(I_=new Ix),I_}static get ZERO(){return s||Object.freeze(s=new Ix([0,0,0,0,0,0,0,0,0])),s}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return X}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Ib)}fromObject(e){return this.check()}fromQuaternion(e){let t,r,i,n,s,a,o,l,u,c,h,f,d,p,g,m;return t=e[0],r=e[1],i=e[2],n=e[3],s=t+t,a=r+r,o=i+i,l=t*s,u=r*s,c=r*a,h=i*s,f=i*a,d=i*o,p=n*s,g=n*a,m=n*o,this[0]=1-c-d,this[3]=u-m,this[6]=h+g,this[1]=u+m,this[4]=1-l-d,this[7]=f-p,this[2]=h-g,this[5]=f+p,this[8]=1-l-c,this.check()}set(e,t,r,i,n,s,a,o,l){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=n,this[5]=s,this[6]=a,this[7]=o,this[8]=l,this.check()}setRowMajor(e,t,r,i,n,s,a,o,l){return this[0]=e,this[1]=i,this[2]=a,this[3]=t,this[4]=n,this[5]=o,this[6]=r,this[7]=s,this[8]=l,this.check()}determinant(){let e,t,r,i,n,s,a,o,l;return e=this[0],t=this[1],r=this[2],i=this[3],n=this[4],s=this[5],a=this[6],o=this[7],e*((l=this[8])*n-s*o)+t*(-l*i+s*a)+r*(o*i-n*a)}transpose(){return!function(e,t){if(e===t){let r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){let e,t,r,i,n,s,a,o,l,u,c,h,f;return e=this[0],t=this[1],r=this[2],i=this[3],n=this[4],s=this[5],a=this[6],o=this[7],u=(l=this[8])*n-s*o,(f=e*u+t*(c=-l*i+s*a)+r*(h=o*i-n*a))&&(f=1/f,this[0]=u*f,this[1]=(-l*t+r*o)*f,this[2]=(s*t-r*n)*f,this[3]=c*f,this[4]=(l*e-r*a)*f,this[5]=(-s*e+r*i)*f,this[6]=h*f,this[7]=(-o*e+t*a)*f,this[8]=(n*e-t*i)*f),this.check()}multiplyLeft(e){return Iy(this,e,this),this.check()}multiplyRight(e){return Iy(this,this,e),this.check()}rotate(e){let t,r,i,n,s,a,o,l,u,c,h;return t=this[0],r=this[1],i=this[2],n=this[3],s=this[4],a=this[5],o=this[6],l=this[7],u=this[8],c=Math.sin(e),h=Math.cos(e),this[0]=h*t+c*n,this[1]=h*r+c*s,this[2]=h*i+c*a,this[3]=h*n-c*t,this[4]=h*s-c*r,this[5]=h*a-c*i,this[6]=o,this[7]=l,this[8]=u,this.check()}scale(e){return Array.isArray(e)?Iv(this,this,e):Iv(this,this,[e,e]),this.check()}translate(e){let t,r,i,n,s,a,o,l,u,c,h;return t=this[0],r=this[1],i=this[2],n=this[3],s=this[4],a=this[5],o=this[6],l=this[7],u=this[8],c=e[0],h=e[1],this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=c*t+h*n+o,this[7]=c*r+h*s+l,this[8]=c*i+h*a+u,this.check()}transform(e,t){let r;switch(e.length){case 2:r=wL(t||[-0,-0],e,this);break;case 3:r=_J(t||[-0,-0,-0],e,this);break;case 4:r=we(t||[-0,-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return _v(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let I_=null;class Iw extends _x{static get ZERO(){return a||Object.freeze(a=new Iw(0,0,0,0)),a}constructor(e=0,t=0,r=0,i=0){super(-0,-0,-0,-0),_f(e)&&1==arguments.length?this.copy(e):(_h.debug&&(_y(e),_y(t),_y(r),_y(i)),this[0]=e,this[1]=t,this[2]=r,this[3]=i)}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return _h.debug&&(_y(e.x),_y(e.y),_y(e.z),_y(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=_y(e)}get w(){return this[3]}set w(e){this[3]=_y(e)}transform(e){return _X(this,this,e),this.check()}transformByMatrix3(e){return we(this,this,e),this.check()}transformByMatrix2(e){let t,r;return t=this[0],r=this[1],this[0]=e[0]*t+e[2]*r,this[1]=e[1]*t+e[3]*r,this[2]=this[2],this[3]=this[3],this.check()}transformByQuaternion(e){return _Q(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function Ik(){let e=new vH(4);return vH!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function IP(e,t,r){let i=Math.sin(r*=.5);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function IS(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*c+a*o+n*u-s*l,e[1]=n*c+a*l+s*o-i*u,e[2]=s*c+a*u+i*l-n*o,e[3]=a*c-i*o-n*l-s*u,e}let IE=(g=__(),m=_P(1,0,0),y=_P(0,1,0),function(e,t,r){let i=_W(t,r);return i<-.999999?(_G(g,m,t),1e-6>_k(g)&&_G(g,y,t),_V(g,g),IP(e,g,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(_G(g,t,r),e[0]=g[0],e[1]=g[1],e[2]=g[2],e[3]=1+i,b3(e,e))});Ik(),Ik(),v=new vH(9),vH!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1;let IA=[0,0,0,1];class IM extends _m{constructor(e=0,t=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1==arguments.length?this.copy(e):this.set(e,t,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return!function(e,t){let r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let n=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*s+s]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+s]-t[3*s+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[s]=(t[3*s+i]+t[3*i+s])*r}}(this,e),this.check()}fromAxisRotation(e,t){return IP(this,e,t),this.check()}identity(){return this[0]=0,this[1]=0,this[2]=0,this[3]=1,this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=_y(e)}get y(){return this[1]}set y(e){this[1]=_y(e)}get z(){return this[2]}set z(e){this[2]=_y(e)}get w(){return this[3]}set w(e){this[3]=_y(e)}len(){return bQ(this)}lengthSquared(){return b0(this)}dot(e){return b4(this,e)}rotationTo(e,t){return IE(this,e,t),this.check()}add(e){return bB(this,this,e),this.check()}calculateW(){let e,t,r;return e=this[0],t=this[1],r=this[2],this[0]=e,this[1]=t,this[2]=r,this[3]=Math.sqrt(Math.abs(1-e*e-t*t-r*r)),this.check()}conjugate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this[3]=this[3],this.check()}invert(){let e,t,r,i,n,s;return e=this[0],t=this[1],r=this[2],s=(n=e*e+t*t+r*r+(i=this[3])*i)?1/n:0,this[0]=-e*s,this[1]=-t*s,this[2]=-r*s,this[3]=i*s,this.check()}lerp(e,t,r){return void 0===r?this.lerp(this,e,t):(b5(this,e,t,r),this.check())}multiplyRight(e){return IS(this,this,e),this.check()}multiplyLeft(e){return IS(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o+s*a,this[1]=i*o+n*a,this[2]=n*o-i*a,this[3]=s*o-r*a,this.check()}rotateY(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o-n*a,this[1]=i*o+s*a,this[2]=n*o+r*a,this[3]=s*o-i*a,this.check()}rotateZ(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o+i*a,this[1]=i*o-r*a,this[2]=n*o+s*a,this[3]=s*o-n*a,this.check()}scale(e){return bY(this,this,e),this.check()}slerp(e,t,r){var i,n,s;let a,o,l,u,c,h,f,d,p,g,m,y,v,b,x,_;switch(arguments.length){case 1:({start:a=IA,target:o,ratio:l}=e);break;case 2:a=this,o=e,l=t;break;default:a=e,o=t,l=r}return i=a,n=o,s=l,p=i[0],g=i[1],m=i[2],y=i[3],v=n[0],b=n[1],(u=p*v+g*b+m*(x=n[2])+y*(_=n[3]))<0&&(u=-u,v=-v,b=-b,x=-x,_=-_),1-u>1e-6?(d=Math.sin(c=Math.acos(u)),h=Math.sin((1-s)*c)/d,f=Math.sin(s*c)/d):(h=1-s,f=s),this[0]=h*p+f*v,this[1]=h*g+f*b,this[2]=h*m+f*x,this[3]=h*y+f*_,this.check()}transformVector4(e,t=new Iw){return b9(t,e,this),_v(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}let IT=new wr,IC=new wr,IO=new wr,II=new wr,IL=new wr,Ij=new wr,IN=new wr;class ID{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new wr().from(e),this.halfAxes=new Ix(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new wr(e).len(),new wr(t).len(),new wr(r).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new wr(e).normalize(),n=new wr(t).normalize(),s=new wr(r).normalize();return new IM().fromMatrix3(new Ix([...i,...n,...s]))}fromCenterHalfSizeQuaternion(e,t,r){let i=new IM(r),n=new Ix().fromQuaternion(i);return n[0]=n[0]*t[0],n[1]=n[1]*t[0],n[2]=n[2]*t[0],n[3]=n[3]*t[1],n[4]=n[4]*t[1],n[5]=n[5]*t[1],n[6]=n[6]*t[2],n[7]=n[7]*t[2],n[8]=n[8]*t[2],this.center=new wr().from(e),this.halfAxes=n,this}clone(){return new ID(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Im){let t=this.halfAxes,r=t.getColumn(0,IO),i=t.getColumn(1,II),n=t.getColumn(2,IL),s=IT.copy(r).add(i).add(n);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){let t=this.center,r=e.normal,i=this.halfAxes,n=r.x,s=r.y,a=r.z,o=Math.abs(n*i[0]+s*i[1]+a*i[2])+Math.abs(n*i[3]+s*i[4]+a*i[5])+Math.abs(n*i[6]+s*i[7]+a*i[8]),l=r.dot(t)+e.distance;return l<=-o?-1:1*!!(l>=o)}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t,r=IC.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,IO),s=i.getColumn(1,II),a=i.getColumn(2,IL),o=n.magnitude(),l=s.magnitude(),u=a.magnitude();n.normalize(),s.normalize(),a.normalize();let c=0;return(t=Math.abs(r.dot(n))-o)>0&&(c+=t*t),(t=Math.abs(r.dot(s))-l)>0&&(c+=t*t),(t=Math.abs(r.dot(a))-u)>0&&(c+=t*t),c}computePlaneDistances(e,t,r=[-0,-0]){let i=1/0,n=-1/0,s=this.center,a=this.halfAxes,o=a.getColumn(0,IO),l=a.getColumn(1,II),u=a.getColumn(2,IL),c=Ij.copy(o).add(l).add(u).add(s),h=IN.copy(c).subtract(e),f=t.dot(h);return i=Math.min(f,i),n=Math.max(f,n),c.copy(s).add(o).add(l).subtract(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),c.copy(s).add(o).subtract(l).add(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),c.copy(s).add(o).subtract(l).subtract(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),s.copy(c).subtract(o).add(l).add(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),s.copy(c).subtract(o).add(l).subtract(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),s.copy(c).subtract(o).subtract(l).add(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),s.copy(c).subtract(o).subtract(l).subtract(u),h.copy(c).subtract(e),i=Math.min(f=t.dot(h),i),n=Math.max(f,n),r[0]=i,r[1]=n,r}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,IO);t.transformAsPoint(e);let r=this.halfAxes.getColumn(1,II);r.transformAsPoint(e);let i=this.halfAxes.getColumn(2,IL);return i.transformAsPoint(e),this.halfAxes=new Ix([...t,...r,...i]),this}getTransform(){throw Error("not implemented")}}let IR=new wr,Iz=new wr;class IF{constructor(e=[0,0,1],t=0){this.normal=new wr,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return _b(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=IR.from(e),this.normal.from(t).normalize();let r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,i){return this.normal.set(e,t,r),_b(_g(this.normal.len(),1)),this.distance=i,this}clone(){return new IF(this.normal,this.distance)}equals(e){return _g(this.distance,e.distance)&&_g(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=Iz.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){let r=IR.from(e),i=this.getPointDistance(r),n=Iz.copy(this.normal).scale(i);return r.subtract(n).to(t)}}let IB=[new wr([1,0,0]),new wr([0,1,0]),new wr([0,0,1])],IU=new wr,I$=new wr;class IV{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*IB.length;let t=e.center,r=e.radius,i=0;for(let e of IB){let n=this.planes[i],s=this.planes[i+1];n||(n=this.planes[i]=new IF),s||(s=this.planes[i+1]=new IF);let a=IU.copy(e).scale(-r).add(t);n.fromPointNormal(a,e);let o=IU.copy(e).scale(r).add(t),l=I$.copy(e).negate();s.fromPointNormal(o,l),i+=2}return this}computeVisibility(e){let t=1;for(let r of this.planes)switch(e.intersectPlane(r)){case -1:return -1;case 0:t=0}return t}computeVisibilityWithPlaneMask(e,t){if(_b(Number.isFinite(t),"parentPlaneMask is required."),t===IV.MASK_OUTSIDE||t===IV.MASK_INSIDE)return t;let r=IV.MASK_INSIDE,i=this.planes;for(let n=0;n<this.planes.length;++n){let s=n<31?1<<n:0;if(n<31&&(t&s)==0)continue;let a=i[n],o=e.intersectPlane(a);if(-1===o)return IV.MASK_OUTSIDE;0===o&&(r|=s)}return r}}IV.MASK_OUTSIDE=0xffffffff,IV.MASK_INSIDE=0,IV.MASK_INDETERMINATE=0x7fffffff,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr,new wr;let IW=Math.PI/2,IG=Math.PI/4,Iq=Math.PI/6,IH=2*Math.PI;e.s(["EPSILON1",0,.1,"EPSILON10",0,1e-10,"EPSILON11",0,1e-11,"EPSILON12",0,1e-12,"EPSILON13",0,1e-13,"EPSILON14",0,1e-14,"EPSILON15",0,1e-15,"EPSILON16",0,1e-16,"EPSILON17",0,1e-17,"EPSILON18",0,1e-18,"EPSILON19",0,1e-19,"EPSILON2",0,.01,"EPSILON20",0,1e-20,"EPSILON3",0,.001,"EPSILON4",0,1e-4,"EPSILON5",0,1e-5,"EPSILON6",0,1e-6,"EPSILON7",0,1e-7,"EPSILON8",0,1e-8,"EPSILON9",0,1e-9,"PI_OVER_FOUR",0,IG,"PI_OVER_SIX",0,Iq,"PI_OVER_TWO",0,IW,"TWO_PI",0,IH],94069);var IK=e.i(94069),IK=IK;let IY=new Ix,IZ=new Ix,IX=new Ix,IJ=new Ix,IQ=new Ix,I0=[1,0,0],I1=[2,2,1],I2=new wr,I3=new wr,I4=new wr,I6=new wr,I5=new wr,I8=new Ix,I7={diagonal:new Ix,unitary:new Ix},I9=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Le=I9.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Lt=Le.concat([[.25,.5],[.75,.5]]);class Lr{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){let e=2*this.x,t=2*this.y,r=this.z+1;this._children=[new Lr(e,t,r),new Lr(e,t+1,r),new Lr(e+1,t,r),new Lr(e+1,t+1,r)]}return this._children}update(e){let{viewport:t,cullingVolume:r,elevationBounds:i,minZ:n,maxZ:s,bounds:a,offset:o,project:l}=e,u=this.getBoundingVolume(i,o,l);if(a&&!this.insideBounds(a)||0>r.computeVisibility(u))return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=n&&(e+=Math.floor(Math.log2(u.distanceTo(t.cameraPosition)*t.scale/t.height))),e>=s)return this.selected=!0,!0}for(let t of(this.selected=!1,this.childVisible=!0,this.children))t.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,i]){let n=512/Math.pow(2,this.z);return this.x*n<r&&this.y*n<i&&(this.x+1)*n>e&&(this.y+1)*n>t}getBoundingVolume(e,t,r){if(r){let t=this.z<1?Lt:this.z<2?Le:I9,i=[];for(let n of t){let t=Lo(this.x+n[0],this.y+n[1],this.z);t[2]=e[0],i.push(r(t)),e[0]!==e[1]&&(t[2]=e[1],i.push(r(t)))}return function(e,t=new ID){if(!e||0===e.length)return t.halfAxes=new Ix([0,0,0,0,0,0,0,0,0]),t.center=new wr,t;let r=e.length,i=new wr(0,0,0);for(let t of e)i.add(t);let n=1/r;i.multiplyByScalar(n);let s=0,a=0,o=0,l=0,u=0,c=0;for(let t of e){let e=I2.copy(t).subtract(i);s+=e.x*e.x,a+=e.x*e.y,o+=e.x*e.z,l+=e.y*e.y,u+=e.y*e.z,c+=e.z*e.z}s*=n,a*=n,o*=n,l*=n,u*=n,c*=n,I8[0]=s,I8[1]=a,I8[2]=o,I8[3]=a,I8[4]=l,I8[5]=u,I8[6]=o,I8[7]=u,I8[8]=c;let{unitary:h}=function(e,t={}){let r=IK.EPSILON20,i=0,n=0;IZ.identity(),IX.copy(e);let s=r*function(e){let t=0;for(let r=0;r<9;++r){let i=e[r];t+=i*i}return Math.sqrt(t)}(IX);for(;n<10&&function(e){let t=0;for(let r=0;r<3;++r){let i=e[IY.getElementIndex(I1[r],I0[r])];t+=2*i*i}return Math.sqrt(t)}(IX)>s;)(function(e,t){let r=IK.EPSILON15,i=0,n=1;for(let t=0;t<3;++t){let r=Math.abs(e[IY.getElementIndex(I1[t],I0[t])]);r>i&&(n=t,i=r)}let s=I0[n],a=I1[n],o=1,l=0;if(Math.abs(e[IY.getElementIndex(a,s)])>r){let t,r=(e[IY.getElementIndex(a,a)]-e[IY.getElementIndex(s,s)])/2/e[IY.getElementIndex(a,s)];o=1/Math.sqrt(1+(t=r<0?-1/(-r+Math.sqrt(1+r*r)):1/(r+Math.sqrt(1+r*r)))*t),l=t*o}Ix.IDENTITY.to(t),t[IY.getElementIndex(s,s)]=t[IY.getElementIndex(a,a)]=o,t[IY.getElementIndex(a,s)]=l,t[IY.getElementIndex(s,a)]=-l})(IX,IJ),IQ.copy(IJ).transpose(),IX.multiplyRight(IJ),IX.multiplyLeft(IQ),IZ.multiplyRight(IJ),++i>2&&(++n,i=0);return t.unitary=IZ.toTarget(t.unitary),t.diagonal=IX.toTarget(t.diagonal),t}(I8,I7),f=t.halfAxes.copy(h),d=f.getColumn(0,I4),p=f.getColumn(1,I6),g=f.getColumn(2,I5),m=-Number.MAX_VALUE,y=-Number.MAX_VALUE,v=-Number.MAX_VALUE,b=Number.MAX_VALUE,x=Number.MAX_VALUE,_=Number.MAX_VALUE;for(let t of e)I2.copy(t),m=Math.max(I2.dot(d),m),y=Math.max(I2.dot(p),y),v=Math.max(I2.dot(g),v),b=Math.min(I2.dot(d),b),x=Math.min(I2.dot(p),x),_=Math.min(I2.dot(g),_);d=d.multiplyByScalar(.5*(b+m)),p=p.multiplyByScalar(.5*(x+y)),g=g.multiplyByScalar(.5*(_+v)),t.center.copy(d).add(p).add(g);let w=I3.set(m-b,y-x,v-_).multiplyByScalar(.5),k=new Ix([w[0],0,0,0,w[1],0,0,0,w[2]]);return t.halfAxes.multiplyRight(k),t}(i)}let i=512/Math.pow(2,this.z),n=this.x*i+512*t,s=512-(this.y+1)*i;return new Id([n,s,e[0]],[n+i,s+i,e[1]])}}let Li=[-1/0,-1/0,1/0,1/0];function Ln(e,t){let r=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...r.map(e=>e[0])),Math.min(...r.map(e=>e[1])),Math.max(...r.map(e=>e[0])),Math.max(...r.map(e=>e[1]))]}function Ls({viewport:e,z:t,cullRect:r}){return(e.subViewports||[e]).map(e=>(function e(t,r,i){if(!Array.isArray(r)){let e=i.x-t.x,n=i.y-t.y,{width:s,height:a}=i,o={targetZ:r},l=t.unproject([e,n],o),u=t.unproject([e+s,n],o),c=t.unproject([e,n+a],o),h=t.unproject([e+s,n+a],o);return[Math.min(l[0],u[0],c[0],h[0]),Math.min(l[1],u[1],c[1],h[1]),Math.max(l[0],u[0],c[0],h[0]),Math.max(l[1],u[1],c[1],h[1])]}let n=e(t,r[0],i),s=e(t,r[1],i);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]})(e,t||0,r))}function La(e,t){return 512*Math.pow(2,e)/t}function Lo(e,t,r){let i=La(r,512),n=Math.PI-2*Math.PI*t/i;return[e/i*360-180,180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))]}function Ll(e,t,r,i){let n=La(r,i);return[e/n*512,t/n*512]}let Lu="best-available",Lc={[Lu]:function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&!Lf(t)&&Ld(t);for(let t of e)t.isVisible=!!(2&t.state)},"no-overlap":function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&Lf(t);for(let t of Array.from(e).sort((e,t)=>e.zoom-t.zoom))if(t.isVisible=!!(2&t.state),t.children&&(t.isVisible||1&t.state))for(let e of t.children)e.state=1;else t.isSelected&&Ld(t)},never:()=>{}},Lh={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};function Lf(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=2,!0;t=t.parent}return!1}function Ld(e){for(let t of e.children)t.isLoaded||t.content?t.state|=2:Ld(t)}class Lp extends CL{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(e=>e.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state,r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(e=>{e.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:i,extent:n,maxZoom:s,minZoom:a,maxRequests:o,debounceTime:l,zoomOffset:u}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:s,minZoom:a,tileSize:e,refinementStrategy:i,extent:n,maxRequests:o,debounceTime:l,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:n}=e,s=this.state.isLoaded!==n,a=this.state.frameNumber!==i;n&&(s||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=n}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:t,getTileData:r,fetch:i}=this.props,{signal:n}=e;return(e.url="string"==typeof t||Array.isArray(t)?function(e,t){if(!e||!e.length)return null;let{index:r,id:i}=t;if(Array.isArray(e)){let t=Math.abs(i.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))%e.length;e=e[t]}let n=e;for(let e of Object.keys(r)){let t=RegExp(`{${e}}`,"g");n=n.replace(t,String(r[e]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}(t,e):null,r)?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:n}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let t=e.sourceLayer,r=t.props.tile,i=e.info;return i.picked&&(i.tile=r),i.sourceTile=r,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(e=>e.clone(t)));else{let r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=kM(r,Boolean).map(r=>r.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){let{tile:r}=e.props,{modelMatrix:i}=this.props;return this.state.tileset.isTileVisible(r,t,i?new wW(i):null)}}Lp.defaultProps={TilesetClass:class{constructor(e){this._getCullBounds=function(e){let t,r={};return i=>{for(let n in i)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}(i[n],r[n])){t=e(i),r=i;break}return t}}(Ls),this.opts={...Lh,...e},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),null!==this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new Is({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new wW,this._modelMatrixInverse=new wW}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){let i=r?new wW(r):new wW,n=!i.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&_g(this._zRange,t)&&!n)this.needsReload&&(this._selectedTiles=this._selectedTiles.map(e=>this._getTile(e.index,!0)));else{n&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;let r=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=r.map(e=>this._getTile(e,!0)),this._dirty&&this._rebuildTree()}let s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t,r){if(!e.isVisible)return!1;if(t&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:n}=e;for(let[e,t,s,a]of i){let i;if("west"in n)i=n.west<s&&n.east>e&&n.south<a&&n.north>t;else{if(r&&!wW.IDENTITY.equals(r)){let[e,t,i,s]=Ln([n.left,n.top,n.right,n.bottom],r);n={left:e,top:t,right:i,bottom:s}}let o=Math.min(n.top,n.bottom),l=Math.max(n.top,n.bottom);i=n.left<s&&n.right>e&&o<a&&l>t}if(i)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:i,modelMatrix:n,modelMatrixInverse:s}){let{tileSize:a,extent:o,zoomOffset:l}=this.opts;return function({viewport:e,maxZoom:t,minZoom:r,zRange:i,extent:n,tileSize:s=512,modelMatrix:a,modelMatrixInverse:o,zoomOffset:l=0}){let u=e.isGeospatial?Math.round(e.zoom+Math.log2(512/s))+l:Math.ceil(e.zoom)+l;if("number"==typeof r&&Number.isFinite(r)&&u<r){if(!n)return[];u=r}"number"==typeof t&&Number.isFinite(t)&&u>t&&(u=t);let c=n;return a&&o&&n&&!e.isGeospatial&&(c=Ln(n,a)),e.isGeospatial?function(e,t,r,i){let n=e instanceof Iu&&e.resolution?e.projectPosition:null,s=new IV(Object.values(e.getFrustumPlanes()).map(({normal:e,distance:t})=>new IF(e.clone().negate(),t))),a=e.distanceScales.unitsPerMeter[2],o=r&&r[0]*a||0,l=r&&r[1]*a||0,u=e instanceof Sa&&e.pitch<=60?t:0;if(i){let[e,t,r,n]=i,s=w3([e,n]),a=w3([r,t]);i=[s[0],512-s[1],a[0],512-a[1]]}let c=new Lr(0,0,0),h={viewport:e,project:n,cullingVolume:s,elevationBounds:[o,l],minZ:u,maxZ:t,bounds:i,offset:0};if(c.update(h),e instanceof Sa&&e.subViewports&&e.subViewports.length>1){for(h.offset=-1;c.update(h)&&!(--h.offset<-3););for(h.offset=1;c.update(h)&&!(++h.offset>3););}return c.getSelected()}(e,u,i,n):function(e,t,r,i,n){var s,a,o;let l,u=(s=e,a=0,o=i,l=s.getBounds(),s.isGeospatial?[Math.max(l[0],o[0]),Math.max(l[1],o[1]),Math.min(l[2],o[2]),Math.min(l[3],o[3])]:[Math.max(Math.min(l[0],o[2]),o[0]),Math.max(Math.min(l[1],o[3]),o[1]),Math.min(Math.max(l[2],o[0]),o[2]),Math.min(Math.max(l[3],o[1]),o[3])]),c=La(t,r),[h,f,d,p]=n?Ln(u,n).map(e=>e*c/512):u.map(e=>e*c/512),g=[];for(let e=Math.floor(h);e<d;e++)for(let r=Math.floor(f);r<p;r++)g.push({x:e,y:r,z:t});return g}(e,u,s,c||Li,o)}({viewport:e,maxZoom:t,minZoom:r,zRange:i,tileSize:a,extent:o,modelMatrix:n,modelMatrixInverse:s,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:t}=this.opts;return{bbox:function(e,t,r,i,n=512){if(e.isGeospatial){let[e,n]=Lo(t,r,i),[s,a]=Lo(t+1,r+1,i);return{west:e,north:n,east:s,south:a}}let[s,a]=Ll(t,r,i,n),[o,l]=Ll(t+1,r+1,i,n);return{left:s,top:a,right:o,bottom:l}}(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){let t=Math.floor(e.x/2);return{x:t,y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){let e=this.opts.refinementStrategy||Lu,t=Array(this._cache.size),r=0;for(let e of this._cache.values())t[r++]=e.isVisible,e.isSelected=!1,e.isVisible=!1;for(let e of this._selectedTiles)e.isSelected=!0,e.isVisible=!0;for(let i of(("function"==typeof e?e:Lc[e])(Array.from(this._cache.values())),r=0,this._cache.values()))if(t[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,t=[],r=0;for(let e of this._cache.values())e.isLoading&&(r++,e.isSelected||e.isVisible||t.push(e));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){let{_cache:e}=this;for(let t of e.values())t.parent=null,t.children&&(t.children.length=0);for(let t of e.values()){let e=this._getNearestAncestor(t);t.parent=e,e?.children&&e.children.push(t)}}_resizeCache(){let{_cache:e,opts:t}=this,r=t.maxCacheSize??(null!==t.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>i){for(let[n,s]of e)if(s.isVisible||s.isSelected||(this._cacheByteSize-=null!==t.maxCacheByteSize?s.byteLength:0,e.delete(n),this.opts.onTileUnload?.(s)),e.size<=r&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((e,t)=>e.zoom-t.zoom),this._dirty=!1)}_getTile(e,t){let r=this.getTileId(e),i=this._cache.get(r),n=!1;return!i&&t?(Object.assign(i=new Ia(e),this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),n=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(n=!0),i&&n&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){let{_minZoom:t=0}=this,r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);let e=this._getTile(r);if(e)return e}return null}},data:{type:"data",value:[]},dataComparator:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0},renderSubLayers:{type:"function",value:e=>new Ii(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Lu,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Lp.layerName="TileLayer";let Lg={longitude:-73.9777,latitude:40.7527,zoom:10.6,minZoom:8.5,maxZoom:16,pitch:5,bearing:-4},Lm=new SW({ambientLight:new SI({color:[255,255,255],intensity:.65}),directionalLights:[new class extends SD{constructor(e){super(e),this.timestamp=e.timestamp}getProjectedLight({layer:e}){let{viewport:t}=e.context;if(t.resolution&&t.resolution>0){let[e,t,r]=C_(this.timestamp,0,0);this.direction=[e,-r,t]}else{let{latitude:e,longitude:r}=t;this.direction=C_(this.timestamp,e,r)}return this}}({timestamp:Date.UTC(2024,4,18,20),color:[253,186,116],intensity:1.1,direction:[-.7,-.6,-.5]})]});function Ly({scenario:e,focus:t,highlights:r=[]}){let[i,n]=(0,Q.useState)(Lg),[s,a]=(0,Q.useState)("supported"),o=(0,Q.useMemo)(()=>.55+t/100*.55,[t]),l=(0,Q.useMemo)(()=>new Lp({id:"osm-base-tiles",data:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:256,refinementStrategy:"best-available",renderSubLayers:e=>{let{tile:t,data:r}=e;if(!t||!t.bbox||!r)return null;let{west:i,south:n,east:s,north:a}=t.bbox;return new CC(e,{data:null,image:r,bounds:[i,n,s,a]})}}),[]),u=(0,Q.useMemo)(()=>e.layers.flatMap(e=>(function(e,t){switch(e.visualization){case"choropleth":case"flow":default:return[];case"point":{let r=Lx(3+4*t,3,12);return[new Cv({id:`scenario-${e.id}-points`,data:e.dataset.features,pickable:!0,parameters:{depthTest:!1},getPosition:e=>e.geometry.coordinates,radiusUnits:"pixels",getRadius:()=>r,getFillColor:()=>Lb(e.style.color,.65+.25*t),getLineColor:()=>Lb(e.style.secondaryColor??e.style.color,.9),lineWidthUnits:"pixels",lineWidthMinPixels:1.8,updateTriggers:{getRadius:r}})]}}})(e,o)).filter(e=>!!e),[e.layers,o]),c=(0,Q.useMemo)(()=>{if(0===r.length)return null;let e=Lx(5+8*o,5,18);return new Cv({id:"scenario-highlights",data:r.slice(0,6),pickable:!0,parameters:{depthTest:!1},getPosition:e=>e.coordinates,radiusUnits:"pixels",getRadius:()=>e,getFillColor:[14,165,233,210],getLineColor:[236,254,255,240],lineWidthUnits:"pixels",lineWidthMinPixels:2,updateTriggers:{getRadius:e}})},[r,o]);(0,Q.useEffect)(()=>{requestAnimationFrame(()=>{let e=document.createElement("canvas");a(["webgl2","webgl","experimental-webgl"].some(t=>null!==e.getContext(t))?"supported":"unsupported")})},[]);let h=(0,Q.useMemo)(()=>{let e=[l,...u];return c&&e.push(c),e},[l,u,c]),f=(0,Q.useMemo)(()=>e=>{let{object:t,layer:r}=e;if(!t||!r)return null;if("scenario-highlights"===r.id)return{html:[`<div class="font-semibold text-slate-900">${t.sensorId}</div>`,`<div class="text-[12px] text-slate-500">${t.sensorType}${t.district?` \xb7 ${t.district}`:""}</div>`,`<div class="mt-1 text-[12px] text-slate-600">Score ${t.anomalyScore.toFixed(2)}</div>`,t.health?`<div class="mt-1 inline-flex rounded-full bg-slate-100 px-2 py-[2px] text-[11px] font-medium text-slate-600">${t.health}</div>`:""].join(""),style:Lv};let i="properties"in t?t.properties??void 0:void 0;if(!i)return null;let n=i.district??i.program??i.indicator??i.name;if(!n)return null;let s=[i.priority,i.status,i.stage,i.leadTheme,i.leadAgency,i.borough].map(e=>"string"==typeof e?e:null).filter(Boolean).join("  "),a=function(e){for(let[t,r]of[["sdgComposite",e=>`${(100*e).toFixed(0)} index`],["impactScore",e=>`${Math.round(100*e)} impact`],["progressIndex",e=>`${Math.round(100*e)} progress`],["householdsReached",e=>`${Math.round(e/1e3)}k households`],["wellbeingScore",e=>`${Math.round(e)} wellbeing`],["resilienceScore",e=>`${Math.round(100*e)} resilience`],["score",e=>e.toFixed(2)],["percentage",e=>`${Math.round(e)}%`],["height",e=>`${Math.round(e)} m`]]){let i=e[t];if("number"==typeof i&&Number.isFinite(i))return r(i)}return null}(i);return{html:[`<div class="font-semibold text-slate-900">${n}</div>`,s?`<div class="text-[12px] text-slate-500">${s}</div>`:"",null!==a?`<div class="mt-1 text-[12px] text-slate-600">Metric ${a}</div>`:""].join(""),style:Lv}},[]),d=(0,Q.useCallback)(e=>{n(t=>({...t,zoom:Lx(t.zoom+e,t.minZoom??4,t.maxZoom??18)}))},[]),p=(0,Q.useCallback)(e=>{let t=e?.viewState;t&&"object"==typeof t&&"longitude"in t&&"latitude"in t&&"zoom"in t&&n(e=>({...e,longitude:Number(t.longitude)||e.longitude,latitude:Number(t.latitude)||e.latitude,zoom:Number(t.zoom)||e.zoom,minZoom:"minZoom"in t&&"number"==typeof t.minZoom?t.minZoom:e.minZoom,maxZoom:"maxZoom"in t&&"number"==typeof t.maxZoom?t.maxZoom:e.maxZoom,pitch:"pitch"in t&&"number"==typeof t.pitch?t.pitch:e.pitch,bearing:"bearing"in t&&"number"==typeof t.bearing?t.bearing:e.bearing}))},[]);return(0,J.jsxs)("div",{className:"relative h-[360px] w-full overflow-hidden rounded-[32px] bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 sm:h-[440px] lg:h-[520px] xl:h-[560px]",children:["supported"===s?(0,J.jsx)(Cu,{viewState:i,controller:{dragPan:!0,scrollZoom:!0,dragRotate:!1,doubleClickZoom:!0,touchZoom:!0},onViewStateChange:p,layers:h,effects:[Lm],getTooltip:f,parameters:{clearColor:[.94,.97,.99,1]}}):"unsupported"===s?(0,J.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 text-sm font-medium text-slate-500",children:"Interactive map unavailable on this device."}):(0,J.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 text-sm font-medium text-slate-500",children:"Preparing interactive map"}),(0,J.jsx)("div",{className:"pointer-events-none absolute left-6 top-6 rounded-full bg-white/90 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-500 shadow-sm ring-1 ring-slate-900/5",children:"New York City"}),(0,J.jsxs)("div",{className:"absolute right-6 top-6 flex flex-col gap-2",children:[(0,J.jsx)("button",{type:"button",className:"rounded-full bg-white/95 p-2 shadow-md ring-1 ring-slate-900/10 transition hover:scale-105 hover:bg-white",onClick:()=>d(.6),"aria-label":"Zoom in",children:(0,J.jsx)("span",{className:"block text-base font-semibold text-slate-600",children:"+"})}),(0,J.jsx)("button",{type:"button",className:"rounded-full bg-white/95 p-2 shadow-md ring-1 ring-slate-900/10 transition hover:scale-105 hover:bg-white",onClick:()=>d(-.6),"aria-label":"Zoom out",children:(0,J.jsx)("span",{className:"block text-base font-semibold text-slate-600",children:"-"})})]})]})}let Lv={backgroundColor:"rgba(255,255,255,0.95)",borderRadius:"12px",padding:"10px 12px",boxShadow:"0 18px 32px -20px rgba(15,23,42,0.35)",border:"1px solid rgba(148, 163, 184, 0.2)",color:"#0f172a"};function Lb(e,t=1){let r=e.replace("#",""),i=3===r.length?r.split("").map(e=>`${e}${e}`).join(""):r,n=Number.parseInt(i,16);return Number.isNaN(n)||6!==i.length?[30,64,175,Math.round(255*t)]:[n>>16&255,n>>8&255,255&n,Math.round(255*Lx(t,0,1))]}function Lx(e,t,r){return Math.min(r,Math.max(t,e))}var L_=e.i(20688),Lw=e.i(97265);let Lk=[{id:"ingestion",title:"Telemetry Ingestion",status:"complete",etaMinutes:0,completion:100,summary:"64 feeds cleaned and aligned with the twin.",insights:["Duplicate curb sensors removed before features load."],kpis:[{id:"ingestion-latency",label:"Pipeline latency",value:"84 s",deltaLabel:"-18%",direction:"down",narrative:"GPU streaming keeps weather feeds under 90 seconds."}],compliance:[{id:"gdpr",label:"GDPR",status:"pass",description:"PII removed across mobility surveys."}],artifacts:[{id:"feature-store",label:"Feature store snapshot",detail:"118 features ready for modeling."}],auditTrail:[{timestamp:"07:42",actor:"Pipeline bot",message:"All connectors returned healthy responses."},{timestamp:"07:48",actor:"Ops analyst",message:"Flagged EV charger feed for follow-up."}],trend:{id:"ingestion-throughput",title:"Feeds cleared",metricLabel:"per 15 min",points:[{label:"07:00",value:28},{label:"07:15",value:31},{label:"07:30",value:34},{label:"07:45",value:36},{label:"08:00",value:38}],baselineLabel:"Target",baselineValue:32,summary:"Running 18% faster than last week's pull."}},{id:"classification",title:"SDG Classification",status:"active",etaMinutes:6,completion:68,summary:"Models tag telemetry with SDG codes and policy context.",insights:["Equity scan flagged a subsidy gap in East Dock."],kpis:[{id:"classification-precision",label:"Classification precision",value:"97.4%",deltaLabel:"+2.1%",direction:"up",narrative:"Active learning used the latest permit checks."}],compliance:[{id:"undp",label:"UN SDG taxonomy",status:"pass",description:"Indicators mapped with source evidence."},{id:"equity-scan",label:"Equity scan",status:"attention",description:"Needs fresh census microdata for East Dock."}],artifacts:[{id:"taxonomy-crosswalk",label:"Taxonomy crosswalk",detail:"SDG to city KPI table with confidence scores."}],auditTrail:[{timestamp:"08:03",actor:"Model ops",message:"Scaled GPU nodes to 3 for inference."},{timestamp:"08:05",actor:"Policy engine",message:"Loaded 2025 VLR guidance update."}],trend:{id:"classification-confidence",title:"Model confidence",metricLabel:"precision",unit:"%",points:[{label:"07:30",value:94.2},{label:"07:45",value:95.6},{label:"08:00",value:96.1},{label:"08:15",value:97.4}],baselineLabel:"Floor",baselineValue:92,summary:"Active learning lifted precision above the 95% floor."}},{id:"scoring",title:"KPI Scoring",status:"pending",etaMinutes:12,completion:24,summary:"Simulator checks live KPIs against last year.",insights:["Micromobility share is 12 points above last year."],kpis:[{id:"mobility-delta",label:"Mobility uplift",value:"+12.6 pts",deltaLabel:"+12.6 pts",direction:"up",narrative:"Curb pilots boosting throughput in Innovation Corridor."}],compliance:[{id:"audit-readiness",label:"Audit readiness",status:"pass",description:"Variance explanations link to twin snapshots."},{id:"kpi-governance",label:"KPI governance",status:"attention",description:"Waiting on budget sign-off for affordability metric."}],artifacts:[{id:"scenario-sheets",label:"Scenario sheets",detail:"Baseline vs. improved comparison for 2023-2025."}],auditTrail:[{timestamp:"08:12",actor:"Twin simulator",message:"Monte Carlo batch #2 at 70% completion."},{timestamp:"08:15",actor:"Finance liaison",message:"Budget office notified for affordability review."}],trend:{id:"scoring-uplift",title:"Mobility uplift",metricLabel:"vs baseline",unit:"pts",points:[{label:"Baseline",value:0},{label:"Week 1",value:4.5},{label:"Week 2",value:7.3},{label:"Week 3",value:9.8},{label:"Week 4",value:12.6}],baselineLabel:"Goal",baselineValue:8,summary:"Mobility plan is already four points above the quarterly goal."}},{id:"narrative",title:"Narrative Assembly",status:"pending",etaMinutes:18,completion:12,summary:"Writer bot turns KPIs into clear VLR stories.",insights:["Executive summary waits for SDG 9 evidence."],kpis:[{id:"draft-speed",label:"Draft speed",value:"4m 28s",deltaLabel:"-1.9 min",direction:"down",narrative:"Template tuning trimmed drafting time this week."}],compliance:[{id:"language-pack",label:"Language pack",status:"pass",description:"Multilingual glossary validated."},{id:"sensitivity",label:"Sensitivity review",status:"risk",description:"Human review needed for coastal displacement section."}],artifacts:[{id:"briefing-deck",label:"Briefing deck",detail:"Slides with twin heatmaps ready for export."}],auditTrail:[{timestamp:"08:20",actor:"Narrative bot",message:"Drafted climate resilience chapter v1.4."},{timestamp:"08:23",actor:"Sensitivity reviewer",message:"Requested community quotes for Harbor District."}],trend:{id:"narrative-cycle",title:"Draft cycle time",metricLabel:"per chapter",unit:"min",points:[{label:"Kickoff",value:9.4},{label:"Climate",value:6.2},{label:"Equity",value:5.5},{label:"Mobility",value:4.8}],baselineLabel:"Target",baselineValue:6,summary:"Playbooks keep chapters under the six minute target."}}],LP=[{id:"heat-strategy",severity:"warning",message:"Heat plan pending for two waterfront schools.",suggestedAction:"Trigger the cooling shelter protocol."},{id:"der-incentives",severity:"critical",message:"DER incentives need council approval before the Q4 vote.",suggestedAction:"Book a finance briefing with the innovation committee."},{id:"equity-gap",severity:"info",message:"Mobility subsidy data missing for East Dock.",suggestedAction:"Request census microdata and fare card reports."}],LS={type:"FeatureCollection",name:"ImpactCorridors",features:[{type:"Feature",properties:{program:"Civic Learning Spine",sdgTarget:"SDG 4.3  Lifelong Learning Access",impactScore:.91,stage:"Scaling",leadAgency:"Department of Learning Innovation"},geometry:{type:"LineString",coordinates:[[-74.012,40.704],[-74.002,40.716],[-73.989,40.73],[-73.977,40.744]]}},{type:"Feature",properties:{program:"Coastal Resilience Walk",sdgTarget:"SDG 13.1  Climate Preparedness",impactScore:.84,stage:"Pilot",leadAgency:"Urban Coast Office"},geometry:{type:"LineString",coordinates:[[-74.018,40.708],[-74.009,40.721],[-73.995,40.732],[-73.984,40.741]]}},{type:"Feature",properties:{program:"Innovation Commons Stroll",sdgTarget:"SDG 11.7  Public Space Equity",impactScore:.79,stage:"Discovery",leadAgency:"Civic Commons Lab"},geometry:{type:"LineString",coordinates:[[-73.982,40.768],[-73.971,40.778],[-73.959,40.785],[-73.947,40.793]]}}]},LE={type:"FeatureCollection",name:"DistrictSnapshots",features:[{type:"Feature",properties:{district:"Harbor Resilience Loop",sdgComposite:.86,leadTheme:"Climate Adaptation",householdsReached:186e3,priority:"Accelerate"},geometry:{type:"Polygon",coordinates:[[[-74.018,40.699],[-74.002,40.712],[-73.996,40.706],[-74.01,40.693],[-74.018,40.699]]]}},{type:"Feature",properties:{district:"Innovation Basin Studio",sdgComposite:.72,leadTheme:"Skills & Jobs",householdsReached:94e3,priority:"Stabilize"},geometry:{type:"Polygon",coordinates:[[[-73.999,40.741],[-73.985,40.748],[-73.973,40.739],[-73.988,40.733],[-73.999,40.741]]]}},{type:"Feature",properties:{district:"Northern Commons Network",sdgComposite:.9,leadTheme:"Housing Inclusion",householdsReached:158e3,priority:"Monitor"},geometry:{type:"Polygon",coordinates:[[[-73.972,40.795],[-73.958,40.803],[-73.946,40.792],[-73.96,40.784],[-73.972,40.795]]]}}]},LA={type:"FeatureCollection",name:"IndicatorSites",features:[{type:"Feature",properties:{id:"SDG-204",indicator:"Affordable Housing Access",sdgTarget:"SDG 11.1",status:"On Track",progressIndex:.82,refreshMinutesAgo:4,district:"Aurora District"},geometry:{type:"Point",coordinates:[-73.995,40.734]}},{type:"Feature",properties:{id:"SDG-441",indicator:"Green Schoolyards Coverage",sdgTarget:"SDG 3.4",status:"Watch",progressIndex:.63,refreshMinutesAgo:2,district:"Harbor Resilience Loop"},geometry:{type:"Point",coordinates:[-74.006,40.715]}},{type:"Feature",properties:{id:"SDG-109",indicator:"Clean Energy Retrofits",sdgTarget:"SDG 7.2",status:"On Track",progressIndex:.74,refreshMinutesAgo:1,district:"Aurora Medical Campus"},geometry:{type:"Point",coordinates:[-73.958,40.79]}},{type:"Feature",properties:{id:"SDG-512",indicator:"Community Health Access",sdgTarget:"SDG 3.8",status:"Delayed",progressIndex:.41,refreshMinutesAgo:17,district:"Care Corridor Spine"},geometry:{type:"Point",coordinates:[-73.981,40.758]}},{type:"Feature",properties:{id:"SDG-317",indicator:"Urban Cooling Canopies",sdgTarget:"SDG 13.1",status:"Watch",progressIndex:.58,refreshMinutesAgo:3,district:"Innovation Basin Studio"},geometry:{type:"Point",coordinates:[-73.973,40.743]}},{type:"Feature",properties:{id:"SDG-204B",indicator:"Resilient Infrastructure Upgrades",sdgTarget:"SDG 9.1",status:"Watch",progressIndex:.69,refreshMinutesAgo:6,district:"Harbor Resilience Loop"},geometry:{type:"Point",coordinates:[-74.01,40.706]}},{type:"Feature",properties:{id:"SDG-626",indicator:"Civic Wi-Fi Coverage",sdgTarget:"SDG 9.c",status:"On Track",progressIndex:.77,refreshMinutesAgo:5,district:"Civic Learning Spine"},geometry:{type:"Point",coordinates:[-73.948,40.772]}}]},LM=Object.fromEntries(Lw.citywideKpis.map(e=>[e.id,e]));function LT(e){return e.map(e=>LM[e]).filter(e=>!!e).map(e=>({...e}))}let LC={"sdg-localization":{key:"sdg-localization",name:"SDG Localization",tagline:"District SDG scorecards update in real time.",narrative:"Census, budget, and survey feeds flag which districts fall behind so crews can move before targets slip.",command:"Resolve the two districts slipping before the daily stand-up.",liveSignals:[{label:"Districts on track",value:"12 of 18",delta:"+1 today",tone:"positive"},{label:"Data refresh",value:"98%",delta:"Live",tone:"positive"}],aiInsights:[{title:"Send the tutoring crew back to Innovation Basin.",detail:"Attendance dipped in two schools; a mobile team lifts SDG 4 back on track within five days.",confidence:.82}],kpis:LT(["sdg-progress"]),layers:[{id:"district-sdg-composite",label:"District SDG Composite",legend:"Blue shows overall SDG score for each district.",visualization:"choropleth",dataset:LE,style:{color:"#38bdf8",secondaryColor:"#0ea5e9",intensity:.78}},{id:"indicator-observatories",label:"Indicator Observatories",legend:"Pins mark indicators drifting from plan.",visualization:"point",dataset:LA,style:{color:"#7c3aed",secondaryColor:"#a855f7",intensity:.62}},{id:"impact-corridors",label:"Impact Corridors",legend:"Lines show active programs boosting SDG delivery.",visualization:"flow",dataset:LS,style:{color:"#0ea5e9",secondaryColor:"#22d3ee",intensity:.7}}],actions:["Deploy the mobile tutoring team to Innovation Basin.","Add Harbor Loops climate win to tomorrows VLR brief."]},"vlr-automation":{key:"vlr-automation",name:"VLR Automation Console",tagline:"AI keeps the voluntary local review on schedule.",narrative:"Evidence from finance, climate, and community teams syncs automatically so drafts stay ready for sign-off.",command:"Publish the executive summary by Friday.",liveSignals:[{label:"Sections ready",value:"7 / 9",delta:"+2 today",tone:"positive"},{label:"Evidence cleared",value:"92%",delta:"+6%",tone:"positive"}],aiInsights:[{title:"SDG 9 packet still waits on invoice tags.",detail:"Finance is missing two project codes; approve the fetch and the automation will reconcile them.",confidence:.9}],kpis:LT(["vlr-ready"]),layers:[{id:"evidence-corridors",label:"Evidence Corridors",legend:"Lines show which programs feed the VLR workspace.",visualization:"flow",dataset:LS,style:{color:"#14b8a6",secondaryColor:"#22c55e",intensity:.68}},{id:"evidence-sites",label:"Evidence Sites",legend:"Pins highlight packets waiting for review.",visualization:"point",dataset:LA,style:{color:"#f97316",secondaryColor:"#fb923c",intensity:.58}}],actions:["Nudge finance to clear the SDG 9 invoices.","Publish the SDG 11 public space story after quotes land."]},"city-profiling":{key:"city-profiling",name:"City Profiling Studio",tagline:"Compare wellbeing lift by district.",narrative:"The twin blends demographics, capital plans, and sentiment to show which projects move wellbeing fastest.",command:"Select the next three districts for council funding.",liveSignals:[{label:"Wellbeing score",value:"74 index",delta:"+4 pts",tone:"positive"},{label:"Capital on track",value:"81% funded",delta:"-3%",tone:"warning"}],aiInsights:[{title:"Northern Commons still delivers the biggest lift.",detail:"A $14M streetscape bundle lifts wellbeing six points without raising displacement risk.",confidence:.88}],kpis:LT(["wellbeing-score","capital-ready"]),layers:[{id:"profile-districts",label:"District Profiles",legend:"Purple shows overall wellbeing score.",visualization:"choropleth",dataset:LE,style:{color:"#a855f7",secondaryColor:"#6366f1",intensity:.74}},{id:"investment-corridors",label:"Investment Corridors",legend:"Lines trace priority capital programs.",visualization:"flow",dataset:LS,style:{color:"#38bdf8",secondaryColor:"#22d3ee",intensity:.65}},{id:"wellbeing-sentinels",label:"Wellbeing Sentinels",legend:"Pins pulse if wellbeing deviates from forecast.",visualization:"point",dataset:LA,style:{color:"#22c55e",secondaryColor:"#4ade80",intensity:.6}}],actions:["Advance the Northern Commons package to the council agenda.","Share Harbor Loop shoreline options with the budget office."]}};Lw.demandForecast,Lw.resilienceForecast,Lw.anomalyClusters;var LO=e.i(75157),LI=e.i(98298);let LL=[{id:"digital-twin",label:"GIS City Analysis",description:"City map with SDG signals.",icon:ei},{id:"vlr",label:"VLR Automation",description:"Track the review workflow.",icon:en},{id:"pipelines",label:"AI Pipelines",description:"See forecasts and model health.",icon:er},{id:"policy-insights",label:"Policy Insights",description:"Executive-ready directives.",icon:ee.Gavel}],Lj={"digital-twin":"sdg-localization",vlr:"vlr-automation",pipelines:"city-profiling"},LN={ingestion:"Data check",classification:"Tag evidence",scoring:"Score outcomes",narrative:"Draft stories"},LD={warning:"bg-amber-100 text-amber-700",critical:"bg-rose-100 text-rose-700",info:"bg-sky-100 text-sky-700"},LR={warning:"Attention",critical:"Urgent",info:"Info"};function Lz(){let[e,t]=(0,Q.useState)("digital-twin"),[r,i]=(0,Q.useState)(55),n=Lj[e],s=n?LC[n]:null;if(n&&!s)throw Error(`Scenario not found for key ${n}`);let a=(0,Q.useMemo)(()=>{let e;if(!n)return{signals:[],aiInsights:[],kpis:[],actions:[]};let t=(e=LC[n])?{signals:e.liveSignals,aiInsights:e.aiInsights,kpis:e.kpis,actions:e.actions}:[];return Array.isArray(t)?{signals:[],aiInsights:[],kpis:[],actions:[]}:t},[n]),o=(0,Q.useMemo)(()=>{let e;return s?(e=[],s.layers.filter(e=>"point"===e.visualization).forEach(t=>{t.dataset.features.forEach((r,i)=>{if(r.geometry?.type!=="Point")return;let n=r.geometry.coordinates;if(!Array.isArray(n)||n.length<2)return;let[s,a]=n;if("number"!=typeof s||"number"!=typeof a)return;let o=r.properties??{},l="number"==typeof o.progressIndex?o.progressIndex:null,u="number"==typeof o.anomalyScore?o.anomalyScore:null!==l?1-Math.min(Math.max(l,0),1):.45;e.push({id:String(o.id??r.id??`${t.id}-${i}`),sensorId:"string"==typeof o.id?o.id:`Node-${i+1}`,sensorType:"string"==typeof o.indicator?o.indicator:t.label,layerLabel:t.label,district:"string"==typeof o.district?o.district:null,health:"string"==typeof o.status?o.status:null,anomalyScore:Math.min(Math.max(u,0),1),lastReadingMinutes:"number"==typeof o.refreshMinutesAgo?o.refreshMinutesAgo:"number"==typeof o.lastReadingMinutesAgo?o.lastReadingMinutesAgo:null,coordinates:[s,a]})})}),e.slice(0,6)):[]},[s]);return(0,J.jsxs)("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:[(0,J.jsx)(LI.TopBar,{}),(0,J.jsx)("main",{className:"mx-auto w-full max-w-7xl px-4 pb-16 pt-6 sm:px-6 lg:px-8",children:(0,J.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-start",children:[(0,J.jsx)(LU,{activeModule:e,onSelect:t}),(0,J.jsxs)("div",{className:"flex-1 space-y-8",children:["policy-insights"!==e?(0,J.jsx)(LF,{}):null,(0,J.jsx)(LB,{activeModule:e,onSelect:t,className:"lg:hidden"}),"digital-twin"===e&&s?(0,J.jsx)(L$,{scenario:s,insights:a,focus:r,onFocusChange:i,highlights:o}):null,"vlr"===e&&s?(0,J.jsx)(LW,{scenario:s}):null,"pipelines"===e?(0,J.jsx)(LH,{}):null,"policy-insights"===e?(0,J.jsx)(L_.PolicyInsightsExperience,{variant:"embedded"}):null]})]})})]})}function LF(){let e=Lw.citywideKpis.filter(e=>"sdg-progress"===e.id||"vlr-ready"===e.id);return(0,J.jsx)("section",{className:"mb-8 grid gap-3 sm:grid-cols-2",children:e.map(e=>{let t="up"===e.change.direction?"text-emerald-600":"text-rose-600",r=e.changeLabel??`${"up"===e.change.direction?"+":""}${e.change.percentage.toFixed(1)}% vs last ${e.change.period}`;return(0,J.jsxs)("article",{className:"flex flex-col justify-between rounded-3xl border border-slate-200 bg-white p-4 shadow-sm sm:p-5",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-sm font-medium text-slate-600",children:e.label}),(0,J.jsxs)("p",{className:"mt-3 flex items-baseline gap-2 text-slate-900",children:[(0,J.jsx)("span",{className:"text-3xl font-semibold",children:e.value}),(0,J.jsx)("span",{className:"text-sm font-medium text-slate-500",children:e.unit})]})]}),(0,J.jsx)("p",{className:(0,LO.cn)("mt-4 text-xs font-medium",t),children:r})]},e.id)})})}function LB({activeModule:e,onSelect:t,className:r}){return(0,J.jsx)("nav",{className:(0,LO.cn)("mb-6 flex flex-wrap gap-2",r),children:LL.map(r=>{let i=e===r.id;return(0,J.jsxs)("button",{type:"button",onClick:()=>t(r.id),className:(0,LO.cn)("flex items-center gap-3 rounded-2xl border px-3 py-2 text-left text-sm transition-colors",i?"border-slate-300 bg-white text-slate-900 shadow-sm":"border-transparent bg-slate-100 text-slate-500 hover:border-slate-200 hover:bg-white"),children:[(0,J.jsx)("span",{className:(0,LO.cn)("flex h-8 w-8 items-center justify-center rounded-xl text-sky-600",i?"bg-sky-100":"bg-slate-200/70"),children:(0,J.jsx)(r.icon,{className:"h-4 w-4"})}),(0,J.jsxs)("span",{children:[(0,J.jsx)("span",{className:"block text-sm font-semibold",children:r.label}),(0,J.jsx)("span",{className:"block text-xs text-slate-400",children:r.description})]})]},r.id)})})}function LU({activeModule:e,onSelect:t}){return(0,J.jsx)("aside",{className:"hidden shrink-0 lg:block lg:w-60 xl:w-64",children:(0,J.jsxs)("nav",{className:"sticky top-24 flex flex-col gap-1 rounded-3xl border border-slate-200 bg-white px-3 py-4 shadow-sm",children:[(0,J.jsx)("p",{className:"px-2 pb-2 text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Modules"}),LL.map(r=>{let i=e===r.id;return(0,J.jsxs)("button",{type:"button",onClick:()=>t(r.id),className:(0,LO.cn)("flex items-start gap-3 rounded-2xl px-3 py-3 text-left transition-colors",i?"bg-sky-50 text-slate-900 shadow-[0_12px_32px_-24px_rgba(14,165,233,0.65)]":"text-slate-500 hover:bg-slate-100 hover:text-slate-800"),"aria-current":i?"page":void 0,children:[(0,J.jsx)("span",{className:(0,LO.cn)("mt-0.5 flex h-9 w-9 items-center justify-center rounded-xl border text-sky-600",i?"border-sky-200 bg-white":"border-transparent bg-slate-200/60 text-slate-500"),children:(0,J.jsx)(r.icon,{className:"h-4 w-4"})}),(0,J.jsxs)("span",{className:"flex-1",children:[(0,J.jsx)("span",{className:"block text-sm font-semibold",children:r.label}),(0,J.jsx)("span",{className:"mt-1 block text-xs text-slate-400",children:r.description})]})]},r.id)})]})})}function L$({scenario:e,insights:t,focus:r,highlights:i}){let n=t.signals.slice(0,3),s=t.aiInsights[0],a=t.actions.slice(0,2),o=t.kpis.slice(0,2),l=i.slice(0,3),u=Lw.demandForecast.points.slice(0,6).map(e=>({periodLabel:LK(e.timestamp),percentage:Math.round(100*e.value)})),c=u.length>0?u[u.length-1]?.percentage??null:null,h=u.length>0?u[0]?.percentage??null:null,f=null!==c&&null!==h?c-h:null,d=null!==f?`${f>=0?"+":""}${f.toFixed(0)} pts`:null,p=null!==f?f>=0?"text-emerald-600":"text-rose-600":"text-slate-400",g=[...n.map(e=>({id:`signal-${e.label}`,label:e.label,value:e.value,helper:e.delta})),...o.map(e=>({id:`kpi-${e.id}`,label:e.label,value:`${e.value} ${e.unit}`.trim(),helper:e.changeLabel??null}))];return(0,J.jsx)("section",{children:(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:e.name}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:e.tagline})]}),(0,J.jsxs)("p",{className:"text-xs text-slate-400",children:["Brief  ",e.command]})]}),(0,J.jsxs)("div",{className:"mt-6 grid gap-6 lg:grid-cols-[minmax(0,8.5fr)_minmax(0,3.5fr)] xl:gap-10",children:[(0,J.jsx)("div",{className:"space-y-4",children:(0,J.jsxs)("div",{className:"relative h-[400px] w-full overflow-hidden rounded-[36px] border border-slate-200 bg-slate-100/40 sm:h-[460px] lg:h-[560px] xl:h-[600px]",children:[(0,J.jsx)(Ly,{scenario:e,focus:r,highlights:i}),(0,J.jsx)(LV,{highlights:l})]})}),(0,J.jsxs)("aside",{className:"space-y-4",children:[l.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Active hotspots"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2",children:l.map(e=>{let t=`${Math.round(100*e.anomalyScore)}% watch`,r="Delayed"===e.health?"text-rose-600":"Watch"===e.health?"text-amber-600":"text-emerald-600";return(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2 text-sm text-slate-600",children:[(0,J.jsxs)("p",{className:"flex items-center justify-between text-sm font-semibold text-slate-900",children:[(0,J.jsx)("span",{children:e.sensorType}),(0,J.jsx)("span",{className:"text-xs font-medium text-slate-400",children:t})]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:[e.district??"Citywide",e.sensorId].filter(Boolean).join("  ")}),(0,J.jsx)("p",{className:(0,LO.cn)("mt-1 text-xs font-medium",r),children:e.health??"On track"})]},e.id)})})]}):null,g.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Live numbers"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2",children:g.map(e=>(0,J.jsxs)("li",{className:"flex items-baseline justify-between gap-3 rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:e.label})]}),e.helper?(0,J.jsx)("span",{className:"text-xs font-medium text-slate-400",children:e.helper}):null]},e.id))})]}):null,u.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Gender parity outlook"}),(0,J.jsxs)("div",{className:"mt-2 flex items-baseline gap-2",children:[(0,J.jsx)("span",{className:"text-2xl font-semibold text-slate-900",children:null!==c?`${c.toFixed(0)}% SDG 5 achieved`:""}),d?(0,J.jsx)("span",{className:(0,LO.cn)("text-xs font-medium",p),children:d}):null]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Updated monthly from the gender equity index"}),(0,J.jsx)("div",{className:"mt-4 h-24 w-full",children:(0,J.jsx)(nL,{width:"100%",height:"100%",children:(0,J.jsxs)(m8,{data:u,children:[(0,J.jsx)(ve,{hide:!0}),(0,J.jsx)(y0,{dataKey:"periodLabel",hide:!0}),(0,J.jsx)(m6,{type:"monotone",dataKey:"percentage",stroke:"#0ea5e9",strokeWidth:2,dot:!1})]})})})]}):null,s||a.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"AI playbook"}),s?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"mt-2 text-base font-semibold text-slate-900",children:s.title}),s.detail?(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:s.detail}):null,(0,J.jsxs)("span",{className:"mt-3 inline-flex rounded-full bg-sky-100 px-3 py-1 text-xs font-medium text-sky-700",children:[Math.round(100*s.confidence),"% confidence"]})]}):null,a.length?(0,J.jsx)("ol",{className:"mt-4 space-y-2 text-sm text-slate-600",children:a.map((e,t)=>(0,J.jsxs)("li",{className:"flex gap-2",children:[(0,J.jsxs)("span",{className:"font-medium text-sky-500",children:[t+1,"."]}),(0,J.jsx)("span",{className:"leading-6",children:e})]},e))}):null]}):null]})]})]})})}function LV({highlights:e}){return e.length?(0,J.jsx)("div",{className:"pointer-events-none absolute right-4 top-4 flex max-w-xs flex-col gap-2",children:e.map(e=>(0,J.jsxs)("div",{className:"pointer-events-auto rounded-2xl border border-slate-200 bg-white/85 px-4 py-3 text-xs text-slate-600 shadow-[0_20px_50px_-32px_rgba(15,23,42,0.45)] backdrop-blur",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.sensorType}),(0,J.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:[e.district??"Citywide","  ",e.sensorId]}),(0,J.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,J.jsxs)("span",{className:"inline-flex items-center rounded-full bg-sky-100 px-2 py-1 text-[10px] font-medium text-sky-700",children:[Math.round(100*e.anomalyScore),"% watch"]}),null!==e.lastReadingMinutes?(0,J.jsxs)("span",{className:"text-[10px] text-slate-400",children:[e.lastReadingMinutes,"m ago"]}):null]})]},e.id))}):null}function LW({scenario:e}){let[t,r]=(0,Q.useState)(Lk[0].id),i=Lk.find(e=>e.id===t)??Lk[0],n=LP.slice(0,3),s=i.kpis.slice(0,2),a=i.artifacts.slice(0,3),o=i.trend?`vlr-trend-${i.trend.id}`:null;return(0,J.jsxs)("section",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:"VLR automation"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Follow each automated pass."})]}),(0,J.jsxs)("span",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Scenario  ",e.name]})]}),(0,J.jsx)("div",{className:"mt-5 space-y-2",children:Lk.map(e=>{let i=LN[e.id]??e.title,n=e.id===t;return(0,J.jsxs)("button",{type:"button",onClick:()=>r(e.id),className:(0,LO.cn)("w-full rounded-2xl border border-slate-200 bg-white p-4 text-left transition hover:border-slate-300",n&&"border-sky-200 bg-sky-50 shadow-[0_18px_42px_-30px_rgba(14,165,233,0.55)]"),children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,J.jsxs)("div",{className:"space-y-1",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:i}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:e.summary})]}),(0,J.jsx)(LG,{status:e.status})]}),(0,J.jsxs)("div",{className:"mt-3 flex items-center gap-3",children:[(0,J.jsx)("div",{className:"h-1.5 w-full flex-1 overflow-hidden rounded-full bg-slate-200",children:(0,J.jsx)("div",{className:(0,LO.cn)("h-full rounded-full transition-all","complete"===e.status&&"bg-emerald-400","active"===e.status&&"bg-sky-400","pending"===e.status&&"bg-slate-400"),style:{width:`${Math.max(e.completion,"pending"===e.status?12:6)}%`}})}),(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:[e.etaMinutes,"m"]})]})]},e.id)})})]}),(0,J.jsxs)("div",{className:"space-y-5",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Stage snapshot"}),(0,J.jsxs)("div",{className:"mt-4 flex flex-col gap-5",children:[(0,J.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)(Lq,{completion:i.completion}),(0,J.jsxs)("div",{className:"space-y-1 text-sm text-slate-600",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:LN[i.id]??i.title}),(0,J.jsx)("p",{children:i.summary}),(0,J.jsxs)("p",{className:"text-xs text-slate-400",children:["ETA ",i.etaMinutes," min"]})]})]})}),i.trend?(0,J.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-slate-50/60 p-4",children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:i.trend.title}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:i.trend.metricLabel})]}),i.trend.baselineLabel&&void 0!==i.trend.baselineValue?(0,J.jsxs)("span",{className:"text-xs font-medium text-slate-400",children:[i.trend.baselineLabel," ",`${i.trend.baselineValue}${i.trend.unit??""}`]}):null]}),(0,J.jsx)("div",{className:"mt-3 h-36 w-full sm:h-40",children:(0,J.jsx)(nL,{width:"100%",height:"100%",children:(0,J.jsxs)(gJ,{data:i.trend.points,children:[o?(0,J.jsx)("defs",{children:(0,J.jsxs)("linearGradient",{id:o,x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,J.jsx)("stop",{offset:"5%",stopColor:"#0ea5e9",stopOpacity:.35}),(0,J.jsx)("stop",{offset:"95%",stopColor:"#0ea5e9",stopOpacity:.05})]})}):null,(0,J.jsx)(mM,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),(0,J.jsx)(y0,{dataKey:"label",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(ve,{hide:!0,domain:[0,"auto"]}),(0,J.jsx)(yW,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>{let t=i.trend?.unit??"",r=Number.isInteger(e)?String(e):e.toFixed(1);return[`${r}${t}`,i.trend?.title??"Value"]},labelFormatter:e=>e}),(0,J.jsx)(pl,{type:"monotone",dataKey:"value",stroke:"#0ea5e9",strokeWidth:2,fill:o?`url(#${o})`:"#bae6fd",fillOpacity:o?1:.4})]})})}),(0,J.jsx)("p",{className:"mt-3 text-xs text-slate-500",children:i.trend.summary})]}):null,s.length?(0,J.jsx)("ul",{className:"grid gap-3 sm:grid-cols-2",children:s.map(e=>{let t="up"===e.direction?"text-emerald-600":"text-rose-600";return(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 p-3",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.label}),(0,J.jsx)("p",{className:(0,LO.cn)("mt-2 text-xs font-medium",t),children:e.deltaLabel}),(0,J.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:e.narrative})]},e.id)})}):null,i.compliance.length?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Checks"}),(0,J.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:i.compliance.map(e=>(0,J.jsx)("span",{className:(0,LO.cn)("inline-flex items-center rounded-full px-3 py-1 text-xs font-medium","pass"===e.status?"bg-emerald-100 text-emerald-700":"attention"===e.status?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"),title:e.description,children:e.label},e.id))})]}):null,a.length?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Artifacts"}),(0,J.jsx)("ul",{className:"mt-2 space-y-2",children:a.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:e.label}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.detail})]},e.id))})]}):null]})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Workflow log"}),i.insights.length?(0,J.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-slate-600",children:i.insights.map(e=>(0,J.jsx)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:e},e))}):null,(0,J.jsx)("p",{className:"mt-4 text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Recent events"}),(0,J.jsx)("ul",{className:"mt-2 space-y-2 text-xs text-slate-500",children:i.auditTrail.map(e=>(0,J.jsxs)("li",{className:"flex items-start gap-3",children:[(0,J.jsx)("span",{className:"font-medium text-slate-400",children:e.timestamp}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"font-medium text-slate-600",children:e.actor}),(0,J.jsx)("p",{children:e.message})]})]},`${e.timestamp}-${e.actor}`))})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Alerts to clear"}),(0,J.jsx)("ul",{className:"mt-3 space-y-3",children:n.map(e=>{var t;let r="warning"===(t=e.severity)||"critical"===t||"info"===t?t:"info";return(0,J.jsxs)("li",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,J.jsx)("p",{className:"text-sm font-medium text-slate-900",children:e.message}),(0,J.jsx)("span",{className:(0,LO.cn)("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",LD[r]),children:LR[r]})]}),(0,J.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:e.suggestedAction})]},e.id)})})]})]})]})}function LG({status:e}){return(0,J.jsx)("span",{className:(0,LO.cn)("inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium","complete"===e?"bg-emerald-100 text-emerald-700":"active"===e?"bg-sky-100 text-sky-700":"bg-slate-100 text-slate-600"),children:"complete"===e?"Done":"active"===e?"In progress":"pending"===e?"Queued":""})}function Lq({completion:e}){let t=Math.min(100,Math.max(0,Math.round(e))),r=3.6*t,i=`conic-gradient(#0ea5e9 ${r}deg, rgba(14,165,233,0.12) ${r}deg)`;return(0,J.jsxs)("div",{className:"relative h-20 w-20",children:[(0,J.jsx)("div",{className:"absolute inset-0 rounded-full",style:{backgroundImage:i}}),(0,J.jsxs)("div",{className:"absolute inset-2 flex items-center justify-center rounded-full border border-slate-200 bg-white text-sm font-semibold text-slate-700 shadow-sm",children:[t,"%"]})]})}function LH(){let[e,t]=(0,Q.useState)(Lw.scenarioComparisons[0]?.id??""),r=Lw.demandForecast.points.map(e=>({...e,periodLabel:LK(e.timestamp),percentage:Number((100*e.value).toFixed(1))})),i=Lw.resilienceForecast.points.map(e=>{let t,r,i;return{...e,quarterLabel:(r=Math.floor((t=new Date(e.timestamp)).getUTCMonth()/3)+1,i=String(t.getUTCFullYear()).slice(-2),`Q${r} '${i}`)}}),n=Lw.scenarioComparisons,s=n.find(t=>t.id===e)??n[0],a=s?.unit??"",o=s?s.optimized-s.baseline:0,l=n.reduce((e,t)=>Math.max(e,t.optimized),0),u=l>0?l:1,c=r.length?Math.max(...r.map(e=>e.percentage)):0,h=r.length?Math.min(...r.map(e=>e.percentage)):0,f=r.length>1?r[r.length-1].percentage-r[0].percentage:0,d=f>0?"text-emerald-600":f<0?"text-rose-600":"text-slate-500",p=Lw.riskCells.slice(0,4).map(e=>({...e,percentage:Math.round(100*e.score)})),g=Lw.anomalyClusters.slice(0,3),m=Lw.explainabilitySnippets.slice(0,3),y=r.length?r[r.length-1].periodLabel:null,v=i.length?i[0].value:null,b=i.length?i[i.length-1].value:null,x=null!==v&&null!==b?b-v:null,_="number"==typeof x&&0!==x?x>0?"text-emerald-600":"text-rose-600":"text-slate-500";return(0,J.jsxs)("section",{className:"space-y-6",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:"SDG & VLR progress board"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Monthly and quarterly indicators show how planners are closing priority SDG gaps and VLR actions."})]}),y?(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:["Latest monthly update  ",y]}):null]}),(0,J.jsx)("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:Lw.modelPerformanceStats.map(e=>{let t="up"===e.tone?"text-emerald-600":"text-rose-600";return(0,J.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3",children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.metric}),(0,J.jsx)("p",{className:"mt-2 text-lg font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:(0,LO.cn)("mt-1 text-xs font-medium",t),children:e.change})]},e.id)})})]}),(0,J.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.6fr)_minmax(0,1fr)]",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Gender equity projection"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:Lw.demandForecast.horizon})]}),(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:["Model  ",Lw.demandForecast.metric]})]}),(0,J.jsx)("div",{className:"mt-4 h-64 w-full",children:(0,J.jsx)(nL,{width:"100%",height:"100%",children:(0,J.jsxs)(m8,{data:r,children:[(0,J.jsx)(mM,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,J.jsx)(y0,{dataKey:"periodLabel",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(ve,{stroke:"#94a3b8",tickLine:!1,axisLine:!1,unit:"%"}),(0,J.jsx)(yW,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>[`${e.toFixed(1)}%`,"Gender equity index"],labelFormatter:e=>`Month ${e}`}),(0,J.jsx)(m6,{type:"monotone",dataKey:"percentage",stroke:"#0ea5e9",strokeWidth:3,dot:!1,activeDot:{r:5}})]})})}),(0,J.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Highest monthly score"}),(0,J.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:[c.toFixed(1),"%"]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Starting point"}),(0,J.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:[h.toFixed(1),"%"]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Change since start"}),(0,J.jsxs)("p",{className:(0,LO.cn)("text-sm font-semibold",d),children:[f>0?"+":"",f.toFixed(1)," pts"]})]})]})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Program impact scenarios"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Compare baseline vs coordinated programs to see how SDG and VLR goals advance."})]}),n.length?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:n.map(r=>{let i=r.id===e;return(0,J.jsx)("button",{type:"button",onClick:()=>t(r.id),className:(0,LO.cn)("rounded-2xl border px-3 py-1.5 text-sm font-medium transition-colors",i?"border-sky-200 bg-sky-50 text-sky-700":"border-transparent bg-slate-100 text-slate-500 hover:border-slate-200 hover:bg-white"),children:r.scenario},r.id)})}),s?(0,J.jsxs)("div",{className:"mt-5 space-y-3 text-sm text-slate-600",children:[(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Baseline"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:[s.baseline.toLocaleString("en")," ",a]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-sky-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Automation"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:[s.optimized.toLocaleString("en")," ",a]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-emerald-50 px-3 py-2 text-emerald-700",children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Lift"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold",children:[o>0?"+":"",o.toFixed(0)," ",a]})]}),(0,J.jsxs)("div",{className:"relative mt-4 h-2 w-full rounded-full bg-slate-200",children:[(0,J.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-full bg-slate-400/40",style:{width:`${Math.min(s.baseline/u*100,100)}%`}}),(0,J.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-full bg-sky-500",style:{width:`${Math.min(s.optimized/u*100,100)}%`}})]}),(0,J.jsx)("p",{className:"text-xs text-slate-400",children:"Scaling against the strongest lift in this board."}),(0,J.jsx)("p",{className:"text-sm leading-6 text-slate-600",children:s.narrative})]}):null]}):(0,J.jsx)("p",{className:"mt-4 text-sm text-slate-500",children:"Scenario comparisons will appear here once they are set."})]})]}),(0,J.jsxs)("div",{className:"grid gap-6",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Wellbeing outlook"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:Lw.resilienceForecast.horizon})]}),(0,J.jsx)("span",{className:"text-xs text-slate-400",children:"Model  wellbeing index"})]}),(0,J.jsx)("div",{className:"mt-4 h-64 w-full",children:(0,J.jsx)(nL,{width:"100%",height:"100%",children:(0,J.jsxs)(gJ,{data:i,children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("linearGradient",{id:"resilienceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,J.jsx)("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.35}),(0,J.jsx)("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:.05})]})}),(0,J.jsx)(mM,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,J.jsx)(y0,{dataKey:"quarterLabel",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(ve,{stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(yW,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>[`${e.toFixed(0)} index`,"Wellbeing"]}),(0,J.jsx)(pl,{type:"monotone",dataKey:"value",stroke:"#6366f1",strokeWidth:2,fill:"url(#resilienceGradient)",fillOpacity:1})]})})}),(0,J.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4 text-sm text-slate-600",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Now"}),(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"number"==typeof b?`${b.toFixed(0)} index`:""})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Six-quarter change"}),(0,J.jsx)("p",{className:(0,LO.cn)("text-sm font-semibold",_),children:"number"==typeof x?`${x>0?"+":""}${x.toFixed(0)} pts`:""})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Confidence"}),(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Model uses census & labor data"})]})]})]}),(0,J.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Watch list"}),(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"AI flags the districts that need attention before the monthly coordination meeting."}),(0,J.jsx)("ul",{className:"mt-4 space-y-3",children:p.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-4 py-3",children:[(0,J.jsxs)("p",{className:"flex items-center justify-between text-sm font-semibold text-slate-900",children:[(0,J.jsx)("span",{children:e.district}),(0,J.jsxs)("span",{children:[e.percentage,"%"]})]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.driver}),(0,J.jsx)("div",{className:"mt-2 h-1.5 w-full rounded-full bg-slate-200",children:(0,J.jsx)("div",{className:"h-1.5 rounded-full bg-sky-500",style:{width:`${Math.min(e.percentage,100)}%`}})})]},e.id))}),g.length?(0,J.jsxs)("div",{className:"mt-5 border-t border-slate-200 pt-4",children:[(0,J.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"Automation queue"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-slate-600",children:g.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.cluster}),(0,J.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:[e.affectedAssets," VLR packets  resolves in ",e.expectedResolutionDays," days"]})]},e.id))})]}):null]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Explainable by design"}),(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Every insight carries the evidence trail city auditors expect."}),(0,J.jsx)("ul",{className:"mt-4 space-y-3",children:m.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-4 py-3",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.title}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.detail})]},e.id))})]})]})]})]})}function LK(e){return new Intl.DateTimeFormat("en",{month:"short",year:"2-digit"}).format(new Date(e))}e.s(["default",()=>Lz],52683)}]);