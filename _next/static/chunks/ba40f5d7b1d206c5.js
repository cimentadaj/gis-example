(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78756,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isUnsafeProperty=function(e){return"__proto__"===e}},33858,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},96736,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toKey=function(e){return"string"==typeof e||"symbol"==typeof e?e:Object.is(e?.valueOf?.(),-0)?"-0":String(e)}},48018,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toString=function e(t){if(null==t)return"";if("string"==typeof t)return t;if(Array.isArray(t))return t.map(e).join(",");let r=String(t);return"0"===r&&Object.is(Number(t),-0)?"-0":r}},79232,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(48018),n=e.r(96736);r.toPath=function(e){if(Array.isArray(e))return e.map(n.toKey);if("symbol"==typeof e)return[e];e=i.toString(e);let t=[],r=e.length;if(0===r)return t;let s=0,a="",o="",l=!1;for(46===e.charCodeAt(0)&&(t.push(""),s++);s<r;){let i=e[s];o?"\\"===i&&s+1<r?a+=e[++s]:i===o?o="":a+=i:l?'"'===i||"'"===i?o=i:"]"===i?(l=!1,t.push(a),a=""):a+=i:"["===i?(l=!0,a&&(t.push(a),a="")):"."===i?a&&(t.push(a),a=""):a+=i,s++}return a&&t.push(a),t}},18915,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(78756),n=e.r(33858),s=e.r(96736),a=e.r(79232);r.get=function e(t,r,o){if(null==t)return o;switch(typeof r){case"string":{if(i.isUnsafeProperty(r))return o;let s=t[r];if(void 0===s)if(n.isDeepKey(r))return e(t,a.toPath(r),o);else return o;return s}case"number":case"symbol":{"number"==typeof r&&(r=s.toKey(r));let e=t[r];if(void 0===e)return o;return e}default:{if(Array.isArray(r)){var l=t,c=r,u=o;if(0===c.length)return u;let e=l;for(let t=0;t<c.length;t++){if(null==e||i.isUnsafeProperty(c[t]))return u;e=e[c[t]]}return void 0===e?u:e}if(r=Object.is(r?.valueOf(),-0)?"-0":String(r),i.isUnsafeProperty(r))return o;let e=t[r];if(void 0===e)return o;return e}}}},92068,(e,t,r)=>{t.exports=e.r(18915).get},43210,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.last=function(e){return e[e.length-1]}},75576,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.toArray=function(e){return Array.isArray(e)?e:Array.from(e)}},70871,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isLength=function(e){return Number.isSafeInteger(e)&&e>=0}},69642,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(70871);r.isArrayLike=function(e){return null!=e&&"function"!=typeof e&&i.isLength(e.length)}},5518,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(43210),n=e.r(75576),s=e.r(69642);r.last=function(e){if(s.isArrayLike(e))return i.last(n.toArray(e))}},4178,(e,t,r)=>{t.exports=e.r(5518).last},55838,(e,t,r)=>{"use strict";var i=e.r(71645),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useState,a=i.useEffect,o=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=s({inst:{value:r,getSnapshot:t}}),n=i[0].inst,u=i[1];return o(function(){n.value=r,n.getSnapshot=t,c(n)&&u({inst:n})},[e,r,t]),a(function(){return c(n)&&u({inst:n}),e(function(){c(n)&&u({inst:n})})},[e]),l(r),r};r.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},2239,(e,t,r)=>{"use strict";t.exports=e.r(55838)},52822,(e,t,r)=>{"use strict";var i=e.r(71645),n=e.r(2239),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=n.useSyncExternalStore,o=i.useRef,l=i.useEffect,c=i.useMemo,u=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,n){var h=o(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;var f=a(e,(h=c(function(){function e(e){if(!l){if(l=!0,a=e,e=i(e),void 0!==n&&d.hasValue){var t=d.value;if(n(t,e))return o=t}return o=e}if(t=o,s(a,e))return t;var r=i(e);return void 0!==n&&n(t,r)?(a=e,t):(a=e,o=r)}var a,o,l=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,i,n]))[0],h[1]);return l(function(){d.hasValue=!0,d.value=f},[f]),u(f),f}},30224,(e,t,r)=>{"use strict";t.exports=e.r(52822)},45403,(e,t,r)=>{"use strict";function i(e){return"symbol"==typeof e?1:null===e?2:void 0===e?3:4*(e!=e)}Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.compareValues=(e,t,r)=>{if(e!==t){let n=i(e),s=i(t);if(n===s&&0===n){if(e<t)return"desc"===r?1:-1;if(e>t)return"desc"===r?-1:1}return"desc"===r?s-n:n-s}return 0}},9542,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isSymbol=function(e){return"symbol"==typeof e||e instanceof Symbol}},38104,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(9542),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;r.isKey=function(e,t){return!Array.isArray(e)&&(!!("number"==typeof e||"boolean"==typeof e||null==e||i.isSymbol(e))||"string"==typeof e&&(s.test(e)||!n.test(e))||null!=t&&Object.hasOwn(t,e))}},910,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(45403),n=e.r(38104),s=e.r(79232);r.orderBy=function(e,t,r,a){if(null==e)return[];r=a?void 0:r,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=null==t?[null]:[t]),0===t.length&&(t=[null]),Array.isArray(r)||(r=null==r?[]:[r]),r=r.map(e=>String(e));let o=(e,t)=>{let r=e;for(let e=0;e<t.length&&null!=r;++e)r=r[t[e]];return r},l=t.map(e=>(Array.isArray(e)&&1===e.length&&(e=e[0]),null==e||"function"==typeof e||Array.isArray(e)||n.isKey(e))?e:{key:e,path:s.toPath(e)});return e.map(e=>({original:e,criteria:l.map(t=>{var r,i;return r=t,null==(i=e)||null==r?i:"object"==typeof r&&"key"in r?Object.hasOwn(i,r.key)?i[r.key]:o(i,r.path):"function"==typeof r?r(i):Array.isArray(r)?o(i,r):"object"==typeof i?i[r]:i})})).slice().sort((e,t)=>{for(let n=0;n<l.length;n++){let s=i.compareValues(e.criteria[n],t.criteria[n],r[n]);if(0!==s)return s}return 0}).map(e=>e.original)}},84578,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.flatten=function(e,t=1){let r=[],i=Math.floor(t),n=(e,t)=>{for(let s=0;s<e.length;s++){let a=e[s];Array.isArray(a)&&t<i?n(a,t+1):r.push(a)}};return n(e,0),r}},5257,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=/^(?:0|[1-9]\d*)$/;r.isIndex=function(e,t=Number.MAX_SAFE_INTEGER){switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return i.test(e)}}},90820,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isObject=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)}},23855,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.eq=function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}},15111,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(5257),n=e.r(69642),s=e.r(90820),a=e.r(23855);r.isIterateeCall=function(e,t,r){return!!s.isObject(r)&&(!!("number"==typeof t&&n.isArrayLike(r)&&i.isIndex(t))&&t<r.length||"string"==typeof t&&t in r)&&a.eq(r[t],e)}},69955,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(910),n=e.r(84578),s=e.r(15111);r.sortBy=function(e,...t){let r=t.length;return r>1&&s.isIterateeCall(e,t[0],t[1])?t=[]:r>2&&s.isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),i.orderBy(e,n.flatten(t),["asc"])}},42342,(e,t,r)=>{t.exports=e.r(69955).sortBy},24798,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.debounce=function(e,t,{signal:r,edges:i}={}){let n,s=null,a=null!=i&&i.includes("leading"),o=null==i||i.includes("trailing"),l=()=>{null!==s&&(e.apply(n,s),n=void 0,s=null)},c=null,u=()=>{null!=c&&clearTimeout(c),c=setTimeout(()=>{c=null,o&&l(),h()},t)},h=()=>{null!==c&&(clearTimeout(c),c=null),n=void 0,s=null},d=function(...e){if(r?.aborted)return;n=this,s=e;let t=null==c;u(),a&&t&&l()};return d.schedule=u,d.cancel=h,d.flush=()=>{l()},r?.addEventListener("abort",h,{once:!0}),d}},96074,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(24798);r.debounce=function(e,t=0,r={}){let n;"object"!=typeof r&&(r={});let{leading:s=!1,trailing:a=!0,maxWait:o}=r,l=[,,];s&&(l[0]="leading"),a&&(l[1]="trailing");let c=null,u=i.debounce(function(...t){n=e.apply(this,t),c=null},t,{edges:l}),h=function(...t){return null!=o&&(null===c&&(c=Date.now()),Date.now()-c>=o)?(n=e.apply(this,t),c=Date.now(),u.cancel(),u.schedule(),n):(u.apply(this,t),n)};return h.cancel=u.cancel,h.flush=()=>(u.flush(),n),h}},46508,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(96074);r.throttle=function(e,t=0,r={}){let{leading:n=!0,trailing:s=!0}=r;return i.debounce(e,t,{leading:n,maxWait:t,trailing:s})}},58723,(e,t,r)=>{t.exports=e.r(46508).throttle},52210,(e,t,r)=>{"use strict";var i="function"==typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,s=i?Symbol.for("react.portal"):60106,a=i?Symbol.for("react.fragment"):60107,o=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,c=i?Symbol.for("react.provider"):60109,u=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.async_mode"):60111,d=i?Symbol.for("react.concurrent_mode"):60111,f=i?Symbol.for("react.forward_ref"):60112,p=i?Symbol.for("react.suspense"):60113,g=i?Symbol.for("react.suspense_list"):60120,m=i?Symbol.for("react.memo"):60115,y=i?Symbol.for("react.lazy"):60116,v=i?Symbol.for("react.block"):60121,b=i?Symbol.for("react.fundamental"):60117,x=i?Symbol.for("react.responder"):60118,w=i?Symbol.for("react.scope"):60119;function _(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case h:case d:case a:case l:case o:case p:return e;default:switch(e=e&&e.$$typeof){case u:case f:case y:case m:case c:return e;default:return t}}case s:return t}}}function k(e){return _(e)===d}r.AsyncMode=h,r.ConcurrentMode=d,r.ContextConsumer=u,r.ContextProvider=c,r.Element=n,r.ForwardRef=f,r.Fragment=a,r.Lazy=y,r.Memo=m,r.Portal=s,r.Profiler=l,r.StrictMode=o,r.Suspense=p,r.isAsyncMode=function(e){return k(e)||_(e)===h},r.isConcurrentMode=k,r.isContextConsumer=function(e){return _(e)===u},r.isContextProvider=function(e){return _(e)===c},r.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},r.isForwardRef=function(e){return _(e)===f},r.isFragment=function(e){return _(e)===a},r.isLazy=function(e){return _(e)===y},r.isMemo=function(e){return _(e)===m},r.isPortal=function(e){return _(e)===s},r.isProfiler=function(e){return _(e)===l},r.isStrictMode=function(e){return _(e)===o},r.isSuspense=function(e){return _(e)===p},r.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===l||e===o||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===m||e.$$typeof===c||e.$$typeof===u||e.$$typeof===f||e.$$typeof===b||e.$$typeof===x||e.$$typeof===w||e.$$typeof===v)},r.typeOf=_},79684,(e,t,r)=>{"use strict";t.exports=e.r(52210)},41015,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(9542);r.toNumber=function(e){return i.isSymbol(e)?NaN:Number(e)}},89793,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(41015);r.toFinite=function(e){return e?(e=i.toNumber(e))===1/0||e===-1/0?(e<0?-1:1)*Number.MAX_VALUE:e==e?e:0:0===e?e:0}},45264,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(15111),n=e.r(89793);r.range=function(e,t,r){r&&"number"!=typeof r&&i.isIterateeCall(e,t,r)&&(t=r=void 0),e=n.toFinite(e),void 0===t?(t=e,e=0):t=n.toFinite(t),r=void 0===r?e<t?1:-1:n.toFinite(r);let s=Math.max(Math.ceil((t-e)/(r||1)),0),a=Array(s);for(let t=0;t<s;t++)a[t]=e,e+=r;return a}},66814,(e,t,r)=>{t.exports=e.r(45264).range},51655,(e,t,r)=>{!function(r){"use strict";var i,n={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},s=!0,a="[DecimalError] ",o=a+"Invalid argument: ",l=a+"Exponent out of range: ",c=Math.floor,u=Math.pow,h=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,d=c(1286742750677284.5),f={};function p(e,t){var r,i,n,a,o,l,c,u,h=e.constructor,d=h.precision;if(!e.s||!t.s)return t.s||(t=new h(e)),s?P(t,d):t;if(c=e.d,u=t.d,o=e.e,n=t.e,c=c.slice(),a=o-n){for(a<0?(i=c,a=-a,l=u.length):(i=u,n=o,l=c.length),a>(l=(o=Math.ceil(d/7))>l?o+1:l+1)&&(a=l,i.length=1),i.reverse();a--;)i.push(0);i.reverse()}for((l=c.length)-(a=u.length)<0&&(a=l,i=u,u=c,c=i),r=0;a;)r=(c[--a]=c[a]+u[a]+r)/1e7|0,c[a]%=1e7;for(r&&(c.unshift(r),++n),l=c.length;0==c[--l];)c.pop();return t.d=c,t.e=n,s?P(t,d):t}function g(e,t,r){if(e!==~~e||e<t||e>r)throw Error(o+e)}function m(e){var t,r,i,n=e.length-1,s="",a=e[0];if(n>0){for(s+=a,t=1;t<n;t++)(r=7-(i=e[t]+"").length)&&(s+=w(r)),s+=i;(r=7-(i=(a=e[t])+"").length)&&(s+=w(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}f.absoluteValue=f.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},f.comparedTo=f.cmp=function(e){var t,r,i,n;if(e=new this.constructor(e),this.s!==e.s)return this.s||-e.s;if(this.e!==e.e)return this.e>e.e^this.s<0?1:-1;for(t=0,r=(i=this.d.length)<(n=e.d.length)?i:n;t<r;++t)if(this.d[t]!==e.d[t])return this.d[t]>e.d[t]^this.s<0?1:-1;return i===n?0:i>n^this.s<0?1:-1},f.decimalPlaces=f.dp=function(){var e=this.d.length-1,t=(e-this.e)*7;if(e=this.d[e])for(;e%10==0;e/=10)t--;return t<0?0:t},f.dividedBy=f.div=function(e){return y(this,new this.constructor(e))},f.dividedToIntegerBy=f.idiv=function(e){var t=this.constructor;return P(y(this,new t(e),0,1),t.precision)},f.equals=f.eq=function(e){return!this.cmp(e)},f.exponent=function(){return b(this)},f.greaterThan=f.gt=function(e){return this.cmp(e)>0},f.greaterThanOrEqualTo=f.gte=function(e){return this.cmp(e)>=0},f.isInteger=f.isint=function(){return this.e>this.d.length-2},f.isNegative=f.isneg=function(){return this.s<0},f.isPositive=f.ispos=function(){return this.s>0},f.isZero=function(){return 0===this.s},f.lessThan=f.lt=function(e){return 0>this.cmp(e)},f.lessThanOrEqualTo=f.lte=function(e){return 1>this.cmp(e)},f.logarithm=f.log=function(e){var t,r=this.constructor,n=r.precision,o=n+5;if(void 0===e)e=new r(10);else if((e=new r(e)).s<1||e.eq(i))throw Error(a+"NaN");if(this.s<1)throw Error(a+(this.s?"NaN":"-Infinity"));return this.eq(i)?new r(0):(s=!1,t=y(_(this,o),_(e,o),o),s=!0,P(t,n))},f.minus=f.sub=function(e){return e=new this.constructor(e),this.s==e.s?S(this,e):p(this,(e.s=-e.s,e))},f.modulo=f.mod=function(e){var t,r=this.constructor,i=r.precision;if(!(e=new r(e)).s)throw Error(a+"NaN");return this.s?(s=!1,t=y(this,e,0,1).times(e),s=!0,this.minus(t)):P(new r(this),i)},f.naturalExponential=f.exp=function(){return v(this)},f.naturalLogarithm=f.ln=function(){return _(this)},f.negated=f.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},f.plus=f.add=function(e){return e=new this.constructor(e),this.s==e.s?p(this,e):S(this,(e.s=-e.s,e))},f.precision=f.sd=function(e){var t,r,i;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(o+e);if(t=b(this)+1,r=7*(i=this.d.length-1)+1,i=this.d[i]){for(;i%10==0;i/=10)r--;for(i=this.d[0];i>=10;i/=10)r++}return e&&t>r?t:r},f.squareRoot=f.sqrt=function(){var e,t,r,i,n,o,l,u=this.constructor;if(this.s<1){if(!this.s)return new u(0);throw Error(a+"NaN")}for(e=b(this),s=!1,0==(n=Math.sqrt(+this))||n==1/0?(((t=m(this.d)).length+e)%2==0&&(t+="0"),n=Math.sqrt(t),e=c((e+1)/2)-(e<0||e%2),i=new u(t=n==1/0?"5e"+e:(t=n.toExponential()).slice(0,t.indexOf("e")+1)+e)):i=new u(n.toString()),n=l=(r=u.precision)+3;;)if(i=(o=i).plus(y(this,o,l+2)).times(.5),m(o.d).slice(0,l)===(t=m(i.d)).slice(0,l)){if(t=t.slice(l-3,l+1),n==l&&"4999"==t){if(P(o,r+1,0),o.times(o).eq(this)){i=o;break}}else if("9999"!=t)break;l+=4}return s=!0,P(i,r)},f.times=f.mul=function(e){var t,r,i,n,a,o,l,c,u,h=this.constructor,d=this.d,f=(e=new h(e)).d;if(!this.s||!e.s)return new h(0);for(e.s*=this.s,r=this.e+e.e,(c=d.length)<(u=f.length)&&(a=d,d=f,f=a,o=c,c=u,u=o),a=[],i=o=c+u;i--;)a.push(0);for(i=u;--i>=0;){for(t=0,n=c+i;n>i;)l=a[n]+f[i]*d[n-i-1]+t,a[n--]=l%1e7|0,t=l/1e7|0;a[n]=(a[n]+t)%1e7|0}for(;!a[--o];)a.pop();return t?++r:a.shift(),e.d=a,e.e=r,s?P(e,h.precision):e},f.toDecimalPlaces=f.todp=function(e,t){var r=this,i=r.constructor;return(r=new i(r),void 0===e)?r:(g(e,0,1e9),void 0===t?t=i.rounding:g(t,0,8),P(r,e+b(r)+1,t))},f.toExponential=function(e,t){var r,i=this,n=i.constructor;return void 0===e?r=E(i,!0):(g(e,0,1e9),void 0===t?t=n.rounding:g(t,0,8),r=E(i=P(new n(i),e+1,t),!0,e+1)),r},f.toFixed=function(e,t){var r,i,n=this.constructor;return void 0===e?E(this):(g(e,0,1e9),void 0===t?t=n.rounding:g(t,0,8),r=E((i=P(new n(this),e+b(this)+1,t)).abs(),!1,e+b(i)+1),this.isneg()&&!this.isZero()?"-"+r:r)},f.toInteger=f.toint=function(){var e=this.constructor;return P(new e(this),b(this)+1,e.rounding)},f.toNumber=function(){return+this},f.toPower=f.pow=function(e){var t,r,n,o,l,u,h=this,d=h.constructor,f=+(e=new d(e));if(!e.s)return new d(i);if(!(h=new d(h)).s){if(e.s<1)throw Error(a+"Infinity");return h}if(h.eq(i))return h;if(n=d.precision,e.eq(i))return P(h,n);if(u=(t=e.e)>=(r=e.d.length-1),l=h.s,u){if((r=f<0?-f:f)<=0x1fffffffffffff){for(o=new d(i),t=Math.ceil(n/7+4),s=!1;r%2&&A((o=o.times(h)).d,t),0!==(r=c(r/2));)A((h=h.times(h)).d,t);return s=!0,e.s<0?new d(i).div(o):P(o,n)}}else if(l<0)throw Error(a+"NaN");return l=l<0&&1&e.d[Math.max(t,r)]?-1:1,h.s=1,s=!1,o=e.times(_(h,n+12)),s=!0,(o=v(o)).s=l,o},f.toPrecision=function(e,t){var r,i,n=this,s=n.constructor;return void 0===e?(r=b(n),i=E(n,r<=s.toExpNeg||r>=s.toExpPos)):(g(e,1,1e9),void 0===t?t=s.rounding:g(t,0,8),r=b(n=P(new s(n),e,t)),i=E(n,e<=r||r<=s.toExpNeg,e)),i},f.toSignificantDigits=f.tosd=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(g(e,1,1e9),void 0===t?t=r.rounding:g(t,0,8)),P(new r(this),e,t)},f.toString=f.valueOf=f.val=f.toJSON=function(){var e=b(this),t=this.constructor;return E(this,e<=t.toExpNeg||e>=t.toExpPos)};var y=function(){function e(e,t){var r,i=0,n=e.length;for(e=e.slice();n--;)r=e[n]*t+i,e[n]=r%1e7|0,i=r/1e7|0;return i&&e.unshift(i),e}function t(e,t,r,i){var n,s;if(r!=i)s=r>i?1:-1;else for(n=s=0;n<r;n++)if(e[n]!=t[n]){s=e[n]>t[n]?1:-1;break}return s}function r(e,t,r){for(var i=0;r--;)e[r]-=i,i=+(e[r]<t[r]),e[r]=1e7*i+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(i,n,s,o){var l,c,u,h,d,f,p,g,m,y,v,x,w,_,k,S,E,A,M=i.constructor,T=i.s==n.s?1:-1,C=i.d,O=n.d;if(!i.s)return new M(i);if(!n.s)throw Error(a+"Division by zero");for(u=0,c=i.e-n.e,E=O.length,k=C.length,g=(p=new M(T)).d=[];O[u]==(C[u]||0);)++u;if(O[u]>(C[u]||0)&&--c,(x=null==s?s=M.precision:o?s+(b(i)-b(n))+1:s)<0)return new M(0);if(x=x/7+2|0,u=0,1==E)for(h=0,O=O[0],x++;(u<k||h)&&x--;u++)w=1e7*h+(C[u]||0),g[u]=w/O|0,h=w%O|0;else{for((h=1e7/(O[0]+1)|0)>1&&(O=e(O,h),C=e(C,h),E=O.length,k=C.length),_=E,y=(m=C.slice(0,E)).length;y<E;)m[y++]=0;(A=O.slice()).unshift(0),S=O[0],O[1]>=1e7/2&&++S;do h=0,(l=t(O,m,E,y))<0?(v=m[0],E!=y&&(v=1e7*v+(m[1]||0)),(h=v/S|0)>1?(h>=1e7&&(h=1e7-1),f=(d=e(O,h)).length,y=m.length,1==(l=t(d,m,f,y))&&(h--,r(d,E<f?A:O,f))):(0==h&&(l=h=1),d=O.slice()),(f=d.length)<y&&d.unshift(0),r(m,d,y),-1==l&&(y=m.length,(l=t(O,m,E,y))<1&&(h++,r(m,E<y?A:O,y))),y=m.length):0===l&&(h++,m=[0]),g[u++]=h,l&&m[0]?m[y++]=C[_]||0:(m=[C[_]],y=1);while((_++<k||void 0!==m[0])&&x--)}return g[0]||g.shift(),p.e=c,P(p,o?s+b(p)+1:s)}}();function v(e,t){var r,n,a,o,c,h=0,d=0,f=e.constructor,p=f.precision;if(b(e)>16)throw Error(l+b(e));if(!e.s)return new f(i);for(null==t?(s=!1,c=p):c=t,o=new f(.03125);e.abs().gte(.1);)e=e.times(o),d+=5;for(c+=Math.log(u(2,d))/Math.LN10*2+5|0,r=n=a=new f(i),f.precision=c;;){if(n=P(n.times(e),c),r=r.times(++h),m((o=a.plus(y(n,r,c))).d).slice(0,c)===m(a.d).slice(0,c)){for(;d--;)a=P(a.times(a),c);return f.precision=p,null==t?(s=!0,P(a,p)):a}a=o}}function b(e){for(var t=7*e.e,r=e.d[0];r>=10;r/=10)t++;return t}function x(e,t,r){if(t>e.LN10.sd())throw s=!0,r&&(e.precision=r),Error(a+"LN10 precision limit exceeded");return P(new e(e.LN10),t)}function w(e){for(var t="";e--;)t+="0";return t}function _(e,t){var r,n,o,l,c,u,h,d,f,p=1,g=e,v=g.d,w=g.constructor,k=w.precision;if(g.s<1)throw Error(a+(g.s?"NaN":"-Infinity"));if(g.eq(i))return new w(0);if(null==t?(s=!1,d=k):d=t,g.eq(10))return null==t&&(s=!0),x(w,d);if(w.precision=d+=10,n=(r=m(v)).charAt(0),!(15e14>Math.abs(l=b(g))))return h=x(w,d+2,k).times(l+""),g=_(new w(n+"."+r.slice(1)),d-10).plus(h),w.precision=k,null==t?(s=!0,P(g,k)):g;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=m((g=g.times(e)).d)).charAt(0),p++;for(l=b(g),n>1?(g=new w("0."+r),l++):g=new w(n+"."+r.slice(1)),u=c=g=y(g.minus(i),g.plus(i),d),f=P(g.times(g),d),o=3;;){if(c=P(c.times(f),d),m((h=u.plus(y(c,new w(o),d))).d).slice(0,d)===m(u.d).slice(0,d))return u=u.times(2),0!==l&&(u=u.plus(x(w,d+2,k).times(l+""))),u=y(u,new w(p),d),w.precision=k,null==t?(s=!0,P(u,k)):u;u=h,o+=2}}function k(e,t){var r,i,n;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(r<0&&(r=i),r+=+t.slice(i+1),t=t.substring(0,i)):r<0&&(r=t.length),i=0;48===t.charCodeAt(i);)++i;for(n=t.length;48===t.charCodeAt(n-1);)--n;if(t=t.slice(i,n)){if(n-=i,e.e=c((r=r-i-1)/7),e.d=[],i=(r+1)%7,r<0&&(i+=7),i<n){for(i&&e.d.push(+t.slice(0,i)),n-=7;i<n;)e.d.push(+t.slice(i,i+=7));i=7-(t=t.slice(i)).length}else i-=n;for(;i--;)t+="0";if(e.d.push(+t),s&&(e.e>d||e.e<-d))throw Error(l+r)}else e.s=0,e.e=0,e.d=[0];return e}function P(e,t,r){var i,n,a,o,h,f,p,g,m=e.d;for(o=1,a=m[0];a>=10;a/=10)o++;if((i=t-o)<0)i+=7,n=t,p=m[g=0];else{if((g=Math.ceil((i+1)/7))>=(a=m.length))return e;for(o=1,p=a=m[g];a>=10;a/=10)o++;i%=7,n=i-7+o}if(void 0!==r&&(h=p/(a=u(10,o-n-1))%10|0,f=t<0||void 0!==m[g+1]||p%a,f=r<4?(h||f)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||f||6==r&&(i>0?n>0?p/u(10,o-n):0:m[g-1])%10&1||r==(e.s<0?8:7))),t<1||!m[0])return f?(a=b(e),m.length=1,t=t-a-1,m[0]=u(10,(7-t%7)%7),e.e=c(-t/7)||0):(m.length=1,m[0]=e.e=e.s=0),e;if(0==i?(m.length=g,a=1,g--):(m.length=g+1,a=u(10,7-i),m[g]=n>0?(p/u(10,o-n)%u(10,n)|0)*a:0),f)for(;;)if(0==g){1e7==(m[0]+=a)&&(m[0]=1,++e.e);break}else{if(m[g]+=a,1e7!=m[g])break;m[g--]=0,a=1}for(i=m.length;0===m[--i];)m.pop();if(s&&(e.e>d||e.e<-d))throw Error(l+b(e));return e}function S(e,t){var r,i,n,a,o,l,c,u,h,d,f=e.constructor,p=f.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new f(e),s?P(t,p):t;if(c=e.d,d=t.d,i=t.e,u=e.e,c=c.slice(),o=u-i){for((h=o<0)?(r=c,o=-o,l=d.length):(r=d,i=u,l=c.length),o>(n=Math.max(Math.ceil(p/7),l)+2)&&(o=n,r.length=1),r.reverse(),n=o;n--;)r.push(0);r.reverse()}else{for((h=(n=c.length)<(l=d.length))&&(l=n),n=0;n<l;n++)if(c[n]!=d[n]){h=c[n]<d[n];break}o=0}for(h&&(r=c,c=d,d=r,t.s=-t.s),l=c.length,n=d.length-l;n>0;--n)c[l++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(a=n;a&&0===c[--a];)c[a]=1e7-1;--c[a],c[n]+=1e7}c[n]-=d[n]}for(;0===c[--l];)c.pop();for(;0===c[0];c.shift())--i;return c[0]?(t.d=c,t.e=i,s?P(t,p):t):new f(0)}function E(e,t,r){var i,n=b(e),s=m(e.d),a=s.length;return t?(r&&(i=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+w(i):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(n<0?"e":"e+")+n):n<0?(s="0."+w(-n-1)+s,r&&(i=r-a)>0&&(s+=w(i))):n>=a?(s+=w(n+1-a),r&&(i=r-n-1)>0&&(s=s+"."+w(i))):((i=n+1)<a&&(s=s.slice(0,i)+"."+s.slice(i)),r&&(i=r-a)>0&&(n+1===a&&(s+="."),s+=w(i))),e.s<0?"-"+s:s}function A(e,t){if(e.length>t)return e.length=t,!0}function M(e){if(!e||"object"!=typeof e)throw Error(a+"Object expected");var t,r,i,n=["precision",1,1e9,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<n.length;t+=3)if(void 0!==(i=e[r=n[t]]))if(c(i)===i&&i>=n[t+1]&&i<=n[t+2])this[r]=i;else throw Error(o+r+": "+i);if(void 0!==(i=e[r="LN10"]))if(i==Math.LN10)this[r]=new this(i);else throw Error(o+r+": "+i);return this}if((n=function e(t){var r,i,n;function s(e){if(!(this instanceof s))return new s(e);if(this.constructor=s,e instanceof s){this.s=e.s,this.e=e.e,this.d=(e=e.d)?e.slice():e;return}if("number"==typeof e){if(0*e!=0)throw Error(o+e);if(e>0)this.s=1;else if(e<0)e=-e,this.s=-1;else{this.s=0,this.e=0,this.d=[0];return}if(e===~~e&&e<1e7){this.e=0,this.d=[e];return}return k(this,e.toString())}if("string"!=typeof e)throw Error(o+e);if(45===e.charCodeAt(0)?(e=e.slice(1),this.s=-1):this.s=1,h.test(e))k(this,e);else throw Error(o+e)}if(s.prototype=f,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=e,s.config=s.set=M,void 0===t&&(t={}),t)for(r=0,n=["precision","rounding","toExpNeg","toExpPos","LN10"];r<n.length;)t.hasOwnProperty(i=n[r++])||(t[i]=this[i]);return s.config(t),s}(n)).default=n.Decimal=n,i=new n(1),"function"==typeof define&&define.amd){let t;e.r,void 0!==(t=n)&&e.v(t)}else t.exports?t.exports=n:(r||(r="undefined"!=typeof self&&self&&self.self==self?self:Function("return this")()),r.Decimal=n)}(e.e)},14595,(e,t,r)=>{"use strict";var i=e.r(71645),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=i.useRef,o=i.useEffect,l=i.useMemo,c=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,u){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;var f=s(e,(h=l(function(){function e(e){if(!o){if(o=!0,s=e,e=i(e),void 0!==u&&d.hasValue){var t=d.value;if(u(t,e))return a=t}return a=e}if(t=a,n(s,e))return t;var r=i(e);return void 0!==u&&u(t,r)?(s=e,t):(s=e,a=r)}var s,a,o=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,i,u]))[0],h[1]);return o(function(){d.hasValue=!0,d.value=f},[f]),c(f),f}},13027,(e,t,r)=>{"use strict";t.exports=e.r(14595)},78492,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function s(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,i||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1)),c.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=Array(s);i<s;i++)a[i]=r[i].fn;return a},c.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,s),!0;case 6:return u.fn.call(u.context,t,r,i,s,a),!0}for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},c.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return l(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||l(this,s);else{for(var o=0,c=[],u=a.length;o<u;o++)(a[o].fn!==t||i&&!a[o].once||r&&a[o].context!==r)&&c.push(a[o]);c.length?this._events[s]=1===c.length?c[0]:c:l(this,s)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c},10185,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.uniqBy=function(e,t){let r=new Map;for(let i=0;i<e.length;i++){let n=e[i],s=t(n);r.has(s)||r.set(s,n)}return Array.from(r.values())}},36074,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.identity=function(e){return e}},52603,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isObjectLike=function(e){return"object"==typeof e&&null!==e}},44936,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(69642),n=e.r(52603);r.isArrayLikeObject=function(e){return n.isObjectLike(e)&&i.isArrayLike(e)}},77473,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(18915);r.property=function(e){return function(t){return i.get(t,e)}}},75234,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isPrimitive=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e}},44695,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(90820),n=e.r(75234),s=e.r(23855);function a(e,t,r,c){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,r,i){if(null==t)return!0;if(Array.isArray(t))return o(e,t,r,i);if(t instanceof Map){var s=e,a=t,c=r,u=i;if(0===a.size)return!0;if(!(s instanceof Map))return!1;for(let[e,t]of a.entries())if(!1===c(s.get(e),t,e,s,a,u))return!1;return!0}if(t instanceof Set)return l(e,t,r,i);let h=Object.keys(t);if(null==e)return 0===h.length;if(0===h.length)return!0;if(i?.has(t))return i.get(t)===e;i?.set(t,e);try{for(let s=0;s<h.length;s++){let a=h[s];if(!n.isPrimitive(e)&&!(a in e)||void 0===t[a]&&void 0!==e[a]||null===t[a]&&null!==e[a]||!r(e[a],t[a],a,e,t,i))return!1}return!0}finally{i?.delete(t)}}(e,t,r,c);case"function":if(Object.keys(t).length>0)return a(e,{...t},r,c);return s.eq(e,t);default:if(!i.isObject(e))return s.eq(e,t);if("string"==typeof t)return""===t;return!0}}function o(e,t,r,i){if(0===t.length)return!0;if(!Array.isArray(e))return!1;let n=new Set;for(let s=0;s<t.length;s++){let a=t[s],o=!1;for(let l=0;l<e.length;l++){if(n.has(l))continue;let c=e[l],u=!1;if(r(c,a,s,e,t,i)&&(u=!0),u){n.add(l),o=!0;break}}if(!o)return!1}return!0}function l(e,t,r,i){return 0===t.size||e instanceof Set&&o([...e],[...t],r,i)}r.isMatchWith=function e(t,r,i){return"function"!=typeof i?e(t,r,()=>void 0):a(t,r,function e(t,r,n,s,o,l){let c=i(t,r,n,s,o,l);return void 0!==c?!!c:a(t,r,e,l)},new Map)},r.isSetMatch=l},3450,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(44695);r.isMatch=function(e,t){return i.isMatchWith(e,t,()=>void 0)}},67034,(e,t,r)=>{var i={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],i=t[1];return(r+i)*3/4-i},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],c=new n((a+o)*3/4-o),u=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===o&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===o&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,s=[],a=0,o=i-n;a<o;a+=16383)s.push(function(e,t,i){for(var n,s=[],a=t;a<i;a+=3)n=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[n>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===n?s.push(r[(t=e[i-1])>>2]+r[t<<4&63]+"=="):2===n&&s.push(r[(t=(e[i-2]<<8)+e[i-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}i[45]=62,i[95]=63},72:function(e,t,r){"use strict";var i=r(675),n=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var i=e,n=t;if(("string"!=typeof n||""===n)&&(n="utf8"),!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);var s=0|f(i,n),l=a(s),c=l.write(i,n);return c!==s&&(l=l.slice(0,c)),l}if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(T(e,ArrayBuffer)||e&&T(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(T(e,SharedArrayBuffer)||e&&T(e.buffer,SharedArrayBuffer)))return function(e,t,r){var i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),i}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return o.from(u,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),a(e<0?0:0|d(e))}function h(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(c(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||T(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(n)return i?-1:S(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=t;s<r;++s)n+=C[e[s]];return n}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}(this,t,r);case"latin1":case"binary":return function(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}(this,t,r);case"base64":return n=this,s=t,a=r,0===s&&a===n.length?i.fromByteArray(n):i.fromByteArray(n.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var i=e.slice(t,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function m(e,t,r,i,n){var s;if(0===e.length)return -1;if("string"==typeof r?(i=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(n)return -1;else r=e.length-1;else if(r<0)if(!n)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,i,n);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(n)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,i,n)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,i,n){var s,a=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var u=-1;for(s=r;s<o;s++)if(c(e,s)===c(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*a}else -1!==u&&(s-=s-u),u=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var h=!0,d=0;d<l;d++)if(c(e,s+d)!==c(t,d)){h=!1;break}if(h)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(T(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),T(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,i=t.length,n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:+(i<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,i=o.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(T(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,i,n){if(T(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,n>>>=0,this===e)return 0;for(var s=n-i,a=r-t,l=Math.min(s,a),c=this.slice(i,n),u=e.slice(t,r),h=0;h<l;++h)if(c[h]!==u[h]){s=c[h],a=u[h];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var s,a,o,l,c=e[n],u=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:(192&(s=e[n+1]))==128&&(l=(31&c)<<6|63&s)>127&&(u=l);break;case 3:s=e[n+1],a=e[n+2],(192&s)==128&&(192&a)==128&&(l=(15&c)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[n+1],a=e[n+2],o=e[n+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&c)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),n+=h}var d=i,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function b(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function x(e,t,r,i,n,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw RangeError('"value" argument is out of bounds');if(r+i>e.length)throw RangeError("Index out of range")}function w(e,t,r,i,n,s){if(r+i>e.length||r<0)throw RangeError("Index out of range")}function _(e,t,r,i,s){return t*=1,r>>>=0,s||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),n.write(e,t,r,i,23,4),r+4}function k(e,t,r,i,s){return t*=1,r>>>=0,s||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),n.write(e,t,r,i,52,8),r+8}o.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var n,s,a,o,l,c,u,h,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var f=!1;;)switch(i){case"hex":return function(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=t.length;i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return n=t,s=r,M(S(e,this.length-n),this,n,s);case"ascii":return a=t,o=r,M(E(e),this,a,o);case"latin1":case"binary":return function(e,t,r,i){return M(E(t),e,r,i)}(this,e,t,r);case"base64":return l=t,c=r,M(A(e),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,h=r,M(function(e,t){for(var r,i,n=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n.push(r%256),n.push(i);return n}(e,this.length-u),this,u,h);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,o.prototype),i},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=this[e],n=1,s=0;++s<t&&(n*=256);)i+=this[e+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var i=t,n=1,s=this[e+--i];i>0&&(n*=256);)s+=this[e+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,i){if(e*=1,t>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;x(this,e,t,r,n,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,i){if(e*=1,t>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;x(this,e,t,r,n,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,i){if(e*=1,t>>>=0,!i){var n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,i){if(e*=1,t>>>=0,!i){var n=Math.pow(2,8*r-1);x(this,e,t,r,n-1,-n)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||x(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,i){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n=i-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,i);else if(this===e&&r<t&&t<i)for(var s=n-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,i),t);return n},o.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){var n,s=e.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{var a=o.isBuffer(e)?e:o.from(e,i),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=a[n%l]}return this};var P=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,i=e.length,n=null,s=[],a=0;a<i;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319||a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function E(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function M(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length)&&!(n>=e.length);++n)t[n+r]=e[n];return n}function T(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var C=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var i=16*r,n=0;n<16;++n)t[i+n]=e[r]+e[n];return t}()},783:function(e,t){t.read=function(e,t,r,i,n){var s,a,o=8*n-i-1,l=(1<<o)-1,c=l>>1,u=-7,h=r?n-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+e[t+h],h+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=i;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),s-=c}return(f?-1:1)*a*Math.pow(2,s-i)},t.write=function(e,t,r,i,n,s){var a,o,l,c=8*s-n-1,u=(1<<c)-1,h=u>>1,d=5960464477539062e-23*(23===n),f=i?0:s-1,p=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(t*l-1)*Math.pow(2,n),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;e[r+f]=255&o,f+=p,o/=256,n-=8);for(a=a<<n|o,c+=n;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*g}}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}},a=!0;try{i[e](r,r.exports,s),a=!1}finally{a&&delete n[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},9866,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.getSymbols=function(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}},23678,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.getTag=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}},55813,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.argumentsTag="[object Arguments]",r.arrayBufferTag="[object ArrayBuffer]",r.arrayTag="[object Array]",r.bigInt64ArrayTag="[object BigInt64Array]",r.bigUint64ArrayTag="[object BigUint64Array]",r.booleanTag="[object Boolean]",r.dataViewTag="[object DataView]",r.dateTag="[object Date]",r.errorTag="[object Error]",r.float32ArrayTag="[object Float32Array]",r.float64ArrayTag="[object Float64Array]",r.functionTag="[object Function]",r.int16ArrayTag="[object Int16Array]",r.int32ArrayTag="[object Int32Array]",r.int8ArrayTag="[object Int8Array]",r.mapTag="[object Map]",r.numberTag="[object Number]",r.objectTag="[object Object]",r.regexpTag="[object RegExp]",r.setTag="[object Set]",r.stringTag="[object String]",r.symbolTag="[object Symbol]",r.uint16ArrayTag="[object Uint16Array]",r.uint32ArrayTag="[object Uint32Array]",r.uint8ArrayTag="[object Uint8Array]",r.uint8ClampedArrayTag="[object Uint8ClampedArray]"},55424,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),r.isTypedArray=function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}},92348,(e,t,r)=>{"use strict";var i=e.i(67034);Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let n=e.r(9866),s=e.r(23678),a=e.r(55813),o=e.r(75234),l=e.r(55424);function c(e,t,r,n=new Map,h){let d=h?.(e,t,r,n);if(void 0!==d)return d;if(o.isPrimitive(e))return e;if(n.has(e))return n.get(e);if(Array.isArray(e)){let t=Array(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=c(e[i],i,r,n,h);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[i,s]of(n.set(e,t),e))t.set(i,c(s,i,r,n,h));return t}if(e instanceof Set){let t=new Set;for(let i of(n.set(e,t),e))t.add(c(i,void 0,r,n,h));return t}if(void 0!==i.Buffer&&i.Buffer.isBuffer(e))return e.subarray();if(l.isTypedArray(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=c(e[i],i,r,n,h);return t}if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return n.set(e,t),u(t,e,r,n,h),t}if("undefined"!=typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return n.set(e,t),u(t,e,r,n,h),t}if("undefined"!=typeof Blob&&e instanceof Blob){let t=new Blob([e],{type:e.type});return n.set(e,t),u(t,e,r,n,h),t}if(e instanceof Error){let t=new e.constructor;return n.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,u(t,e,r,n,h),t}if(e instanceof Boolean){let t=new Boolean(e.valueOf());return n.set(e,t),u(t,e,r,n,h),t}if(e instanceof Number){let t=new Number(e.valueOf());return n.set(e,t),u(t,e,r,n,h),t}if(e instanceof String){let t=new String(e.valueOf());return n.set(e,t),u(t,e,r,n,h),t}if("object"==typeof e&&function(e){switch(s.getTag(e)){case a.argumentsTag:case a.arrayTag:case a.arrayBufferTag:case a.dataViewTag:case a.booleanTag:case a.dateTag:case a.float32ArrayTag:case a.float64ArrayTag:case a.int8ArrayTag:case a.int16ArrayTag:case a.int32ArrayTag:case a.mapTag:case a.numberTag:case a.objectTag:case a.regexpTag:case a.setTag:case a.stringTag:case a.symbolTag:case a.uint8ArrayTag:case a.uint8ClampedArrayTag:case a.uint16ArrayTag:case a.uint32ArrayTag:return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return n.set(e,t),u(t,e,r,n,h),t}return e}function u(e,t,r=e,i,s){let a=[...Object.keys(t),...n.getSymbols(t)];for(let n=0;n<a.length;n++){let o=a[n],l=Object.getOwnPropertyDescriptor(e,o);(null==l||l.writable)&&(e[o]=c(t[o],o,r,i,s))}}r.cloneDeepWith=function(e,t){return c(e,void 0,e,new Map,t)},r.cloneDeepWithImpl=c,r.copyProperties=u},99510,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(92348);r.cloneDeep=function(e){return i.cloneDeepWithImpl(e,void 0,e,new Map,void 0)}},67284,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(3450),n=e.r(99510);r.matches=function(e){return e=n.cloneDeep(e),t=>i.isMatch(t,e)}},68110,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(92348),n=e.r(55813);r.cloneDeepWith=function(e,t){return i.cloneDeepWith(e,(r,s,a,o)=>{let l=t?.(r,s,a,o);if(void 0!==l)return l;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case n.numberTag:case n.stringTag:case n.booleanTag:{let t=new e.constructor(e?.valueOf());return i.copyProperties(t,e),t}case n.argumentsTag:{let t={};return i.copyProperties(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}},93141,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(68110);r.cloneDeep=function(e){return i.cloneDeepWith(e)}},17858,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(23678);r.isArguments=function(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===i.getTag(e)}},56518,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(33858),n=e.r(5257),s=e.r(17858),a=e.r(79232);r.has=function(e,t){let r;if(0===(r=Array.isArray(t)?t:"string"==typeof t&&i.isDeepKey(t)&&e?.[t]==null?a.toPath(t):[t]).length)return!1;let o=e;for(let e=0;e<r.length;e++){let t=r[e];if((null==o||!Object.hasOwn(o,t))&&!((Array.isArray(o)||s.isArguments(o))&&n.isIndex(t)&&t<o.length))return!1;o=o[t]}return!0}},40656,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(3450),n=e.r(96736),s=e.r(93141),a=e.r(18915),o=e.r(56518);r.matchesProperty=function(e,t){switch(typeof e){case"object":Object.is(e?.valueOf(),-0)&&(e="-0");break;case"number":e=n.toKey(e)}return t=s.cloneDeep(t),function(r){let n=a.get(r,e);return void 0===n?o.has(r,e):void 0===t?void 0===n:i.isMatch(n,t)}}},27519,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(36074),n=e.r(77473),s=e.r(67284),a=e.r(40656);r.iteratee=function(e){if(null==e)return i.identity;switch(typeof e){case"function":return e;case"object":if(Array.isArray(e)&&2===e.length)return a.matchesProperty(e[0],e[1]);return s.matches(e);case"string":case"symbol":case"number":return n.property(e)}}},77008,(e,t,r)=>{"use strict";Object.defineProperty(r,Symbol.toStringTag,{value:"Module"});let i=e.r(10185),n=e.r(36074),s=e.r(44936),a=e.r(27519);r.uniqBy=function(e,t=n.identity){return s.isArrayLikeObject(e)?i.uniqBy(Array.from(e),a.iteratee(t)):[]}},92809,(e,t,r)=>{t.exports=e.r(77008).uniqBy},54008,(e,t,r)=>{"use strict";function i(e,t,r){r=r||2;var i,d,f,m,v,b,x,w=t&&t.length,_=w?t[0]*r:e.length,k=n(e,0,_,r,!0),P=[];if(!k||k.next===k.prev)return P;if(w&&(k=function(e,t,r,i){var o,u,h,d,f,m=[];for(o=0,u=t.length;o<u;o++)h=t[o]*i,d=o<u-1?t[o+1]*i:e.length,(f=n(e,h,d,i,!1))===f.next&&(f.steiner=!0),m.push(function(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e)return r}(f));for(m.sort(a),o=0;o<m.length;o++)r=function(e,t){var r=function(e,t){var r,i,n,s=t,a=e.x,o=e.y,u=-1/0;do{if(o<=s.y&&o>=s.next.y&&s.next.y!==s.y){var h=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(h<=a&&h>u&&(u=h,n=s.x<s.next.x?s:s.next,h===a))return n}s=s.next}while(s!==t)if(!n)return null;var d,f=n,g=n.x,m=n.y,y=1/0;s=n;do{a>=s.x&&s.x>=g&&a!==s.x&&l(o<m?a:u,o,g,m,o<m?u:a,o,s.x,s.y)&&(d=Math.abs(o-s.y)/(a-s.x),p(s,e)&&(d<y||d===y&&(s.x>n.x||s.x===n.x&&(r=n,i=s,0>c(r.prev,r,i.prev)&&0>c(i.next,r,r.next))))&&(n=s,y=d)),s=s.next}while(s!==f)return n}(e,t);if(!r)return t;var i=g(r,e);return s(i,i.next),s(r,r.next)}(m[o],r);return r}(e,t,k,r)),e.length>80*r){i=f=e[0],d=m=e[1];for(var S=r;S<_;S+=r)v=e[S],b=e[S+1],v<i&&(i=v),b<d&&(d=b),v>f&&(f=v),b>m&&(m=b);x=0!==(x=Math.max(f-i,m-d))?32767/x:0}return function e(t,r,i,n,a,d,f){if(t){!f&&d&&function(e,t,r,i){var n=e;do 0===n.z&&(n.z=o(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e)n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,a,o,l,c=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,i=r,o=0,t=0;t<c&&(o++,i=i.nextZ);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(a>1)}(n)}(t,n,a,d);for(var m,v,b=t;t.prev!==t.next;){if(m=t.prev,v=t.next,d?function(e,t,r,i){var n=e.prev,s=e.next;if(c(n,e,s)>=0)return!1;for(var a=n.x,u=e.x,h=s.x,d=n.y,f=e.y,p=s.y,g=a<u?a<h?a:h:u<h?u:h,m=d<f?d<p?d:p:f<p?f:p,y=a>u?a>h?a:h:u>h?u:h,v=d>f?d>p?d:p:f>p?f:p,b=o(g,m,t,r,i),x=o(y,v,t,r,i),w=e.prevZ,_=e.nextZ;w&&w.z>=b&&_&&_.z<=x;){if(w.x>=g&&w.x<=y&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&l(a,d,u,f,h,p,w.x,w.y)&&c(w.prev,w,w.next)>=0||(w=w.prevZ,_.x>=g&&_.x<=y&&_.y>=m&&_.y<=v&&_!==n&&_!==s&&l(a,d,u,f,h,p,_.x,_.y)&&c(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;w&&w.z>=b;){if(w.x>=g&&w.x<=y&&w.y>=m&&w.y<=v&&w!==n&&w!==s&&l(a,d,u,f,h,p,w.x,w.y)&&c(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;_&&_.z<=x;){if(_.x>=g&&_.x<=y&&_.y>=m&&_.y<=v&&_!==n&&_!==s&&l(a,d,u,f,h,p,_.x,_.y)&&c(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}(t,n,a,d):function(e){var t=e.prev,r=e.next;if(c(t,e,r)>=0)return!1;for(var i=t.x,n=e.x,s=r.x,a=t.y,o=e.y,u=r.y,h=i<n?i<s?i:s:n<s?n:s,d=a<o?a<u?a:u:o<u?o:u,f=i>n?i>s?i:s:n>s?n:s,p=a>o?a>u?a:u:o>u?o:u,g=r.next;g!==t;){if(g.x>=h&&g.x<=f&&g.y>=d&&g.y<=p&&l(i,a,n,o,s,u,g.x,g.y)&&c(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}(t)){r.push(m.i/i|0),r.push(t.i/i|0),r.push(v.i/i|0),y(t),t=v.next,b=v.next;continue}if((t=v)===b){f?1===f?e(t=function(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!u(n,a)&&h(n,i,i.next,a)&&p(n,a)&&p(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),y(i),y(i.next),i=e=a),i=i.next}while(i!==e)return s(i)}(s(t),r,i),r,i,n,a,d,2):2===f&&function(t,r,i,n,a,o){var l=t;do{for(var d,f,m=l.next.next;m!==l.prev;){if(l.i!==m.i&&(d=l,f=m,d.next.i!==f.i&&d.prev.i!==f.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&h(r,r.next,e,t))return!0;r=r.next}while(r!==e)return!1}(d,f)&&(p(d,f)&&p(f,d)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e)return i}(d,f)&&(c(d.prev,d,f.prev)||c(d,f.prev,f))||u(d,f)&&c(d.prev,d,d.next)>0&&c(f.prev,f,f.next)>0))){var y=g(l,m);l=s(l,l.next),y=s(y,y.next),e(l,r,i,n,a,o,0),e(y,r,i,n,a,o,0);return}m=m.next}l=l.next}while(l!==t)}(t,r,i,n,a,d):e(s(t),r,i,n,a,d,1);break}}}}(k,P,r,i,d,x,0),P}function n(e,t,r,i,n){var s,a;if(n===b(e,t,r,i)>0)for(s=t;s<r;s+=i)a=m(s,e[s],e[s+1],a);else for(s=r-i;s>=t;s-=i)a=m(s,e[s],e[s+1],a);return a&&u(a,a.next)&&(y(a),a=a.next),a}function s(e,t){if(!e)return e;t||(t=e);var r,i=e;do if(r=!1,!i.steiner&&(u(i,i.next)||0===c(i.prev,i,i.next))){if(y(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function a(e,t){return e.x-t.x}function o(e,t,r,i,n){return(e=((e=((e=((e=((e=(e-r)*n|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-i)*n|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function l(e,t,r,i,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(r-a)*(t-o)&&(r-a)*(s-o)>=(n-a)*(i-o)}function c(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function u(e,t){return e.x===t.x&&e.y===t.y}function h(e,t,r,i){var n=f(c(e,t,r)),s=f(c(e,t,i)),a=f(c(r,i,e)),o=f(c(r,i,t));return!!(n!==s&&a!==o||0===n&&d(e,r,t)||0===s&&d(e,i,t)||0===a&&d(r,e,i)||0===o&&d(r,t,i))}function d(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function f(e){return e>0?1:e<0?-1:0}function p(e,t){return 0>c(e.prev,e,e.next)?c(e,t,e.next)>=0&&c(e,e.prev,t)>=0:0>c(e,t,e.prev)||0>c(e,e.next,t)}function g(e,t){var r=new v(e.i,e.x,e.y),i=new v(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function m(e,t,r,i){var n=new v(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function y(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function v(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function b(e,t,r,i){for(var n=0,s=t,a=r-i;s<r;s+=i)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}t.exports=i,t.exports.default=i,i.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,a=Math.abs(b(e,0,s,r));if(n)for(var o=0,l=t.length;o<l;o++){var c=t[o]*r,u=o<l-1?t[o+1]*r:e.length;a-=Math.abs(b(e,c,u,r))}var h=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,f=i[o+1]*r,p=i[o+2]*r;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[n][s][a]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}},52683,e=>{"use strict";let t,r,i,n,s,a,o,l,c,u,h,d,f,p,g,m,y,v;var b,x,w,_,k,P,S,E,A,M,T,C,O,I,L,j,N,D,R,z,F,B,U,$,V,W,G,q,H,K,Z,Y,X,J=e.i(43476),Q=e.i(71645);let ee=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},et=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var er={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let ei=(0,Q.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:n="",children:s,iconNode:a,...o},l)=>(0,Q.createElement)("svg",{ref:l,...er,width:t,height:t,stroke:e,strokeWidth:i?24*Number(r)/Number(t):r,className:et("lucide",n),...!s&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,Q.createElement)(e,t)),...Array.isArray(s)?s:[s]])),en=(e,t)=>{let r=(0,Q.forwardRef)(({className:r,...i},n)=>(0,Q.createElement)(ei,{ref:n,iconNode:t,className:et(`lucide-${ee(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...i}));return r.displayName=ee(e),r},es=en("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),ea=en("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),eo=en("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),el=en("workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);var ec=Q;function eu(){for(var e,t,r=0,i="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,i,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(i=e(t[r]))&&(n&&(n+=" "),n+=i)}else for(i in t)t[i]&&(n&&(n+=" "),n+=i);return n}(e))&&(i&&(i+=" "),i+=t);return i}function eh(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ed(e){return function(){return e}}function ef(e){this._context=e}function ep(e){return new ef(e)}Array.prototype.slice,ef.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};let eg=Math.PI,em=2*eg,ey=em-1e-6;function ev(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class eb{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?ev:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return ev;let r=10**t;return function(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,i){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,t,r,i,n,s){this._append`C${+e},${+t},${+r},${+i},${this._x1=+n},${this._y1=+s}`}arcTo(e,t,r,i,n){if(e*=1,t*=1,r*=1,i*=1,(n*=1)<0)throw Error(`negative radius: ${n}`);let s=this._x1,a=this._y1,o=r-e,l=i-t,c=s-e,u=a-t,h=c*c+u*u;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(h>1e-6)if(Math.abs(u*o-l*c)>1e-6&&n){let d=r-s,f=i-a,p=o*o+l*l,g=Math.sqrt(p),m=Math.sqrt(h),y=n*Math.tan((eg-Math.acos((p+h-(d*d+f*f))/(2*g*m)))/2),v=y/m,b=y/g;Math.abs(v-1)>1e-6&&this._append`L${e+v*c},${t+v*u}`,this._append`A${n},${n},0,0,${+(u*d>c*f)},${this._x1=e+b*o},${this._y1=t+b*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,r,i,n,s){if(e*=1,t*=1,r*=1,s=!!s,r<0)throw Error(`negative radius: ${r}`);let a=r*Math.cos(i),o=r*Math.sin(i),l=e+a,c=t+o,u=1^s,h=s?i-n:n-i;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-c)>1e-6)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%em+em),h>ey?this._append`A${r},${r},0,1,${u},${e-a},${t-o}A${r},${r},0,1,${u},${this._x1=l},${this._y1=c}`:h>1e-6&&this._append`A${r},${r},0,${+(h>=eg)},${u},${this._x1=e+r*Math.cos(n)},${this._y1=t+r*Math.sin(n)}`)}rect(e,t,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r*=1}v${+i}h${-r}Z`}toString(){return this._}}function ex(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(null==r)t=null;else{let e=Math.floor(r);if(!(e>=0))throw RangeError(`invalid digits: ${r}`);t=e}return e},()=>new eb(t)}function ew(e){return e[0]}function e_(e){return e[1]}function ek(e,t){var r=ed(!0),i=null,n=ep,s=null,a=ex(o);function o(o){var l,c,u,h=(o=eh(o)).length,d=!1;for(null==i&&(s=n(u=a())),l=0;l<=h;++l)!(l<h&&r(c=o[l],l,o))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+e(c,l,o),+t(c,l,o));if(u)return s=null,u+""||null}return e="function"==typeof e?e:void 0===e?ew:ed(e),t="function"==typeof t?t:void 0===t?e_:ed(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:ed(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:ed(+e),o):t},o.defined=function(e){return arguments.length?(r="function"==typeof e?e:ed(!!e),o):r},o.curve=function(e){return arguments.length?(n=e,null!=i&&(s=n(i)),o):n},o.context=function(e){return arguments.length?(null==e?i=s=null:s=n(i=e),o):i},o}function eP(e,t,r){var i=null,n=ed(!0),s=null,a=ep,o=null,l=ex(c);function c(c){var u,h,d,f,p,g=(c=eh(c)).length,m=!1,y=Array(g),v=Array(g);for(null==s&&(o=a(p=l())),u=0;u<=g;++u){if(!(u<g&&n(f=c[u],u,c))===m)if(m=!m)h=u,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),d=u-1;d>=h;--d)o.point(y[d],v[d]);o.lineEnd(),o.areaEnd()}m&&(y[u]=+e(f,u,c),v[u]=+t(f,u,c),o.point(i?+i(f,u,c):y[u],r?+r(f,u,c):v[u]))}if(p)return o=null,p+""||null}function u(){return ek().defined(n).curve(a).context(s)}return e="function"==typeof e?e:void 0===e?ew:ed(+e),t="function"==typeof t?t:void 0===t?ed(0):ed(+t),r="function"==typeof r?r:void 0===r?e_:ed(+r),c.x=function(t){return arguments.length?(e="function"==typeof t?t:ed(+t),i=null,c):e},c.x0=function(t){return arguments.length?(e="function"==typeof t?t:ed(+t),c):e},c.x1=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:ed(+e),c):i},c.y=function(e){return arguments.length?(t="function"==typeof e?e:ed(+e),r=null,c):t},c.y0=function(e){return arguments.length?(t="function"==typeof e?e:ed(+e),c):t},c.y1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:ed(+e),c):r},c.lineX0=c.lineY0=function(){return u().x(e).y(t)},c.lineY1=function(){return u().x(e).y(r)},c.lineX1=function(){return u().x(i).y(t)},c.defined=function(e){return arguments.length?(n="function"==typeof e?e:ed(!!e),c):n},c.curve=function(e){return arguments.length?(a=e,null!=s&&(o=a(s)),c):a},c.context=function(e){return arguments.length?(null==e?s=o=null:o=a(s=e),c):s},c}function eS(){}function eE(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function eA(e){this._context=e}function eM(e){this._context=e}function eT(e){this._context=e}eb.prototype,eA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:eE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:eE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},eM.prototype={areaStart:eS,areaEnd:eS,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:eE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},eT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,i):this._context.moveTo(r,i);break;case 3:this._point=4;default:eE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class eC{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function eO(e){this._context=e}eO.prototype={areaStart:eS,areaEnd:eS,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e*=1,t*=1,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function eI(e,t,r){var i=e._x1-e._x0,n=t-e._x1,s=(e._y1-e._y0)/(i||n<0&&-0),a=(r-e._y1)/(n||i<0&&-0);return((s<0?-1:1)+(a<0?-1:1))*Math.min(Math.abs(s),Math.abs(a),.5*Math.abs((s*n+a*i)/(i+n)))||0}function eL(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function ej(e,t,r){var i=e._x0,n=e._y0,s=e._x1,a=e._y1,o=(s-i)/3;e._context.bezierCurveTo(i+o,n+o*t,s-o,a-o*r,s,a)}function eN(e){this._context=e}function eD(e){this._context=new eR(e)}function eR(e){this._context=e}function ez(e){this._context=e}function eF(e){var t,r,i=e.length-1,n=Array(i),s=Array(i),a=Array(i);for(n[0]=0,s[0]=2,a[0]=e[0]+2*e[1],t=1;t<i-1;++t)n[t]=1,s[t]=4,a[t]=4*e[t]+2*e[t+1];for(n[i-1]=2,s[i-1]=7,a[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)r=n[t]/s[t-1],s[t]-=r,a[t]-=r*a[t-1];for(n[i-1]=a[i-1]/s[i-1],t=i-2;t>=0;--t)n[t]=(a[t]-n[t+1])/s[t];for(t=0,s[i-1]=(e[i]+n[i-1])/2;t<i-1;++t)s[t]=2*e[t+1]-n[t+1];return[n,s]}function eB(e,t){this._context=e,this._t=t}eN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ej(this,this._t0,eL(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(t*=1,(e*=1)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ej(this,eL(this,r=eI(this,e,t)),r);break;default:ej(this,this._t0,r=eI(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}},(eD.prototype=Object.create(eN.prototype)).point=function(e,t){eN.prototype.point.call(this,t,e)},eR.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,i,n,s){this._context.bezierCurveTo(t,e,i,r,s,n)}},ez.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===r)this._context.lineTo(e[1],t[1]);else for(var i=eF(e),n=eF(t),s=0,a=1;a<r;++s,++a)this._context.bezierCurveTo(i[0][s],n[0][s],i[1][s],n[1][s],e[a],t[a]);(this._line||0!==this._line&&1===r)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},eB.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}}this._x=e,this._y=t}};var eU=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function e$(e){return"string"==typeof e&&eU.includes(e)}var eV=(e,t)=>{if(!e||"function"==typeof e||"boolean"==typeof e)return null;var r=e;if((0,Q.isValidElement)(e)&&(r=e.props),"object"!=typeof r&&"function"!=typeof r)return null;var i={};return Object.keys(r).forEach(e=>{e$(e)&&(i[e]=t||(t=>r[e](r,t)))}),i},eW=e.i(92068),eG=e=>0===e?0:e>0?1:-1,eq=e=>"number"==typeof e&&e!=+e,eH=e=>"string"==typeof e&&e.indexOf("%")===e.length-1,eK=e=>("number"==typeof e||e instanceof Number)&&!eq(e),eZ=e=>eK(e)||"string"==typeof e,eY=0,eX=e=>{var t=++eY;return"".concat(e||"").concat(t)},eJ=function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!eK(e)&&"string"!=typeof e)return i;if(eH(e)){if(null==t)return i;var s=e.indexOf("%");r=t*parseFloat(e.slice(0,s))/100}else r=+e;return eq(r)&&(r=i),n&&null!=t&&r>t&&(r=t),r},eQ=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,r={},i=0;i<t;i++)if(r[e[i]])return!0;else r[e[i]]=!0;return!1};function e0(e,t,r){return eK(e)&&eK(t)?e+r*(t-e):t}function e1(e,t,r){if(e&&e.length)return e.find(e=>e&&("function"==typeof t?t(e):(0,eW.default)(e,t))===r)}var e2=e=>null==e?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function e3(e){return Number.isFinite(e)}function e4(e){return"number"==typeof e&&e>0&&Number.isFinite(e)}var e5=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function e6(e){return"string"==typeof e&&e5.includes(e)}function e8(e){return"string"==typeof e&&e.startsWith("data-")}function e7(e){return Object.fromEntries(Object.entries(e).filter(e=>{var[t]=e;return e6(t)||e8(t)}))}function e9(e){return null==e?null:(0,Q.isValidElement)(e)&&"object"==typeof e.props&&null!==e.props?e7(e.props):"object"!=typeof e||Array.isArray(e)?null:e7(e)}function te(){return(te=Object.assign.bind()).apply(null,arguments)}function tt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function tr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ti={curveBasisClosed:function(e){return new eM(e)},curveBasisOpen:function(e){return new eT(e)},curveBasis:function(e){return new eA(e)},curveBumpX:function(e){return new eC(e,!0)},curveBumpY:function(e){return new eC(e,!1)},curveLinearClosed:function(e){return new eO(e)},curveLinear:ep,curveMonotoneX:function(e){return new eN(e)},curveMonotoneY:function(e){return new eD(e)},curveNatural:function(e){return new ez(e)},curveStep:function(e){return new eB(e,.5)},curveStepAfter:function(e){return new eB(e,1)},curveStepBefore:function(e){return new eB(e,0)}},tn=e=>e3(e.x)&&e3(e.y),ts=e=>e.x,ta=e=>e.y,to=e=>{var{className:t,points:r,path:i,pathRef:n}=e;if((!r||!r.length)&&!i)return null;var s=r&&r.length?(e=>{var t,{type:r="linear",points:i=[],baseLine:n,layout:s,connectNulls:a=!1}=e,o=((e,t)=>{if("function"==typeof e)return e;var r="curve".concat(e2(e));return("curveMonotone"===r||"curveBump"===r)&&t?ti["".concat(r).concat("vertical"===t?"Y":"X")]:ti[r]||ep})(r,s),l=a?i.filter(tn):i;if(Array.isArray(n)){var c=a?n.filter(e=>tn(e)):n,u=l.map((e,t)=>tr(tr({},e),{},{base:c[t]}));return(t="vertical"===s?eP().y(ta).x1(ts).x0(e=>e.base.x):eP().x(ts).y1(ta).y0(e=>e.base.y)).defined(tn).curve(o),t(u)}return(t="vertical"===s&&eK(n)?eP().y(ta).x1(ts).x0(n):eK(n)?eP().x(ts).y1(ta).y0(n):ek().x(ts).y(ta)).defined(tn).curve(o),t(l)})(e):i;return Q.createElement("path",te({},e7(e),eV(e),{className:eu("recharts-curve",t),d:null===s?void 0:s,ref:n}))};function tl(){return(tl=Object.assign.bind()).apply(null,arguments)}var tc=e=>{var{cx:t,cy:r,r:i,className:n}=e,s=eu("recharts-dot",n);return t===+t&&r===+r&&i===+i?Q.createElement("circle",tl({},e7(e),eV(e),{className:s,cx:t,cy:r,r:i})):null};function tu(e){return Object.fromEntries(Object.entries(e).filter(e=>{var[t]=e;return e6(t)||e8(t)||e$(t)}))}function th(e){return null==e?null:(0,Q.isValidElement)(e)?tu(e.props):"object"!=typeof e||Array.isArray(e)?null:tu(e)}var td=["children","className"];function tf(){return(tf=Object.assign.bind()).apply(null,arguments)}var tp=Q.forwardRef((e,t)=>{var{children:r,className:i}=e,n=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,td),s=eu("recharts-layer",i);return Q.createElement("g",tf({className:s},tu(n),{ref:t}),r)}),tg=e.i(4178),tm={devToolsEnabled:!1,isSsr:!("undefined"!=typeof window&&window.document&&window.document.createElement&&window.setTimeout)};function ty(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}var tv=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ty(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ty(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},{cacheSize:2e3,enableCache:!0}),tb=new class{constructor(e){!function(e,t,r){var i;(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"cache",new Map),this.maxSize=e}get(e){var t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}}(tv.cacheSize),tx={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},tw="recharts_measurement_span",t_=(e,t)=>{try{var r=document.getElementById(tw);r||((r=document.createElement("span")).setAttribute("id",tw),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,tx,t),r.textContent="".concat(e);var i=r.getBoundingClientRect();return{width:i.width,height:i.height}}catch(e){return{width:0,height:0}}},tk=function(e){var t,r,i,n,s,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e||tm.isSsr)return{width:0,height:0};if(!tv.enableCache)return t_(e,o);var l=(t=o.fontSize||"",r=o.fontFamily||"",i=o.fontWeight||"",n=o.fontStyle||"",s=o.letterSpacing||"",a=o.textTransform||"","".concat(e,"|").concat(t,"|").concat(r,"|").concat(i,"|").concat(n,"|").concat(s,"|").concat(a)),c=tb.get(l);if(c)return c;var u=t_(e,o);return tb.set(l,u),u},tP=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,tS=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,tE=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,tA=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,tM={cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,in:96,Q:96/101.6,px:1},tT=Object.keys(tM);class tC{static parse(e){var t,[,r,i]=null!=(t=tA.exec(e))?t:[];return new tC(parseFloat(r),null!=i?i:"")}constructor(e,t){this.num=e,this.unit=t,this.num=e,this.unit=t,eq(e)&&(this.unit=""),""===t||tE.test(t)||(this.num=NaN,this.unit=""),tT.includes(t)&&(this.num=e*tM[t],this.unit="px")}add(e){return this.unit!==e.unit?new tC(NaN,""):new tC(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new tC(NaN,""):new tC(this.num-e.num,this.unit)}multiply(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tC(NaN,""):new tC(this.num*e.num,this.unit||e.unit)}divide(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new tC(NaN,""):new tC(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return eq(this.num)}}function tO(e){if(e.includes("NaN"))return"NaN";for(var t=e;t.includes("*")||t.includes("/");){var r,[,i,n,s]=null!=(r=tP.exec(t))?r:[],a=tC.parse(null!=i?i:""),o=tC.parse(null!=s?s:""),l="*"===n?a.multiply(o):a.divide(o);if(l.isNaN())return"NaN";t=t.replace(tP,l.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var c,[,u,h,d]=null!=(c=tS.exec(t))?c:[],f=tC.parse(null!=u?u:""),p=tC.parse(null!=d?d:""),g="+"===h?f.add(p):f.subtract(p);if(g.isNaN())return"NaN";t=t.replace(tS,g.toString())}return t}var tI=/\(([^()]*)\)/;function tL(e){var t=function(e){try{var t;return t=e.replace(/\s+/g,""),t=function(e){for(var t,r=e;null!=(t=tI.exec(r));){var[,i]=t;r=r.replace(tI,tO(i))}return r}(t),t=tO(t)}catch(e){return"NaN"}}(e.slice(5,-1));return"NaN"===t?"":t}var tj=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],tN=["dx","dy","angle","className","breakAll"];function tD(){return(tD=Object.assign.bind()).apply(null,arguments)}function tR(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var tz=/[ \f\n\r\t\v\u2028\u2029]+/,tF=e=>{var{children:t,breakAll:r,style:i}=e;try{var n=[];null!=t&&(n=r?t.toString().split(""):t.toString().split(tz));var s=n.map(e=>({word:e,width:tk(e,i).width})),a=r?0:tk("",i).width;return{wordsWithComputedWidth:s,spaceWidth:a}}catch(e){return null}},tB=e=>[{words:null==e?[]:e.toString().split(tz)}],tU="#808080",t$=(0,Q.forwardRef)((e,t)=>{var r,{x:i=0,y:n=0,lineHeight:s="1em",capHeight:a="0.71em",scaleToFit:o=!1,textAnchor:l="start",verticalAnchor:c="end",fill:u=tU}=e,h=tR(e,tj),d=(0,Q.useMemo)(()=>(e=>{var{width:t,scaleToFit:r,children:i,style:n,breakAll:s,maxLines:a}=e;if((t||r)&&!tm.isSsr){var o=tF({breakAll:s,children:i,style:n});if(!o)return tB(i);var{wordsWithComputedWidth:l,spaceWidth:c}=o;return((e,t,r,i,n)=>{var s,{maxLines:a,children:o,style:l,breakAll:c}=e,u=eK(a),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((e,t)=>{var{word:s,width:a}=t,o=e[e.length-1];return o&&(null==i||n||o.width+a+r<Number(i))?(o.words.push(s),o.width+=a+r):e.push({words:[s],width:a}),e},[])},d=h(t),f=e=>e.reduce((e,t)=>e.width>t.width?e:t);if(!u||n||!(d.length>a||f(d).width>Number(i)))return d;for(var p=e=>{var t=h(tF({breakAll:c,style:l,children:o.slice(0,e)+""}).wordsWithComputedWidth);return[t.length>a||f(t).width>Number(i),t]},g=0,m=o.length-1,y=0;g<=m&&y<=o.length-1;){var v=Math.floor((g+m)/2),[b,x]=p(v-1),[w]=p(v);if(b||w||(g=v+1),b&&w&&(m=v-1),!b&&w){s=x;break}y++}return s||d})({breakAll:s,children:i,maxLines:a,style:n},l,c,t,r)}return tB(i)})({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:o,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,o,h.style,h.width]),{dx:f,dy:p,angle:g,className:m,breakAll:y}=h,v=tR(h,tN);if(!eZ(i)||!eZ(n)||0===d.length)return null;var b=i+(eK(f)?f:0),x=n+(eK(p)?p:0);switch(c){case"start":r=tL("calc(".concat(a,")"));break;case"middle":r=tL("calc(".concat((d.length-1)/2," * -").concat(s," + (").concat(a," / 2))"));break;default:r=tL("calc(".concat(d.length-1," * -").concat(s,")"))}var w=[];if(o){var _=d[0].width,{width:k}=h;w.push("scale(".concat(eK(k)?k/_:1,")"))}return g&&w.push("rotate(".concat(g,", ").concat(b,", ").concat(x,")")),w.length&&(v.transform=w.join(" ")),Q.createElement("text",tD({},tu(v),{ref:t,x:b,y:x,className:eu("recharts-text",m),textAnchor:l,fill:u.includes("url")?tU:u}),d.map((e,t)=>{var i=e.words.join(y?"":" ");return Q.createElement("tspan",{x:b,dy:0===t?r:s,key:"".concat(i,"-").concat(t)},i)}))});function tV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function tW(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tV(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tV(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}t$.displayName="Text";var tG=Math.PI/180,tq=(e,t,r,i)=>({x:e+Math.cos(-tG*i)*r,y:t+Math.sin(-tG*i)*r}),tH=e.i(30224),tK=(0,Q.createContext)(null),tZ=e=>e,tY=()=>{var e=(0,Q.useContext)(tK);return e?e.store.dispatch:tZ},tX=()=>{},tJ=()=>tX,tQ=(e,t)=>e===t;function t0(e){var t=(0,Q.useContext)(tK);return(0,tH.useSyncExternalStoreWithSelector)(t?t.subscription.addNestedSub:tJ,t?t.store.getState:tX,t?t.store.getState:tX,t?e:tX,tQ)}var t1=e.i(47167),t2=Symbol.for("immer-nothing"),t3=Symbol.for("immer-draftable"),t4=Symbol.for("immer-state");function t5(e){throw Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var t6=Object.getPrototypeOf;function t8(e){return!!e&&!!e[t4]}function t7(e){return!!e&&(rt(e)||Array.isArray(e)||!!e[t3]||!!e.constructor?.[t3]||ra(e)||ro(e))}var t9=Object.prototype.constructor.toString(),re=new WeakMap;function rt(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);if(null===t||t===Object.prototype)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(r===Object)return!0;if("function"!=typeof r)return!1;let i=re.get(r);return void 0===i&&(i=Function.toString.call(r),re.set(r,i)),i===t9}function rr(e,t,r=!0){0===ri(e)?(r?Reflect.ownKeys(e):Object.keys(e)).forEach(r=>{t(r,e[r],e)}):e.forEach((r,i)=>t(i,r,e))}function ri(e){let t=e[t4];return t?t.type_:Array.isArray(e)?1:ra(e)?2:3*!!ro(e)}function rn(e,t){return 2===ri(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function rs(e,t,r){let i=ri(e);2===i?e.set(t,r):3===i?e.add(r):e[t]=r}function ra(e){return e instanceof Map}function ro(e){return e instanceof Set}function rl(e){return e.copy_||e.base_}function rc(e,t){if(ra(e))return new Map(e);if(ro(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=rt(e);if(!0!==t&&("class_only"!==t||r)){let t=t6(e);return null!==t&&r?{...e}:Object.assign(Object.create(t),e)}{let t=Object.getOwnPropertyDescriptors(e);delete t[t4];let r=Reflect.ownKeys(t);for(let i=0;i<r.length;i++){let n=r[i],s=t[n];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[n]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[n]})}return Object.create(t6(e),t)}}function ru(e,t=!1){return rd(e)||t8(e)||!t7(e)||(ri(e)>1&&Object.defineProperties(e,{set:rh,add:rh,clear:rh,delete:rh}),Object.freeze(e),t&&Object.values(e).forEach(e=>ru(e,!0))),e}var rh={value:function(){t5(2)}};function rd(e){return null===e||"object"!=typeof e||Object.isFrozen(e)}var rf={};function rp(e){let t=rf[e];return t||t5(0,e),t}function rg(e,t){t&&(rp("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function rm(e){ry(e),e.drafts_.forEach(rb),e.drafts_=null}function ry(e){e===L&&(L=e.parent_)}function rv(e){return L={drafts_:[],parent_:L,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function rb(e){let t=e[t4];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function rx(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return void 0!==e&&e!==r?(r[t4].modified_&&(rm(t),t5(4)),t7(e)&&(e=rw(t,e),t.parent_||rk(t,e)),t.patches_&&rp("Patches").generateReplacementPatches_(r[t4].base_,e,t.patches_,t.inversePatches_)):e=rw(t,r,[]),rm(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==t2?e:void 0}function rw(e,t,r){if(rd(t))return t;let i=e.immer_.shouldUseStrictIteration(),n=t[t4];if(!n)return rr(t,(i,s)=>r_(e,n,t,i,s,r),i),t;if(n.scope_!==e)return t;if(!n.modified_)return rk(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let t=n.copy_,s=t,a=!1;3===n.type_&&(s=new Set(t),t.clear(),a=!0),rr(s,(i,s)=>r_(e,n,t,i,s,r,a),i),rk(e,t,!1),r&&e.patches_&&rp("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function r_(e,t,r,i,n,s,a){if(null==n||"object"!=typeof n&&!a)return;let o=rd(n);if(!o||a){if(t8(n)){let a=rw(e,n,s&&t&&3!==t.type_&&!rn(t.assigned_,i)?s.concat(i):void 0);if(rs(r,i,a),!t8(a))return;e.canAutoFreeze_=!1}else a&&r.add(n);if(t7(n)&&!o){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[i]===n&&o)return;rw(e,n),(!t||!t.scope_.parent_)&&"symbol"!=typeof i&&(ra(r)?r.has(i):Object.prototype.propertyIsEnumerable.call(r,i))&&rk(e,n)}}}function rk(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&ru(t,r)}var rP={get(e,t){if(t===t4)return e;let r=rl(e);if(!rn(r,t)){var i;let n;return i=e,(n=rA(r,t))?"value"in n?n.value:n.get?.call(i.draft_):void 0}let n=r[t];return e.finalized_||!t7(n)?n:n===rE(e.base_,t)?(rT(e),e.copy_[t]=rC(n,e)):n},has:(e,t)=>t in rl(e),ownKeys:e=>Reflect.ownKeys(rl(e)),set(e,t,r){let i=rA(rl(e),t);if(i?.set)return i.set.call(e.draft_,r),!0;if(!e.modified_){let i=rE(rl(e),t),n=i?.[t4];if(n&&n.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||rn(e.base_,t)))return!0;rT(e),rM(e)}return!!(e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t]))||(e.copy_[t]=r,e.assigned_[t]=!0,!0)},deleteProperty:(e,t)=>(void 0!==rE(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,rT(e),rM(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){let r=rl(e),i=Reflect.getOwnPropertyDescriptor(r,t);return i?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:i.enumerable,value:r[t]}:i},defineProperty(){t5(11)},getPrototypeOf:e=>t6(e.base_),setPrototypeOf(){t5(12)}},rS={};function rE(e,t){let r=e[t4];return(r?rl(r):e)[t]}function rA(e,t){if(!(t in e))return;let r=t6(e);for(;r;){let e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=t6(r)}}function rM(e){!e.modified_&&(e.modified_=!0,e.parent_&&rM(e.parent_))}function rT(e){e.copy_||(e.copy_=rc(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function rC(e,t){let r=ra(e)?rp("MapSet").proxyMap_(e,t):ro(e)?rp("MapSet").proxySet_(e,t):function(e,t){let r=Array.isArray(e),i={type_:+!!r,scope_:t?t.scope_:L,modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},n=i,s=rP;r&&(n=[i],s=rS);let{revoke:a,proxy:o}=Proxy.revocable(n,s);return i.draft_=o,i.revoke_=a,o}(e,t);return(t?t.scope_:L).drafts_.push(r),r}function rO(e){return t8(e)||t5(10,e),function e(t){let r;if(!t7(t)||rd(t))return t;let i=t[t4],n=!0;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,r=rc(t,i.scope_.immer_.useStrictShallowCopy_),n=i.scope_.immer_.shouldUseStrictIteration()}else r=rc(t,!0);return rr(r,(t,i)=>{rs(r,t,e(i))},n),i&&(i.finalized_=!1),r}(e)}rr(rP,(e,t)=>{rS[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),rS.deleteProperty=function(e,t){return rS.set.call(this,e,t,void 0)},rS.set=function(e,t,r){return rP.set.call(this,e[0],t,r,e[0])};var rI=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,r)=>{let i;if("function"==typeof e&&"function"!=typeof t){let r=t;t=e;let i=this;return function(e=r,...n){return i.produce(e,e=>t.call(this,e,...n))}}if("function"!=typeof t&&t5(6),void 0!==r&&"function"!=typeof r&&t5(7),t7(e)){let n=rv(this),s=rC(e,void 0),a=!0;try{i=t(s),a=!1}finally{a?rm(n):ry(n)}return rg(n,r),rx(i,n)}if(e&&"object"==typeof e)t5(1,e);else{if(void 0===(i=t(e))&&(i=e),i===t2&&(i=void 0),this.autoFreeze_&&ru(i,!0),r){let t=[],n=[];rp("Patches").generateReplacementPatches_(e,i,t,n),r(t,n)}return i}},this.produceWithPatches=(e,t)=>{let r,i;return"function"==typeof e?(t,...r)=>this.produceWithPatches(t,t=>e(t,...r)):[this.produce(e,t,(e,t)=>{r=e,i=t}),r,i]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),"boolean"==typeof e?.useStrictIteration&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){t7(e)||t5(8),t8(e)&&(e=rO(e));let t=rv(this),r=rC(e,void 0);return r[t4].isManual_=!0,ry(t),r}finishDraft(e,t){let r=e&&e[t4];r&&r.isManual_||t5(9);let{scope_:i}=r;return rg(i,t),rx(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}r>-1&&(t=t.slice(r+1));let i=rp("Patches").applyPatches_;return t8(e)?i(e,t):this.produce(e,e=>i(e,t))}}().produce,rL=e=>Array.isArray(e)?e:[e],rj=0,rN=class{revision=rj;_value;_lastValue;_isEqual=rD;constructor(e,t=rD){this._value=this._lastValue=e,this._isEqual=t}get value(){return this._value}set value(e){this.value!==e&&(this._value=e,this.revision=++rj)}};function rD(e,t){return e===t}function rR(e){return e instanceof rN||console.warn("Not a valid cell! ",e),e.value}var rz=(e,t)=>!1;function rF(){return function(e,t=rD){return new rN(null,t)}(0,rz)}var rB=e=>{let t=e.collectionTag;null===t&&(t=e.collectionTag=rF()),rR(t)};Symbol();var rU=0,r$=Object.getPrototypeOf({}),rV=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy(this,rW);tag=rF();tags={};children={};collectionTag=null;id=rU++},rW={get:(e,t)=>(function(){let{value:r}=e,i=Reflect.get(r,t);if("symbol"==typeof t||t in r$)return i;if("object"==typeof i&&null!==i){var n;let r=e.children[t];return void 0===r&&(r=e.children[t]=Array.isArray(n=i)?new rG(n):new rV(n)),r.tag&&rR(r.tag),r.proxy}{let r=e.tags[t];return void 0===r&&((r=e.tags[t]=rF()).value=i),rR(r),i}})(),ownKeys:e=>(rB(e),Reflect.ownKeys(e.value)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e.value,t),has:(e,t)=>Reflect.has(e.value,t)},rG=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy([this],rq);tag=rF();tags={};children={};collectionTag=null;id=rU++},rq={get:([e],t)=>("length"===t&&rB(e),rW.get(e,t)),ownKeys:([e])=>rW.ownKeys(e),getOwnPropertyDescriptor:([e],t)=>rW.getOwnPropertyDescriptor(e,t),has:([e],t)=>rW.has(e,t)},rH="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function rK(){return{s:0,v:void 0,o:null,p:null}}function rZ(e,t={}){let r,i=rK(),{resultEqualityCheck:n}=t,s=0;function a(){let t,a=i,{length:o}=arguments;for(let e=0;e<o;e++){let t=arguments[e];if("function"==typeof t||"object"==typeof t&&null!==t){let e=a.o;null===e&&(a.o=e=new WeakMap);let r=e.get(t);void 0===r?(a=rK(),e.set(t,a)):a=r}else{let e=a.p;null===e&&(a.p=e=new Map);let r=e.get(t);void 0===r?(a=rK(),e.set(t,a)):a=r}}let l=a;if(1===a.s)t=a.v;else if(t=e.apply(null,arguments),s++,n){let e=r?.deref?.()??r;null!=e&&n(e,t)&&(t=e,0!==s&&s--),r="object"==typeof t&&null!==t||"function"==typeof t?new rH(t):t}return l.s=1,l.v=t,t}return a.clearCache=()=>{i=rK(),a.resetResultsCount()},a.resultsCount=()=>s,a.resetResultsCount=()=>{s=0},a}var rY=function(e,...t){let r="function"==typeof e?{memoize:e,memoizeOptions:t}:e,i=(...e)=>{let t,i,n=0,s=0,a={},o=e.pop();"object"==typeof o&&(a=o,o=e.pop()),function(e,t=`expected a function, instead received ${typeof e}`){if("function"!=typeof e)throw TypeError(t)}(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);let{memoize:l,memoizeOptions:c=[],argsMemoize:u=rZ,argsMemoizeOptions:h=[],devModeChecks:d={}}={...r,...a},f=rL(c),p=rL(h),g=(!function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(e=>"function"==typeof e)){let r=e.map(e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e).join(", ");throw TypeError(`${t}[${r}]`)}}(t=Array.isArray(e[0])?e[0]:e,"createSelector expects all input-selectors to be functions, but received the following types: "),t),m=l(function(){return n++,o.apply(null,arguments)},...f);return Object.assign(u(function(){s++;let e=function(e,t){let r=[],{length:i}=e;for(let n=0;n<i;n++)r.push(e[n].apply(null,t));return r}(g,arguments);return i=m.apply(null,e)},...p),{resultFunc:o,memoizedResultFunc:m,dependencies:g,dependencyRecomputations:()=>s,resetDependencyRecomputations:()=>{s=0},lastResult:()=>i,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:l,argsMemoize:u})};return Object.assign(i,{withTypes:()=>i}),i}(rZ),rX=Object.assign((e,t=rY)=>{!function(e,t=`expected an object, instead received ${typeof e}`){if("object"!=typeof e)throw TypeError(t)}(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);let r=Object.keys(e);return t(r.map(t=>e[t]),(...e)=>e.reduce((e,t,i)=>(e[r[i]]=t,e),{}))},{withTypes:()=>rX});function rJ(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var rQ="function"==typeof Symbol&&Symbol.observable||"@@observable",r0=()=>Math.random().toString(36).substring(7).split("").join("."),r1={INIT:`@@redux/INIT${r0()}`,REPLACE:`@@redux/REPLACE${r0()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${r0()}`};function r2(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function r3(e){let t,r=Object.keys(e),i={};for(let t=0;t<r.length;t++){let n=r[t];"function"==typeof e[n]&&(i[n]=e[n])}let n=Object.keys(i);try{Object.keys(i).forEach(e=>{let t=i[e];if(void 0===t(void 0,{type:r1.INIT}))throw Error(rJ(12));if(void 0===t(void 0,{type:r1.PROBE_UNKNOWN_ACTION()}))throw Error(rJ(13))})}catch(e){t=e}return function(e={},r){if(t)throw t;let s=!1,a={};for(let t=0;t<n.length;t++){let o=n[t],l=i[o],c=e[o],u=l(c,r);if(void 0===u)throw r&&r.type,Error(rJ(14));a[o]=u,s=s||u!==c}return(s=s||n.length!==Object.keys(e).length)?a:e}}function r4(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...r)=>e(t(...r)))}function r5(e){return r2(e)&&"type"in e&&"string"==typeof e.type}function r6(e){return({dispatch:t,getState:r})=>i=>n=>"function"==typeof n?n(t,r,e):i(n)}var r8=r6(),r7="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!=arguments.length)return"object"==typeof arguments[0]?r4:r4.apply(null,arguments)};function r9(e,t){function r(...i){if(t){let r=t(...i);if(!r)throw Error(iG(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:i[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=t=>r5(t)&&t.type===e,r}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var ie=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function it(e){return t7(e)?rI(e,()=>{}):e}function ir(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}var ii="RTK_autoBatch",is=()=>e=>({payload:e,meta:{[ii]:!0}}),ia=e=>t=>{setTimeout(t,e)},io=(e={type:"raf"})=>t=>(...r)=>{let i=t(...r),n=!0,s=!1,a=!1,o=new Set,l="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:ia(10):"callback"===e.type?e.queueNotification:ia(e.timeout),c=()=>{a=!1,s&&(s=!1,o.forEach(e=>e()))};return Object.assign({},i,{subscribe(e){let t=i.subscribe(()=>n&&e());return o.add(e),()=>{t(),o.delete(e)}},dispatch(e){try{return(s=!(n=!e?.meta?.[ii]))&&!a&&(a=!0,l(c)),i.dispatch(e)}finally{n=!0}}})};function il(e){let t,r={},i=[],n={addCase(e,t){let i="string"==typeof e?e:e.type;if(!i)throw Error(iG(28));if(i in r)throw Error(iG(29));return r[i]=t,n},addAsyncThunk:(e,t)=>(t.pending&&(r[e.pending.type]=t.pending),t.rejected&&(r[e.rejected.type]=t.rejected),t.fulfilled&&(r[e.fulfilled.type]=t.fulfilled),t.settled&&i.push({matcher:e.settled,reducer:t.settled}),n),addMatcher:(e,t)=>(i.push({matcher:e,reducer:t}),n),addDefaultCase:e=>(t=e,n)};return e(n),[r,i,t]}var ic=Symbol.for("rtk-slice-createasyncthunk"),iu=((x=iu||{}).reducer="reducer",x.reducerWithPrepare="reducerWithPrepare",x.asyncThunk="asyncThunk",x),ih=function({creators:e}={}){let t=e?.asyncThunk?.[ic];return function(e){let r,{name:i,reducerPath:n=i}=e;if(!i)throw Error(iG(11));let s=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},a=Object.keys(s),o={},l={},c={},u=[],h={addCase(e,t){let r="string"==typeof e?e:e.type;if(!r)throw Error(iG(12));if(r in l)throw Error(iG(13));return l[r]=t,h},addMatcher:(e,t)=>(u.push({matcher:e,reducer:t}),h),exposeAction:(e,t)=>(c[e]=t,h),exposeCaseReducer:(e,t)=>(o[e]=t,h)};function d(){let[t={},r=[],i]="function"==typeof e.extraReducers?il(e.extraReducers):[e.extraReducers],n={...t,...l};return function(e,t){let r,[i,n,s]=il(t);if("function"==typeof e)r=()=>it(e());else{let t=it(e);r=()=>t}function a(e=r(),t){let o=[i[t.type],...n.filter(({matcher:e})=>e(t)).map(({reducer:e})=>e)];return 0===o.filter(e=>!!e).length&&(o=[s]),o.reduce((e,r)=>{if(r)if(t8(e)){let i=r(e,t);return void 0===i?e:i}else{if(t7(e))return rI(e,e=>r(e,t));let i=r(e,t);if(void 0===i){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return i}return e},e)}return a.getInitialState=r,a}(e.initialState,e=>{for(let t in n)e.addCase(t,n[t]);for(let t of u)e.addMatcher(t.matcher,t.reducer);for(let t of r)e.addMatcher(t.matcher,t.reducer);i&&e.addDefaultCase(i)})}a.forEach(r=>{let n=s[r],a={reducerName:r,type:`${i}/${r}`,createNotation:"function"==typeof e.reducers};"asyncThunk"===n._reducerDefinitionType?function({type:e,reducerName:t},r,i,n){if(!n)throw Error(iG(18));let{payloadCreator:s,fulfilled:a,pending:o,rejected:l,settled:c,options:u}=r,h=n(e,s,u);i.exposeAction(t,h),a&&i.addCase(h.fulfilled,a),o&&i.addCase(h.pending,o),l&&i.addCase(h.rejected,l),c&&i.addMatcher(h.settled,c),i.exposeCaseReducer(t,{fulfilled:a||id,pending:o||id,rejected:l||id,settled:c||id})}(a,n,h,t):function({type:e,reducerName:t,createNotation:r},i,n){let s,a;if("reducer"in i){if(r&&"reducerWithPrepare"!==i._reducerDefinitionType)throw Error(iG(17));s=i.reducer,a=i.prepare}else s=i;n.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,a?r9(e,a):r9(e))}(a,n,h)});let f=e=>e,p=new Map,g=new WeakMap;function m(e,t){return r||(r=d()),r(e,t)}function y(){return r||(r=d()),r.getInitialState()}function v(t,r=!1){function i(e){let n=e[t];return void 0===n&&r&&(n=ir(g,i,y)),n}function n(t=f){let i=ir(p,r,()=>new WeakMap);return ir(i,t,()=>{let i={};for(let[n,s]of Object.entries(e.selectors??{}))i[n]=function(e,t,r,i){function n(s,...a){let o=t(s);return void 0===o&&i&&(o=r()),e(o,...a)}return n.unwrapped=e,n}(s,t,()=>ir(g,t,y),r);return i})}return{reducerPath:t,getSelectors:n,get selectors(){return n(i)},selectSlice:i}}let b={name:i,reducer:m,actions:c,caseReducers:o,getInitialState:y,...v(n),injectInto(e,{reducerPath:t,...r}={}){let i=t??n;return e.inject({reducerPath:i,reducer:m},r),{...b,...v(i,!0)}}};return b}}();function id(){}var ip="listener",ig="completed",im="cancelled",iy=`task-${im}`,iv=`task-${ig}`,ib=`${ip}-${im}`,ix=`${ip}-${ig}`,iw=class{constructor(e){this.code=e,this.message=`task ${im} (reason: ${e})`}name="TaskAbortError";message},i_=(e,t)=>{if("function"!=typeof e)throw TypeError(iG(32))},ik=()=>{},iP=(e,t=ik)=>(e.catch(t),e),iS=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),iE=(e,t)=>{let r=e.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},iA=e=>{if(e.aborted){let{reason:t}=e;throw new iw(t)}};function iM(e,t){let r=ik;return new Promise((i,n)=>{let s=()=>n(new iw(e.reason));e.aborted?s():(r=iS(e,s),t.finally(()=>r()).then(i,n))}).finally(()=>{r=ik})}var iT=async(e,t)=>{try{await Promise.resolve();let t=await e();return{status:"ok",value:t}}catch(e){return{status:e instanceof iw?"cancelled":"rejected",error:e}}finally{t?.()}},iC=e=>t=>iP(iM(e,t).then(t=>(iA(e),t))),iO=e=>{let t=iC(e);return e=>t(new Promise(t=>setTimeout(t,e)))},{assign:iI}=Object,iL={},ij="listenerMiddleware",iN=e=>{let{type:t,actionCreator:r,matcher:i,predicate:n,effect:s}=e;if(t)n=r9(t).match;else if(r)t=r.type,n=r.match;else if(i)n=i;else if(n);else throw Error(iG(21));return i_(s,"options.listener"),{predicate:n,type:t,effect:s}},iD=iI(e=>{let{type:t,predicate:r,effect:i}=iN(e);return{id:((e=21)=>{let t="",r=e;for(;r--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t})(),effect:i,type:t,predicate:r,pending:new Set,unsubscribe:()=>{throw Error(iG(22))}}},{withTypes:()=>iD}),iR=(e,t)=>{let{type:r,effect:i,predicate:n}=iN(t);return Array.from(e.values()).find(e=>("string"==typeof r?e.type===r:e.predicate===n)&&e.effect===i)},iz=e=>{e.pending.forEach(e=>{iE(e,ib)})},iF=(e,t,r)=>{try{e(t,r)}catch(e){setTimeout(()=>{throw e},0)}},iB=iI(r9(`${ij}/add`),{withTypes:()=>iB}),iU=r9(`${ij}/removeAll`),i$=iI(r9(`${ij}/remove`),{withTypes:()=>i$}),iV=(...e)=>{console.error(`${ij}/error`,...e)},iW=(e={})=>{let t=new Map,r=new Map,{extra:i,onError:n=iV}=e;i_(n,"onError");let s=e=>{var r;return(r=iR(t,e)??iD(e)).unsubscribe=()=>t.delete(r.id),t.set(r.id,r),e=>{r.unsubscribe(),e?.cancelActive&&iz(r)}};iI(s,{withTypes:()=>s});let a=e=>{let r=iR(t,e);return r&&(r.unsubscribe(),e.cancelActive&&iz(r)),!!r};iI(a,{withTypes:()=>a});let o=async(e,a,o,l)=>{var c,u;let h,d=new AbortController,f=(c=d.signal,h=async(e,t)=>{iA(c);let r=()=>{},i=[new Promise((t,i)=>{let n=s({predicate:e,effect:(e,r)=>{r.unsubscribe(),t([e,r.getState(),r.getOriginalState()])}});r=()=>{n(),i()}})];null!=t&&i.push(new Promise(e=>setTimeout(e,t,null)));try{let e=await iM(c,Promise.race(i));return iA(c),e}finally{r()}},(e,t)=>iP(h(e,t))),p=[];try{let n;e.pending.add(d),n=r.get(e)??0,r.set(e,n+1),await Promise.resolve(e.effect(a,iI({},o,{getOriginalState:l,condition:(e,t)=>f(e,t).then(Boolean),take:f,delay:iO(d.signal),pause:iC(d.signal),extra:i,signal:d.signal,fork:(u=d.signal,(e,t)=>{i_(e,"taskExecutor");let r=new AbortController;iS(u,()=>iE(r,u.reason));let i=iT(async()=>{iA(u),iA(r.signal);let t=await e({pause:iC(r.signal),delay:iO(r.signal),signal:r.signal});return iA(r.signal),t},()=>iE(r,iv));return t?.autoJoin&&p.push(i.catch(ik)),{result:iC(u)(i),cancel(){iE(r,iy)}}}),unsubscribe:e.unsubscribe,subscribe:()=>{t.set(e.id,e)},cancelActiveListeners:()=>{e.pending.forEach((e,t,r)=>{e!==d&&(iE(e,ib),r.delete(e))})},cancel:()=>{iE(d,ib),e.pending.delete(d)},throwIfCancelled:()=>{iA(d.signal)}})))}catch(e){e instanceof iw||iF(n,e,{raisedBy:"effect"})}finally{let t;await Promise.all(p),iE(d,ix),1===(t=r.get(e)??1)?r.delete(e):r.set(e,t-1),e.pending.delete(d)}},l=()=>{for(let e of r.keys())iz(e);t.clear()};return{middleware:e=>r=>i=>{let c;if(!r5(i))return r(i);if(iB.match(i))return s(i.payload);if(iU.match(i))return void l();if(i$.match(i))return a(i.payload);let u=e.getState(),h=()=>{if(u===iL)throw Error(iG(23));return u};try{if(c=r(i),t.size>0){let r=e.getState();for(let s of Array.from(t.values())){let t=!1;try{t=s.predicate(i,r,u)}catch(e){t=!1,iF(n,e,{raisedBy:"predicate"})}t&&o(s,i,e,h)}}}finally{u=iL}return c},startListening:s,stopListening:a,clearListeners:l}};function iG(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Symbol.for("rtk-state-proxy-original");var iq=ih({name:"chartLayout",initialState:{layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var r,i,n,s;e.margin.top=null!=(r=t.payload.top)?r:0,e.margin.right=null!=(i=t.payload.right)?i:0,e.margin.bottom=null!=(n=t.payload.bottom)?n:0,e.margin.left=null!=(s=t.payload.left)?s:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:iH,setLayout:iK,setChartSize:iZ,setScale:iY}=iq.actions,iX=iq.reducer,iJ=e.i(42342),iQ=e=>e.legend.settings;function i0(e,t){if((n=e.length)>1)for(var r,i,n,s=1,a=e[t[0]],o=a.length;s<n;++s)for(i=a,a=e[t[s]],r=0;r<o;++r)a[r][1]+=a[r][0]=isNaN(i[r][1])?i[r][0]:i[r][1]}function i1(e){for(var t=e.length,r=Array(t);--t>=0;)r[t]=t;return r}function i2(e,t){return e[t]}function i3(e){let t=[];return t.key=e,t}function i4(e,t,r){return Array.isArray(e)&&e&&t+r!==0?e.slice(t,r+1):e}function i5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function i6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i5(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i5(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i8(e,t,r){return null==e||null==t?r:eZ(t)?(0,eW.default)(e,t,r):"function"==typeof t?t(e):r}rY([e=>e.legend.payload,iQ],(e,t)=>{var{itemSorter:r}=t,i=e.flat(1);return r?(0,iJ.default)(i,r):i});var i7=(e,t)=>"horizontal"===e&&"xAxis"===t||"vertical"===e&&"yAxis"===t||"centric"===e&&"angleAxis"===t||"radial"===e&&"radiusAxis"===t,i9=(e,t,r,i)=>{if(i)return e.map(e=>e.coordinate);var n,s,a=e.map(e=>(e.coordinate===t&&(n=!0),e.coordinate===r&&(s=!0),e.coordinate));return n||a.push(t),s||a.push(r),a},ne=(e,t,r)=>{if(!e)return null;var{duplicateDomain:i,type:n,range:s,scale:a,realScaleType:o,isCategorical:l,categoricalDomain:c,tickCount:u,ticks:h,niceTicks:d,axisType:f}=e;if(!a)return null;var p="scaleBand"===o&&a.bandwidth?a.bandwidth()/2:2,g=(t||r)&&"category"===n&&a.bandwidth?a.bandwidth()/p:0;return(g="angleAxis"===f&&s&&s.length>=2?2*eG(s[0]-s[1])*g:g,t&&(h||d))?(h||d||[]).map((e,t)=>({coordinate:a(i?i.indexOf(e):e)+g,value:e,offset:g,index:t})).filter(e=>!eq(e.coordinate)):l&&c?c.map((e,t)=>({coordinate:a(e)+g,value:e,index:t,offset:g})):a.ticks&&!r&&null!=u?a.ticks(u).map((e,t)=>({coordinate:a(e)+g,value:e,offset:g,index:t})):a.domain().map((e,t)=>({coordinate:a(e)+g,value:i?i[e]:e,index:t,offset:g}))},nt={sign:e=>{var t=e.length;if(!(t<=0))for(var r=0,i=e[0].length;r<i;++r)for(var n=0,s=0,a=0;a<t;++a){var o=eq(e[a][r][1])?e[a][r][0]:e[a][r][1];o>=0?(e[a][r][0]=n,e[a][r][1]=n+o,n=e[a][r][1]):(e[a][r][0]=s,e[a][r][1]=s+o,s=e[a][r][1])}},expand:function(e,t){if((i=e.length)>0){for(var r,i,n,s=0,a=e[0].length;s<a;++s){for(n=r=0;r<i;++r)n+=e[r][s][1]||0;if(n)for(r=0;r<i;++r)e[r][s][1]/=n}i0(e,t)}},none:i0,silhouette:function(e,t){if((r=e.length)>0){for(var r,i=0,n=e[t[0]],s=n.length;i<s;++i){for(var a=0,o=0;a<r;++a)o+=e[a][i][1]||0;n[i][1]+=n[i][0]=-o/2}i0(e,t)}},wiggle:function(e,t){if((n=e.length)>0&&(i=(r=e[t[0]]).length)>0){for(var r,i,n,s=0,a=1;a<i;++a){for(var o=0,l=0,c=0;o<n;++o){for(var u=e[t[o]],h=u[a][1]||0,d=(h-(u[a-1][1]||0))/2,f=0;f<o;++f){var p=e[t[f]];d+=(p[a][1]||0)-(p[a-1][1]||0)}l+=h,c+=d*h}r[a-1][1]+=r[a-1][0]=s,l&&(s-=c/l)}r[a-1][1]+=r[a-1][0]=s,i0(e,t)}},positive:e=>{var t=e.length;if(!(t<=0))for(var r=0,i=e[0].length;r<i;++r)for(var n=0,s=0;s<t;++s){var a=eq(e[s][r][1])?e[s][r][0]:e[s][r][1];a>=0?(e[s][r][0]=n,e[s][r][1]=n+a,n=e[s][r][1]):(e[s][r][0]=0,e[s][r][1]=0)}}};function nr(e){var{axis:t,ticks:r,bandSize:i,entry:n,index:s,dataKey:a}=e;if("category"===t.type){if(!t.allowDuplicatedCategory&&t.dataKey&&null!=n[t.dataKey]){var o=e1(r,"value",n[t.dataKey]);if(o)return o.coordinate+i/2}return r[s]?r[s].coordinate+i/2:null}var l=i8(n,null==a?t.dataKey:a);return null==l?null:t.scale(l)}var ni=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nn=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,ns=(e,t,r)=>{if(e&&e.scale&&e.scale.bandwidth){var i=e.scale.bandwidth();if(!r||i>0)return i}if(e&&t&&t.length>=2){for(var n=(0,iJ.default)(t,e=>e.coordinate),s=1/0,a=1,o=n.length;a<o;a++){var l=n[a],c=n[a-1];s=Math.min((l.coordinate||0)-(c.coordinate||0),s)}return s===1/0?0:s}return r?void 0:0};function na(e){var{tooltipEntrySettings:t,dataKey:r,payload:i,value:n,name:s}=e;return i6(i6({},t),{},{dataKey:r,payload:i,value:n,name:s})}function no(e,t){return e?String(e):"string"==typeof t?t:void 0}var nl=e=>e.layout.width,nc=e=>e.layout.height,nu=e=>e.layout.scale,nh=e=>e.layout.margin,nd=rY(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),nf=rY(e=>e.cartesianAxis.yAxis,e=>Object.values(e));function np(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function ng(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?np(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):np(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var nm=rY([nl,nc,nh,e=>e.brush.height,function(e){return nf(e).reduce((e,t)=>"left"!==t.orientation||t.mirror||t.hide?e:e+("number"==typeof t.width?t.width:60),0)},function(e){return nf(e).reduce((e,t)=>"right"!==t.orientation||t.mirror||t.hide?e:e+("number"==typeof t.width?t.width:60),0)},function(e){return nd(e).reduce((e,t)=>"top"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},function(e){return nd(e).reduce((e,t)=>"bottom"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},iQ,e=>e.legend.size],(e,t,r,i,n,s,a,o,l,c)=>{var u={left:(r.left||0)+n,right:(r.right||0)+s},h=ng(ng({},{top:(r.top||0)+a,bottom:(r.bottom||0)+o}),u),d=h.bottom;h.bottom+=i;var f=e-(h=((e,t,r)=>{if(t&&r){var{width:i,height:n}=r,{align:s,verticalAlign:a,layout:o}=t;if(("vertical"===o||"horizontal"===o&&"middle"===a)&&"center"!==s&&eK(e[s]))return i6(i6({},e),{},{[s]:e[s]+(i||0)});if(("horizontal"===o||"vertical"===o&&"center"===s)&&"middle"!==a&&eK(e[a]))return i6(i6({},e),{},{[a]:e[a]+(n||0)})}return e})(h,l,c)).left-h.right,p=t-h.top-h.bottom;return ng(ng({brushBottom:d},h),{},{width:Math.max(f,0),height:Math.max(p,0)})}),ny=rY(nm,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),nv=rY(nl,nc,(e,t)=>({x:0,y:0,width:e,height:t})),nb=(0,Q.createContext)(null),nx=()=>null!=(0,Q.useContext)(nb),nw=e=>e.brush,n_=rY([nw,nm,nh],(e,t,r)=>({height:e.height,x:eK(e.x)?e.x:t.left,y:eK(e.y)?e.y:t.top+t.height+t.brushBottom-((null==r?void 0:r.bottom)||0),width:eK(e.width)?e.width:t.width})),nk=e.i(58723),nP=function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n]},nS=(e,t,r)=>{var{width:i="100%",height:n="100%",aspect:s,maxHeight:a}=r,o=eH(i)?e:Number(i),l=eH(n)?t:Number(n);return s&&s>0&&(o?l=o/s:l&&(o=l*s),a&&l>a&&(l=a)),{calculatedWidth:o,calculatedHeight:l}},nE={width:0,height:0,overflow:"visible"},nA={width:0,overflowX:"visible"},nM={height:0,overflowY:"visible"},nT={};function nC(){return(nC=Object.assign.bind()).apply(null,arguments)}function nO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function nI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nO(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nO(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var nL=(0,Q.createContext)({width:-1,height:-1});function nj(e){var{children:t,width:r,height:i}=e,n=(0,Q.useMemo)(()=>({width:r,height:i}),[r,i]);return r<=0||i<=0?null:Q.createElement(nL.Provider,{value:n},t)}var nN=()=>(0,Q.useContext)(nL),nD=(0,Q.forwardRef)((e,t)=>{var{aspect:r,initialDimension:i={width:-1,height:-1},width:n,height:s,minWidth:a=0,minHeight:o,maxHeight:l,children:c,debounce:u=0,id:h,className:d,onResize:f,style:p={}}=e,g=(0,Q.useRef)(null),m=(0,Q.useRef)();m.current=f,(0,Q.useImperativeHandle)(t,()=>g.current);var[y,v]=(0,Q.useState)({containerWidth:i.width,containerHeight:i.height}),b=(0,Q.useCallback)((e,t)=>{v(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]);(0,Q.useEffect)(()=>{var e=e=>{var t,{width:r,height:i}=e[0].contentRect;b(r,i),null==(t=m.current)||t.call(m,r,i)};u>0&&(e=(0,nk.default)(e,u,{trailing:!0,leading:!1}));var t=new ResizeObserver(e),{width:r,height:i}=g.current.getBoundingClientRect();return b(r,i),t.observe(g.current),()=>{t.disconnect()}},[b,u]);var{containerWidth:x,containerHeight:w}=y;nP(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:_,calculatedHeight:k}=nS(x,w,{width:n,height:s,aspect:r,maxHeight:l});return nP(_>0||k>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",_,k,n,s,a,o,r),Q.createElement("div",{id:h?"".concat(h):void 0,className:eu("recharts-responsive-container",d),style:nI(nI({},p),{},{width:n,height:s,minWidth:a,minHeight:o,maxHeight:l}),ref:g},Q.createElement("div",{style:(e=>{var{width:t,height:r}=e,i=eH(t),n=eH(r);return i&&n?nE:i?nA:n?nM:nT})({width:n,height:s})},Q.createElement(nj,{width:_,height:k},c)))}),nR=(0,Q.forwardRef)((e,t)=>{var r=nN();if(e4(r.width)&&e4(r.height))return e.children;var{width:i,height:n}=function(e){var{width:t,height:r,aspect:i}=e,n=t,s=r;return void 0===n&&void 0===s?(n="100%",s="100%"):void 0===n?n=i&&i>0?void 0:"100%":void 0===s&&(s=i&&i>0?void 0:"100%"),{width:n,height:s}}({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:s,calculatedHeight:a}=nS(void 0,void 0,{width:i,height:n,aspect:e.aspect,maxHeight:e.maxHeight});return eK(s)&&eK(a)?Q.createElement(nj,{width:s,height:a},e.children):Q.createElement(nD,nC({},e,{width:i,height:n,ref:t}))}),nz=()=>{var e,t=nx(),r=t0(ny),i=t0(n_),n=null==(e=t0(nw))?void 0:e.padding;return t&&i&&n?{width:i.width-n.left-n.right,height:i.height-n.top-n.bottom,x:n.left,y:n.top}:r},nF={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},nB=()=>{var e;return null!=(e=t0(nm))?e:nF},nU=e=>e.layout.layoutType,n$=e=>{var t=tY(),r=nx(),{width:i,height:n}=e,s=nN(),a=i,o=n;return s&&(a=s.width>0?s.width:i,o=s.height>0?s.height:n),(0,Q.useEffect)(()=>{!r&&e4(a)&&e4(o)&&t(iZ({width:a,height:o}))},[t,r,a,o]),null},nV="auto",nW="auto",nG=(e,t)=>{if(e&&t)return null!=e&&e.reversed?[t[1],t[0]]:t},nq={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nV,tick:!0,tickCount:void 0,ticks:void 0,type:"category",unit:void 0},nH={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nW,tick:!0,tickCount:5,ticks:void 0,type:"number",unit:void 0},nK={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nV,tick:!0,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},nZ={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:0,includeHidden:!1,name:void 0,reversed:!1,scale:nW,tick:!0,tickCount:5,ticks:void 0,type:"category",unit:void 0},nY=(e,t)=>null!=e.polarAxis.angleAxis[t]?e.polarAxis.angleAxis[t]:"radial"===e.layout.layoutType?nK:nq,nX=(e,t)=>null!=e.polarAxis.radiusAxis[t]?e.polarAxis.radiusAxis[t]:"radial"===e.layout.layoutType?nZ:nH,nJ=e=>e.polarOptions,nQ=rY([nl,nc,nm],function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{top:0,right:0,bottom:0,left:0,width:0,height:0,brushBottom:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(t-(r.top||0)-(r.bottom||0)))/2}),n0=rY([nJ,nQ],(e,t)=>{if(null!=e)return eJ(e.innerRadius,t,0)}),n1=rY([nJ,nQ],(e,t)=>{if(null!=e)return eJ(e.outerRadius,t,.8*t)}),n2=rY([nJ],e=>{if(null==e)return[0,0];var{startAngle:t,endAngle:r}=e;return[t,r]});rY([nY,n2],nG);var n3=rY([nQ,n0,n1],(e,t,r)=>{if(null!=e&&null!=t&&null!=r)return[t,r]});rY([nX,n3],nG);var n4=rY([nU,nJ,n0,n1,nl,nc],(e,t,r,i,n,s)=>{if(("centric"===e||"radial"===e)&&null!=t&&null!=r&&null!=i){var{cx:a,cy:o,startAngle:l,endAngle:c}=t;return{cx:eJ(a,n,n/2),cy:eJ(o,s,s/2),innerRadius:r,outerRadius:i,startAngle:l,endAngle:c,clockWise:!1}}});function n5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function n6(e,t){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n5(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n5(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e);return Object.keys(t).reduce((e,r)=>(void 0===e[r]&&void 0!==t[r]&&(e[r]=t[r]),e),r)}var n8=["labelRef"];function n7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function n9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n7(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n7(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function se(){return(se=Object.assign.bind()).apply(null,arguments)}var st=(0,Q.createContext)(null),sr=e=>{var{x:t,y:r,width:i,height:n,children:s}=e,a=(0,Q.useMemo)(()=>({x:t,y:r,width:i,height:n}),[t,r,i,n]);return Q.createElement(st.Provider,{value:a},s)},si=()=>{var e=(0,Q.useContext)(st),t=nz();return e||t},sn=(0,Q.createContext)(null),ss=e=>null!=e&&"function"==typeof e,sa=e=>"cx"in e&&eK(e.cx),so={offset:5};function sl(e){var t,r,i,n=n6(e,so),{viewBox:s,position:a,value:o,children:l,content:c,className:u="",textBreakAll:h,labelRef:d}=n,f=(t=(0,Q.useContext)(sn),r=t0(n4),t||r),p=si(),g=s||("center"===a?p:null!=f?f:p);if(!g||null==o&&null==l&&!(0,Q.isValidElement)(c)&&"function"!=typeof c)return null;var m=n9(n9({},n),{},{viewBox:g});if((0,Q.isValidElement)(c)){var{labelRef:y}=m,v=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(m,n8);return(0,Q.cloneElement)(c,v)}if("function"==typeof c){if(i=(0,Q.createElement)(c,m),(0,Q.isValidElement)(i))return i}else i=(e=>{var{value:t,formatter:r}=e,i=null==e.children?t:e.children;return"function"==typeof r?r(i):i})(n);var b=sa(g),x=tu(n);if(b&&("insideStart"===a||"insideEnd"===a||"end"===a))return((e,t,r,i,n)=>{var s,a,{offset:o,className:l}=e,{cx:c,cy:u,innerRadius:h,outerRadius:d,startAngle:f,endAngle:p,clockWise:g}=n,m=(h+d)/2,y=eG(p-f)*Math.min(Math.abs(p-f),360),v=y>=0?1:-1;switch(t){case"insideStart":s=f+v*o,a=g;break;case"insideEnd":s=p-v*o,a=!g;break;case"end":s=p+v*o,a=g;break;default:throw Error("Unsupported position ".concat(t))}a=y<=0?a:!a;var b=tq(c,u,m,s),x=tq(c,u,m,s+(a?1:-1)*359),w="M".concat(b.x,",").concat(b.y,"\n    A").concat(m,",").concat(m,",0,1,").concat(+!a,",\n    ").concat(x.x,",").concat(x.y),_=null==e.id?eX("recharts-radial-line-"):e.id;return Q.createElement("text",se({},i,{dominantBaseline:"central",className:eu("recharts-radial-bar-label",l)}),Q.createElement("defs",null,Q.createElement("path",{id:_,d:w})),Q.createElement("textPath",{xlinkHref:"#".concat(_)},r))})(n,a,i,x,g);var w=b?((e,t,r)=>{var{cx:i,cy:n,innerRadius:s,outerRadius:a,startAngle:o,endAngle:l}=e,c=(o+l)/2;if("outside"===r){var{x:u,y:h}=tq(i,n,a+t,c);return{x:u,y:h,textAnchor:u>=i?"start":"end",verticalAnchor:"middle"}}if("center"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"middle"};if("centerTop"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"start"};if("centerBottom"===r)return{x:i,y:n,textAnchor:"middle",verticalAnchor:"end"};var{x:d,y:f}=tq(i,n,(s+a)/2,c);return{x:d,y:f,textAnchor:"middle",verticalAnchor:"middle"}})(g,n.offset,n.position):((e,t)=>{var r,{parentViewBox:i,offset:n,position:s}=e;null==i||sa(i)||(r=i);var{x:a,y:o,width:l,height:c}=t,u=c>=0?1:-1,h=u*n,d=u>0?"end":"start",f=u>0?"start":"end",p=l>=0?1:-1,g=p*n,m=p>0?"end":"start",y=p>0?"start":"end";if("top"===s)return n9(n9({},{x:a+l/2,y:o-u*n,textAnchor:"middle",verticalAnchor:d}),r?{height:Math.max(o-r.y,0),width:l}:{});if("bottom"===s)return n9(n9({},{x:a+l/2,y:o+c+h,textAnchor:"middle",verticalAnchor:f}),r?{height:Math.max(r.y+r.height-(o+c),0),width:l}:{});if("left"===s){var v={x:a-g,y:o+c/2,textAnchor:m,verticalAnchor:"middle"};return n9(n9({},v),r?{width:Math.max(v.x-r.x,0),height:c}:{})}if("right"===s){var b={x:a+l+g,y:o+c/2,textAnchor:y,verticalAnchor:"middle"};return n9(n9({},b),r?{width:Math.max(r.x+r.width-b.x,0),height:c}:{})}var x=r?{width:l,height:c}:{};return"insideLeft"===s?n9({x:a+g,y:o+c/2,textAnchor:y,verticalAnchor:"middle"},x):"insideRight"===s?n9({x:a+l-g,y:o+c/2,textAnchor:m,verticalAnchor:"middle"},x):"insideTop"===s?n9({x:a+l/2,y:o+h,textAnchor:"middle",verticalAnchor:f},x):"insideBottom"===s?n9({x:a+l/2,y:o+c-h,textAnchor:"middle",verticalAnchor:d},x):"insideTopLeft"===s?n9({x:a+g,y:o+h,textAnchor:y,verticalAnchor:f},x):"insideTopRight"===s?n9({x:a+l-g,y:o+h,textAnchor:m,verticalAnchor:f},x):"insideBottomLeft"===s?n9({x:a+g,y:o+c-h,textAnchor:y,verticalAnchor:d},x):"insideBottomRight"===s?n9({x:a+l-g,y:o+c-h,textAnchor:m,verticalAnchor:d},x):s&&"object"==typeof s&&(eK(s.x)||eH(s.x))&&(eK(s.y)||eH(s.y))?n9({x:a+eJ(s.x,l),y:o+eJ(s.y,c),textAnchor:"end",verticalAnchor:"end"},x):n9({x:a+l/2,y:o+c/2,textAnchor:"middle",verticalAnchor:"middle"},x)})(n,g);return Q.createElement(t$,se({ref:d,className:eu("recharts-label",u)},x,w,{breakAll:h}),i)}function sc(e){var{label:t,labelRef:r}=e;return((e,t,r)=>{if(!e)return null;var i={viewBox:t,labelRef:r};return!0===e?Q.createElement(sl,se({key:"label-implicit"},i)):eZ(e)?Q.createElement(sl,se({key:"label-implicit",value:e},i)):(0,Q.isValidElement)(e)?e.type===sl?(0,Q.cloneElement)(e,n9({key:"label-implicit"},i)):Q.createElement(sl,se({key:"label-implicit",content:e},i)):ss(e)?Q.createElement(sl,se({key:"label-implicit",content:e},i)):e&&"object"==typeof e?Q.createElement(sl,se({},e,{key:"label-implicit"},i)):null})(t,si(),r)||null}sl.displayName="Label";var su=["valueAccessor"],sh=["dataKey","clockWise","id","textBreakAll"];function sd(){return(sd=Object.assign.bind()).apply(null,arguments)}function sf(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var sp=e=>Array.isArray(e.value)?(0,tg.default)(e.value):e.value,sg=(0,Q.createContext)(void 0),sm=sg.Provider,sy=(0,Q.createContext)(void 0);function sv(e){var{valueAccessor:t=sp}=e,r=sf(e,su),{dataKey:i,clockWise:n,id:s,textBreakAll:a}=r,o=sf(r,sh),l=(0,Q.useContext)(sg),c=(0,Q.useContext)(sy),u=l||c;return u&&u.length?Q.createElement(tp,{className:"recharts-label-list"},u.map((e,n)=>{var l,c=null==i?t(e,n):i8(e&&e.payload,i),u=null==s?{}:{id:"".concat(s,"-").concat(n)};return Q.createElement(sl,sd({key:"label-".concat(n)},tu(e),o,u,{fill:null!=(l=r.fill)?l:e.fill,parentViewBox:e.parentViewBox,value:c,textBreakAll:a,viewBox:e.viewBox,index:n}))})):null}function sb(e){var{label:t}=e;return t?!0===t?Q.createElement(sv,{key:"labelList-implicit"}):Q.isValidElement(t)||ss(t)?Q.createElement(sv,{key:"labelList-implicit",content:t}):"object"==typeof t?Q.createElement(sv,sd({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}sy.Provider,sv.displayName="LabelList",e.i(79684);var sx=e=>!e||"object"!=typeof e||!("clipDot"in e)||!!e.clipDot,sw=e.i(66814);function s_(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function sk(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}e.s([],25212),e.i(25212),e.s([],67155),e.i(67155);class sP extends Map{constructor(e,t=sE){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[t,r]of e)this.set(t,r)}get(e){return super.get(sS(this,e))}has(e){return super.has(sS(this,e))}set(e,t){return super.set(function({_intern:e,_key:t},r){let i=t(r);return e.has(i)?e.get(i):(e.set(i,r),r)}(this,e),t)}delete(e){return super.delete(function({_intern:e,_key:t},r){let i=t(r);return e.has(i)&&(r=e.get(i),e.delete(i)),r}(this,e))}}function sS({_intern:e,_key:t},r){let i=t(r);return e.has(i)?e.get(i):r}function sE(e){return null!==e&&"object"==typeof e?e.valueOf():e}let sA=Symbol("implicit");function sM(){var e=new sP,t=[],r=[],i=sA;function n(n){let s=e.get(n);if(void 0===s){if(i!==sA)return i;e.set(n,s=t.push(n)-1)}return r[s%r.length]}return n.domain=function(r){if(!arguments.length)return t.slice();for(let i of(t=[],e=new sP,r))e.has(i)||e.set(i,t.push(i)-1);return n},n.range=function(e){return arguments.length?(r=Array.from(e),n):r.slice()},n.unknown=function(e){return arguments.length?(i=e,n):i},n.copy=function(){return sM(t,r).unknown(i)},s_.apply(n,arguments),n}function sT(){var e,t,r=sM().unknown(void 0),i=r.domain,n=r.range,s=0,a=1,o=!1,l=0,c=0,u=.5;function h(){var r=i().length,h=a<s,d=h?a:s,f=h?s:a;e=(f-d)/Math.max(1,r-l+2*c),o&&(e=Math.floor(e)),d+=(f-d-e*(r-l))*u,t=e*(1-l),o&&(d=Math.round(d),t=Math.round(t));var p=(function(e,t,r){e*=1,t*=1,r=(n=arguments.length)<2?(t=e,e=0,1):n<3?1:+r;for(var i=-1,n=0|Math.max(0,Math.ceil((t-e)/r)),s=Array(n);++i<n;)s[i]=e+i*r;return s})(r).map(function(t){return d+e*t});return n(h?p.reverse():p)}return delete r.unknown,r.domain=function(e){return arguments.length?(i(e),h()):i()},r.range=function(e){return arguments.length?([s,a]=e,s*=1,a*=1,h()):[s,a]},r.rangeRound=function(e){return[s,a]=e,s*=1,a*=1,o=!0,h()},r.bandwidth=function(){return t},r.step=function(){return e},r.round=function(e){return arguments.length?(o=!!e,h()):o},r.padding=function(e){return arguments.length?(l=Math.min(1,c=+e),h()):l},r.paddingInner=function(e){return arguments.length?(l=Math.min(1,e),h()):l},r.paddingOuter=function(e){return arguments.length?(c=+e,h()):c},r.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),h()):u},r.copy=function(){return sT(i(),[s,a]).round(o).paddingInner(l).paddingOuter(c).align(u)},s_.apply(h(),arguments)}function sC(){return function e(t){var r=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return e(r())},t}(sT.apply(null,arguments).paddingInner(1))}let sO=Math.sqrt(50),sI=Math.sqrt(10),sL=Math.sqrt(2);function sj(e,t,r){let i,n,s,a=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(a)),l=a/Math.pow(10,o),c=l>=sO?10:l>=sI?5:l>=sL?2:1;return(o<0?(i=Math.round(e*(s=Math.pow(10,-o)/c)),n=Math.round(t*s),i/s<e&&++i,n/s>t&&--n,s=-s):(i=Math.round(e/(s=Math.pow(10,o)*c)),n=Math.round(t/s),i*s<e&&++i,n*s>t&&--n),n<i&&.5<=r&&r<2)?sj(e,t,2*r):[i,n,s]}function sN(e,t,r){if(t*=1,e*=1,!((r*=1)>0))return[];if(e===t)return[e];let i=t<e,[n,s,a]=i?sj(t,e,r):sj(e,t,r);if(!(s>=n))return[];let o=s-n+1,l=Array(o);if(i)if(a<0)for(let e=0;e<o;++e)l[e]=-((s-e)/a);else for(let e=0;e<o;++e)l[e]=(s-e)*a;else if(a<0)for(let e=0;e<o;++e)l[e]=-((n+e)/a);else for(let e=0;e<o;++e)l[e]=(n+e)*a;return l}function sD(e,t,r){return sj(e*=1,t*=1,r*=1)[2]}function sR(e,t,r){t*=1,e*=1,r*=1;let i=t<e,n=i?sD(t,e,r):sD(e,t,r);return(i?-1:1)*(n<0?-(1/n):n)}function sz(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function sF(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function sB(e){let t,r,i;function n(e,i,s=0,a=e.length){if(s<a){if(0!==t(i,i))return a;do{let t=s+a>>>1;0>r(e[t],i)?s=t+1:a=t}while(s<a)}return s}return 2!==e.length?(t=sz,r=(t,r)=>sz(e(t),r),i=(t,r)=>e(t)-r):(t=e===sz||e===sF?e:sU,r=e,i=e),{left:n,center:function(e,t,r=0,s=e.length){let a=n(e,t,r,s-1);return a>r&&i(e[a-1],t)>-i(e[a],t)?a-1:a},right:function(e,i,n=0,s=e.length){if(n<s){if(0!==t(i,i))return s;do{let t=n+s>>>1;0>=r(e[t],i)?n=t+1:s=t}while(n<s)}return n}}}function sU(){return 0}function s$(e){return null===e?NaN:+e}let sV=sB(sz),sW=sV.right;function sG(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function sq(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function sH(){}sV.left,sB(s$).center;var sK="\\s*([+-]?\\d+)\\s*",sZ="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sY="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sX=/^#([0-9a-f]{3,8})$/,sJ=RegExp(`^rgb\\(${sK},${sK},${sK}\\)$`),sQ=RegExp(`^rgb\\(${sY},${sY},${sY}\\)$`),s0=RegExp(`^rgba\\(${sK},${sK},${sK},${sZ}\\)$`),s1=RegExp(`^rgba\\(${sY},${sY},${sY},${sZ}\\)$`),s2=RegExp(`^hsl\\(${sZ},${sY},${sY}\\)$`),s3=RegExp(`^hsla\\(${sZ},${sY},${sY},${sZ}\\)$`),s4={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function s5(){return this.rgb().formatHex()}function s6(){return this.rgb().formatRgb()}function s8(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=sX.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?s7(t):3===r?new at(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?s9(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?s9(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=sJ.exec(e))?new at(t[1],t[2],t[3],1):(t=sQ.exec(e))?new at(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=s0.exec(e))?s9(t[1],t[2],t[3],t[4]):(t=s1.exec(e))?s9(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=s2.exec(e))?ao(t[1],t[2]/100,t[3]/100,1):(t=s3.exec(e))?ao(t[1],t[2]/100,t[3]/100,t[4]):s4.hasOwnProperty(e)?s7(s4[e]):"transparent"===e?new at(NaN,NaN,NaN,0):null}function s7(e){return new at(e>>16&255,e>>8&255,255&e,1)}function s9(e,t,r,i){return i<=0&&(e=t=r=NaN),new at(e,t,r,i)}function ae(e,t,r,i){var n;return 1==arguments.length?((n=e)instanceof sH||(n=s8(n)),n)?new at((n=n.rgb()).r,n.g,n.b,n.opacity):new at:new at(e,t,r,null==i?1:i)}function at(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}function ar(){return`#${aa(this.r)}${aa(this.g)}${aa(this.b)}`}function ai(){let e=an(this.opacity);return`${1===e?"rgb(":"rgba("}${as(this.r)}, ${as(this.g)}, ${as(this.b)}${1===e?")":`, ${e})`}`}function an(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function as(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function aa(e){return((e=as(e))<16?"0":"")+e.toString(16)}function ao(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ac(e,t,r,i)}function al(e){if(e instanceof ac)return new ac(e.h,e.s,e.l,e.opacity);if(e instanceof sH||(e=s8(e)),!e)return new ac;if(e instanceof ac)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,n=Math.min(t,r,i),s=Math.max(t,r,i),a=NaN,o=s-n,l=(s+n)/2;return o?(a=t===s?(r-i)/o+(r<i)*6:r===s?(i-t)/o+2:(t-r)/o+4,o/=l<.5?s+n:2-s-n,a*=60):o=l>0&&l<1?0:a,new ac(a,o,l,e.opacity)}function ac(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}function au(e){return(e=(e||0)%360)<0?e+360:e}function ah(e){return Math.max(0,Math.min(1,e||0))}function ad(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function af(e,t,r,i,n){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*r+(1+3*e+3*s-3*a)*i+a*n)/6}sG(sH,s8,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:s5,formatHex:s5,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return al(this).formatHsl()},formatRgb:s6,toString:s6}),sG(at,ae,sq(sH,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new at(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new at(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new at(as(this.r),as(this.g),as(this.b),an(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ar,formatHex:ar,formatHex8:function(){return`#${aa(this.r)}${aa(this.g)}${aa(this.b)}${aa((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:ai,toString:ai})),sG(ac,function(e,t,r,i){return 1==arguments.length?al(e):new ac(e,t,r,null==i?1:i)},sq(sH,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new ac(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new ac(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,n=2*r-i;return new at(ad(e>=240?e-240:e+120,n,i),ad(e,n,i),ad(e<120?e+240:e-120,n,i),this.opacity)},clamp(){return new ac(au(this.h),ah(this.s),ah(this.l),an(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=an(this.opacity);return`${1===e?"hsl(":"hsla("}${au(this.h)}, ${100*ah(this.s)}%, ${100*ah(this.l)}%${1===e?")":`, ${e})`}`}}));let ap=e=>()=>e;function ag(e,t){var r=t-e;return r?function(t){return e+t*r}:ap(isNaN(e)?t:e)}let am=function e(t){var r,i=1==(r=+t)?ag:function(e,t){var i,n,s;return t-e?(i=e,n=t,i=Math.pow(i,s=r),n=Math.pow(n,s)-i,s=1/s,function(e){return Math.pow(i+e*n,s)}):ap(isNaN(e)?t:e)};function n(e,t){var r=i((e=ae(e)).r,(t=ae(t)).r),n=i(e.g,t.g),s=i(e.b,t.b),a=ag(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=n(t),e.b=s(t),e.opacity=a(t),e+""}}return n.gamma=e,n}(1);function ay(e){return function(t){var r,i,n=t.length,s=Array(n),a=Array(n),o=Array(n);for(r=0;r<n;++r)i=ae(t[r]),s[r]=i.r||0,a[r]=i.g||0,o[r]=i.b||0;return s=e(s),a=e(a),o=e(o),i.opacity=1,function(e){return i.r=s(e),i.g=a(e),i.b=o(e),i+""}}}function av(e,t){return e*=1,t*=1,function(r){return e*(1-r)+t*r}}ay(function(e){var t=e.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),n=e[i],s=e[i+1],a=i>0?e[i-1]:2*n-s,o=i<t-1?e[i+2]:2*s-n;return af((r-i/t)*t,a,n,s,o)}}),ay(function(e){var t=e.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*t),n=e[(i+t-1)%t],s=e[i%t],a=e[(i+1)%t],o=e[(i+2)%t];return af((r-i/t)*t,n,s,a,o)}});var ab=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ax=RegExp(ab.source,"g");function aw(e,t){var r,i,n=typeof t;return null==t||"boolean"===n?ap(t):("number"===n?av:"string"===n?(i=s8(t))?(t=i,am):function(e,t){var r,i,n,s,a,o=ab.lastIndex=ax.lastIndex=0,l=-1,c=[],u=[];for(e+="",t+="";(n=ab.exec(e))&&(s=ax.exec(t));)(a=s.index)>o&&(a=t.slice(o,a),c[l]?c[l]+=a:c[++l]=a),(n=n[0])===(s=s[0])?c[l]?c[l]+=s:c[++l]=s:(c[++l]=null,u.push({i:l,x:av(n,s)})),o=ax.lastIndex;return o<t.length&&(a=t.slice(o),c[l]?c[l]+=a:c[++l]=a),c.length<2?u[0]?(r=u[0].x,function(e){return r(e)+""}):(i=t,function(){return i}):(t=u.length,function(e){for(var r,i=0;i<t;++i)c[(r=u[i]).i]=r.x(e);return c.join("")})}:t instanceof s8?am:t instanceof Date?function(e,t){var r=new Date;return e*=1,t*=1,function(i){return r.setTime(e*(1-i)+t*i),r}}:!ArrayBuffer.isView(r=t)||r instanceof DataView?Array.isArray(t)?function(e,t){var r,i=t?t.length:0,n=e?Math.min(i,e.length):0,s=Array(n),a=Array(i);for(r=0;r<n;++r)s[r]=aw(e[r],t[r]);for(;r<i;++r)a[r]=t[r];return function(e){for(r=0;r<n;++r)a[r]=s[r](e);return a}}:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?function(e,t){var r,i={},n={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?i[r]=aw(e[r],t[r]):n[r]=t[r];return function(e){for(r in i)n[r]=i[r](e);return n}}:av:function(e,t){t||(t=[]);var r,i=e?Math.min(t.length,e.length):0,n=t.slice();return function(s){for(r=0;r<i;++r)n[r]=e[r]*(1-s)+t[r]*s;return n}})(e,t)}function a_(e,t){return e*=1,t*=1,function(r){return Math.round(e*(1-r)+t*r)}}function ak(e){return+e}var aP=[0,1];function aS(e){return e}function aE(e,t){var r;return(t-=e*=1)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r})}function aA(e,t,r){var i=e[0],n=e[1],s=t[0],a=t[1];return n<i?(i=aE(n,i),s=r(a,s)):(i=aE(i,n),s=r(s,a)),function(e){return s(i(e))}}function aM(e,t,r){var i=Math.min(e.length,t.length)-1,n=Array(i),s=Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)n[a]=aE(e[a],e[a+1]),s[a]=r(t[a],t[a+1]);return function(t){var r=sW(e,t,1,i)-1;return s[r](n[r](t))}}function aT(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function aC(){var e,t,r,i,n,s,a=aP,o=aP,l=aw,c=aS;function u(){var e,t,r,l=Math.min(a.length,o.length);return c!==aS&&(e=a[0],t=a[l-1],e>t&&(r=e,e=t,t=r),c=function(r){return Math.max(e,Math.min(t,r))}),i=l>2?aM:aA,n=s=null,h}function h(t){return null==t||isNaN(t*=1)?r:(n||(n=i(a.map(e),o,l)))(e(c(t)))}return h.invert=function(r){return c(t((s||(s=i(o,a.map(e),av)))(r)))},h.domain=function(e){return arguments.length?(a=Array.from(e,ak),u()):a.slice()},h.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},h.rangeRound=function(e){return o=Array.from(e),l=a_,u()},h.clamp=function(e){return arguments.length?(c=!!e||aS,u()):c!==aS},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(r=e,h):r},function(r,i){return e=r,t=i,u()}}function aO(){return aC()(aS,aS)}function aI(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function aL(e){return(e=aI(Math.abs(e)))?e[1]:NaN}var aj=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function aN(e){var t;if(!(t=aj.exec(e)))throw Error("invalid format: "+e);return new aD({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function aD(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function aR(e,t){var r=aI(e,t);if(!r)return e+"";var i=r[0],n=r[1];return n<0?"0."+Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+Array(n-i.length+2).join("0")}aN.prototype=aD.prototype,aD.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};let az={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>aR(100*e,t),r:aR,s:function(e,t){var r=aI(e,t);if(!r)return e+"";var i=r[0],n=r[1],s=n-(j=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,a=i.length;return s===a?i:s>a?i+Array(s-a+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+Array(1-s).join("0")+aI(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function aF(e){return e}var aB=Array.prototype.map,aU=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function a$(e,t,r,i){var n,s,a=sR(e,t,r);switch((i=aN(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(s=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(aL(o)/3)))-aL(Math.abs(a))))||(i.precision=s),R(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(s=Math.max(0,aL(Math.abs(Math.max(Math.abs(e),Math.abs(t)))-(n=Math.abs(n=a)))-aL(n))+1)||(i.precision=s-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(s=Math.max(0,-aL(Math.abs(a))))||(i.precision=s-("%"===i.type)*2)}return D(i)}function aV(e){var t=e.domain;return e.ticks=function(e){var r=t();return sN(r[0],r[r.length-1],null==e?10:e)},e.tickFormat=function(e,r){var i=t();return a$(i[0],i[i.length-1],null==e?10:e,r)},e.nice=function(r){null==r&&(r=10);var i,n,s=t(),a=0,o=s.length-1,l=s[a],c=s[o],u=10;for(c<l&&(n=l,l=c,c=n,n=a,a=o,o=n);u-- >0;){if((n=sD(l,c,r))===i)return s[a]=l,s[o]=c,t(s);if(n>0)l=Math.floor(l/n)*n,c=Math.ceil(c/n)*n;else if(n<0)l=Math.ceil(l*n)/n,c=Math.floor(c*n)/n;else break;i=n}return e},e}function aW(){var e=aO();return e.copy=function(){return aT(e,aW())},s_.apply(e,arguments),aV(e)}function aG(e){var t;function r(e){return null==e||isNaN(e*=1)?t:e}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,ak),r):e.slice()},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return aG(e).unknown(t)},e=arguments.length?Array.from(e,ak):[0,1],aV(r)}function aq(e,t){e=e.slice();var r,i=0,n=e.length-1,s=e[i],a=e[n];return a<s&&(r=i,i=n,n=r,r=s,s=a,a=r),e[i]=t.floor(s),e[n]=t.ceil(a),e}function aH(e){return Math.log(e)}function aK(e){return Math.exp(e)}function aZ(e){return-Math.log(-e)}function aY(e){return-Math.exp(-e)}function aX(e){return isFinite(e)?+("1e"+e):e<0?0:e}function aJ(e){return(t,r)=>-e(-t,r)}function aQ(e){let t,r,i=e(aH,aK),n=i.domain,s=10;function a(){var a,o;return t=(a=s)===Math.E?Math.log:10===a&&Math.log10||2===a&&Math.log2||(a=Math.log(a),e=>Math.log(e)/a),r=10===(o=s)?aX:o===Math.E?Math.exp:e=>Math.pow(o,e),n()[0]<0?(t=aJ(t),r=aJ(r),e(aZ,aY)):e(aH,aK),i}return i.base=function(e){return arguments.length?(s=+e,a()):s},i.domain=function(e){return arguments.length?(n(e),a()):n()},i.ticks=e=>{let i,a,o=n(),l=o[0],c=o[o.length-1],u=c<l;u&&([l,c]=[c,l]);let h=t(l),d=t(c),f=null==e?10:+e,p=[];if(!(s%1)&&d-h<f){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(i=1;i<s;++i)if(!((a=h<0?i/r(-h):i*r(h))<l)){if(a>c)break;p.push(a)}}else for(;h<=d;++h)for(i=s-1;i>=1;--i)if(!((a=h>0?i/r(-h):i*r(h))<l)){if(a>c)break;p.push(a)}2*p.length<f&&(p=sN(l,c,f))}else p=sN(h,d,Math.min(d-h,f)).map(r);return u?p.reverse():p},i.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===s?"s":","),"function"!=typeof n&&(s%1||null!=(n=aN(n)).precision||(n.trim=!0),n=D(n)),e===1/0)return n;let a=Math.max(1,s*e/i.ticks().length);return e=>{let i=e/r(Math.round(t(e)));return i*s<s-.5&&(i*=s),i<=a?n(e):""}},i.nice=()=>n(aq(n(),{floor:e=>r(Math.floor(t(e))),ceil:e=>r(Math.ceil(t(e)))})),i}function a0(){let e=aQ(aC()).domain([1,10]);return e.copy=()=>aT(e,a0()).base(e.base()),s_.apply(e,arguments),e}function a1(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function a2(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function a3(e){var t=1,r=e(a1(1),a2(t));return r.constant=function(r){return arguments.length?e(a1(t=+r),a2(t)):t},aV(r)}function a4(){var e=a3(aC());return e.copy=function(){return aT(e,a4()).constant(e.constant())},s_.apply(e,arguments)}function a5(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function a6(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function a8(e){return e<0?-e*e:e*e}function a7(e){var t=e(aS,aS),r=1;return t.exponent=function(t){return arguments.length?1==(r=+t)?e(aS,aS):.5===r?e(a6,a8):e(a5(r),a5(1/r)):r},aV(t)}function a9(){var e=a7(aC());return e.copy=function(){return aT(e,a9()).exponent(e.exponent())},s_.apply(e,arguments),e}function oe(){return a9.apply(null,arguments).exponent(.5)}function ot(e){return Math.sign(e)*e*e}function or(){var e,t=aO(),r=[0,1],i=!1;function n(r){var n,s=Math.sign(n=t(r))*Math.sqrt(Math.abs(n));return isNaN(s)?e:i?Math.round(s):s}return n.invert=function(e){return t.invert(ot(e))},n.domain=function(e){return arguments.length?(t.domain(e),n):t.domain()},n.range=function(e){return arguments.length?(t.range((r=Array.from(e,ak)).map(ot)),n):r.slice()},n.rangeRound=function(e){return n.range(e).round(!0)},n.round=function(e){return arguments.length?(i=!!e,n):i},n.clamp=function(e){return arguments.length?(t.clamp(e),n):t.clamp()},n.unknown=function(t){return arguments.length?(e=t,n):e},n.copy=function(){return or(t.domain(),r).round(i).clamp(t.clamp()).unknown(e)},s_.apply(n,arguments),aV(n)}function oi(e,t){let r;if(void 0===t)for(let t of e)null!=t&&(r<t||void 0===r&&t>=t)&&(r=t);else{let i=-1;for(let n of e)null!=(n=t(n,++i,e))&&(r<n||void 0===r&&n>=n)&&(r=n)}return r}function on(e,t){let r;if(void 0===t)for(let t of e)null!=t&&(r>t||void 0===r&&t>=t)&&(r=t);else{let i=-1;for(let n of e)null!=(n=t(n,++i,e))&&(r>n||void 0===r&&n>=n)&&(r=n)}return r}function os(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:+(e>t))}function oa(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}function oo(){var e,t=[],r=[],i=[];function n(){var e=0,n=Math.max(1,r.length);for(i=Array(n-1);++e<n;)i[e-1]=function(e,t,r=s$){if(!(!(i=e.length)||isNaN(t*=1))){if(t<=0||i<2)return+r(e[0],0,e);if(t>=1)return+r(e[i-1],i-1,e);var i,n=(i-1)*t,s=Math.floor(n),a=+r(e[s],s,e);return a+(r(e[s+1],s+1,e)-a)*(n-s)}}(t,e/n);return s}function s(t){return null==t||isNaN(t*=1)?e:r[sW(i,t)]}return s.invertExtent=function(e){var n=r.indexOf(e);return n<0?[NaN,NaN]:[n>0?i[n-1]:t[0],n<i.length?i[n]:t[t.length-1]]},s.domain=function(e){if(!arguments.length)return t.slice();for(let r of(t=[],e))null==r||isNaN(r*=1)||t.push(r);return t.sort(sz),n()},s.range=function(e){return arguments.length?(r=Array.from(e),n()):r.slice()},s.unknown=function(t){return arguments.length?(e=t,s):e},s.quantiles=function(){return i.slice()},s.copy=function(){return oo().domain(t).range(r).unknown(e)},s_.apply(s,arguments)}function ol(){var e,t=0,r=1,i=1,n=[.5],s=[0,1];function a(t){return null!=t&&t<=t?s[sW(n,t,0,i)]:e}function o(){var e=-1;for(n=Array(i);++e<i;)n[e]=((e+1)*r-(e-i)*t)/(i+1);return a}return a.domain=function(e){return arguments.length?([t,r]=e,t*=1,r*=1,o()):[t,r]},a.range=function(e){return arguments.length?(i=(s=Array.from(e)).length-1,o()):s.slice()},a.invertExtent=function(e){var a=s.indexOf(e);return a<0?[NaN,NaN]:a<1?[t,n[0]]:a>=i?[n[i-1],r]:[n[a-1],n[a]]},a.unknown=function(t){return arguments.length&&(e=t),a},a.thresholds=function(){return n.slice()},a.copy=function(){return ol().domain([t,r]).range(s).unknown(e)},s_.apply(aV(a),arguments)}function oc(){var e,t=[.5],r=[0,1],i=1;function n(n){return null!=n&&n<=n?r[sW(t,n,0,i)]:e}return n.domain=function(e){return arguments.length?(i=Math.min((t=Array.from(e)).length,r.length-1),n):t.slice()},n.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(t.length,r.length-1),n):r.slice()},n.invertExtent=function(e){var i=r.indexOf(e);return[t[i-1],t[i]]},n.unknown=function(t){return arguments.length?(e=t,n):e},n.copy=function(){return oc().domain(t).range(r).unknown(e)},s_.apply(n,arguments)}D=(N=function(e){var t,r,i,n=void 0===e.grouping||void 0===e.thousands?aF:(t=aB.call(e.grouping,Number),r=e.thousands+"",function(e,i){for(var n=e.length,s=[],a=0,o=t[0],l=0;n>0&&o>0&&(l+o+1>i&&(o=Math.max(1,i-l)),s.push(e.substring(n-=o,n+o)),!((l+=o+1)>i));)o=t[a=(a+1)%t.length];return s.reverse().join(r)}),s=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",l=void 0===e.numerals?aF:(i=aB.call(e.numerals,String),function(e){return e.replace(/[0-9]/g,function(e){return i[+e]})}),c=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"":e.minus+"",h=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=aN(e)).fill,r=e.align,i=e.sign,d=e.symbol,f=e.zero,p=e.width,g=e.comma,m=e.precision,y=e.trim,v=e.type;"n"===v?(g=!0,v="g"):az[v]||(void 0===m&&(m=12),y=!0,v="g"),(f||"0"===t&&"="===r)&&(f=!0,t="0",r="=");var b="$"===d?s:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?a:/[%p]/.test(v)?c:"",w=az[v],_=/[defgprs%]/.test(v);function k(e){var s,a,c,d=b,k=x;if("c"===v)k=w(e)+k,e="";else{var P=(e*=1)<0||1/e<0;if(e=isNaN(e)?h:w(Math.abs(e),m),y&&(e=function(e){e:for(var t,r=e.length,i=1,n=-1;i<r;++i)switch(e[i]){case".":n=t=i;break;case"0":0===n&&(n=i),t=i;break;default:if(!+e[i])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(t+1):e}(e)),P&&0==+e&&"+"!==i&&(P=!1),d=(P?"("===i?i:u:"-"===i||"("===i?"":i)+d,k=("s"===v?aU[8+j/3]:"")+k+(P&&"("===i?")":""),_){for(s=-1,a=e.length;++s<a;)if(48>(c=e.charCodeAt(s))||c>57){k=(46===c?o+e.slice(s+1):e.slice(s))+k,e=e.slice(0,s);break}}}g&&!f&&(e=n(e,1/0));var S=d.length+e.length+k.length,E=S<p?Array(p-S+1).join(t):"";switch(g&&f&&(e=n(E+e,E.length?p-k.length:1/0),E=""),r){case"<":e=d+e+k+E;break;case"=":e=d+E+e+k;break;case"^":e=E.slice(0,S=E.length>>1)+d+e+k+E.slice(S);break;default:e=E+d+e+k}return l(e)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return e+""},k}return{format:d,formatPrefix:function(e,t){var r=d(((e=aN(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(aL(t)/3))),n=Math.pow(10,-i),s=aU[8+i/3];return function(e){return r(n*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]})).format,R=N.formatPrefix;let ou=new Date,oh=new Date;function od(e,t,r,i){function n(t){return e(t=0==arguments.length?new Date:new Date(+t)),t}return n.floor=t=>(e(t=new Date(+t)),t),n.ceil=r=>(e(r=new Date(r-1)),t(r,1),e(r),r),n.round=e=>{let t=n(e),r=n.ceil(e);return e-t<r-e?t:r},n.offset=(e,r)=>(t(e=new Date(+e),null==r?1:Math.floor(r)),e),n.range=(r,i,s)=>{let a,o=[];if(r=n.ceil(r),s=null==s?1:Math.floor(s),!(r<i)||!(s>0))return o;do o.push(a=new Date(+r)),t(r,s),e(r);while(a<r&&r<i)return o},n.filter=r=>od(t=>{if(t>=t)for(;e(t),!r(t);)t.setTime(t-1)},(e,i)=>{if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!r(e););else for(;--i>=0;)for(;t(e,1),!r(e););}),r&&(n.count=(t,i)=>(ou.setTime(+t),oh.setTime(+i),e(ou),e(oh),Math.floor(r(ou,oh))),n.every=e=>isFinite(e=Math.floor(e))&&e>0?e>1?n.filter(i?t=>i(t)%e==0:t=>n.count(0,t)%e==0):n:null),n}let of=od(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());of.every=e=>isFinite(e=Math.floor(e))&&e>0?od(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)}):null,of.range;let op=od(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());op.every=e=>isFinite(e=Math.floor(e))&&e>0?od(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)}):null,op.range;let og=od(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());og.range;let om=od(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());om.range;function oy(e){return od(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/6048e5)}let ov=oy(0),ob=oy(1),ox=oy(2),ow=oy(3),o_=oy(4),ok=oy(5),oP=oy(6);function oS(e){return od(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/6048e5)}ov.range,ob.range,ox.range,ow.range,o_.range,ok.range,oP.range;let oE=oS(0),oA=oS(1),oM=oS(2),oT=oS(3),oC=oS(4),oO=oS(5),oI=oS(6);oE.range,oA.range,oM.range,oT.range,oC.range,oO.range,oI.range;let oL=od(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1);oL.range;let oj=od(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1);oj.range;let oN=od(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5));oN.range;let oD=od(e=>{e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())},(e,t)=>{e.setTime(+e+36e5*t)},(e,t)=>(t-e)/36e5,e=>e.getHours());oD.range;let oR=od(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+36e5*t)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours());oR.range;let oz=od(e=>{e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())},(e,t)=>{e.setTime(+e+6e4*t)},(e,t)=>(t-e)/6e4,e=>e.getMinutes());oz.range;let oF=od(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+6e4*t)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes());oF.range;let oB=od(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+1e3*t)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds());oB.range;let oU=od(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);function o$(e,t,r,i,n,s){let a=[[oB,1,1e3],[oB,5,5e3],[oB,15,15e3],[oB,30,3e4],[s,1,6e4],[s,5,3e5],[s,15,9e5],[s,30,18e5],[n,1,36e5],[n,3,108e5],[n,6,216e5],[n,12,432e5],[i,1,864e5],[i,2,1728e5],[r,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function o(t,r,i){let n=Math.abs(r-t)/i,s=sB(([,,e])=>e).right(a,n);if(s===a.length)return e.every(sR(t/31536e6,r/31536e6,i));if(0===s)return oU.every(Math.max(sR(t,r,i),1));let[o,l]=a[n/a[s-1][2]<a[s][2]/n?s-1:s];return o.every(l)}return[function(e,t,r){let i=t<e;i&&([e,t]=[t,e]);let n=r&&"function"==typeof r.range?r:o(e,t,r),s=n?n.range(e,+t+1):[];return i?s.reverse():s},o]}oU.every=e=>isFinite(e=Math.floor(e))&&e>0?e>1?od(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):oU:null,oU.range;let[oV,oW]=o$(op,om,oE,oN,oR,oF),[oG,oq]=o$(of,og,ov,oL,oD,oz);function oH(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function oK(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function oZ(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}var oY={"-":"",_:" ",0:"0"},oX=/^\s*\d+/,oJ=/^%/,oQ=/[\\^$*+?|[\]().{}]/g;function o0(e,t,r){var i=e<0?"-":"",n=(i?-e:e)+"",s=n.length;return i+(s<r?Array(r-s+1).join(t)+n:n)}function o1(e){return e.replace(oQ,"\\$&")}function o2(e){return RegExp("^(?:"+e.map(o1).join("|")+")","i")}function o3(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function o4(e,t,r){var i=oX.exec(t.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function o5(e,t,r){var i=oX.exec(t.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function o6(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function o8(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function o7(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function o9(e,t,r){var i=oX.exec(t.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function le(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function lt(e,t,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function lr(e,t,r){var i=oX.exec(t.slice(r,r+1));return i?(e.q=3*i[0]-3,r+i[0].length):-1}function li(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function ln(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function ls(e,t,r){var i=oX.exec(t.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function la(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function lo(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function ll(e,t,r){var i=oX.exec(t.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function lc(e,t,r){var i=oX.exec(t.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function lu(e,t,r){var i=oX.exec(t.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function lh(e,t,r){var i=oJ.exec(t.slice(r,r+1));return i?r+i[0].length:-1}function ld(e,t,r){var i=oX.exec(t.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function lf(e,t,r){var i=oX.exec(t.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function lp(e,t){return o0(e.getDate(),t,2)}function lg(e,t){return o0(e.getHours(),t,2)}function lm(e,t){return o0(e.getHours()%12||12,t,2)}function ly(e,t){return o0(1+oL.count(of(e),e),t,3)}function lv(e,t){return o0(e.getMilliseconds(),t,3)}function lb(e,t){return lv(e,t)+"000"}function lx(e,t){return o0(e.getMonth()+1,t,2)}function lw(e,t){return o0(e.getMinutes(),t,2)}function l_(e,t){return o0(e.getSeconds(),t,2)}function lk(e){var t=e.getDay();return 0===t?7:t}function lP(e,t){return o0(ov.count(of(e)-1,e),t,2)}function lS(e){var t=e.getDay();return t>=4||0===t?o_(e):o_.ceil(e)}function lE(e,t){return e=lS(e),o0(o_.count(of(e),e)+(4===of(e).getDay()),t,2)}function lA(e){return e.getDay()}function lM(e,t){return o0(ob.count(of(e)-1,e),t,2)}function lT(e,t){return o0(e.getFullYear()%100,t,2)}function lC(e,t){return o0((e=lS(e)).getFullYear()%100,t,2)}function lO(e,t){return o0(e.getFullYear()%1e4,t,4)}function lI(e,t){var r=e.getDay();return o0((e=r>=4||0===r?o_(e):o_.ceil(e)).getFullYear()%1e4,t,4)}function lL(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+o0(t/60|0,"0",2)+o0(t%60,"0",2)}function lj(e,t){return o0(e.getUTCDate(),t,2)}function lN(e,t){return o0(e.getUTCHours(),t,2)}function lD(e,t){return o0(e.getUTCHours()%12||12,t,2)}function lR(e,t){return o0(1+oj.count(op(e),e),t,3)}function lz(e,t){return o0(e.getUTCMilliseconds(),t,3)}function lF(e,t){return lz(e,t)+"000"}function lB(e,t){return o0(e.getUTCMonth()+1,t,2)}function lU(e,t){return o0(e.getUTCMinutes(),t,2)}function l$(e,t){return o0(e.getUTCSeconds(),t,2)}function lV(e){var t=e.getUTCDay();return 0===t?7:t}function lW(e,t){return o0(oE.count(op(e)-1,e),t,2)}function lG(e){var t=e.getUTCDay();return t>=4||0===t?oC(e):oC.ceil(e)}function lq(e,t){return e=lG(e),o0(oC.count(op(e),e)+(4===op(e).getUTCDay()),t,2)}function lH(e){return e.getUTCDay()}function lK(e,t){return o0(oA.count(op(e)-1,e),t,2)}function lZ(e,t){return o0(e.getUTCFullYear()%100,t,2)}function lY(e,t){return o0((e=lG(e)).getUTCFullYear()%100,t,2)}function lX(e,t){return o0(e.getUTCFullYear()%1e4,t,4)}function lJ(e,t){var r=e.getUTCDay();return o0((e=r>=4||0===r?oC(e):oC.ceil(e)).getUTCFullYear()%1e4,t,4)}function lQ(){return"+0000"}function l0(){return"%"}function l1(e){return+e}function l2(e){return Math.floor(e/1e3)}function l3(e){return new Date(e)}function l4(e){return e instanceof Date?+e:+new Date(+e)}function l5(e,t,r,i,n,s,a,o,l,c){var u=aO(),h=u.invert,d=u.domain,f=c(".%L"),p=c(":%S"),g=c("%I:%M"),m=c("%I %p"),y=c("%a %d"),v=c("%b %d"),b=c("%B"),x=c("%Y");function w(e){return(l(e)<e?f:o(e)<e?p:a(e)<e?g:s(e)<e?m:i(e)<e?n(e)<e?y:v:r(e)<e?b:x)(e)}return u.invert=function(e){return new Date(h(e))},u.domain=function(e){return arguments.length?d(Array.from(e,l4)):d().map(l3)},u.ticks=function(t){var r=d();return e(r[0],r[r.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?w:c(t)},u.nice=function(e){var r=d();return e&&"function"==typeof e.range||(e=t(r[0],r[r.length-1],null==e?10:e)),e?d(aq(r,e)):u},u.copy=function(){return aT(u,l5(e,t,r,i,n,s,a,o,l,c))},u}function l6(){return s_.apply(l5(oG,oq,of,og,ov,oL,oD,oz,oB,F).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function l8(){return s_.apply(l5(oV,oW,op,om,oE,oj,oR,oF,oB,B).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function l7(){var e,t,r,i,n,s=0,a=1,o=aS,l=!1;function c(t){return null==t||isNaN(t*=1)?n:o(0===r?.5:(t=(i(t)-e)*r,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var r,i;return arguments.length?([r,i]=t,o=e(r,i),c):[o(0),o(1)]}}return c.domain=function(n){return arguments.length?([s,a]=n,e=i(s*=1),t=i(a*=1),r=e===t?0:1/(t-e),c):[s,a]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(o=e,c):o},c.range=u(aw),c.rangeRound=u(a_),c.unknown=function(e){return arguments.length?(n=e,c):n},function(n){return i=n,e=n(s),t=n(a),r=e===t?0:1/(t-e),c}}function l9(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ce(){var e=aV(l7()(aS));return e.copy=function(){return l9(e,ce())},sk.apply(e,arguments)}function ct(){var e=aQ(l7()).domain([1,10]);return e.copy=function(){return l9(e,ct()).base(e.base())},sk.apply(e,arguments)}function cr(){var e=a3(l7());return e.copy=function(){return l9(e,cr()).constant(e.constant())},sk.apply(e,arguments)}function ci(){var e=a7(l7());return e.copy=function(){return l9(e,ci()).exponent(e.exponent())},sk.apply(e,arguments)}function cn(){return ci.apply(null,arguments).exponent(.5)}function cs(){var e=[],t=aS;function r(r){if(null!=r&&!isNaN(r*=1))return t((sW(e,r,1)-1)/(e.length-1))}return r.domain=function(t){if(!arguments.length)return e.slice();for(let r of(e=[],t))null==r||isNaN(r*=1)||e.push(r);return e.sort(sz),r},r.interpolator=function(e){return arguments.length?(t=e,r):t},r.range=function(){return e.map((r,i)=>t(i/(e.length-1)))},r.quantiles=function(t){return Array.from({length:t+1},(r,i)=>(function(e,t,r){if(!(!(i=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t*=1)>=t&&(yield t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(i*=1)>=i&&(yield i)}}(e,void 0))).length)||isNaN(t*=1))){if(t<=0||i<2)return on(e);if(t>=1)return oi(e);var i,n=(i-1)*t,s=Math.floor(n),a=oi((function e(t,r,i=0,n=1/0,s){if(r=Math.floor(r),i=Math.floor(Math.max(0,i)),n=Math.floor(Math.min(t.length-1,n)),!(i<=r&&r<=n))return t;for(s=void 0===s?os:function(e=sz){if(e===sz)return os;if("function"!=typeof e)throw TypeError("compare is not a function");return(t,r)=>{let i=e(t,r);return i||0===i?i:(0===e(r,r))-(0===e(t,t))}}(s);n>i;){if(n-i>600){let a=n-i+1,o=r-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(o-a/2<0?-1:1),h=Math.max(i,Math.floor(r-o*c/a+u)),d=Math.min(n,Math.floor(r+(a-o)*c/a+u));e(t,r,h,d,s)}let a=t[r],o=i,l=n;for(oa(t,i,r),s(t[n],a)>0&&oa(t,i,n);o<l;){for(oa(t,o,l),++o,--l;0>s(t[o],a);)++o;for(;s(t[l],a)>0;)--l}0===s(t[i],a)?oa(t,i,l):oa(t,++l,n),l<=r&&(i=l+1),r<=l&&(n=l-1)}return t})(e,s).subarray(0,s+1));return a+(on(e.subarray(s+1))-a)*(n-s)}})(e,i/t))},r.copy=function(){return cs(t).domain(e)},sk.apply(r,arguments)}function ca(){var e,t,r,i,n,s,a,o=0,l=.5,c=1,u=1,h=aS,d=!1;function f(e){return isNaN(e*=1)?a:(e=.5+((e=+s(e))-t)*(u*e<u*t?i:n),h(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var r,i,n;return arguments.length?([r,i,n]=t,h=function(e,t){void 0===t&&(t=e,e=aw);for(var r=0,i=t.length-1,n=t[0],s=Array(i<0?0:i);r<i;)s[r]=e(n,n=t[++r]);return function(e){var t=Math.max(0,Math.min(i-1,Math.floor(e*=i)));return s[t](e-t)}}(e,[r,i,n]),f):[h(0),h(.5),h(1)]}}return f.domain=function(a){return arguments.length?([o,l,c]=a,e=s(o*=1),t=s(l*=1),r=s(c*=1),i=e===t?0:.5/(t-e),n=t===r?0:.5/(r-t),u=t<e?-1:1,f):[o,l,c]},f.clamp=function(e){return arguments.length?(d=!!e,f):d},f.interpolator=function(e){return arguments.length?(h=e,f):h},f.range=p(aw),f.rangeRound=p(a_),f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return s=a,e=a(o),t=a(l),r=a(c),i=e===t?0:.5/(t-e),n=t===r?0:.5/(r-t),u=t<e?-1:1,f}}function co(){var e=aV(ca()(aS));return e.copy=function(){return l9(e,co())},sk.apply(e,arguments)}function cl(){var e=aQ(ca()).domain([.1,1,10]);return e.copy=function(){return l9(e,cl()).base(e.base())},sk.apply(e,arguments)}function cc(){var e=a3(ca());return e.copy=function(){return l9(e,cc()).constant(e.constant())},sk.apply(e,arguments)}function cu(){var e=a7(ca());return e.copy=function(){return l9(e,cu()).exponent(e.exponent())},sk.apply(e,arguments)}function ch(){return cu.apply(null,arguments).exponent(.5)}F=(z=function(e){var t=e.dateTime,r=e.date,i=e.time,n=e.periods,s=e.days,a=e.shortDays,o=e.months,l=e.shortMonths,c=o2(n),u=o3(n),h=o2(s),d=o3(s),f=o2(a),p=o3(a),g=o2(o),m=o3(o),y=o2(l),v=o3(l),b={a:function(e){return a[e.getDay()]},A:function(e){return s[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return o[e.getMonth()]},c:null,d:lp,e:lp,f:lb,g:lC,G:lI,H:lg,I:lm,j:ly,L:lv,m:lx,M:lw,p:function(e){return n[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:l1,s:l2,S:l_,u:lk,U:lP,V:lE,w:lA,W:lM,x:null,X:null,y:lT,Y:lO,Z:lL,"%":l0},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return s[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return o[e.getUTCMonth()]},c:null,d:lj,e:lj,f:lF,g:lY,G:lJ,H:lN,I:lD,j:lR,L:lz,m:lB,M:lU,p:function(e){return n[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:l1,s:l2,S:l$,u:lV,U:lW,V:lq,w:lH,W:lK,x:null,X:null,y:lZ,Y:lX,Z:lQ,"%":l0},w={a:function(e,t,r){var i=f.exec(t.slice(r));return i?(e.w=p.get(i[0].toLowerCase()),r+i[0].length):-1},A:function(e,t,r){var i=h.exec(t.slice(r));return i?(e.w=d.get(i[0].toLowerCase()),r+i[0].length):-1},b:function(e,t,r){var i=y.exec(t.slice(r));return i?(e.m=v.get(i[0].toLowerCase()),r+i[0].length):-1},B:function(e,t,r){var i=g.exec(t.slice(r));return i?(e.m=m.get(i[0].toLowerCase()),r+i[0].length):-1},c:function(e,r,i){return P(e,t,r,i)},d:ln,e:ln,f:lu,g:le,G:o9,H:la,I:la,j:ls,L:lc,m:li,M:lo,p:function(e,t,r){var i=c.exec(t.slice(r));return i?(e.p=u.get(i[0].toLowerCase()),r+i[0].length):-1},q:lr,Q:ld,s:lf,S:ll,u:o5,U:o6,V:o8,w:o4,W:o7,x:function(e,t,i){return P(e,r,t,i)},X:function(e,t,r){return P(e,i,t,r)},y:le,Y:o9,Z:lt,"%":lh};function _(e,t){return function(r){var i,n,s,a=[],o=-1,l=0,c=e.length;for(r instanceof Date||(r=new Date(+r));++o<c;)37===e.charCodeAt(o)&&(a.push(e.slice(l,o)),null!=(n=oY[i=e.charAt(++o)])?i=e.charAt(++o):n="e"===i?" ":"0",(s=t[i])&&(i=s(r,n)),a.push(i),l=o+1);return a.push(e.slice(l,o)),a.join("")}}function k(e,t){return function(r){var i,n,s=oZ(1900,void 0,1);if(P(s,e,r+="",0)!=r.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(!t||"Z"in s||(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(i=(n=(i=oK(oZ(s.y,0,1))).getUTCDay())>4||0===n?oA.ceil(i):oA(i),i=oj.offset(i,(s.V-1)*7),s.y=i.getUTCFullYear(),s.m=i.getUTCMonth(),s.d=i.getUTCDate()+(s.w+6)%7):(i=(n=(i=oH(oZ(s.y,0,1))).getDay())>4||0===n?ob.ceil(i):ob(i),i=oL.offset(i,(s.V-1)*7),s.y=i.getFullYear(),s.m=i.getMonth(),s.d=i.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:+("W"in s)),n="Z"in s?oK(oZ(s.y,0,1)).getUTCDay():oH(oZ(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(n+5)%7:s.w+7*s.U-(n+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,oK(s)):oH(s)}}function P(e,t,r,i){for(var n,s,a=0,o=t.length,l=r.length;a<o;){if(i>=l)return -1;if(37===(n=t.charCodeAt(a++))){if(!(s=w[(n=t.charAt(a++))in oY?t.charAt(a++):n])||(i=s(e,r,i))<0)return -1}else if(n!=r.charCodeAt(i++))return -1}return i}return b.x=_(r,b),b.X=_(i,b),b.c=_(t,b),x.x=_(r,x),x.X=_(i,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})).format,z.parse,B=z.utcFormat,z.utcParse,e.s(["scaleBand",()=>sT,"scaleDiverging",()=>co,"scaleDivergingLog",()=>cl,"scaleDivergingPow",()=>cu,"scaleDivergingSqrt",()=>ch,"scaleDivergingSymlog",()=>cc,"scaleIdentity",()=>aG,"scaleImplicit",0,sA,"scaleLinear",()=>aW,"scaleLog",()=>a0,"scaleOrdinal",()=>sM,"scalePoint",()=>sC,"scalePow",()=>a9,"scaleQuantile",()=>oo,"scaleQuantize",()=>ol,"scaleRadial",()=>or,"scaleSequential",()=>ce,"scaleSequentialLog",()=>ct,"scaleSequentialPow",()=>ci,"scaleSequentialQuantile",()=>cs,"scaleSequentialSqrt",()=>cn,"scaleSequentialSymlog",()=>cr,"scaleSqrt",()=>oe,"scaleSymlog",()=>a4,"scaleThreshold",()=>oc,"scaleTime",()=>l6,"scaleUtc",()=>l8,"tickFormat",()=>a$],29061),e.i(29061),e.s(["scaleBand",()=>sT,"scaleDiverging",()=>co,"scaleDivergingLog",()=>cl,"scaleDivergingPow",()=>cu,"scaleDivergingSqrt",()=>ch,"scaleDivergingSymlog",()=>cc,"scaleIdentity",()=>aG,"scaleImplicit",0,sA,"scaleLinear",()=>aW,"scaleLog",()=>a0,"scaleOrdinal",()=>sM,"scalePoint",()=>sC,"scalePow",()=>a9,"scaleQuantile",()=>oo,"scaleQuantize",()=>ol,"scaleRadial",()=>or,"scaleSequential",()=>ce,"scaleSequentialLog",()=>ct,"scaleSequentialPow",()=>ci,"scaleSequentialQuantile",()=>cs,"scaleSequentialSqrt",()=>cn,"scaleSequentialSymlog",()=>cr,"scaleSqrt",()=>oe,"scaleSymlog",()=>a4,"scaleThreshold",()=>oc,"scaleTime",()=>l6,"scaleUtc",()=>l8,"tickFormat",()=>a$],79357);var cd=e.i(79357);function cf(e){return null!=e}var cp=e=>e.chartData,cg=rY([cp],e=>{var t=null!=e.chartData?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),cm=(e,t,r,i)=>i?cg(e):cp(e);function cy(e){if(Array.isArray(e)&&2===e.length){var[t,r]=e;if(e3(t)&&e3(r))return!0}return!1}function cv(e,t,r){return r?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function cb(e,t){if(t&&"function"!=typeof e&&Array.isArray(e)&&2===e.length){var r,i,[n,s]=e;if(e3(n))r=n;else if("function"==typeof n)return;if(e3(s))i=s;else if("function"==typeof s)return;var a=[r,i];if(cy(a))return a}}var cx=e.i(51655),cw=e=>e,c_={},ck=e=>function t(){let r;return 0==arguments.length||1==arguments.length&&(r=arguments.length<=0?void 0:arguments[0],r===c_)?t:e(...arguments)},cP=(e,t)=>1===e?t:ck(function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];var s=i.filter(e=>e!==c_).length;return s>=e?t(...i):cP(e-s,ck(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t(...i.map(e=>e===c_?r.shift():e),...r)}))}),cS=(e,t)=>{for(var r=[],i=e;i<t;++i)r[i-e]=i;return r},cE=cP((o=(e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(e=>t[e]).map(e)).length,o),cA=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return cw;var i=t.reverse(),n=i[0],s=i.slice(1);return function(){return s.reduce((e,t)=>t(e),n(...arguments))}},cM=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join(""),cT=e=>{var t=null,r=null;return function(){for(var i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];return t&&n.every((e,r)=>{var i;return e===(null==(i=t)?void 0:i[r])})?r:(t=n,r=e(...n))}};function cC(e){return 0===e?1:Math.floor(new cx.default(e).abs().log(10).toNumber())+1}function cO(e,t,r){for(var i=new cx.default(e),n=0,s=[];i.lt(t)&&n<1e5;)s.push(i.toNumber()),i=i.add(r),n++;return s}cP((l=(e,t,r)=>{var i=+e;return i+r*(t-i)}).length,l),cP((c=(e,t,r)=>{var i=t-e;return(r-e)/(i=i||1/0)}).length,c),cP((u=(e,t,r)=>{var i=t-e;return Math.max(0,Math.min(1,(r-e)/(i=i||1/0)))}).length,u);var cI=e=>{var[t,r]=e,[i,n]=[t,r];return t>r&&([i,n]=[r,t]),[i,n]},cL=(e,t,r)=>{if(e.lte(0))return new cx.default(0);var i=cC(e.toNumber()),n=new cx.default(10).pow(i),s=e.div(n),a=1!==i?.05:.1,o=new cx.default(Math.ceil(s.div(a).toNumber())).add(r).mul(a).mul(n);return new cx.default(t?o.toNumber():Math.ceil(o.toNumber()))},cj=function(e,t,r,i){var n,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new cx.default(0),tickMin:new cx.default(0),tickMax:new cx.default(0)};var a=cL(new cx.default(t).sub(e).div(r-1),i,s),o=Math.ceil((n=e<=0&&t>=0?new cx.default(0):(n=new cx.default(e).add(t).div(2)).sub(new cx.default(n).mod(a))).sub(e).div(a).toNumber()),l=Math.ceil(new cx.default(t).sub(n).div(a).toNumber()),c=o+l+1;return c>r?cj(e,t,r,i,s+1):(c<r&&(l=t>0?l+(r-c):l,o=t>0?o:o+(r-c)),{step:a,tickMin:n.sub(new cx.default(o).mul(a)),tickMax:n.add(new cx.default(l).mul(a))})},cN=cT(function(e){var[t,r]=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=Math.max(i,2),[a,o]=cI([t,r]);if(a===-1/0||o===1/0){var l=o===1/0?[a,...cS(0,i-1).map(()=>1/0)]:[...cS(0,i-1).map(()=>-1/0),o];return t>r?cM(l):l}if(a===o){var c=new cx.default(1),u=new cx.default(a);if(!u.isint()&&n){var h=Math.abs(a);h<1?(c=new cx.default(10).pow(cC(a)-1),u=new cx.default(Math.floor(u.div(c).toNumber())).mul(c)):h>1&&(u=new cx.default(Math.floor(a)))}else 0===a?u=new cx.default(Math.floor((i-1)/2)):n||(u=new cx.default(Math.floor(a)));var d=Math.floor((i-1)/2);return cA(cE(e=>u.add(new cx.default(e-d).mul(c)).toNumber()),cS)(0,i)}var{step:f,tickMin:p,tickMax:g}=cj(a,o,s,n,0),m=cO(p,g.add(new cx.default(.1).mul(f)),f);return t>r?cM(m):m}),cD=cT(function(e,t){var[r,i]=e,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[s,a]=cI([r,i]);if(s===-1/0||a===1/0)return[r,i];if(s===a)return[s];var o=Math.max(t,2),l=cL(new cx.default(a).sub(s).div(o-1),n,0),c=[...cO(new cx.default(s),new cx.default(a),l),a];return!1===n&&(c=c.map(e=>Math.round(e))),r>i?cM(c):c}),cR=e=>e.rootProps.stackOffset,cz=e=>e.options.chartName,cF=e=>e.rootProps.syncId,cB=e=>e.rootProps.syncMethod,cU=e=>e.options.eventEmitter,c$=(e,t)=>t,cV=(e,t,r)=>r;function cW(e){return null==e?void 0:e.id}var cG=e=>{var t=nU(e);return"horizontal"===t?"xAxis":"vertical"===t?"yAxis":"centric"===t?"angleAxis":"radiusAxis"},cq=e=>e.tooltip.settings.axisId,cH=e=>{var t=cG(e),r=cq(e);return ut(e,t,r)},cK=rY([cH],e=>null==e?void 0:e.dataKey);function cZ(e,t,r){var{chartData:i=[]}=t,{allowDuplicatedCategory:n,dataKey:s}=r,a=new Map;return e.forEach(e=>{var t,r=null!=(t=e.data)?t:i;if(null!=r&&0!==r.length){var o=cW(e);r.forEach((t,r)=>{var i,l=null==s||n?r:String(i8(t,s,null)),c=i8(t,e.dataKey,0);Object.assign(i=a.has(l)?a.get(l):{},{[o]:c}),a.set(l,i)})}}),Array.from(a.values())}function cY(e){return null!=e.stackId&&null!=e.dataKey}var cX=(e,t)=>e===t||null!=e&&null!=t&&e[0]===t[0]&&e[1]===t[1];function cJ(e,t){return!!(Array.isArray(e)&&Array.isArray(t))&&0===e.length&&0===t.length||e===t}function cQ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function c0(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cQ(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cQ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var c1=[0,"auto"],c2={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},c3=(e,t)=>e.cartesianAxis.xAxis[t],c4=(e,t)=>{var r=c3(e,t);return null==r?c2:r},c5={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:c1,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:60},c6=(e,t)=>e.cartesianAxis.yAxis[t],c8=(e,t)=>{var r=c6(e,t);return null==r?c5:r},c7={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},c9=(e,t)=>{var r=e.cartesianAxis.zAxis[t];return null==r?c7:r},ue=(e,t,r)=>{switch(t){case"xAxis":return c4(e,r);case"yAxis":return c8(e,r);case"zAxis":return c9(e,r);case"angleAxis":return nY(e,r);case"radiusAxis":return nX(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},ut=(e,t,r)=>{switch(t){case"xAxis":return c4(e,r);case"yAxis":return c8(e,r);case"angleAxis":return nY(e,r);case"radiusAxis":return nX(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},ur=e=>e.graphicalItems.cartesianItems.some(e=>"bar"===e.type)||e.graphicalItems.polarItems.some(e=>"radialBar"===e.type);function ui(e,t){return r=>{switch(e){case"xAxis":return"xAxisId"in r&&r.xAxisId===t;case"yAxis":return"yAxisId"in r&&r.yAxisId===t;case"zAxis":return"zAxisId"in r&&r.zAxisId===t;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===t;default:return!1}}}var un=e=>e.graphicalItems.cartesianItems,us=rY([c$,cV],ui),ua=(e,t,r)=>e.filter(r).filter(e=>(null==t?void 0:t.includeHidden)===!0||!e.hide),uo=rY([un,ue,us],ua,{memoizeOptions:{resultEqualityCheck:cJ}}),ul=rY([uo],e=>e.filter(e=>"area"===e.type||"bar"===e.type).filter(cY)),uc=e=>e.filter(e=>!("stackId"in e)||void 0===e.stackId),uu=rY([uo],uc),uh=e=>e.map(e=>e.data).filter(Boolean).flat(1),ud=rY([uo],uh,{memoizeOptions:{resultEqualityCheck:cJ}}),uf=(e,t)=>{var{chartData:r=[],dataStartIndex:i,dataEndIndex:n}=t;return e.length>0?e:r.slice(i,n+1)},up=rY([ud,cm],uf),ug=(e,t,r)=>(null==t?void 0:t.dataKey)!=null?e.map(e=>({value:i8(e,t.dataKey)})):r.length>0?r.map(e=>e.dataKey).flatMap(t=>e.map(e=>({value:i8(e,t)}))):e.map(e=>({value:e})),um=rY([up,ue,uo],ug);function uy(e,t){switch(e){case"xAxis":return"x"===t.direction;case"yAxis":return"y"===t.direction;default:return!1}}function uv(e){if(eZ(e)||e instanceof Date){var t=Number(e);if(e3(t))return t}}function ub(e){if(Array.isArray(e)){var t=[uv(e[0]),uv(e[1])];return cy(t)?t:void 0}var r=uv(e);if(null!=r)return[r,r]}function ux(e){return e.map(uv).filter(cf)}var uw=rY([ul,cm,cH],cZ),u_=(e,t,r)=>Object.fromEntries(Object.entries(t.reduce((e,t)=>(null==t.stackId||(null==e[t.stackId]&&(e[t.stackId]=[]),e[t.stackId].push(t)),e),{})).map(t=>{var i,[n,s]=t,a=s.map(cW);return[n,{stackedData:(i=nt[r],(function(){var e=ed([]),t=i1,r=i0,i=i2;function n(n){var s,a,o=Array.from(e.apply(this,arguments),i3),l=o.length,c=-1;for(let e of n)for(s=0,++c;s<l;++s)(o[s][c]=[0,+i(e,o[s].key,c,n)]).data=e;for(s=0,a=eh(t(o));s<l;++s)o[a[s]].index=s;return r(o,a),o}return n.keys=function(t){return arguments.length?(e="function"==typeof t?t:ed(Array.from(t)),n):e},n.value=function(e){return arguments.length?(i="function"==typeof e?e:ed(+e),n):i},n.order=function(e){return arguments.length?(t=null==e?i1:"function"==typeof e?e:ed(Array.from(e)),n):t},n.offset=function(e){return arguments.length?(r=null==e?i0:e,n):r},n})().keys(a).value((e,t)=>+i8(e,t,0)).order(i1).offset(i)(e)),graphicalItems:s}]})),uk=rY([uw,ul,cR],u_),uP=(e,t,r,i)=>{var{dataStartIndex:n,dataEndIndex:s}=t;if(null==i&&"zAxis"!==r){var a=((e,t,r)=>{if(null!=e){let i;return[(i=Object.keys(e).reduce((i,n)=>{var{stackedData:s}=e[n],a=s.reduce((e,i)=>{var n,s=[Math.min(...n=i4(i,t,r).flat(2).filter(eK)),Math.max(...n)];return[Math.min(e[0],s[0]),Math.max(e[1],s[1])]},[1/0,-1/0]);return[Math.min(a[0],i[0]),Math.max(a[1],i[1])]},[1/0,-1/0]))[0]===1/0?0:i[0],i[1]===-1/0?0:i[1]]}})(e,n,s);if(null==a||0!==a[0]||0!==a[1])return a}},uS=rY([ue],e=>e.allowDataOverflow),uE=e=>{var t;if(null==e||!("domain"in e))return c1;if(null!=e.domain)return e.domain;if(null!=e.ticks){if("number"===e.type){var r=ux(e.ticks);return[Math.min(...r),Math.max(...r)]}if("category"===e.type)return e.ticks.map(String)}return null!=(t=null==e?void 0:e.domain)?t:c1},uA=rY([ue],uE),uM=rY([uA,uS],cb),uT=rY([uk,cp,c$,uM],uP,{memoizeOptions:{resultEqualityCheck:cX}}),uC=e=>e.errorBars,uO=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.filter(Boolean);if(0!==i.length){var n=i.flat();return[Math.min(...n),Math.max(...n)]}},uI=(e,t,r,i,n)=>{var s,a;if(r.length>0&&e.forEach(e=>{r.forEach(r=>{var o,l,c=null==(o=i[r.id])?void 0:o.filter(e=>uy(n,e)),u=i8(e,null!=(l=t.dataKey)?l:r.dataKey),h=!(!c||"number"!=typeof u||eq(u))&&c.length?ux(c.flatMap(t=>{var r,i,n=i8(e,t.dataKey);if(Array.isArray(n)?[r,i]=n:r=i=n,e3(r)&&e3(i))return[u-r,u+i]})):[];if(h.length>=2){var d=Math.min(...h),f=Math.max(...h);(null==s||d<s)&&(s=d),(null==a||f>a)&&(a=f)}var p=ub(u);null!=p&&(s=null==s?p[0]:Math.min(s,p[0]),a=null==a?p[1]:Math.max(a,p[1]))})}),(null==t?void 0:t.dataKey)!=null&&e.forEach(e=>{var r=ub(i8(e,t.dataKey));null!=r&&(s=null==s?r[0]:Math.min(s,r[0]),a=null==a?r[1]:Math.max(a,r[1]))}),e3(s)&&e3(a))return[s,a]},uL=rY([up,ue,uu,uC,c$],uI,{memoizeOptions:{resultEqualityCheck:cX}});function uj(e){var{value:t}=e;if(eZ(t)||t instanceof Date)return t}var uN=e=>e.referenceElements.dots,uD=(e,t,r)=>e.filter(e=>"extendDomain"===e.ifOverflow).filter(e=>"xAxis"===t?e.xAxisId===r:e.yAxisId===r),uR=rY([uN,c$,cV],uD),uz=e=>e.referenceElements.areas,uF=rY([uz,c$,cV],uD),uB=e=>e.referenceElements.lines,uU=rY([uB,c$,cV],uD),u$=(e,t)=>{var r=ux(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},uV=rY(uR,c$,u$),uW=(e,t)=>{var r=ux(e.flatMap(e=>["xAxis"===t?e.x1:e.y1,"xAxis"===t?e.x2:e.y2]));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},uG=rY([uF,c$],uW),uq=(e,t)=>{var r=ux(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==r.length)return[Math.min(...r),Math.max(...r)]},uH=rY(uU,c$,uq),uK=rY(uV,uH,uG,(e,t,r)=>uO(e,r,t)),uZ=(e,t,r,i,n,s,a,o)=>null!=r?r:function(e,t,r){if(r||null!=t){if("function"==typeof e&&null!=t)try{var i=e(t,r);if(cy(i))return cv(i,t,r)}catch(e){}if(Array.isArray(e)&&2===e.length){var n,s,[a,o]=e;if("auto"===a)null!=t&&(n=Math.min(...t));else if(eK(a))n=a;else if("function"==typeof a)try{null!=t&&(n=a(null==t?void 0:t[0]))}catch(e){}else if("string"==typeof a&&ni.test(a)){var l=ni.exec(a);if(null==l||null==t)n=void 0;else{var c=+l[1];n=t[0]-c}}else n=null==t?void 0:t[0];if("auto"===o)null!=t&&(s=Math.max(...t));else if(eK(o))s=o;else if("function"==typeof o)try{null!=t&&(s=o(null==t?void 0:t[1]))}catch(e){}else if("string"==typeof o&&nn.test(o)){var u=nn.exec(o);if(null==u||null==t)s=void 0;else{var h=+u[1];s=t[1]+h}}else s=null==t?void 0:t[1];var d=[n,s];if(cy(d))return null==t?d:cv(d,t,r)}}}(t,"vertical"===a&&"xAxis"===o||"horizontal"===a&&"yAxis"===o?uO(i,s,n):uO(s,n),e.allowDataOverflow),uY=rY([ue,uA,uM,uT,uL,uK,nU,c$],uZ,{memoizeOptions:{resultEqualityCheck:cX}}),uX=[0,1],uJ=(e,t,r,i,n,s,a)=>{if(null!=e&&null!=r&&0!==r.length||void 0!==a){var o,{dataKey:l,type:c}=e,u=i7(t,s);return u&&null==l?(0,sw.default)(0,r.length):"category"===c?(o=i.map(uj).filter(e=>null!=e),u&&(null==e.dataKey||e.allowDuplicatedCategory&&eQ(o))?(0,sw.default)(0,i.length):e.allowDuplicatedCategory?o:Array.from(new Set(o))):"expand"===n?uX:a}},uQ=rY([ue,nU,up,um,cR,c$,uY],uJ),u0=(e,t,r,i,n)=>{if(null!=e){var{scale:s,type:a}=e;if("auto"===s)return"radial"===t&&"radiusAxis"===n?"band":"radial"===t&&"angleAxis"===n?"linear":"category"===a&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!r)?"point":"category"===a?"band":"linear";if("string"==typeof s){var o="scale".concat(e2(s));return o in cd?o:"point"}}},u1=rY([ue,nU,ur,cz,c$],u0);function u2(e,t,r,i){if(null!=r&&null!=i){if("function"==typeof e.scale)return e.scale.copy().domain(r).range(i);var n=function(e){if(null!=e){if(e in cd)return cd[e]();var t="scale".concat(e2(e));if(t in cd)return cd[t]()}}(t);if(null!=n){var s=n.domain(r).range(i);return(e=>{var t=e.domain();if(t&&!(t.length<=2)){var r=t.length,i=e.range(),n=Math.min(i[0],i[1])-1e-4,s=Math.max(i[0],i[1])+1e-4,a=e(t[0]),o=e(t[r-1]);(a<n||a>s||o<n||o>s)&&e.domain([t[0],t[r-1]])}})(s),s}}}var u3=(e,t,r)=>{var i=uE(t);if("auto"===r||"linear"===r){if(null!=t&&t.tickCount&&Array.isArray(i)&&("auto"===i[0]||"auto"===i[1])&&cy(e))return cN(e,t.tickCount,t.allowDecimals);if(null!=t&&t.tickCount&&"number"===t.type&&cy(e))return cD(e,t.tickCount,t.allowDecimals)}},u4=rY([uQ,ut,u1],u3),u5=(e,t,r,i)=>"angleAxis"!==i&&(null==e?void 0:e.type)==="number"&&cy(t)&&Array.isArray(r)&&r.length>0?[Math.min(t[0],r[0]),Math.max(t[1],r[r.length-1])]:t,u6=rY([ue,uQ,u4,c$],u5),u8=rY(um,ue,(e,t)=>{if(t&&"number"===t.type){var r=1/0,i=Array.from(ux(e.map(e=>e.value))).sort((e,t)=>e-t);if(i.length<2)return 1/0;var n=i[i.length-1]-i[0];if(0===n)return 1/0;for(var s=0;s<i.length-1;s++)r=Math.min(r,i[s+1]-i[s]);return r/n}}),u7=rY(u8,nU,e=>e.rootProps.barCategoryGap,nm,(e,t,r,i)=>i,(e,t,r,i,n)=>{if(!e3(e))return 0;var s="vertical"===t?i.height:i.width;if("gap"===n)return e*s/2;if("no-gap"===n){var a=eJ(r,e*s),o=e*s/2;return o-a-(o-a)/s*a}return 0}),u9=rY(c4,(e,t)=>{var r=c4(e,t);return null==r||"string"!=typeof r.padding?0:u7(e,"xAxis",t,r.padding)},(e,t)=>{if(null==e)return{left:0,right:0};var r,i,{padding:n}=e;return"string"==typeof n?{left:t,right:t}:{left:(null!=(r=n.left)?r:0)+t,right:(null!=(i=n.right)?i:0)+t}}),he=rY(c8,(e,t)=>{var r=c8(e,t);return null==r||"string"!=typeof r.padding?0:u7(e,"yAxis",t,r.padding)},(e,t)=>{if(null==e)return{top:0,bottom:0};var r,i,{padding:n}=e;return"string"==typeof n?{top:t,bottom:t}:{top:(null!=(r=n.top)?r:0)+t,bottom:(null!=(i=n.bottom)?i:0)+t}}),ht=rY([nm,u9,n_,nw,(e,t,r)=>r],(e,t,r,i,n)=>{var{padding:s}=i;return n?[s.left,r.width-s.right]:[e.left+t.left,e.left+e.width-t.right]}),hr=rY([nm,nU,he,n_,nw,(e,t,r)=>r],(e,t,r,i,n,s)=>{var{padding:a}=n;return s?[i.height-a.bottom,a.top]:"horizontal"===t?[e.top+e.height-r.bottom,e.top+r.top]:[e.top+r.top,e.top+e.height-r.bottom]}),hi=(e,t,r,i)=>{var n;switch(t){case"xAxis":return ht(e,r,i);case"yAxis":return hr(e,r,i);case"zAxis":return null==(n=c9(e,r))?void 0:n.range;case"angleAxis":return n2(e);case"radiusAxis":return n3(e,r);default:return}},hn=rY([ue,hi],nG),hs=rY([ue,u1,u6,hn],u2);function ha(e,t){return e.id<t.id?-1:+(e.id>t.id)}rY([uo,uC,c$],(e,t,r)=>e.flatMap(e=>t[e.id]).filter(Boolean).filter(e=>uy(r,e)));var ho=(e,t)=>t,hl=(e,t,r)=>r,hc=rY(nd,ho,hl,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(ha)),hu=rY(nf,ho,hl,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(ha)),hh=(e,t)=>({width:e.width,height:t.height}),hd=rY(nm,c4,hh),hf=rY(nc,nm,hc,ho,hl,(e,t,r,i,n)=>{var s,a={};return r.forEach(r=>{var o=hh(t,r);null==s&&(s=((e,t,r)=>{switch(t){case"top":return e.top;case"bottom":return r-e.bottom;default:return 0}})(t,i,e));var l="top"===i&&!n||"bottom"===i&&n;a[r.id]=s-Number(l)*o.height,s+=(l?-1:1)*o.height}),a}),hp=rY(nl,nm,hu,ho,hl,(e,t,r,i,n)=>{var s,a={};return r.forEach(r=>{var o={width:"number"==typeof r.width?r.width:60,height:t.height};null==s&&(s=((e,t,r)=>{switch(t){case"left":return e.left;case"right":return r-e.right;default:return 0}})(t,i,e));var l="left"===i&&!n||"right"===i&&n;a[r.id]=s-Number(l)*o.width,s+=(l?-1:1)*o.width}),a}),hg=rY([nm,c4,(e,t)=>{var r=c4(e,t);if(null!=r)return hf(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,i)=>{if(null!=t){var n=null==r?void 0:r[i];return null==n?{x:e.left,y:0}:{x:e.left,y:n}}}),hm=rY([nm,c8,(e,t)=>{var r=c8(e,t);if(null!=r)return hp(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,i)=>{if(null!=t){var n=null==r?void 0:r[i];return null==n?{x:0,y:e.top}:{x:n,y:e.top}}}),hy=rY(nm,c8,(e,t)=>({width:"number"==typeof t.width?t.width:60,height:e.height})),hv=(e,t,r,i)=>{if(null!=r){var{allowDuplicatedCategory:n,type:s,dataKey:a}=r,o=i7(e,i),l=t.map(e=>e.value);if(a&&o&&"category"===s&&n&&eQ(l))return l}},hb=rY([nU,um,ue,c$],hv),hx=(e,t,r,i)=>{if(null!=r&&null!=r.dataKey){var{type:n,scale:s}=r;if(i7(e,i)&&("number"===n||"auto"!==s))return t.map(e=>e.value)}},hw=rY([nU,um,ut,c$],hx),h_=rY([nU,(e,t,r)=>{switch(t){case"xAxis":return c4(e,r);case"yAxis":return c8(e,r);default:throw Error("Unexpected axis type: ".concat(t))}},u1,hs,hb,hw,hi,u4,c$],(e,t,r,i,n,s,a,o,l)=>{if(null==t)return null;var c=i7(e,l);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:l,categoricalDomain:s,duplicateDomain:n,isCategorical:c,niceTicks:o,range:a,realScaleType:r,scale:i}}),hk=rY([nU,ut,u1,hs,u4,hi,hb,hw,c$],(e,t,r,i,n,s,a,o,l)=>{if(null!=t&&null!=i){var c=i7(e,l),{type:u,ticks:h,tickCount:d}=t,f="scaleBand"===r&&"function"==typeof i.bandwidth?i.bandwidth()/2:2,p="category"===u&&i.bandwidth?i.bandwidth()/f:0;p="angleAxis"===l&&null!=s&&s.length>=2?2*eG(s[0]-s[1])*p:p;var g=h||n;return g?g.map((e,t)=>({index:t,coordinate:i(a?a.indexOf(e):e)+p,value:e,offset:p})).filter(e=>!eq(e.coordinate)):c&&o?o.map((e,t)=>({coordinate:i(e)+p,value:e,index:t,offset:p})):i.ticks?i.ticks(d).map(e=>({coordinate:i(e)+p,value:e,offset:p})):i.domain().map((e,t)=>({coordinate:i(e)+p,value:a?a[e]:e,index:t,offset:p}))}}),hP=rY([nU,ut,hs,hi,hb,hw,c$],(e,t,r,i,n,s,a)=>{if(null!=t&&null!=r&&null!=i&&i[0]!==i[1]){var o=i7(e,a),{tickCount:l}=t,c=0;return(c="angleAxis"===a&&(null==i?void 0:i.length)>=2?2*eG(i[0]-i[1])*c:c,o&&s)?s.map((e,t)=>({coordinate:r(e)+c,value:e,index:t,offset:c})):r.ticks?r.ticks(l).map(e=>({coordinate:r(e)+c,value:e,offset:c})):r.domain().map((e,t)=>({coordinate:r(e)+c,value:n?n[e]:e,index:t,offset:c}))}}),hS=rY(ue,hs,(e,t)=>{if(null!=e&&null!=t)return c0(c0({},e),{},{scale:t})}),hE=rY([ue,u1,uQ,hn],u2);rY((e,t,r)=>c9(e,r),hE,(e,t)=>{if(null!=e&&null!=t)return c0(c0({},e),{},{scale:t})});var hA=rY([nU,nd,nf],(e,t,r)=>{switch(e){case"horizontal":return t.some(e=>e.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(e=>e.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),hM=e=>e.options.defaultTooltipEventType,hT=e=>e.options.validateTooltipEventTypes;function hC(e,t,r){if(null==e)return t;var i=e?"axis":"item";return null==r?t:r.includes(i)?i:t}function hO(e,t){return hC(t,hM(e),hT(e))}var hI=(e,t)=>{var r,i=Number(t);if(!eq(i)&&null!=t)return i>=0?null==e||null==(r=e[i])?void 0:r.value:void 0},hL={active:!1,index:null,dataKey:void 0,coordinate:void 0},hj=ih({name:"tooltip",initialState:{itemInteraction:{click:hL,hover:hL},axisInteraction:{click:hL,hover:hL},keyboardInteraction:hL,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:is()},removeTooltipEntrySettings:{reducer(e,t){var r=rO(e).tooltipItemPayloads.indexOf(t.payload);r>-1&&e.tooltipItemPayloads.splice(r,1)},prepare:is()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:hN,removeTooltipEntrySettings:hD,setTooltipSettingsState:hR,setActiveMouseOverItemIndex:hz,mouseLeaveItem:hF,mouseLeaveChart:hB,setActiveClickItemIndex:hU,setMouseOverAxisIndex:h$,setMouseClickAxisIndex:hV,setSyncInteraction:hW,setKeyboardInteraction:hG}=hj.actions,hq=hj.reducer;function hH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function hK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hH(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hH(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var hZ=(e,t,r,i)=>{if(null==t)return hL;var n,s,a,o=(n=e,s=t,a=r,"axis"===s?"click"===a?n.axisInteraction.click:n.axisInteraction.hover:"click"===a?n.itemInteraction.click:n.itemInteraction.hover);if(null==o)return hL;if(o.active)return o;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&null!=e.syncInteraction.index)return e.syncInteraction;var l=!0===e.settings.active;if(null!=o.index){if(l)return hK(hK({},o),{},{active:!0})}else if(null!=i)return{active:!0,coordinate:void 0,dataKey:void 0,index:i};return hK(hK({},hL),{},{coordinate:o.coordinate})},hY=(e,t)=>{var r=null==e?void 0:e.index;if(null==r)return null;var i=Number(r);if(!e3(i))return r;var n=Infinity;return t.length>0&&(n=t.length-1),String(Math.max(0,Math.min(i,n)))},hX=(e,t,r,i,n,s,a,o)=>{if(null!=s&&null!=o){var l=a[0],c=null==l?void 0:o(l.positions,s);if(null!=c)return c;var u=null==n?void 0:n[Number(s)];if(u)if("horizontal"===r)return{x:u.coordinate,y:(i.top+t)/2};else return{x:(i.left+e)/2,y:u.coordinate}}},hJ=(e,t,r,i)=>{var n;return"axis"===t?e.tooltipItemPayloads:0===e.tooltipItemPayloads.length?[]:null==(n="hover"===r?e.itemInteraction.hover.dataKey:e.itemInteraction.click.dataKey)&&null!=i?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(e=>{var t;return(null==(t=e.settings)?void 0:t.dataKey)===n})},hQ=e=>e.options.tooltipPayloadSearcher,h0=e=>e.tooltip;function h1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function h2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h1(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var h3=(e,t,r,i,n,s,a)=>{if(null!=t&&null!=s){var{chartData:o,computedData:l,dataStartIndex:c,dataEndIndex:u}=r;return e.reduce((e,r)=>{var h,d,f,{dataDefinedOnItem:p,settings:g}=r,m=null!=p?p:o,y=Array.isArray(m)?i4(m,c,u):m,v=null!=(h=null==g?void 0:g.dataKey)?h:i,b=null==g?void 0:g.nameKey;return Array.isArray(d=i&&Array.isArray(y)&&!Array.isArray(y[0])&&"axis"===a?e1(y,i,n):s(y,t,l,b))?d.forEach(t=>{var r=h2(h2({},g),{},{name:t.name,unit:t.unit,color:void 0,fill:void 0});e.push(na({tooltipEntrySettings:r,dataKey:t.dataKey,payload:t.payload,value:i8(t.payload,t.dataKey),name:t.name}))}):e.push(na({tooltipEntrySettings:g,dataKey:v,payload:d,value:i8(d,v),name:null!=(f=i8(d,b))?f:null==g?void 0:g.name})),e},[])}},h4=rY([cH,nU,ur,cz,cG],u0),h5=rY([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),h6=rY([cG,cq],ui),h8=rY([h5,cH,h6],ua,{memoizeOptions:{resultEqualityCheck:cJ}}),h7=rY([h8],e=>e.filter(cY)),h9=rY([h8],uh,{memoizeOptions:{resultEqualityCheck:cJ}}),de=rY([h9,cp],uf),dt=rY([h7,cp,cH],cZ),dr=rY([de,cH,h8],ug),di=rY([cH],uE),dn=rY([cH],e=>e.allowDataOverflow),ds=rY([di,dn],cb),da=rY([h8],e=>e.filter(cY)),dl=rY([dt,da,cR],u_),dc=rY([dl,cp,cG,ds],uP),du=rY([h8],uc),dh=rY([de,cH,du,uC,cG],uI,{memoizeOptions:{resultEqualityCheck:cX}}),dd=rY([uN,cG,cq],uD),df=rY([dd,cG],u$),dp=rY([uz,cG,cq],uD),dg=rY([dp,cG],uW),dm=rY([uB,cG,cq],uD),dy=rY([dm,cG],uq),dv=rY([df,dy,dg],uO),db=rY([cH,di,ds,dc,dh,dv,nU,cG],uZ),dx=rY([cH,nU,de,dr,cR,cG,db],uJ),dw=rY([dx,cH,h4],u3),d_=rY([cH,dx,dw,cG],u5),dk=e=>{var t=cG(e),r=cq(e);return hi(e,t,r,!1)},dP=rY([cH,dk],nG),dS=rY([cH,h4,d_,dP],u2),dE=rY([nU,dr,cH,cG],hv),dA=rY([nU,dr,cH,cG],hx),dM=rY([nU,cH,h4,dS,dk,dE,dA,cG],(e,t,r,i,n,s,a,o)=>{if(t){var{type:l}=t,c=i7(e,o);if(i){var u="scaleBand"===r&&i.bandwidth?i.bandwidth()/2:2,h="category"===l&&i.bandwidth?i.bandwidth()/u:0;return(h="angleAxis"===o&&null!=n&&(null==n?void 0:n.length)>=2?2*eG(n[0]-n[1])*h:h,c&&a)?a.map((e,t)=>({coordinate:i(e)+h,value:e,index:t,offset:h})):i.domain().map((e,t)=>({coordinate:i(e)+h,value:s?s[e]:e,index:t,offset:h}))}}}),dT=rY([hM,hT,e=>e.tooltip.settings],(e,t,r)=>hC(r.shared,e,t)),dC=e=>e.tooltip.settings.trigger,dO=e=>e.tooltip.settings.defaultIndex,dI=rY([h0,dT,dC,dO],hZ),dL=rY([dI,de],hY),dj=rY([dM,dL],hI),dN=rY([dI],e=>{if(e)return e.dataKey}),dD=rY([h0,dT,dC,dO],hJ),dR=rY([nl,nc,nU,nm,dM,dO,dD,hQ],hX),dz=rY([dI,dR],(e,t)=>null!=e&&e.coordinate?e.coordinate:t),dF=rY([dI],e=>e.active),dB=rY([dD,dL,cp,cK,dj,hQ,dT],h3),dU=rY([dB],e=>{if(null!=e)return Array.from(new Set(e.map(e=>e.payload).filter(e=>null!=e)))});function d$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function dV(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d$(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var dW=ih({name:"cartesianAxis",initialState:{xAxis:{},yAxis:{},zAxis:{}},reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:is()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:is()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:is()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:is()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:is()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:is()},updateYAxisWidth(e,t){var{id:r,width:i}=t.payload,n=e.yAxis[r];if(n){var s=n.widthHistory||[];if(3===s.length&&s[0]===s[2]&&i===s[1]&&i!==n.width&&1>=Math.abs(i-s[0]))return;var a=[...s,i].slice(-3);e.yAxis[r]=dV(dV({},e.yAxis[r]),{},{width:i,widthHistory:a})}}}}),{addXAxis:dG,removeXAxis:dq,addYAxis:dH,removeYAxis:dK,addZAxis:dZ,removeZAxis:dY,updateYAxisWidth:dX}=dW.actions,dJ=dW.reducer,dQ=rY([nm],e=>{if(e)return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}),d0=rY([dQ,nl,nc],(e,t,r)=>{if(e&&null!=t&&null!=r)return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,r-e.top-e.bottom)}});function d1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function d2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d1(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d3(e){var{points:t,mainColor:r,activeDot:i,itemDataKey:n}=e,s=t0(dL),a=t0(dU);if(null==t||null==a)return null;var o=t.find(e=>a.includes(e.payload));return null==o?null:(e=>{var t,{point:r,childIndex:i,mainColor:n,activeDot:s,dataKey:a}=e;if(!1===s||null==r.x||null==r.y)return null;var o=d2(d2({index:i,dataKey:a,cx:r.x,cy:r.y,r:4,fill:null!=n?n:"none",strokeWidth:2,stroke:"#fff",payload:r.payload,value:r.value},e9(s)),eV(s));return t=(0,Q.isValidElement)(s)?(0,Q.cloneElement)(s,o):"function"==typeof s?s(o):Q.createElement(tc,o),Q.createElement(tp,{className:"recharts-active-dot"},t)})({point:o,childIndex:Number(s),mainColor:r,dataKey:n,activeDot:i})}function d4(e){var{fn:t,args:r}=e,i=tY(),n=nx();return(0,Q.useLayoutEffect)(()=>{if(!n){var e=t(r);return i(hN(e)),()=>{i(hD(e))}}},[t,r,i,n]),null}function d5(e,t){var r,i,n=t0(t=>c4(t,e)),s=t0(e=>c8(e,t)),a=null!=(r=null==n?void 0:n.allowDataOverflow)?r:c2.allowDataOverflow,o=null!=(i=null==s?void 0:s.allowDataOverflow)?i:c5.allowDataOverflow;return{needClip:a||o,needClipX:a,needClipY:o}}function d6(e){var{xAxisId:t,yAxisId:r,clipPathId:i}=e,n=t0(d0),{needClipX:s,needClipY:a,needClip:o}=d5(t,r);if(!o)return null;var{x:l,y:c,width:u,height:h}=n;return Q.createElement("clipPath",{id:"clipPath-".concat(i)},Q.createElement("rect",{x:s?l:l-u/2,y:a?c:c-h/2,width:s?u:2*u,height:a?h:2*h}))}var d8=(e,t,r,i)=>hS(e,"xAxis",t,i),d7=(e,t,r,i)=>hP(e,"xAxis",t,i),d9=(e,t,r,i)=>hS(e,"yAxis",r,i),fe=(e,t,r,i)=>hP(e,"yAxis",r,i),ft=rY([nU,d8,d9,d7,fe],(e,t,r,i,n)=>i7(e,"xAxis")?ns(t,i,!1):ns(r,n,!1)),fr=rY([un,(e,t,r,i,n)=>n],(e,t)=>e.filter(e=>"area"===e.type).find(e=>e.id===t)),fi=rY([nU,d8,d9,d7,fe,(e,t,r,i,n)=>{var s,a,o=fr(e,t,r,i,n);if(null!=o&&null!=(a=i7(nU(e),"xAxis")?uk(e,"yAxis",r,i):uk(e,"xAxis",t,i))){var{stackId:l}=o,c=cW(o);if(null!=l&&null!=c){var u=null==(s=a[l])?void 0:s.stackedData;return null==u?void 0:u.find(e=>e.key===c)}}},cm,ft,fr],(e,t,r,i,n,s,a,o,l)=>{var c,{chartData:u,dataStartIndex:h,dataEndIndex:d}=a;if(null!=l&&("horizontal"===e||"vertical"===e)&&null!=t&&null!=r&&null!=i&&null!=n&&0!==i.length&&0!==n.length&&null!=o){var{data:f}=l;if(null!=(c=f&&f.length>0?f:null==u?void 0:u.slice(h,d+1)))return function(e){var t,{areaSettings:{connectNulls:r,baseValue:i,dataKey:n},stackedData:s,layout:a,chartBaseValue:o,xAxis:l,yAxis:c,displayedData:u,dataStartIndex:h,xAxisTicks:d,yAxisTicks:f,bandSize:p}=e,g=s&&s.length,m=((e,t,r,i,n)=>{var s=null!=r?r:t;if(eK(s))return s;var a="horizontal"===e?n:i,o=a.scale.domain();if("number"===a.type){var l=Math.max(o[0],o[1]),c=Math.min(o[0],o[1]);return"dataMin"===s?c:"dataMax"===s||l<0?l:Math.max(Math.min(o[0],o[1]),0)}return"dataMin"===s?o[0]:"dataMax"===s?o[1]:o[0]})(a,o,i,l,c),y="horizontal"===a,v=!1,b=u.map((e,t)=>{g?i=s[h+t]:Array.isArray(i=i8(e,n))?v=!0:i=[m,i];var i,a=null==i[1]||g&&!r&&null==i8(e,n);return y?{x:nr({axis:l,ticks:d,bandSize:p,entry:e,index:t}),y:a?null:c.scale(i[1]),value:i,payload:e}:{x:a?null:l.scale(i[1]),y:nr({axis:c,ticks:f,bandSize:p,entry:e,index:t}),value:i,payload:e}});return t=g||v?b.map(e=>{var t=Array.isArray(e.value)?e.value[0]:null;return y?{x:e.x,y:null!=t&&null!=e.y?c.scale(t):null,payload:e.payload}:{x:null!=t?l.scale(t):null,y:e.y,payload:e.payload}}):y?c.scale(m):l.scale(m),{points:b,baseLine:t,isRange:v}}({layout:e,xAxis:t,yAxis:r,xAxisTicks:i,yAxisTicks:n,dataStartIndex:h,areaSettings:l,stackedData:s,displayedData:c,chartBaseValue:void 0,bandSize:o})}}),fn=(e,t)=>t,fs=(e,t,r)=>r,fa=(e,t,r,i)=>i,fo=rY(dM,e=>(0,iJ.default)(e,e=>e.coordinate)),fl=rY([h0,fn,fs,fa],hZ),fc=rY([fl,de],hY),fu=rY([h0,fn,fs,fa],hJ),fh=rY([nl,nc,nU,nm,dM,fa,fu,hQ],hX),fd=rY([fl,fh],(e,t)=>{var r;return null!=(r=e.coordinate)?r:t}),ff=rY(dM,fc,hI),fp=rY([fu,fc,cp,cK,ff,hQ,fn],h3),fg=rY([fl],e=>({isActive:e.active,activeIndex:e.index})),fm=ih({name:"legend",initialState:{settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:is()},removeLegendPayload:{reducer(e,t){var r=rO(e).payload.indexOf(t.payload);r>-1&&e.payload.splice(r,1)},prepare:is()}}}),{setLegendSize:fy,setLegendSettings:fv,addLegendPayload:fb,removeLegendPayload:fx}=fm.actions,fw=fm.reducer,f_=()=>{};function fk(e){var{legendPayload:t}=e,r=tY(),i=nx();return(0,Q.useLayoutEffect)(()=>i?f_:(r(fb(t)),()=>{r(fx(t))}),[r,i,t]),null}function fP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"animation-",r=(0,Q.useRef)(eX(t)),i=(0,Q.useRef)(e);return i.current!==e&&(r.current=eX(t),i.current=e),r.current}var fS=null!=(U=Q["useId".toString()])?U:()=>{var[e]=Q.useState(()=>eX("uid-"));return e},fE=(0,Q.createContext)(void 0),fA=e=>{var t,r,{id:i,type:n,children:s}=e,a=(t="recharts-".concat(n),r=fS(),i||(t?"".concat(t,"-").concat(r):r));return Q.createElement(fE.Provider,{value:a},s(a))},fM=ih({name:"graphicalItems",initialState:{cartesianItems:[],polarItems:[]},reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:is()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:r,next:i}=t.payload,n=rO(e).cartesianItems.indexOf(r);n>-1&&(e.cartesianItems[n]=i)},prepare:is()},removeCartesianGraphicalItem:{reducer(e,t){var r=rO(e).cartesianItems.indexOf(t.payload);r>-1&&e.cartesianItems.splice(r,1)},prepare:is()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:is()},removePolarGraphicalItem:{reducer(e,t){var r=rO(e).polarItems.indexOf(t.payload);r>-1&&e.polarItems.splice(r,1)},prepare:is()}}}),{addCartesianGraphicalItem:fT,replaceCartesianGraphicalItem:fC,removeCartesianGraphicalItem:fO,addPolarGraphicalItem:fI,removePolarGraphicalItem:fL}=fM.actions,fj=fM.reducer;function fN(e){var t=tY(),r=(0,Q.useRef)(null);return(0,Q.useLayoutEffect)(()=>{null===r.current?t(fT(e)):r.current!==e&&t(fC({prev:r.current,next:e})),r.current=e},[t,e]),(0,Q.useLayoutEffect)(()=>()=>{r.current&&(t(fO(r.current)),r.current=null)},[t]),null}function fD(){}function fR(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function fz(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fR(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fR(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var fF=(e,t)=>Object.keys(t).reduce((r,i)=>fz(fz({},r),{},{[i]:e(i,t[i])}),{});function fB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function fU(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fB(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var f$=(e,t,r)=>e+(t-e)*r,fV=e=>{var{from:t,to:r}=e;return t!==r},fW=(e,t,r)=>{var i=fF((t,r)=>{if(fV(r)){var[i,n]=e(r.from,r.to,r.velocity);return fU(fU({},r),{},{from:i,velocity:n})}return r},t);return r<1?fF((e,t)=>fV(t)?fU(fU({},t),{},{velocity:f$(t.velocity,i[e].velocity,r),from:f$(t.from,i[e].from,r)}):t,t):fW(e,i,r-1)},fG=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],fq=(e,t)=>e.map((e,r)=>e*t**r).reduce((e,t)=>e+t),fH=(e,t)=>r=>fq(fG(e,t),r),fK=function(){let e,t;for(var r,i,n,s,a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];if(1===o.length)switch(o[0]){case"linear":[r,n,i,s]=[0,0,1,1];break;case"ease":[r,n,i,s]=[.25,.1,.25,1];break;case"ease-in":[r,n,i,s]=[.42,0,1,1];break;case"ease-out":[r,n,i,s]=[.42,0,.58,1];break;case"ease-in-out":[r,n,i,s]=[0,0,.58,1];break;default:var c=o[0].split("(");"cubic-bezier"===c[0]&&4===c[1].split(")")[0].split(",").length&&([r,n,i,s]=c[1].split(")")[0].split(",").map(e=>parseFloat(e)))}else 4===o.length&&([r,n,i,s]=o);var u=fH(r,i),h=fH(n,s),d=(e=r,t=i,r=>fq([...fG(e,t).map((e,t)=>e*t).slice(1),0],r)),f=e=>e>1?1:e<0?0:e,p=e=>{for(var t=e>1?1:e,r=t,i=0;i<8;++i){var n=u(r)-t,s=d(r);if(1e-4>Math.abs(n-t)||s<1e-4)break;r=f(r-n/s)}return h(r)};return p.isStepper=!1,p},fZ=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stiff:t=100,damping:r=8,dt:i=17}=e,n=(e,n,s)=>{var a=s+(-(e-n)*t-s*r)*i/1e3,o=s*i/1e3+e;return 1e-4>Math.abs(o-n)&&1e-4>Math.abs(a)?[n,0]:[o,a]};return n.isStepper=!0,n.dt=i,n};class fY{setTimeout(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=performance.now(),i=null,n=s=>{s-r>=t?e(s):"function"==typeof requestAnimationFrame&&(i=requestAnimationFrame(n))};return i=requestAnimationFrame(n),()=>{cancelAnimationFrame(i)}}}var fX=(0,Q.createContext)(function(){var e,t,r,i,n;return e=new fY,t=()=>null,r=!1,i=null,n=s=>{if(!r){if(Array.isArray(s)){if(!s.length)return;var[a,...o]=s;if("number"==typeof a){i=e.setTimeout(n.bind(null,o),a);return}n(a),i=e.setTimeout(n.bind(null,o));return}"string"==typeof s&&t(s),"object"==typeof s&&t(s),"function"==typeof s&&s()}},{stop:()=>{r=!0},start:e=>{r=!1,i&&(i(),i=null),n(e)},subscribe:e=>(t=e,()=>{t=()=>null}),getTimeoutController:()=>e}}),fJ={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},fQ={t:0},f0={t:1};function f1(e){var t,r,i,n=n6(e,fJ),{isActive:s,canBegin:a,duration:o,easing:l,begin:c,onAnimationEnd:u,onAnimationStart:h,children:d}=n,f=(t=n.animationId,r=n.animationManager,i=(0,Q.useContext)(fX),(0,Q.useMemo)(()=>null!=r?r:i(t),[t,r,i])),[p,g]=(0,Q.useState)(s?fQ:f0),m=(0,Q.useRef)(null);return(0,Q.useEffect)(()=>{s||g(f0)},[s]),(0,Q.useEffect)(()=>{if(!s||!a)return fD;var e,t,r,i,n,d,p,y,v,b,x,w=(e=(e=>{if("string"==typeof e)switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return fK(e);case"spring":return fZ();default:if("cubic-bezier"===e.split("(")[0])return fK(e)}return"function"==typeof e?e:null})(l),t=f.getTimeoutController(),r=[Object.keys(fQ),Object.keys(f0)].reduce((e,t)=>e.filter(e=>t.includes(e))),!0===e.isStepper?(n=r.reduce((e,t)=>fU(fU({},e),{},{[t]:{from:fQ[t],velocity:0,to:f0[t]}}),{}),d=null,p=r=>{i||(i=r);var s=(r-i)/e.dt;n=fW(e,n,s),g(fU(fU(fU({},fQ),f0),fF((e,t)=>t.from,n))),i=r,Object.values(n).filter(fV).length&&(d=t.setTimeout(p))},()=>(d=t.setTimeout(p),()=>{d()})):(v=null,b=r.reduce((e,t)=>fU(fU({},e),{},{[t]:[fQ[t],f0[t]]}),{}),x=r=>{y||(y=r);var i=(r-y)/o,n=fF((t,r)=>f$(...r,e(i)),b);if(g(fU(fU(fU({},fQ),f0),n)),i<1)v=t.setTimeout(x);else{var s=fF((t,r)=>f$(...r,e(1)),b);g(fU(fU(fU({},fQ),f0),s))}},()=>(v=t.setTimeout(x),()=>{v()})));return f.start([h,c,()=>{m.current=w()},o,u]),()=>{f.stop(),m.current&&m.current(),u()}},[s,a,o,l,c,h,u,f]),d(p.t)}function f2(e){var t=e9(e);if(null!=t){var{r,strokeWidth:i}=t,n=Number(r),s=Number(i);return(Number.isNaN(n)||n<0)&&(n=3),(Number.isNaN(s)||s<0)&&(s=2),{r:n,strokeWidth:s}}return{r:3,strokeWidth:2}}var f3=["id"],f4=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function f5(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function f6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function f8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f6(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f6(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function f7(){return(f7=Object.assign.bind()).apply(null,arguments)}function f9(e,t){return e&&"none"!==e?e:t}function pe(e){var{dataKey:t,data:r,stroke:i,strokeWidth:n,fill:s,name:a,hide:o,unit:l}=e;return{dataDefinedOnItem:r,positions:void 0,settings:{stroke:i,strokeWidth:n,fill:s,dataKey:t,nameKey:void 0,name:no(a,t),hide:o,type:e.tooltipType,color:f9(i,s),unit:l}}}function pt(e){var{clipPathId:t,points:r,props:i}=e,{needClip:n,dot:s,dataKey:a}=i;if(null==r||!s&&1!==r.length)return null;var o=sx(s),l=e7(i),c=th(s),u=r.map((e,t)=>{var i,n=f8(f8(f8({key:"dot-".concat(t),r:3},l),c),{},{index:t,cx:e.x,cy:e.y,dataKey:a,value:e.value,payload:e.payload,points:r});if(ec.isValidElement(s))i=ec.cloneElement(s,n);else if("function"==typeof s)i=s(n);else{var o=eu("recharts-area-dot","boolean"!=typeof s?s.className:"");i=ec.createElement(tc,f7({},n,{className:o}))}return i}),h={clipPath:n?"url(#clipPath-".concat(o?"":"dots-").concat(t,")"):void 0};return ec.createElement(tp,f7({className:"recharts-area-dots"},h),u)}function pr(e){var{showLabels:t,children:r,points:i}=e,n=i.map(e=>{var t={x:e.x,y:e.y,width:0,height:0};return f8(f8({},t),{},{value:e.value,payload:e.payload,parentViewBox:void 0,viewBox:t,fill:void 0})});return ec.createElement(sm,{value:t?n:null},r)}function pi(e){var{points:t,baseLine:r,needClip:i,clipPathId:n,props:s}=e,{layout:a,type:o,stroke:l,connectNulls:c,isRange:u}=s,{id:h}=s,d=f5(s,f3),f=e7(d);return ec.createElement(ec.Fragment,null,(null==t?void 0:t.length)>1&&ec.createElement(tp,{clipPath:i?"url(#clipPath-".concat(n,")"):void 0},ec.createElement(to,f7({},f,{id:h,points:t,connectNulls:c,type:o,baseLine:r,layout:a,stroke:"none",className:"recharts-area-area"})),"none"!==l&&ec.createElement(to,f7({},f,{className:"recharts-area-curve",layout:a,type:o,connectNulls:c,fill:"none",points:t})),"none"!==l&&u&&ec.createElement(to,f7({},f,{className:"recharts-area-curve",layout:a,type:o,connectNulls:c,fill:"none",points:r}))),ec.createElement(pt,{points:t,props:d,clipPathId:n}))}function pn(e){var{alpha:t,baseLine:r,points:i,strokeWidth:n}=e,s=i[0].y,a=i[i.length-1].y;if(!e3(s)||!e3(a))return null;var o=t*Math.abs(s-a),l=Math.max(...i.map(e=>e.x||0));return(eK(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(e=>e.x||0),l)),eK(l))?ec.createElement("rect",{x:0,y:s<a?s:s-o,width:l+(n?parseInt("".concat(n),10):1),height:Math.floor(o)}):null}function ps(e){var{alpha:t,baseLine:r,points:i,strokeWidth:n}=e,s=i[0].x,a=i[i.length-1].x;if(!e3(s)||!e3(a))return null;var o=t*Math.abs(s-a),l=Math.max(...i.map(e=>e.y||0));return(eK(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(e=>e.y||0),l)),eK(l))?ec.createElement("rect",{x:s<a?s:s-o,y:0,width:o,height:Math.floor(l+(n?parseInt("".concat(n),10):1))}):null}function pa(e){var{alpha:t,layout:r,points:i,baseLine:n,strokeWidth:s}=e;return"vertical"===r?ec.createElement(pn,{alpha:t,points:i,baseLine:n,strokeWidth:s}):ec.createElement(ps,{alpha:t,points:i,baseLine:n,strokeWidth:s})}function po(e){var{needClip:t,clipPathId:r,props:i,previousPointsRef:n,previousBaselineRef:s}=e,{points:a,baseLine:o,isAnimationActive:l,animationBegin:c,animationDuration:u,animationEasing:h,onAnimationStart:d,onAnimationEnd:f}=i,p=fP(i,"recharts-area-"),[g,m]=(0,ec.useState)(!1),y=(0,ec.useCallback)(()=>{"function"==typeof f&&f(),m(!1)},[f]),v=(0,ec.useCallback)(()=>{"function"==typeof d&&d(),m(!0)},[d]),b=n.current,x=s.current;return ec.createElement(pr,{showLabels:!g,points:a},i.children,ec.createElement(f1,{animationId:p,begin:c,duration:u,isActive:l,easing:h,onAnimationEnd:y,onAnimationStart:v,key:p},e=>{if(b){var c,u=b.length/a.length,h=1===e?a:a.map((t,r)=>{var i=Math.floor(r*u);if(b[i]){var n=b[i];return f8(f8({},t),{},{x:e0(n.x,t.x,e),y:e0(n.y,t.y,e)})}return t});if(eK(o))c=e0(x,o,e);else c=null==o||eq(o)?e0(x,0,e):o.map((t,r)=>{var i=Math.floor(r*u);if(Array.isArray(x)&&x[i]){var n=x[i];return f8(f8({},t),{},{x:e0(n.x,t.x,e),y:e0(n.y,t.y,e)})}return t});return e>0&&(n.current=h,s.current=c),ec.createElement(pi,{points:h,baseLine:c,needClip:t,clipPathId:r,props:i})}return e>0&&(n.current=a,s.current=o),ec.createElement(tp,null,l&&ec.createElement("defs",null,ec.createElement("clipPath",{id:"animationClipPath-".concat(r)},ec.createElement(pa,{alpha:e,points:a,baseLine:o,layout:i.layout,strokeWidth:i.strokeWidth}))),ec.createElement(tp,{clipPath:"url(#animationClipPath-".concat(r,")")},ec.createElement(pi,{points:a,baseLine:o,needClip:t,clipPathId:r,props:i})))}),ec.createElement(sb,{label:i.label}))}function pl(e){var{needClip:t,clipPathId:r,props:i}=e,n=(0,ec.useRef)(null),s=(0,ec.useRef)();return ec.createElement(po,{needClip:t,clipPathId:r,props:i,previousPointsRef:n,previousBaselineRef:s})}class pc extends ec.PureComponent{render(){var{hide:e,dot:t,points:r,className:i,top:n,left:s,needClip:a,xAxisId:o,yAxisId:l,width:c,height:u,id:h,baseLine:d}=this.props;if(e)return null;var f=eu("recharts-area",i),{r:p,strokeWidth:g}=f2(t),m=sx(t),y=2*p+g;return ec.createElement(ec.Fragment,null,ec.createElement(tp,{className:f},a&&ec.createElement("defs",null,ec.createElement(d6,{clipPathId:h,xAxisId:o,yAxisId:l}),!m&&ec.createElement("clipPath",{id:"clipPath-dots-".concat(h)},ec.createElement("rect",{x:s-y/2,y:n-y/2,width:c+y,height:u+y}))),ec.createElement(pl,{needClip:a,clipPathId:h,props:this.props})),ec.createElement(d3,{points:r,mainColor:f9(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}),this.props.isRange&&Array.isArray(d)&&ec.createElement(d3,{points:d,mainColor:f9(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}))}}var pu={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:!tm.isSsr,legendType:"line",stroke:"#3182bd",xAxisId:0,yAxisId:0};function ph(e){var t,r=n6(e,pu),{activeDot:i,animationBegin:n,animationDuration:s,animationEasing:a,connectNulls:o,dot:l,fill:c,fillOpacity:u,hide:h,isAnimationActive:d,legendType:f,stroke:p,xAxisId:g,yAxisId:m}=r,y=f5(r,f4),v=t0(nU),b=t0(cz),{needClip:x}=d5(g,m),w=nx(),{points:_,isRange:k,baseLine:P}=null!=(t=t0(t=>fi(t,g,m,w,e.id)))?t:{},S=t0(d0);if("horizontal"!==v&&"vertical"!==v||null==S||"AreaChart"!==b&&"ComposedChart"!==b)return null;var{height:E,width:A,x:M,y:T}=S;return _&&_.length?ec.createElement(pc,f7({},y,{activeDot:i,animationBegin:n,animationDuration:s,animationEasing:a,baseLine:P,connectNulls:o,dot:l,fill:c,fillOpacity:u,height:E,hide:h,layout:v,isAnimationActive:d,isRange:k,legendType:f,needClip:x,points:_,stroke:p,width:A,left:M,top:T,xAxisId:g,yAxisId:m})):null}var pd=ec.memo(function(e){var t=n6(e,pu),r=nx();return ec.createElement(fA,{id:t.id,type:"area"},e=>{var i;return ec.createElement(ec.Fragment,null,ec.createElement(fk,{legendPayload:(e=>{var{dataKey:t,name:r,stroke:i,fill:n,legendType:s,hide:a}=e;return[{inactive:a,dataKey:t,type:s,color:f9(i,n),value:no(r,t),payload:e}]})(t)}),ec.createElement(d4,{fn:pe,args:t}),ec.createElement(fN,{type:"area",id:e,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:null==(i=t.stackId)?void 0:String(i),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:r,connectNulls:t.connectNulls}),ec.createElement(ph,f7({},t,{id:e})))})});function pf(e,t){if(t){var r=Number.parseInt(t,10);if(!eq(r))return null==e?void 0:e[r]}}pd.displayName="Area";var pp=ih({name:"options",initialState:{chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},reducers:{createEventEmitter:e=>{null==e.eventEmitter&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),pg=pp.reducer,{createEventEmitter:pm}=pp.actions,py=(e.i(13027),{notify(){},get:()=>[]}),pv="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,pb="undefined"!=typeof navigator&&"ReactNative"===navigator.product,px=pv||pb?Q.useLayoutEffect:Q.useEffect,pw=Symbol.for("react-redux-context"),p_="undefined"!=typeof globalThis?globalThis:{},pk=function(){if(!Q.createContext)return{};let e=p_[pw]??=new Map,t=e.get(Q.createContext);return t||(t=Q.createContext(null),e.set(Q.createContext,t)),t}(),pP=function(e){let{children:t,context:r,serverState:i,store:n}=e,s=Q.useMemo(()=>{let e=function(e,t){let r,i=py,n=0,s=!1;function a(){c.onStateChange&&c.onStateChange()}function o(){if(n++,!r){let t,n;r=e.subscribe(a),t=null,n=null,i={clear(){t=null,n=null},notify(){let e=t;for(;e;)e.callback(),e=e.next},get(){let e=[],r=t;for(;r;)e.push(r),r=r.next;return e},subscribe(e){let r=!0,i=n={callback:e,next:null,prev:n};return i.prev?i.prev.next=i:t=i,function(){r&&null!==t&&(r=!1,i.next?i.next.prev=i.prev:n=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}}function l(){n--,r&&0===n&&(r(),r=void 0,i.clear(),i=py)}let c={addNestedSub:function(e){o();let t=i.subscribe(e),r=!1;return()=>{r||(r=!0,t(),l())}},notifyNestedSubs:function(){i.notify()},handleChangeWrapper:a,isSubscribed:function(){return s},trySubscribe:function(){s||(s=!0,o())},tryUnsubscribe:function(){s&&(s=!1,l())},getListeners:()=>i};return c}(n);return{store:n,subscription:e,getServerState:i?()=>i:void 0}},[n,i]),a=Q.useMemo(()=>n.getState(),[n]);return px(()=>{let{subscription:e}=s;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),a!==n.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}},[s,a]),Q.createElement((r||pk).Provider,{value:s},t)};function pS(e=pk){return function(){return Q.useContext(e)}}var pE=pS(),pA=ih({name:"chartData",initialState:{chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},reducers:{setChartData(e,t){if(e.chartData=t.payload,null==t.payload){e.dataStartIndex=0,e.dataEndIndex=0;return}t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:r,endIndex:i}=t.payload;null!=r&&(e.dataStartIndex=r),null!=i&&(e.dataEndIndex=i)}}}),{setChartData:pM,setDataStartEndIndexes:pT,setComputedData:pC}=pA.actions,pO=pA.reducer,pI=rY([(e,t)=>t,nU,n4,cG,dP,dM,fo,nm],(e,t,r,i,n,s,a,o)=>{if(e&&t&&i&&n&&s){var l=(c=e.chartX,u=e.chartY,"horizontal"===t||"vertical"===t?c>=o.left&&c<=o.left+o.width&&u>=o.top&&u<=o.top+o.height?{x:c,y:u}:null:r?((e,t)=>{var r,{x:i,y:n}=e,{radius:s,angle:a}=((e,t)=>{var{x:r,y:i}=e,{cx:n,cy:s}=t,a=((e,t)=>{var{x:r,y:i}=e,{x:n,y:s}=t;return Math.sqrt((r-n)**2+(i-s)**2)})({x:r,y:i},{x:n,y:s});if(a<=0)return{radius:a,angle:0};var o=Math.acos((r-n)/a);return i>s&&(o=2*Math.PI-o),{radius:a,angle:180*o/Math.PI,angleInRadian:o}})({x:i,y:n},t),{innerRadius:o,outerRadius:l}=t;if(s<o||s>l||0===s)return null;var{startAngle:c,endAngle:u}=(e=>{var{startAngle:t,endAngle:r}=e,i=Math.min(Math.floor(t/360),Math.floor(r/360));return{startAngle:t-360*i,endAngle:r-360*i}})(t),h=a;if(c<=u){for(;h>u;)h-=360;for(;h<c;)h+=360;r=h>=c&&h<=u}else{for(;h>c;)h-=360;for(;h<u;)h+=360;r=h>=u&&h<=c}return r?tW(tW({},t),{},{radius:s,angle:((e,t)=>{var{startAngle:r,endAngle:i}=t;return e+360*Math.min(Math.floor(r/360),Math.floor(i/360))})(h,t)}):null})({x:c,y:u},r):null);if(l){var c,u,h=((e,t,r,i,n)=>{var s,a=-1,o=null!=(s=null==t?void 0:t.length)?s:0;if(o<=1||null==e)return 0;if("angleAxis"===i&&null!=n&&1e-6>=Math.abs(Math.abs(n[1]-n[0])-360))for(var l=0;l<o;l++){var c=l>0?r[l-1].coordinate:r[o-1].coordinate,u=r[l].coordinate,h=l>=o-1?r[0].coordinate:r[l+1].coordinate,d=void 0;if(eG(u-c)!==eG(h-u)){var f=[];if(eG(h-u)===eG(n[1]-n[0])){d=h;var p=u+n[1]-n[0];f[0]=Math.min(p,(p+c)/2),f[1]=Math.max(p,(p+c)/2)}else{d=c;var g=h+n[1]-n[0];f[0]=Math.min(u,(g+u)/2),f[1]=Math.max(u,(g+u)/2)}var m=[Math.min(u,(d+u)/2),Math.max(u,(d+u)/2)];if(e>m[0]&&e<=m[1]||e>=f[0]&&e<=f[1]){({index:a}=r[l]);break}}else{var y=Math.min(c,h),v=Math.max(c,h);if(e>(y+u)/2&&e<=(v+u)/2){({index:a}=r[l]);break}}}else if(t){for(var b=0;b<o;b++)if(0===b&&e<=(t[b].coordinate+t[b+1].coordinate)/2||b>0&&b<o-1&&e>(t[b].coordinate+t[b-1].coordinate)/2&&e<=(t[b].coordinate+t[b+1].coordinate)/2||b===o-1&&e>(t[b].coordinate+t[b-1].coordinate)/2){({index:a}=t[b]);break}}return a})("horizontal"===t?l.x:"vertical"===t?l.y:"centric"===t?l.angle:l.radius,a,s,i,n),d=((e,t,r,i)=>{var n=t.find(e=>e&&e.index===r);if(n){if("horizontal"===e)return{x:n.coordinate,y:i.y};if("vertical"===e)return{x:i.x,y:n.coordinate};if("centric"===e){var s=n.coordinate,{radius:a}=i;return i6(i6(i6({},i),tq(i.cx,i.cy,a,s)),{},{angle:s,radius:a})}var o=n.coordinate,{angle:l}=i;return i6(i6(i6({},i),tq(i.cx,i.cy,o,l)),{},{angle:l,radius:o})}return{x:0,y:0}})(t,s,h,l);return{activeIndex:String(h),activeCoordinate:d}}}}),pL=e=>{var t=e.currentTarget.getBoundingClientRect(),r=t.width/e.currentTarget.offsetWidth,i=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/r),chartY:Math.round((e.clientY-t.top)/i)}},pj=r9("mouseClick"),pN=iW();pN.startListening({actionCreator:pj,effect:(e,t)=>{var r=e.payload,i=pI(t.getState(),pL(r));(null==i?void 0:i.activeIndex)!=null&&t.dispatch(hV({activeIndex:i.activeIndex,activeDataKey:void 0,activeCoordinate:i.activeCoordinate}))}});var pD=r9("mouseMove"),pR=iW();function pz(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":t}pR.startListening({actionCreator:pD,effect:(e,t)=>{var r=e.payload,i=t.getState(),n=hO(i,i.tooltip.settings.shared),s=pI(i,pL(r));"axis"===n&&((null==s?void 0:s.activeIndex)!=null?t.dispatch(h$({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate})):t.dispatch(hB()))}});var pF=ih({name:"referenceElements",initialState:{dots:[],areas:[],lines:[]},reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var r=rO(e).dots.findIndex(e=>e===t.payload);-1!==r&&e.dots.splice(r,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var r=rO(e).areas.findIndex(e=>e===t.payload);-1!==r&&e.areas.splice(r,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var r=rO(e).lines.findIndex(e=>e===t.payload);-1!==r&&e.lines.splice(r,1)}}}),{addDot:pB,removeDot:pU,addArea:p$,removeArea:pV,addLine:pW,removeLine:pG}=pF.actions,pq=pF.reducer,pH={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},pK=ih({name:"brush",initialState:pH,reducers:{setBrushSettings:(e,t)=>null==t.payload?pH:t.payload}}),{setBrushSettings:pZ}=pK.actions,pY=pK.reducer,pX={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},pJ=ih({name:"rootProps",initialState:pX,reducers:{updateOptions:(e,t)=>{var r;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=null!=(r=t.payload.barGap)?r:pX.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className}}}),pQ=pJ.reducer,{updateOptions:p0}=pJ.actions,p1=ih({name:"polarAxis",initialState:{radiusAxis:{},angleAxis:{}},reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:p2,removeRadiusAxis:p3,addAngleAxis:p4,removeAngleAxis:p5}=p1.actions,p6=p1.reducer,p8=ih({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:p7}=p8.actions,p9=p8.reducer,ge=r9("keyDown"),gt=r9("focus"),gr=iW();gr.startListening({actionCreator:ge,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:i}=r.tooltip,n=e.payload;if("ArrowRight"===n||"ArrowLeft"===n||"Enter"===n){var s=Number(hY(i,de(r))),a=dM(r);if("Enter"===n){var o=fh(r,"axis","hover",String(i.index));t.dispatch(hG({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:o}));return}var l=s+("ArrowRight"===n?1:-1)*("left-to-right"===hA(r)?1:-1);if(null!=a&&!(l>=a.length)&&!(l<0)){var c=fh(r,"axis","hover",String(l));t.dispatch(hG({active:!0,activeIndex:l.toString(),activeDataKey:void 0,activeCoordinate:c}))}}}}}),gr.startListening({actionCreator:gt,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&null==i.index){var n=fh(r,"axis","hover",String("0"));t.dispatch(hG({activeDataKey:void 0,active:!0,activeIndex:"0",activeCoordinate:n}))}}}});var gi=r9("externalEvent"),gn=iW();gn.startListening({actionCreator:gi,effect:(e,t)=>{if(null!=e.payload.handler){var r=t.getState(),i={activeCoordinate:dz(r),activeDataKey:dN(r),activeIndex:dL(r),activeLabel:dj(r),activeTooltipIndex:dL(r),isTooltipActive:dF(r)};e.payload.handler(i,e.payload.reactEvent)}}});var gs=rY([h0],e=>e.tooltipItemPayloads),ga=rY([gs,hQ,(e,t,r)=>t,(e,t,r)=>r],(e,t,r,i)=>{var n=e.find(e=>e.settings.dataKey===i);if(null!=n){var{positions:s}=n;if(null!=s)return t(s,r)}}),go=r9("touchMove"),gl=iW();gl.startListening({actionCreator:go,effect:(e,t)=>{var r=e.payload,i=t.getState(),n=hO(i,i.tooltip.settings.shared);if("axis"===n){var s=pI(i,pL({clientX:r.touches[0].clientX,clientY:r.touches[0].clientY,currentTarget:r.currentTarget}));(null==s?void 0:s.activeIndex)!=null&&t.dispatch(h$({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate}))}else if("item"===n){var a,o=r.touches[0],l=document.elementFromPoint(o.clientX,o.clientY);if(!l||!l.getAttribute)return;var c=l.getAttribute("data-recharts-item-index"),u=null!=(a=l.getAttribute("data-recharts-item-data-key"))?a:void 0,h=ga(t.getState(),c,u);t.dispatch(hz({activeDataKey:u,activeIndex:c,activeCoordinate:h}))}}});var gc=ih({name:"errorBars",initialState:{},reducers:{addErrorBar:(e,t)=>{var{itemId:r,errorBar:i}=t.payload;e[r]||(e[r]=[]),e[r].push(i)},replaceErrorBar:(e,t)=>{var{itemId:r,prev:i,next:n}=t.payload;e[r]&&(e[r]=e[r].map(e=>e.dataKey===i.dataKey&&e.direction===i.direction?n:e))},removeErrorBar:(e,t)=>{var{itemId:r,errorBar:i}=t.payload;e[r]&&(e[r]=e[r].filter(e=>e.dataKey!==i.dataKey||e.direction!==i.direction))}}}),{addErrorBar:gu,replaceErrorBar:gh,removeErrorBar:gd}=gc.actions,gf=r3({brush:pY,cartesianAxis:dJ,chartData:pO,errorBars:gc.reducer,graphicalItems:fj,layout:iX,legend:fw,options:pg,polarAxis:p6,polarOptions:p9,referenceElements:pq,rootProps:pQ,tooltip:hq}),gp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart";return function(e){let t,r,i,n=function(e){let{thunk:t=!0,immutableCheck:r=!0,serializableCheck:i=!0,actionCreatorCheck:n=!0}=e??{},s=new ie;return t&&("boolean"==typeof t?s.push(r8):s.push(r6(t.extraArgument))),s},{reducer:s,middleware:a,devTools:o=!0,duplicateMiddlewareCheck:l=!0,preloadedState:c,enhancers:u}=e||{};if("function"==typeof s)t=s;else if(r2(s))t=r3(s);else throw Error(iG(1));r="function"==typeof a?a(n):n();let h=r4;o&&(h=r7({trace:!1,..."object"==typeof o&&o}));let d=(i=function(...e){return t=>(r,i)=>{let n=t(r,i),s=()=>{throw Error(rJ(15))},a={getState:n.getState,dispatch:(e,...t)=>s(e,...t)};return s=r4(...e.map(e=>e(a)))(n.dispatch),{...n,dispatch:s}}}(...r),function(e){let{autoBatch:t=!0}=e??{},r=new ie(i);return t&&r.push(io("object"==typeof t?t:void 0)),r});return function e(t,r,i){if("function"!=typeof t)throw Error(rJ(2));if("function"==typeof r&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw Error(rJ(0));if("function"==typeof r&&void 0===i&&(i=r,r=void 0),void 0!==i){if("function"!=typeof i)throw Error(rJ(1));return i(e)(t,r)}let n=t,s=r,a=new Map,o=a,l=0,c=!1;function u(){o===a&&(o=new Map,a.forEach((e,t)=>{o.set(t,e)}))}function h(){if(c)throw Error(rJ(3));return s}function d(e){if("function"!=typeof e)throw Error(rJ(4));if(c)throw Error(rJ(5));let t=!0;u();let r=l++;return o.set(r,e),function(){if(t){if(c)throw Error(rJ(6));t=!1,u(),o.delete(r),a=null}}}function f(e){if(!r2(e))throw Error(rJ(7));if(void 0===e.type)throw Error(rJ(8));if("string"!=typeof e.type)throw Error(rJ(17));if(c)throw Error(rJ(9));try{c=!0,s=n(s,e)}finally{c=!1}return(a=o).forEach(e=>{e()}),e}return f({type:r1.INIT}),{dispatch:f,subscribe:d,getState:h,replaceReducer:function(e){if("function"!=typeof e)throw Error(rJ(10));n=e,f({type:r1.REPLACE})},[rQ]:function(){return{subscribe(e){if("object"!=typeof e||null===e)throw Error(rJ(11));function t(){e.next&&e.next(h())}return t(),{unsubscribe:d(t)}},[rQ](){return this}}}}}(t,c,h(..."function"==typeof u?u(d):d()))}({reducer:gf,preloadedState:e,middleware:e=>e({serializableCheck:!1}).concat([pN.middleware,pR.middleware,gr.middleware,gn.middleware,gl.middleware]),enhancers:e=>{var t=e;return"function"==typeof e&&(t=e()),t.concat(io({type:"raf"}))},devTools:tm.devToolsEnabled&&{serialize:{replacer:pz},name:"recharts-".concat(t)}})};function gg(e){var{preloadedState:t,children:r,reduxStoreName:i}=e,n=nx(),s=(0,Q.useRef)(null);return n?r:(null==s.current&&(s.current=gp(t,i)),Q.createElement(pP,{context:tK,store:s.current},r))}var gm=e=>{var{chartData:t}=e,r=tY(),i=nx();return(0,Q.useEffect)(()=>i?()=>{}:(r(pM(t)),()=>{r(pM(void 0))}),[t,r,i]),null};function gy(e){var{layout:t,margin:r}=e,i=tY(),n=nx();return(0,Q.useEffect)(()=>{n||(i(iK(t)),i(iH(r)))},[i,n,t,r]),null}function gv(e){var t=tY();return(0,Q.useEffect)(()=>{t(p0(e))},[t,e]),null}var gb=()=>t0(e=>e.rootProps.accessibilityLayer),gx=["children","width","height","viewBox","className","style","title","desc"];function gw(){return(gw=Object.assign.bind()).apply(null,arguments)}var g_=(0,Q.forwardRef)((e,t)=>{var{children:r,width:i,height:n,viewBox:s,className:a,style:o,title:l,desc:c}=e,u=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gx),h=s||{width:i,height:n,x:0,y:0},d=eu("recharts-surface",a);return Q.createElement("svg",gw({},tu(u),{className:d,width:i,height:n,style:o,viewBox:"".concat(h.x," ").concat(h.y," ").concat(h.width," ").concat(h.height),ref:t}),Q.createElement("title",null,l),Q.createElement("desc",null,c),r)}),gk=["children"];function gP(){return(gP=Object.assign.bind()).apply(null,arguments)}var gS={width:"100%",height:"100%",display:"block"},gE=(0,Q.forwardRef)((e,t)=>{var r,i,n=t0(nl),s=t0(nc),a=gb();if(!e4(n)||!e4(s))return null;var{children:o,otherAttributes:l,title:c,desc:u}=e;return r="number"==typeof l.tabIndex?l.tabIndex:a?0:void 0,i="string"==typeof l.role?l.role:a?"application":void 0,Q.createElement(g_,gP({},l,{title:c,desc:u,role:i,tabIndex:r,width:n,height:s,style:gS,ref:t}),o)}),gA=e=>{var{children:t}=e,r=t0(n_);if(!r)return null;var{width:i,height:n,y:s,x:a}=r;return Q.createElement(g_,{width:i,height:n,x:a,y:s},t)},gM=(0,Q.forwardRef)((e,t)=>{var{children:r}=e,i=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gk);return nx()?Q.createElement(gA,null,r):Q.createElement(gE,gP({ref:t},i),r)}),gT=new(e.i(78492)).default,gC="recharts.syncEvent.tooltip",gO="recharts.syncEvent.brush";function gI(e){return e.tooltip.syncInteraction}var gL=["x","y"];function gj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function gN(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gj(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gj(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var gD=()=>{},gR=(0,Q.createContext)(null),gz=(0,Q.createContext)(null);function gF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function gB(){return(gB=Object.assign.bind()).apply(null,arguments)}var gU=()=>{var e,t,r,i,n,s,a,o,l,c,u,h;return e=tY(),(0,Q.useEffect)(()=>{e(pm())},[e]),t=t0(cF),r=t0(cU),i=tY(),n=t0(cB),s=t0(dM),a=t0(nU),o=nz(),l=t0(e=>e.rootProps.className),(0,Q.useEffect)(()=>{if(null==t)return gD;var e=(e,l,c)=>{if(r!==c&&t===e){if("index"===n){if(o&&null!=l&&null!=(u=l.payload)&&u.coordinate&&l.payload.sourceViewBox){var u,h,d=l.payload.coordinate,{x:f,y:p}=d,g=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(d,gL),{x:m,y:y,width:v,height:b}=l.payload.sourceViewBox,x=gN(gN({},g),{},{x:o.x+(v?(f-m)/v:0)*o.width,y:o.y+(b?(p-y)/b:0)*o.height});i(gN(gN({},l),{},{payload:gN(gN({},l.payload),{},{coordinate:x})}))}else i(l);return}if(null!=s){if("function"==typeof n){var w=n(s,{activeTooltipIndex:null==l.payload.index?void 0:Number(l.payload.index),isTooltipActive:l.payload.active,activeIndex:null==l.payload.index?void 0:Number(l.payload.index),activeLabel:l.payload.label,activeDataKey:l.payload.dataKey,activeCoordinate:l.payload.coordinate});h=s[w]}else"value"===n&&(h=s.find(e=>String(e.value)===l.payload.label));var{coordinate:_}=l.payload;if(null==h||!1===l.payload.active||null==_||null==o)return void i(hW({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0}));var{x:k,y:P}=_,S=Math.min(k,o.x+o.width),E=Math.min(P,o.y+o.height),A={x:"horizontal"===a?h.coordinate:S,y:"horizontal"===a?E:h.coordinate};i(hW({active:l.payload.active,coordinate:A,dataKey:l.payload.dataKey,index:String(h.index),label:l.payload.label,sourceViewBox:l.payload.sourceViewBox}))}}};return gT.on(gC,e),()=>{gT.off(gC,e)}},[l,i,r,t,n,s,a,o]),c=t0(cF),u=t0(cU),h=tY(),(0,Q.useEffect)(()=>{if(null==c)return gD;var e=(e,t,r)=>{u!==r&&c===e&&h(pT(t))};return gT.on(gO,e),()=>{gT.off(gO,e)}},[h,u,c]),null};function g$(e){if("number"==typeof e)return e;if("string"==typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var gV=(0,Q.forwardRef)((e,t)=>{var r,i,n=(0,Q.useRef)(null),[s,a]=(0,Q.useState)({containerWidth:g$(null==(r=e.style)?void 0:r.width),containerHeight:g$(null==(i=e.style)?void 0:i.height)}),o=(0,Q.useCallback)((e,t)=>{a(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]),l=(0,Q.useCallback)(e=>{if("function"==typeof t&&t(e),null!=e){var{width:r,height:i}=e.getBoundingClientRect();o(r,i);var s=new ResizeObserver(e=>{var{width:t,height:r}=e[0].contentRect;o(t,r)});s.observe(e),n.current=s}},[t,o]);return(0,Q.useEffect)(()=>()=>{var e=n.current;null!=e&&e.disconnect()},[o]),Q.createElement(Q.Fragment,null,Q.createElement(n$,{width:s.containerWidth,height:s.containerHeight}),Q.createElement("div",gB({ref:l},e)))}),gW=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e,[n,s]=(0,Q.useState)({containerWidth:g$(r),containerHeight:g$(i)}),a=(0,Q.useCallback)((e,t)=>{s(r=>{var i=Math.round(e),n=Math.round(t);return r.containerWidth===i&&r.containerHeight===n?r:{containerWidth:i,containerHeight:n}})},[]),o=(0,Q.useCallback)(e=>{if("function"==typeof t&&t(e),null!=e){var{width:r,height:i}=e.getBoundingClientRect();a(r,i)}},[t,a]);return Q.createElement(Q.Fragment,null,Q.createElement(n$,{width:n.containerWidth,height:n.containerHeight}),Q.createElement("div",gB({ref:o},e)))}),gG=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e;return Q.createElement(Q.Fragment,null,Q.createElement(n$,{width:r,height:i}),Q.createElement("div",gB({ref:t},e)))}),gq=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i}=e;return eH(r)||eH(i)?Q.createElement(gW,gB({},e,{ref:t})):Q.createElement(gG,gB({},e,{ref:t}))}),gH=(0,Q.forwardRef)((e,t)=>{var{children:r,className:i,height:n,onClick:s,onContextMenu:a,onDoubleClick:o,onMouseDown:l,onMouseEnter:c,onMouseLeave:u,onMouseMove:h,onMouseUp:d,onTouchEnd:f,onTouchMove:p,onTouchStart:g,style:m,width:y,responsive:v,dispatchTouchEvents:b=!0}=e,x=(0,Q.useRef)(null),w=tY(),[_,k]=(0,Q.useState)(null),[P,S]=(0,Q.useState)(null),E=function(){var e=tY(),[t,r]=(0,Q.useState)(null),i=t0(nu);return(0,Q.useEffect)(()=>{if(null!=t){var r=t.getBoundingClientRect().width/t.offsetWidth;e3(r)&&r!==i&&e(iY(r))}},[t,e,i]),r}(),A=nN(),M=(null==A?void 0:A.width)>0?A.width:y,T=(null==A?void 0:A.height)>0?A.height:n,C=(0,Q.useCallback)(e=>{E(e),"function"==typeof t&&t(e),k(e),S(e),null!=e&&(x.current=e)},[E,t,k,S]),O=(0,Q.useCallback)(e=>{w(pj(e)),w(gi({handler:s,reactEvent:e}))},[w,s]),I=(0,Q.useCallback)(e=>{w(pD(e)),w(gi({handler:c,reactEvent:e}))},[w,c]),L=(0,Q.useCallback)(e=>{w(hB()),w(gi({handler:u,reactEvent:e}))},[w,u]),j=(0,Q.useCallback)(e=>{w(pD(e)),w(gi({handler:h,reactEvent:e}))},[w,h]),N=(0,Q.useCallback)(()=>{w(gt())},[w]),D=(0,Q.useCallback)(e=>{w(ge(e.key))},[w]),R=(0,Q.useCallback)(e=>{w(gi({handler:a,reactEvent:e}))},[w,a]),z=(0,Q.useCallback)(e=>{w(gi({handler:o,reactEvent:e}))},[w,o]),F=(0,Q.useCallback)(e=>{w(gi({handler:l,reactEvent:e}))},[w,l]),B=(0,Q.useCallback)(e=>{w(gi({handler:d,reactEvent:e}))},[w,d]),U=(0,Q.useCallback)(e=>{w(gi({handler:g,reactEvent:e}))},[w,g]),$=(0,Q.useCallback)(e=>{b&&w(go(e)),w(gi({handler:p,reactEvent:e}))},[w,b,p]),V=(0,Q.useCallback)(e=>{w(gi({handler:f,reactEvent:e}))},[w,f]);return Q.createElement(gR.Provider,{value:_},Q.createElement(gz.Provider,{value:P},Q.createElement(!0===v?gV:gq,{width:null!=M?M:null==m?void 0:m.width,height:null!=T?T:null==m?void 0:m.height,className:eu("recharts-wrapper",i),style:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gF(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({position:"relative",cursor:"default",width:M,height:T},m),onClick:O,onContextMenu:R,onDoubleClick:z,onFocus:N,onKeyDown:D,onMouseDown:F,onMouseEnter:I,onMouseLeave:L,onMouseMove:j,onMouseUp:B,onTouchEnd:V,onTouchMove:$,onTouchStart:U,ref:C},Q.createElement(gU,null),r)))}),gK=(0,Q.createContext)(void 0),gZ=e=>{var{children:t}=e,[r]=(0,Q.useState)("".concat(eX("recharts"),"-clip")),i=t0(d0);if(null==i)return null;var{x:n,y:s,width:a,height:o}=i;return Q.createElement(gK.Provider,{value:r},Q.createElement("defs",null,Q.createElement("clipPath",{id:r},Q.createElement("rect",{x:n,y:s,height:o,width:a}))),t)},gY=["width","height","responsive","children","className","style","compact","title","desc"],gX=(0,Q.forwardRef)((e,t)=>{var{width:r,height:i,responsive:n,children:s,className:a,style:o,compact:l,title:c,desc:u}=e,h=e7(function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,gY));return l?Q.createElement(Q.Fragment,null,Q.createElement(n$,{width:r,height:i}),Q.createElement(gM,{otherAttributes:h,title:c,desc:u},s)):Q.createElement(gH,{className:a,style:o,width:r,height:i,responsive:n,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},Q.createElement(gM,{otherAttributes:h,title:c,desc:u,ref:t},Q.createElement(gZ,null,s)))});function gJ(){return(gJ=Object.assign.bind()).apply(null,arguments)}var gQ={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index",responsive:!1},g0=(0,Q.forwardRef)(function(e,t){var r,i=n6(e.categoricalChartProps,gQ),{chartName:n,defaultTooltipEventType:s,validateTooltipEventTypes:a,tooltipPayloadSearcher:o,categoricalChartProps:l}=e;return Q.createElement(gg,{preloadedState:{options:{chartName:n,defaultTooltipEventType:s,validateTooltipEventTypes:a,tooltipPayloadSearcher:o,eventEmitter:void 0}},reduxStoreName:null!=(r=l.id)?r:n},Q.createElement(gm,{chartData:l.data}),Q.createElement(gy,{layout:i.layout,margin:i.margin}),Q.createElement(gv,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),Q.createElement(gX,gJ({},i,{ref:t})))}),g1=["axis"],g2=(0,Q.forwardRef)((e,t)=>Q.createElement(g0,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:g1,tooltipPayloadSearcher:pf,categoricalChartProps:e,ref:t}));class g3{static create(e){return new g3(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:t,position:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==e){if(r)switch(r){case"start":default:return this.scale(e);case"middle":var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+i;case"end":var n=this.bandwidth?this.bandwidth():0;return this.scale(e)+n}if(t){var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+s}return this.scale(e)}}isInRange(e){var t=this.range(),r=t[0],i=t[t.length-1];return r<=i?e>=r&&e<=i:e>=i&&e<=r}}(w="symbol"==typeof(b=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(w="EPS","string"))?b:b+"")in g3?Object.defineProperty(g3,w,{value:1e-4,enumerable:!0,configurable:!0,writable:!0}):g3[w]=1e-4;var g4=function(e){var{width:t,height:r}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i%180+180)%180*Math.PI/180,s=Math.atan(r/t);return Math.abs(n>s&&n<Math.PI-s?r/Math.sin(n):t/Math.cos(n))};function g5(e,t,r){if(t<1)return[];if(1===t&&void 0===r)return e;for(var i=[],n=0;n<e.length;n+=t)if(void 0!==r&&!0!==r(e[n]))return;else i.push(e[n]);return i}function g6(e,t,r,i,n){if(e*t<e*i||e*t>e*n)return!1;var s=r();return e*(t-e*s/2-i)>=0&&e*(t+e*s/2-n)<=0}function g8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function g7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g8(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g8(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function g9(e,t,r){var i,{tick:n,ticks:s,viewBox:a,minTickGap:o,orientation:l,interval:c,tickFormatter:u,unit:h,angle:d}=e;if(!s||!s.length||!n)return[];if(eK(c)||tm.isSsr)return null!=(i=g5(s,(eK(c)?c:0)+1))?i:[];var f="top"===l||"bottom"===l?"width":"height",p=h&&"width"===f?tk(h,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=(e,i)=>{var n,s="function"==typeof u?u(e.value,i):e.value;return"width"===f?(n=tk(s,{fontSize:t,letterSpacing:r}),g4({width:n.width+p.width,height:n.height+p.height},d)):tk(s,{fontSize:t,letterSpacing:r})[f]},m=s.length>=2?eG(s[1].coordinate-s[0].coordinate):1,y=function(e,t,r){var i="width"===r,{x:n,y:s,width:a,height:o}=e;return 1===t?{start:i?n:s,end:i?n+a:s+o}:{start:i?n+a:s+o,end:i?n:s}}(a,m,f);return"equidistantPreserveStart"===c?function(e,t,r,i,n){for(var s,a=(i||[]).slice(),{start:o,end:l}=t,c=0,u=1,h=o;u<=a.length;)if(s=function(){var t,s=null==i?void 0:i[c];if(void 0===s)return{v:g5(i,u)};var a=c,d=()=>(void 0===t&&(t=r(s,a)),t),f=s.coordinate,p=0===c||g6(e,f,d,h,l);p||(c=0,h=o,u+=1),p&&(h=f+e*(d()/2+n),c+=u)}())return s.v;return[]}(m,y,g,s,o):("preserveStart"===c||"preserveStartEnd"===c?function(e,t,r,i,n,s){var a=(i||[]).slice(),o=a.length,{start:l,end:c}=t;if(s){var u=i[o-1],h=r(u,o-1),d=e*(u.coordinate+e*h/2-c);a[o-1]=u=g7(g7({},u),{},{tickCoord:d>0?u.coordinate-d*e:u.coordinate}),g6(e,u.tickCoord,()=>h,l,c)&&(c=u.tickCoord-e*(h/2+n),a[o-1]=g7(g7({},u),{},{isShow:!0}))}for(var f=s?o-1:o,p=function(t){var i,s=a[t],o=()=>(void 0===i&&(i=r(s,t)),i);if(0===t){var u=e*(s.coordinate-e*o()/2-l);a[t]=s=g7(g7({},s),{},{tickCoord:u<0?s.coordinate-u*e:s.coordinate})}else a[t]=s=g7(g7({},s),{},{tickCoord:s.coordinate});g6(e,s.tickCoord,o,l,c)&&(l=s.tickCoord+e*(o()/2+n),a[t]=g7(g7({},s),{},{isShow:!0}))},g=0;g<f;g++)p(g);return a}(m,y,g,s,o,"preserveStartEnd"===c):function(e,t,r,i,n){for(var s=(i||[]).slice(),a=s.length,{start:o}=t,{end:l}=t,c=function(t){var i,c=s[t],u=()=>(void 0===i&&(i=r(c,t)),i);if(t===a-1){var h=e*(c.coordinate+e*u()/2-l);s[t]=c=g7(g7({},c),{},{tickCoord:h>0?c.coordinate-h*e:c.coordinate})}else s[t]=c=g7(g7({},c),{},{tickCoord:c.coordinate});g6(e,c.tickCoord,u,o,l)&&(l=c.tickCoord-e*(u()/2+n),s[t]=g7(g7({},c),{},{isShow:!0}))},u=a-1;u>=0;u--)c(u);return s}(m,y,g,s,o)).filter(e=>e.isShow)}function me(e,t){for(var r in e)if(({}).hasOwnProperty.call(e,r)&&(!({}).hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var i in t)if(({}).hasOwnProperty.call(t,i)&&!({}).hasOwnProperty.call(e,i))return!1;return!0}var mt=["axisLine","width","height","className","hide","ticks"],mr=["viewBox"],mi=["viewBox"];function mn(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ms(){return(ms=Object.assign.bind()).apply(null,arguments)}function ma(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ma(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ml={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"};function mc(e){var{x:t,y:r,width:i,height:n,orientation:s,mirror:a,axisLine:o,otherSvgProps:l}=e;if(!o)return null;var c=mo(mo(mo({},l),e7(o)),{},{fill:"none"});if("top"===s||"bottom"===s){var u=+("top"===s&&!a||"bottom"===s&&a);c=mo(mo({},c),{},{x1:t,y1:r+u*n,x2:t+i,y2:r+u*n})}else{var h=+("left"===s&&!a||"right"===s&&a);c=mo(mo({},c),{},{x1:t+h*i,y1:r,x2:t+h*i,y2:r+n})}return Q.createElement("line",ms({},c,{className:eu("recharts-cartesian-axis-line",(0,eW.default)(o,"className"))}))}function mu(e){var t,{option:r,tickProps:i,value:n}=e,s=eu(i.className,"recharts-cartesian-axis-tick-value");if(Q.isValidElement(r))t=Q.cloneElement(r,mo(mo({},i),{},{className:s}));else if("function"==typeof r)t=r(mo(mo({},i),{},{className:s}));else{var a="recharts-cartesian-axis-tick-value";"boolean"!=typeof r&&(a=eu(a,null==r?void 0:r.className)),t=Q.createElement(t$,ms({},i,{className:a}),n)}return t}function mh(e){var{ticks:t=[],tick:r,tickLine:i,stroke:n,tickFormatter:s,unit:a,padding:o,tickTextProps:l,orientation:c,mirror:u,x:h,y:d,width:f,height:p,tickSize:g,tickMargin:m,fontSize:y,letterSpacing:v,getTicksConfig:b,events:x}=e,w=g9(mo(mo({},b),{},{ticks:t}),y,v),_=function(e,t){switch(e){case"left":return t?"start":"end";case"right":return t?"end":"start";default:return"middle"}}(c,u),k=function(e,t){switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}(c,u),P=e7(b),S=e9(r),E={};"object"==typeof i&&(E=i);var A=mo(mo({},P),{},{fill:"none"},E),M=w.map((e,t)=>{var{line:y,tick:v}=function(e,t,r,i,n,s,a,o,l){var c,u,h,d,f,p,g=o?-1:1,m=e.tickSize||a,y=eK(e.tickCoord)?e.tickCoord:e.coordinate;switch(s){case"top":c=u=e.coordinate,p=(h=(d=r+!o*n)-g*m)-g*l,f=y;break;case"left":h=d=e.coordinate,f=(c=(u=t+!o*i)-g*m)-g*l,p=y;break;case"right":h=d=e.coordinate,f=(c=(u=t+o*i)+g*m)+g*l,p=y;break;default:c=u=e.coordinate,p=(h=(d=r+o*n)+g*m)+g*l,f=y}return{line:{x1:c,y1:h,x2:u,y2:d},tick:{x:f,y:p}}}(e,h,d,f,p,c,g,u,m),b=mo(mo(mo(mo({textAnchor:_,verticalAnchor:k},P),{},{stroke:"none",fill:n},S),v),{},{index:t,payload:e,visibleTicksCount:w.length,tickFormatter:s,padding:o},l);return Q.createElement(tp,ms({className:"recharts-cartesian-axis-tick",key:"tick-".concat(e.value,"-").concat(e.coordinate,"-").concat(e.tickCoord)},((e,t,r)=>{if(null===e||"object"!=typeof e&&"function"!=typeof e)return null;var i=null;return Object.keys(e).forEach(n=>{var s=e[n];e$(n)&&"function"==typeof s&&(i||(i={}),i[n]=e=>(s(t,r,e),null))}),i})(x,e,t)),i&&Q.createElement("line",ms({},A,y,{className:eu("recharts-cartesian-axis-tick-line",(0,eW.default)(i,"className"))})),r&&Q.createElement(mu,{option:r,tickProps:b,value:"".concat("function"==typeof s?s(e.value,t):e.value).concat(a||"")}))});return M.length>0?Q.createElement("g",{className:"recharts-cartesian-axis-ticks"},M):null}var md=(0,Q.forwardRef)((e,t)=>{var{axisLine:r,width:i,height:n,className:s,hide:a,ticks:o}=e,l=mn(e,mt),[c,u]=(0,Q.useState)(""),[h,d]=(0,Q.useState)(""),f=(0,Q.useRef)(null);(0,Q.useImperativeHandle)(t,()=>({getCalculatedWidth:()=>{var t;return(e=>{var{ticks:t,label:r,labelGapWithTick:i=5,tickSize:n=0,tickMargin:s=0}=e,a=0;if(t){Array.from(t).forEach(e=>{if(e){var t=e.getBoundingClientRect();t.width>a&&(a=t.width)}});var o=r?r.getBoundingClientRect().width:0;return Math.round(a+(n+s)+o+(r?i:0))}return 0})({ticks:f.current,label:null==(t=e.labelRef)?void 0:t.current,labelGapWithTick:5,tickSize:e.tickSize,tickMargin:e.tickMargin})}}));var p=(0,Q.useCallback)(e=>{if(e){var t=e.getElementsByClassName("recharts-cartesian-axis-tick-value");f.current=t;var r=t[0];if(r){var i=window.getComputedStyle(r),n=i.fontSize,s=i.letterSpacing;(n!==c||s!==h)&&(u(n),d(s))}}},[c,h]);return a||null!=i&&i<=0||null!=n&&n<=0?null:Q.createElement(tp,{className:eu("recharts-cartesian-axis",s),ref:p},Q.createElement(mc,{x:e.x,y:e.y,width:i,height:n,orientation:e.orientation,mirror:e.mirror,axisLine:r,otherSvgProps:e7(e)}),Q.createElement(mh,{ticks:o,tick:e.tick,tickLine:e.tickLine,stroke:e.stroke,tickFormatter:e.tickFormatter,unit:e.unit,padding:e.padding,tickTextProps:e.tickTextProps,orientation:e.orientation,mirror:e.mirror,x:e.x,y:e.y,width:e.width,height:e.height,tickSize:e.tickSize,tickMargin:e.tickMargin,fontSize:c,letterSpacing:h,getTicksConfig:e,events:l}),Q.createElement(sr,{x:e.x,y:e.y,width:e.width,height:e.height},Q.createElement(sc,{label:e.label,labelRef:e.labelRef}),e.children))}),mf=Q.memo(md,(e,t)=>{var{viewBox:r}=e,i=mn(e,mr),{viewBox:n}=t,s=mn(t,mi);return me(r,n)&&me(i,s)}),mp=Q.forwardRef((e,t)=>{var r=n6(e,ml);return Q.createElement(mf,ms({},r,{ref:t}))});mp.displayName="CartesianAxis";var mg=["x1","y1","x2","y2","key"],mm=["offset"],my=["xAxisId","yAxisId"],mv=["xAxisId","yAxisId"];function mb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mb(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mb(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function mw(){return(mw=Object.assign.bind()).apply(null,arguments)}function m_(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var mk=e=>{var{fill:t}=e;if(!t||"none"===t)return null;var{fillOpacity:r,x:i,y:n,width:s,height:a,ry:o}=e;return Q.createElement("rect",{x:i,y:n,ry:o,width:s,height:a,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function mP(e,t){var r;if(Q.isValidElement(e))r=Q.cloneElement(e,t);else if("function"==typeof e)r=e(t);else{var{x1:i,y1:n,x2:s,y2:a,key:o}=t,l=e7(m_(t,mg)),{offset:c}=l,u=m_(l,mm);r=Q.createElement("line",mw({},u,{x1:i,y1:n,x2:s,y2:a,fill:"none",key:o}))}return r}function mS(e){var{x:t,width:r,horizontal:i=!0,horizontalPoints:n}=e;if(!i||!n||!n.length)return null;var{xAxisId:s,yAxisId:a}=e,o=m_(e,my),l=n.map((e,n)=>mP(i,mx(mx({},o),{},{x1:t,y1:e,x2:t+r,y2:e,key:"line-".concat(n),index:n})));return Q.createElement("g",{className:"recharts-cartesian-grid-horizontal"},l)}function mE(e){var{y:t,height:r,vertical:i=!0,verticalPoints:n}=e;if(!i||!n||!n.length)return null;var{xAxisId:s,yAxisId:a}=e,o=m_(e,mv),l=n.map((e,n)=>mP(i,mx(mx({},o),{},{x1:e,y1:t,x2:e,y2:t+r,key:"line-".concat(n),index:n})));return Q.createElement("g",{className:"recharts-cartesian-grid-vertical"},l)}function mA(e){var{horizontalFill:t,fillOpacity:r,x:i,y:n,width:s,height:a,horizontalPoints:o,horizontal:l=!0}=e;if(!l||!t||!t.length)return null;var c=o.map(e=>Math.round(e+n-n)).sort((e,t)=>e-t);n!==c[0]&&c.unshift(0);var u=c.map((e,o)=>{var l=c[o+1]?c[o+1]-e:n+a-e;if(l<=0)return null;var u=o%t.length;return Q.createElement("rect",{key:"react-".concat(o),y:e,x:i,height:l,width:s,stroke:"none",fill:t[u],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},u)}function mM(e){var{vertical:t=!0,verticalFill:r,fillOpacity:i,x:n,y:s,width:a,height:o,verticalPoints:l}=e;if(!t||!r||!r.length)return null;var c=l.map(e=>Math.round(e+n-n)).sort((e,t)=>e-t);n!==c[0]&&c.unshift(0);var u=c.map((e,t)=>{var l=c[t+1]?c[t+1]-e:n+a-e;if(l<=0)return null;var u=t%r.length;return Q.createElement("rect",{key:"react-".concat(t),x:e,y:s,width:l,height:o,stroke:"none",fill:r[u],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},u)}var mT=(e,t)=>{var{xAxis:r,width:i,height:n,offset:s}=e;return i9(g9(mx(mx(mx({},ml),r),{},{ticks:ne(r,!0),viewBox:{x:0,y:0,width:i,height:n}})),s.left,s.left+s.width,t)},mC=(e,t)=>{var{yAxis:r,width:i,height:n,offset:s}=e;return i9(g9(mx(mx(mx({},ml),r),{},{ticks:ne(r,!0),viewBox:{x:0,y:0,width:i,height:n}})),s.top,s.top+s.height,t)},mO={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function mI(e){var t=t0(nl),r=t0(nc),i=nB(),n=mx(mx({},n6(e,mO)),{},{x:eK(e.x)?e.x:i.left,y:eK(e.y)?e.y:i.top,width:eK(e.width)?e.width:i.width,height:eK(e.height)?e.height:i.height}),{xAxisId:s,yAxisId:a,x:o,y:l,width:c,height:u,syncWithTicks:h,horizontalValues:d,verticalValues:f}=n,p=nx(),g=t0(e=>h_(e,"xAxis",s,p)),m=t0(e=>h_(e,"yAxis",a,p));if(!eK(c)||c<=0||!eK(u)||u<=0||!eK(o)||o!==+o||!eK(l)||l!==+l)return null;var y=n.verticalCoordinatesGenerator||mT,v=n.horizontalCoordinatesGenerator||mC,{horizontalPoints:b,verticalPoints:x}=n;if((!b||!b.length)&&"function"==typeof v){var w=d&&d.length,_=v({yAxis:m?mx(mx({},m),{},{ticks:w?d:m.ticks}):void 0,width:t,height:r,offset:i},!!w||h);nP(Array.isArray(_),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof _,"]")),Array.isArray(_)&&(b=_)}if((!x||!x.length)&&"function"==typeof y){var k=f&&f.length,P=y({xAxis:g?mx(mx({},g),{},{ticks:k?f:g.ticks}):void 0,width:t,height:r,offset:i},!!k||h);nP(Array.isArray(P),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof P,"]")),Array.isArray(P)&&(x=P)}return Q.createElement("g",{className:"recharts-cartesian-grid"},Q.createElement(mk,{fill:n.fill,fillOpacity:n.fillOpacity,x:n.x,y:n.y,width:n.width,height:n.height,ry:n.ry}),Q.createElement(mA,mw({},n,{horizontalPoints:b})),Q.createElement(mM,mw({},n,{verticalPoints:x})),Q.createElement(mS,mw({},n,{offset:i,horizontalPoints:b,xAxis:g,yAxis:m})),Q.createElement(mE,mw({},n,{offset:i,verticalPoints:x,xAxis:g,yAxis:m})))}mI.displayName="CartesianGrid";var mL=Q,mj=["children"],mN=(0,Q.createContext)({data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0});function mD(e){var{children:t}=e,r=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,mj);return Q.createElement(mN.Provider,{value:r},t)}var mR=(e,t,r,i)=>hS(e,"xAxis",t,i),mz=(e,t,r,i)=>hP(e,"xAxis",t,i),mF=(e,t,r,i)=>hS(e,"yAxis",r,i),mB=(e,t,r,i)=>hP(e,"yAxis",r,i),mU=rY([nU,mR,mF,mz,mB],(e,t,r,i,n)=>i7(e,"xAxis")?ns(t,i,!1):ns(r,n,!1));function m$(e){return"line"===e.type}var mV=rY([un,(e,t,r,i,n)=>n],(e,t)=>e.filter(m$).find(e=>e.id===t)),mW=rY([nU,mR,mF,mz,mB,mV,mU,cm],(e,t,r,i,n,s,a,o)=>{var l,{chartData:c,dataStartIndex:u,dataEndIndex:h}=o;if(null!=s&&null!=t&&null!=r&&null!=i&&null!=n&&0!==i.length&&0!==n.length&&null!=a){var{dataKey:d,data:f}=s;if(null!=(l=null!=f&&f.length>0?f:null==c?void 0:c.slice(u,h+1)))return function(e){var{layout:t,xAxis:r,yAxis:i,xAxisTicks:n,yAxisTicks:s,dataKey:a,bandSize:o,displayedData:l}=e;return l.map((e,l)=>{var c=i8(e,a);if("horizontal"===t)return{x:nr({axis:r,ticks:n,bandSize:o,entry:e,index:l}),y:null==c?null:i.scale(c),value:c,payload:e};var u=null==c?null:r.scale(c),h=nr({axis:i,ticks:s,bandSize:o,entry:e,index:l});return null==u||null==h?null:{x:u,y:h,value:c,payload:e}}).filter(Boolean)}({layout:e,xAxis:t,yAxis:r,xAxisTicks:i,yAxisTicks:n,dataKey:d,bandSize:a,displayedData:l})}}),mG=["id"],mq=["type","layout","connectNulls","needClip"],mH=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function mK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mZ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mK(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mK(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function mY(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function mX(){return(mX=Object.assign.bind()).apply(null,arguments)}function mJ(e){var{dataKey:t,data:r,stroke:i,strokeWidth:n,fill:s,name:a,hide:o,unit:l}=e;return{dataDefinedOnItem:r,positions:void 0,settings:{stroke:i,strokeWidth:n,fill:s,dataKey:t,nameKey:void 0,name:no(a,t),hide:o,type:e.tooltipType,color:e.stroke,unit:l}}}var mQ=(e,t)=>"".concat(t,"px ").concat(e-t,"px");function m0(e){var{clipPathId:t,points:r,props:i}=e,{dot:n,dataKey:s,needClip:a}=i;if(null==r||!n&&1!==r.length)return null;var{id:o}=i,l=mY(i,mG),c=sx(n),u=e7(l),h=th(n),d=r.map((e,t)=>{var i,a=mZ(mZ(mZ({key:"dot-".concat(t),r:3},u),h),{},{index:t,cx:e.x,cy:e.y,dataKey:s,value:e.value,payload:e.payload,points:r});if(mL.isValidElement(n))i=mL.cloneElement(n,a);else if("function"==typeof n)i=n(a);else{var o=eu("recharts-line-dot","boolean"!=typeof n?n.className:"");i=mL.createElement(tc,mX({},a,{className:o}))}return i}),f={clipPath:a?"url(#clipPath-".concat(c?"":"dots-").concat(t,")"):void 0};return mL.createElement(tp,mX({className:"recharts-line-dots",key:"dots"},f),d)}function m1(e){var{showLabels:t,children:r,points:i}=e,n=(0,mL.useMemo)(()=>null==i?void 0:i.map(e=>{var t={x:e.x,y:e.y,width:0,height:0};return mZ(mZ({},t),{},{value:e.value,payload:e.payload,viewBox:t,parentViewBox:void 0,fill:void 0})}),[i]);return mL.createElement(sm,{value:t?n:null},r)}function m2(e){var{clipPathId:t,pathRef:r,points:i,strokeDasharray:n,props:s}=e,{type:a,layout:o,connectNulls:l,needClip:c}=s,u=mZ(mZ({},tu(mY(s,mq))),{},{fill:"none",className:"recharts-line-curve",clipPath:c?"url(#clipPath-".concat(t,")"):void 0,points:i,type:a,layout:o,connectNulls:l,strokeDasharray:null!=n?n:s.strokeDasharray});return mL.createElement(mL.Fragment,null,(null==i?void 0:i.length)>1&&mL.createElement(to,mX({},u,{pathRef:r})),mL.createElement(m0,{points:i,clipPathId:t,props:s}))}function m3(e){var{clipPathId:t,props:r,pathRef:i,previousPointsRef:n,longestAnimatedLengthRef:s}=e,{points:a,strokeDasharray:o,isAnimationActive:l,animationBegin:c,animationDuration:u,animationEasing:h,animateNewValues:d,width:f,height:p,onAnimationEnd:g,onAnimationStart:m}=r,y=n.current,v=fP(r,"recharts-line-"),[b,x]=(0,mL.useState)(!1),w=(0,mL.useCallback)(()=>{"function"==typeof g&&g(),x(!1)},[g]),_=(0,mL.useCallback)(()=>{"function"==typeof m&&m(),x(!0)},[m]),k=function(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(e){return 0}}(i.current),P=s.current;return mL.createElement(m1,{points:a,showLabels:!b},r.children,mL.createElement(f1,{animationId:v,begin:c,duration:u,isActive:l,easing:h,onAnimationEnd:w,onAnimationStart:_,key:v},e=>{var c,u=Math.min(e0(P,k+P,e),k);if(c=l?o?((e,t,r)=>{var i=r.reduce((e,t)=>e+t);if(!i)return mQ(t,e);for(var n=Math.floor(e/i),s=e%i,a=t-e,o=[],l=0,c=0;l<r.length;c+=r[l],++l)if(c+r[l]>s){o=[...r.slice(0,l),s-c];break}var u=o.length%2==0?[0,a]:[a];return[...function(e,t){for(var r=e.length%2!=0?[...e,0]:e,i=[],n=0;n<t;++n)i=[...i,...r];return i}(r,n),...o,...u].map(e=>"".concat(e,"px")).join(", ")})(u,k,"".concat(o).split(/[,\s]+/gim).map(e=>parseFloat(e))):mQ(k,u):null==o?void 0:String(o),y){var h=y.length/a.length,g=1===e?a:a.map((t,r)=>{var i=Math.floor(r*h);if(y[i]){var n=y[i];return mZ(mZ({},t),{},{x:e0(n.x,t.x,e),y:e0(n.y,t.y,e)})}return d?mZ(mZ({},t),{},{x:e0(2*f,t.x,e),y:e0(p/2,t.y,e)}):mZ(mZ({},t),{},{x:t.x,y:t.y})});return n.current=g,mL.createElement(m2,{props:r,points:g,clipPathId:t,pathRef:i,strokeDasharray:c})}return e>0&&k>0&&(n.current=a,s.current=u),mL.createElement(m2,{props:r,points:a,clipPathId:t,pathRef:i,strokeDasharray:c})}),mL.createElement(sb,{label:r.label}))}function m4(e){var{clipPathId:t,props:r}=e,i=(0,mL.useRef)(null),n=(0,mL.useRef)(0),s=(0,mL.useRef)(null);return mL.createElement(m3,{props:r,clipPathId:t,previousPointsRef:i,longestAnimatedLengthRef:n,pathRef:s})}var m5=(e,t)=>({x:e.x,y:e.y,value:e.value,errorVal:i8(e.payload,t)});class m6 extends mL.Component{render(){var{hide:e,dot:t,points:r,className:i,xAxisId:n,yAxisId:s,top:a,left:o,width:l,height:c,id:u,needClip:h}=this.props;if(e)return null;var d=eu("recharts-line",i),{r:f,strokeWidth:p}=f2(t),g=sx(t),m=2*f+p;return mL.createElement(mL.Fragment,null,mL.createElement(tp,{className:d},h&&mL.createElement("defs",null,mL.createElement(d6,{clipPathId:u,xAxisId:n,yAxisId:s}),!g&&mL.createElement("clipPath",{id:"clipPath-dots-".concat(u)},mL.createElement("rect",{x:o-m/2,y:a-m/2,width:l+m,height:c+m}))),mL.createElement(mD,{xAxisId:n,yAxisId:s,data:r,dataPointFormatter:m5,errorBarOffset:0},mL.createElement(m4,{props:this.props,clipPathId:u}))),mL.createElement(d3,{activeDot:this.props.activeDot,points:r,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var m8={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!tm.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function m7(e){var t=n6(e,m8),{activeDot:r,animateNewValues:i,animationBegin:n,animationDuration:s,animationEasing:a,connectNulls:o,dot:l,hide:c,isAnimationActive:u,label:h,legendType:d,xAxisId:f,yAxisId:p,id:g}=t,m=mY(t,mH),{needClip:y}=d5(f,p),v=t0(d0),b=t0(nU),x=nx(),w=t0(e=>mW(e,f,p,x,g));if("horizontal"!==b&&"vertical"!==b||null==w||null==v)return null;var{height:_,width:k,x:P,y:S}=v;return mL.createElement(m6,mX({},m,{id:g,connectNulls:o,dot:l,activeDot:r,animateNewValues:i,animationBegin:n,animationDuration:s,animationEasing:a,isAnimationActive:u,hide:c,label:h,legendType:d,xAxisId:f,yAxisId:p,points:w,layout:b,height:_,width:k,left:P,top:S,needClip:y}))}var m9=mL.memo(function(e){var t=n6(e,m8),r=nx();return mL.createElement(fA,{id:t.id,type:"line"},e=>mL.createElement(mL.Fragment,null,mL.createElement(fk,{legendPayload:(e=>{var{dataKey:t,name:r,stroke:i,legendType:n,hide:s}=e;return[{inactive:s,dataKey:t,type:n,color:i,value:no(r,t),payload:e}]})(t)}),mL.createElement(d4,{fn:mJ,args:t}),mL.createElement(fN,{type:"line",id:e,data:t.data,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,hide:t.hide,isPanorama:r}),mL.createElement(m7,mX({},t,{id:e}))))});m9.displayName="Line";var ye=["axis"],yt=(0,Q.forwardRef)((e,t)=>Q.createElement(g0,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:ye,tooltipPayloadSearcher:pf,categoricalChartProps:e,ref:t})),yr=e.i(74080);function yi(){return(yi=Object.assign.bind()).apply(null,arguments)}function yn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function ys(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ya(e){return Array.isArray(e)&&eZ(e[0])&&eZ(e[1])?e.join(" ~ "):e}var yo=e=>{var{separator:t=" : ",contentStyle:r={},itemStyle:i={},labelStyle:n={},payload:s,formatter:a,itemSorter:o,wrapperClassName:l,labelClassName:c,label:u,labelFormatter:h,accessibilityLayer:d=!1}=e,f=ys({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),p=ys({margin:0},n),g=null!=u,m=g?u:"",y=eu("recharts-default-tooltip",l),v=eu("recharts-tooltip-label",c);return g&&h&&null!=s&&(m=h(u,s)),Q.createElement("div",yi({className:y,style:f},d?{role:"status","aria-live":"assertive"}:{}),Q.createElement("p",{className:v,style:p},Q.isValidElement(m)?m:"".concat(m)),(()=>{if(s&&s.length){var e=(o?(0,iJ.default)(s,o):s).map((e,r)=>{if("none"===e.type)return null;var n=e.formatter||a||ya,{value:o,name:l}=e,c=o,u=l;if(n){var h=n(o,l,e,r,s);if(Array.isArray(h))[c,u]=h;else{if(null==h)return null;c=h}}var d=ys({display:"block",paddingTop:4,paddingBottom:4,color:e.color||"#000"},i);return Q.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(r),style:d},eZ(u)?Q.createElement("span",{className:"recharts-tooltip-item-name"},u):null,eZ(u)?Q.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,Q.createElement("span",{className:"recharts-tooltip-item-value"},c),Q.createElement("span",{className:"recharts-tooltip-item-unit"},e.unit||""))});return Q.createElement("ul",{className:"recharts-tooltip-item-list",style:{padding:0,margin:0}},e)}return null})())},yl=Q,yc="recharts-tooltip-wrapper",yu={visibility:"hidden"};function yh(e){var{allowEscapeViewBox:t,coordinate:r,key:i,offsetTopLeft:n,position:s,reverseDirection:a,tooltipDimension:o,viewBox:l,viewBoxDimension:c}=e;if(s&&eK(s[i]))return s[i];var u=r[i]-o-(n>0?n:0),h=r[i]+n;if(t[i])return a[i]?u:h;var d=l[i];return null==d?0:a[i]?u<d?Math.max(h,d):Math.max(u,d):null==c?0:h+o>d+c?Math.max(u,d):Math.max(h,d)}function yd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yd(Object(r),!0).forEach(function(t){yp(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yp(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class yg extends yl.PureComponent{constructor(){super(...arguments),yp(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),yp(this,"handleKeyDown",e=>{if("Escape"===e.key){var t,r,i,n;this.setState({dismissed:!0,dismissedAtCoordinate:{x:null!=(t=null==(r=this.props.coordinate)?void 0:r.x)?t:0,y:null!=(i=null==(n=this.props.coordinate)?void 0:n.y)?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,t;this.state.dismissed&&((null==(e=this.props.coordinate)?void 0:e.x)!==this.state.dismissedAtCoordinate.x||(null==(t=this.props.coordinate)?void 0:t.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:t,animationDuration:r,animationEasing:i,children:n,coordinate:s,hasPayload:a,isAnimationActive:o,offset:l,position:c,reverseDirection:u,useTranslate3d:h,viewBox:d,wrapperStyle:f,lastBoundingBox:p,innerRef:g,hasPortalFromProps:m}=this.props,{cssClasses:y,cssProperties:v}=function(e){var t,r,i,{allowEscapeViewBox:n,coordinate:s,offsetTopLeft:a,position:o,reverseDirection:l,tooltipBox:c,useTranslate3d:u,viewBox:h}=e;return{cssProperties:t=c.height>0&&c.width>0&&s?function(e){var{translateX:t,translateY:r,useTranslate3d:i}=e;return{transform:i?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}({translateX:r=yh({allowEscapeViewBox:n,coordinate:s,key:"x",offsetTopLeft:a,position:o,reverseDirection:l,tooltipDimension:c.width,viewBox:h,viewBoxDimension:h.width}),translateY:i=yh({allowEscapeViewBox:n,coordinate:s,key:"y",offsetTopLeft:a,position:o,reverseDirection:l,tooltipDimension:c.height,viewBox:h,viewBoxDimension:h.height}),useTranslate3d:u}):yu,cssClasses:function(e){var{coordinate:t,translateX:r,translateY:i}=e;return eu(yc,{["".concat(yc,"-right")]:eK(r)&&t&&eK(t.x)&&r>=t.x,["".concat(yc,"-left")]:eK(r)&&t&&eK(t.x)&&r<t.x,["".concat(yc,"-bottom")]:eK(i)&&t&&eK(t.y)&&i>=t.y,["".concat(yc,"-top")]:eK(i)&&t&&eK(t.y)&&i<t.y})}({translateX:r,translateY:i,coordinate:s})}}({allowEscapeViewBox:t,coordinate:s,offsetTopLeft:l,position:c,reverseDirection:u,tooltipBox:{height:p.height,width:p.width},useTranslate3d:h,viewBox:d}),b=m?{}:yf(yf({transition:o&&e?"transform ".concat(r,"ms ").concat(i):void 0},v),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&a?"visible":"hidden",position:"absolute",top:0,left:0}),x=yf(yf({},b),{},{visibility:!this.state.dismissed&&e&&a?"visible":"hidden"},f);return yl.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:y,style:x,ref:g},n)}}var ym=e.i(92809),yy=["x","y","top","left","width","height","className"];function yv(){return(yv=Object.assign.bind()).apply(null,arguments)}function yb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}var yx=e=>{var{x:t=0,y:r=0,top:i=0,left:n=0,width:s=0,height:a=0,className:o}=e,l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yb(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yb(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({x:t,y:r,top:i,left:n,width:s,height:a},function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,yy));return eK(t)&&eK(r)&&eK(s)&&eK(a)&&eK(i)&&eK(n)?Q.createElement("path",yv({},tu(l),{className:eu("recharts-cross",o),d:"M".concat(t,",").concat(i,"v").concat(a,"M").concat(n,",").concat(r,"h").concat(s)})):null},yw=["radius"],y_=["radius"];function yk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yP(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yk(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yS(){return(yS=Object.assign.bind()).apply(null,arguments)}function yE(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var yA=(e,t,r,i,n)=>{var s,a=Math.min(Math.abs(r)/2,Math.abs(i)/2),o=i>=0?1:-1,l=r>=0?1:-1,c=+(i>=0&&r>=0||i<0&&r<0);if(a>0&&n instanceof Array){for(var u=[0,0,0,0],h=0;h<4;h++)u[h]=n[h]>a?a:n[h];s="M".concat(e,",").concat(t+o*u[0]),u[0]>0&&(s+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(c,",").concat(e+l*u[0],",").concat(t)),s+="L ".concat(e+r-l*u[1],",").concat(t),u[1]>0&&(s+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(c,",\n        ").concat(e+r,",").concat(t+o*u[1])),s+="L ".concat(e+r,",").concat(t+i-o*u[2]),u[2]>0&&(s+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(c,",\n        ").concat(e+r-l*u[2],",").concat(t+i)),s+="L ".concat(e+l*u[3],",").concat(t+i),u[3]>0&&(s+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(c,",\n        ").concat(e,",").concat(t+i-o*u[3])),s+="Z"}else if(a>0&&n===+n&&n>0){var d=Math.min(a,n);s="M ".concat(e,",").concat(t+o*d,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+l*d,",").concat(t,"\n            L ").concat(e+r-l*d,",").concat(t,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+r,",").concat(t+o*d,"\n            L ").concat(e+r,",").concat(t+i-o*d,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e+r-l*d,",").concat(t+i,"\n            L ").concat(e+l*d,",").concat(t+i,"\n            A ").concat(d,",").concat(d,",0,0,").concat(c,",").concat(e,",").concat(t+i-o*d," Z")}else s="M ".concat(e,",").concat(t," h ").concat(r," v ").concat(i," h ").concat(-r," Z");return s},yM={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},yT=e=>{let t,r;var i=n6(e,yM),n=(0,Q.useRef)(null),[s,a]=(0,Q.useState)(-1);(0,Q.useEffect)(()=>{if(n.current&&n.current.getTotalLength)try{var e=n.current.getTotalLength();e&&a(e)}catch(e){}},[]);var{x:o,y:l,width:c,height:u,radius:h,className:d}=i,{animationEasing:f,animationDuration:p,animationBegin:g,isAnimationActive:m,isUpdateAnimationActive:y}=i,v=(0,Q.useRef)(c),b=(0,Q.useRef)(u),x=(0,Q.useRef)(o),w=(0,Q.useRef)(l),_=fP((0,Q.useMemo)(()=>({x:o,y:l,width:c,height:u,radius:h}),[o,l,c,u,h]),"rectangle-");if(o!==+o||l!==+l||c!==+c||u!==+u||0===c||0===u)return null;var k=eu("recharts-rectangle",d);if(!y){var P=tu(i),{radius:S}=P,E=yE(P,yw);return Q.createElement("path",yS({},E,{radius:"number"==typeof h?h:void 0,className:k,d:yA(o,l,c,u,h)}))}var A=v.current,M=b.current,T=x.current,C=w.current,O="0px ".concat(-1===s?1:s,"px"),I="".concat(s,"px 0px"),L=(t=["strokeDasharray"],r="string"==typeof f?f:void 0,t.map(e=>"".concat(e.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase()))," ").concat(p,"ms ").concat(r)).join(","));return Q.createElement(f1,{animationId:_,key:_,canBegin:s>0,duration:p,easing:f,isActive:y,begin:g},e=>{var t,r=e0(A,c,e),s=e0(M,u,e),a=e0(T,o,e),d=e0(C,l,e);n.current&&(v.current=r,b.current=s,x.current=a,w.current=d),t=m?e>0?{transition:L,strokeDasharray:I}:{strokeDasharray:O}:{strokeDasharray:I};var f=tu(i),{radius:p}=f,g=yE(f,y_);return Q.createElement("path",yS({},g,{radius:"number"==typeof h?h:void 0,className:k,d:yA(a,d,r,s,h),ref:n,style:yP(yP({},t),i.style)}))})};function yC(e){var{cx:t,cy:r,radius:i,startAngle:n,endAngle:s}=e;return{points:[tq(t,r,i,n),tq(t,r,i,s)],cx:t,cy:r,radius:i,startAngle:n,endAngle:s}}function yO(){return(yO=Object.assign.bind()).apply(null,arguments)}var yI=e=>{var{cx:t,cy:r,radius:i,angle:n,sign:s,isExternal:a,cornerRadius:o,cornerIsExternal:l}=e,c=o*(a?1:-1)+i,u=Math.asin(o/c)/tG,h=l?n:n+s*u,d=tq(t,r,c,h);return{center:d,circleTangency:tq(t,r,i,h),lineTangency:tq(t,r,c*Math.cos(u*tG),l?n-s*u:n),theta:u}},yL=e=>{var{cx:t,cy:r,innerRadius:i,outerRadius:n,startAngle:s,endAngle:a}=e,o=eG(a-s)*Math.min(Math.abs(a-s),359.999),l=s+o,c=tq(t,r,n,s),u=tq(t,r,n,l),h="M ".concat(c.x,",").concat(c.y,"\n    A ").concat(n,",").concat(n,",0,\n    ").concat(+(Math.abs(o)>180),",").concat(+(s>l),",\n    ").concat(u.x,",").concat(u.y,"\n  ");if(i>0){var d=tq(t,r,i,s),f=tq(t,r,i,l);h+="L ".concat(f.x,",").concat(f.y,"\n            A ").concat(i,",").concat(i,",0,\n            ").concat(+(Math.abs(o)>180),",").concat(+(s<=l),",\n            ").concat(d.x,",").concat(d.y," Z")}else h+="L ".concat(t,",").concat(r," Z");return h},yj={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},yN=e=>{var t,r=n6(e,yj),{cx:i,cy:n,innerRadius:s,outerRadius:a,cornerRadius:o,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:h,className:d}=r;if(a<s||u===h)return null;var f=eu("recharts-sector",d),p=a-s,g=eJ(o,p,0,!0);return t=g>0&&360>Math.abs(u-h)?(e=>{var{cx:t,cy:r,innerRadius:i,outerRadius:n,cornerRadius:s,forceCornerRadius:a,cornerIsExternal:o,startAngle:l,endAngle:c}=e,u=eG(c-l),{circleTangency:h,lineTangency:d,theta:f}=yI({cx:t,cy:r,radius:n,angle:l,sign:u,cornerRadius:s,cornerIsExternal:o}),{circleTangency:p,lineTangency:g,theta:m}=yI({cx:t,cy:r,radius:n,angle:c,sign:-u,cornerRadius:s,cornerIsExternal:o}),y=o?Math.abs(l-c):Math.abs(l-c)-f-m;if(y<0)return a?"M ".concat(d.x,",").concat(d.y,"\n        a").concat(s,",").concat(s,",0,0,1,").concat(2*s,",0\n        a").concat(s,",").concat(s,",0,0,1,").concat(-(2*s),",0\n      "):yL({cx:t,cy:r,innerRadius:i,outerRadius:n,startAngle:l,endAngle:c});var v="M ".concat(d.x,",").concat(d.y,"\n    A").concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(h.x,",").concat(h.y,"\n    A").concat(n,",").concat(n,",0,").concat(+(y>180),",").concat(+(u<0),",").concat(p.x,",").concat(p.y,"\n    A").concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(g.x,",").concat(g.y,"\n  ");if(i>0){var{circleTangency:b,lineTangency:x,theta:w}=yI({cx:t,cy:r,radius:i,angle:l,sign:u,isExternal:!0,cornerRadius:s,cornerIsExternal:o}),{circleTangency:_,lineTangency:k,theta:P}=yI({cx:t,cy:r,radius:i,angle:c,sign:-u,isExternal:!0,cornerRadius:s,cornerIsExternal:o}),S=o?Math.abs(l-c):Math.abs(l-c)-w-P;if(S<0&&0===s)return"".concat(v,"L").concat(t,",").concat(r,"Z");v+="L".concat(k.x,",").concat(k.y,"\n      A").concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(_.x,",").concat(_.y,"\n      A").concat(i,",").concat(i,",0,").concat(+(S>180),",").concat(+(u>0),",").concat(b.x,",").concat(b.y,"\n      A").concat(s,",").concat(s,",0,0,").concat(+(u<0),",").concat(x.x,",").concat(x.y,"Z")}else v+="L".concat(t,",").concat(r,"Z");return v})({cx:i,cy:n,innerRadius:s,outerRadius:a,cornerRadius:Math.min(g,p/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:h}):yL({cx:i,cy:n,innerRadius:s,outerRadius:a,startAngle:u,endAngle:h}),Q.createElement("path",yO({},tu(r),{className:f,d:t}))};function yD(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yR(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yD(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yD(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yz(){return(yz=Object.assign.bind()).apply(null,arguments)}function yF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yF(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yU(e){var t,r,i,{coordinate:n,payload:s,index:a,offset:o,tooltipAxisBandSize:l,layout:c,cursor:u,tooltipEventType:h,chartName:d}=e;if(!u||!n||"ScatterChart"!==d&&"axis"!==h)return null;if("ScatterChart"===d)r=n,i=yx;else if("BarChart"===d)t=l/2,r={stroke:"none",fill:"#ccc",x:"horizontal"===c?n.x-t:o.left+.5,y:"horizontal"===c?o.top+.5:n.y-t,width:"horizontal"===c?l:o.width-1,height:"horizontal"===c?o.height-1:l},i=yT;else if("radial"===c){var{cx:f,cy:p,radius:g,startAngle:m,endAngle:y}=yC(n);r={cx:f,cy:p,startAngle:m,endAngle:y,innerRadius:g,outerRadius:g},i=yN}else r={points:function(e,t,r){var i,n,s,a;if("horizontal"===e)s=i=t.x,n=r.top,a=r.top+r.height;else if("vertical"===e)a=n=t.y,i=r.left,s=r.left+r.width;else if(null!=t.cx&&null!=t.cy)if("centric"!==e)return yC(t);else{var{cx:o,cy:l,innerRadius:c,outerRadius:u,angle:h}=t,d=tq(o,l,c,h),f=tq(o,l,u,h);i=d.x,n=d.y,s=f.x,a=f.y}return[{x:i,y:n},{x:s,y:a}]}(c,n,o)},i=to;var v="object"==typeof u&&"className"in u?u.className:void 0,b=yB(yB(yB(yB({stroke:"#ccc",pointerEvents:"none"},o),r),e9(u)),{},{payload:s,payloadIndex:a,className:eu("recharts-tooltip-cursor",v)});return(0,Q.isValidElement)(u)?(0,Q.cloneElement)(u,b):(0,Q.createElement)(i,b)}function y$(e){var t,r,i,n=(t=t0(cH),r=t0(dM),i=t0(dS),ns(yR(yR({},t),{},{scale:i}),r)),s=nB(),a=t0(nU),o=t0(cz);return Q.createElement(yU,yz({},e,{coordinate:e.coordinate,index:e.index,payload:e.payload,offset:s,layout:a,tooltipAxisBandSize:n,chartName:o}))}function yV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yW(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yV(Object(r),!0).forEach(function(t){var i,n,s;i=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in i?Object.defineProperty(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yV(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yG(e){return e.dataKey}var yq=[],yH={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!tm.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function yK(e){var t,r,i,n,s,a,o,l,c,u=n6(e,yH),{active:h,allowEscapeViewBox:d,animationDuration:f,animationEasing:p,content:g,filterNull:m,isAnimationActive:y,offset:v,payloadUniqBy:b,position:x,reverseDirection:w,useTranslate3d:_,wrapperStyle:k,cursor:P,shared:S,trigger:E,defaultIndex:A,portal:M,axisId:T}=u,C=tY(),O="number"==typeof A?String(A):A;(0,Q.useEffect)(()=>{C(hR({shared:S,trigger:E,axisId:T,active:h,defaultIndex:O}))},[C,S,E,T,h,O]);var I=nz(),L=gb(),j=t0(e=>hO(e,S)),{activeIndex:N,isActive:D}=t0(e=>fg(e,j,E,O)),R=t0(e=>fp(e,j,E,O)),z=t0(e=>ff(e,j,E,O)),F=t0(e=>fd(e,j,E,O)),B=(0,Q.useContext)(gR),U=null!=h?h:D,[$,V]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,r]=(0,Q.useState)({height:0,left:0,top:0,width:0}),i=(0,Q.useCallback)(e=>{if(null!=e){var i=e.getBoundingClientRect(),n={height:i.height,left:i.left,top:i.top,width:i.width};(Math.abs(n.height-t.height)>1||Math.abs(n.left-t.left)>1||Math.abs(n.top-t.top)>1||Math.abs(n.width-t.width)>1)&&r({height:n.height,left:n.left,top:n.top,width:n.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,i]}([R,U]),W="axis"===j?z:void 0;t=t0(e=>((e,t,r)=>{if(null!=t){var i=h0(e);return"axis"===t?"hover"===r?i.axisInteraction.hover.dataKey:i.axisInteraction.click.dataKey:"hover"===r?i.itemInteraction.hover.dataKey:i.itemInteraction.click.dataKey}})(e,j,E)),r=t0(cU),i=t0(cF),n=t0(cB),a=null==(s=t0(gI))?void 0:s.active,o=nz(),(0,Q.useEffect)(()=>{if(!a&&null!=i&&null!=r){var e=hW({active:U,coordinate:F,dataKey:t,index:N,label:"number"==typeof W?String(W):W,sourceViewBox:o});gT.emit(gC,i,e,r)}},[a,F,t,N,W,r,i,n,U,o]);var G=null!=M?M:B;if(null==G)return null;var q=null!=R?R:yq;U||(q=yq),m&&q.length&&(l=R.filter(e=>null!=e.value&&(!0!==e.hide||u.includeHidden)),q=!0===b?(0,ym.default)(l,yG):"function"==typeof b?(0,ym.default)(l,b):l);var H=q.length>0,K=Q.createElement(yg,{allowEscapeViewBox:d,animationDuration:f,animationEasing:p,isAnimationActive:y,active:U,coordinate:F,hasPayload:H,offset:v,position:x,reverseDirection:w,useTranslate3d:_,viewBox:I,wrapperStyle:k,lastBoundingBox:$,innerRef:V,hasPortalFromProps:!!M},(c=yW(yW({},u),{},{payload:q,label:W,active:U,coordinate:F,accessibilityLayer:L}),Q.isValidElement(g)?Q.cloneElement(g,c):"function"==typeof g?Q.createElement(g,c):Q.createElement(yo,c)));return Q.createElement(Q.Fragment,null,(0,yr.createPortal)(K,G),U&&Q.createElement(y$,{cursor:P,tooltipEventType:j,coordinate:F,payload:R,index:N}))}var yZ=["dangerouslySetInnerHTML","ticks"],yY=["id"],yX=["domain"],yJ=["domain"];function yQ(){return(yQ=Object.assign.bind()).apply(null,arguments)}function y0(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function y1(e){var t=tY();return(0,Q.useLayoutEffect)(()=>(t(dG(e)),()=>{t(dq(e))}),[e,t]),null}var y2=e=>{var{xAxisId:t,className:r}=e,i=t0(nv),n=nx(),s="xAxis",a=t0(e=>hs(e,s,t,n)),o=t0(e=>hk(e,s,t,n)),l=t0(e=>hd(e,t)),c=t0(e=>hg(e,t)),u=t0(e=>c3(e,t));if(null==l||null==c||null==u)return null;var{dangerouslySetInnerHTML:h,ticks:d}=e,f=y0(e,yZ),{id:p}=u,g=y0(u,yY);return Q.createElement(mp,yQ({},f,g,{scale:a,x:c.x,y:c.y,width:l.width,height:l.height,className:eu("recharts-".concat(s," ").concat(s),r),viewBox:i,ticks:o}))},y3={allowDataOverflow:c2.allowDataOverflow,allowDecimals:c2.allowDecimals,allowDuplicatedCategory:c2.allowDuplicatedCategory,height:c2.height,hide:!1,mirror:c2.mirror,orientation:c2.orientation,padding:c2.padding,reversed:c2.reversed,scale:c2.scale,tickCount:c2.tickCount,type:c2.type,xAxisId:0},y4=Q.memo(e=>{var t,r,i,n,s,a=n6(e,y3);return Q.createElement(Q.Fragment,null,Q.createElement(y1,{interval:null!=(t=a.interval)?t:"preserveEnd",id:a.xAxisId,scale:a.scale,type:a.type,padding:a.padding,allowDataOverflow:a.allowDataOverflow,domain:a.domain,dataKey:a.dataKey,allowDuplicatedCategory:a.allowDuplicatedCategory,allowDecimals:a.allowDecimals,tickCount:a.tickCount,includeHidden:null!=(r=a.includeHidden)&&r,reversed:a.reversed,ticks:a.ticks,height:a.height,orientation:a.orientation,mirror:a.mirror,hide:a.hide,unit:a.unit,name:a.name,angle:null!=(i=a.angle)?i:0,minTickGap:null!=(n=a.minTickGap)?n:5,tick:null==(s=a.tick)||s,tickFormatter:a.tickFormatter}),Q.createElement(y2,a))},(e,t)=>{var{domain:r}=e,i=y0(e,yX),{domain:n}=t;return!!me(i,y0(t,yJ))&&(Array.isArray(r)&&2===r.length&&Array.isArray(n)&&2===n.length?r[0]===n[0]&&r[1]===n[1]:me({domain:r},{domain:n}))});y4.displayName="XAxis";var y5=["dangerouslySetInnerHTML","ticks"],y6=["id"],y8=["domain"],y7=["domain"];function y9(){return(y9=Object.assign.bind()).apply(null,arguments)}function ve(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r={};for(var i in e)if(({}).hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;r[i]=e[i]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)r=s[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function vt(e){var t=tY();return(0,Q.useLayoutEffect)(()=>(t(dH(e)),()=>{t(dK(e))}),[e,t]),null}var vr=e=>{var{yAxisId:t,className:r,width:i,label:n}=e,s=(0,Q.useRef)(null),a=(0,Q.useRef)(null),o=t0(nv),l=nx(),c=tY(),u="yAxis",h=t0(e=>hs(e,u,t,l)),d=t0(e=>hy(e,t)),f=t0(e=>hm(e,t)),p=t0(e=>hk(e,u,t,l)),g=t0(e=>c6(e,t));if((0,Q.useLayoutEffect)(()=>{if(!("auto"!==i||!d||ss(n)||(0,Q.isValidElement)(n))&&null!=g){var e=s.current;if(e){var r=e.getCalculatedWidth();Math.round(d.width)!==Math.round(r)&&c(dX({id:t,width:r}))}}},[p,d,c,n,t,i,g]),null==d||null==f||null==g)return null;var{dangerouslySetInnerHTML:m,ticks:y}=e,v=ve(e,y5),{id:b}=g,x=ve(g,y6);return Q.createElement(mp,y9({},v,x,{ref:s,labelRef:a,scale:h,x:f.x,y:f.y,tickTextProps:"auto"===i?{width:void 0}:{width:i},width:d.width,height:d.height,className:eu("recharts-".concat(u," ").concat(u),r),viewBox:o,ticks:p}))},vi={allowDataOverflow:c5.allowDataOverflow,allowDecimals:c5.allowDecimals,allowDuplicatedCategory:c5.allowDuplicatedCategory,hide:!1,mirror:c5.mirror,orientation:c5.orientation,padding:c5.padding,reversed:c5.reversed,scale:c5.scale,tickCount:c5.tickCount,type:c5.type,width:c5.width,yAxisId:0},vn=Q.memo(e=>{var t,r,i,n,s,a=n6(e,vi);return Q.createElement(Q.Fragment,null,Q.createElement(vt,{interval:null!=(t=a.interval)?t:"preserveEnd",id:a.yAxisId,scale:a.scale,type:a.type,domain:a.domain,allowDataOverflow:a.allowDataOverflow,dataKey:a.dataKey,allowDuplicatedCategory:a.allowDuplicatedCategory,allowDecimals:a.allowDecimals,tickCount:a.tickCount,padding:a.padding,includeHidden:null!=(r=a.includeHidden)&&r,reversed:a.reversed,ticks:a.ticks,width:a.width,orientation:a.orientation,mirror:a.mirror,hide:a.hide,unit:a.unit,name:a.name,angle:null!=(i=a.angle)?i:0,minTickGap:null!=(n=a.minTickGap)?n:5,tick:null==(s=a.tick)||s,tickFormatter:a.tickFormatter}),Q.createElement(vr,a))},(e,t)=>{var{domain:r}=e,i=ve(e,y8),{domain:n}=t;return!!me(i,ve(t,y7))&&(Array.isArray(r)&&2===r.length&&Array.isArray(n)&&2===n.length?r[0]===n[0]&&r[1]===n[1]:me({domain:r},{domain:n}))});vn.displayName="YAxis";let vs=1,va=1;class vo{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:r=1/0,rate:i=1,repeat:n=1}=e,s=vs++,a={time:0,delay:t,duration:r,rate:i,repeat:n};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(e){for(let[t,r]of(this.channels.delete(e),this.animations))r.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;let t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){for(let t of(this.time=Math.max(0,e),this.channels.values()))this._setChannelTime(t,this.time);for(let e of this.animations.values()){let{animation:t,channel:r}=e;t.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let r=va++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function vl(e,t){if(!e)throw Error(t||"shadertools: assertion failed.")}let vc={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function vu(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}let vh={vertex:`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`\
#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},vd=/void\s+main\s*\([^)]*\)\s*\{\n?/,vf=/}\n?[^{}]*$/,vp=[],vg="__LUMA_INJECT_DECLARATIONS__";function vm(e,t,r,i=!1){let n="vertex"===t;for(let t in r){let i=r[t];i.sort((e,t)=>e.order-t.order),vp.length=i.length;for(let e=0,t=i.length;e<t;++e)vp[e]=i[e].injection;let s=`${vp.join("\n")}
`;switch(t){case"vs:#decl":n&&(e=e.replace(vg,s));break;case"vs:#main-start":n&&(e=e.replace(vd,e=>e+s));break;case"vs:#main-end":n&&(e=e.replace(vf,e=>s+e));break;case"fs:#decl":n||(e=e.replace(vg,s));break;case"fs:#main-start":n||(e=e.replace(vd,e=>e+s));break;case"fs:#main-end":n||(e=e.replace(vf,e=>s+e));break;default:e=e.replace(t,e=>e+s)}}return e=e.replace(vg,""),i&&(e=e.replace(/\}\s*$/,e=>e+vh[t])),e}function vy(e){e.map(e=>(function(e){var t;if(e.instance)return;vy(e.dependencies||[]);let{propTypes:r={},deprecations:i=[],inject:n={}}=e,s={normalizedInjections:function(e){let t={vertex:{},fragment:{}};for(let r in e){let i=e[r];"string"==typeof i&&(i={order:0,injection:i}),t[function(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw Error(t)}}(r)][r]=i}return t}(n),parsedDeprecations:((t=i).forEach(e=>{"function"===e.type?e.regex=RegExp(`\\b${e.old}\\(`):e.regex=RegExp(`${e.type} ${e.old};`)}),t)};r&&(s.propValidators=function(e){let t={};for(let[r,i]of Object.entries(e))t[r]=function(e){let t=vu(e);if("object"!==t)return{value:e,...vc[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...vc[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=vu(e.value),{...e,...vc[t],type:t}):{type:"object",value:null};throw Error("props")}(i);return t}(r)),e.instance=s;let a={};r&&(a=Object.entries(r).reduce((e,[t,r])=>{let i=r?.value;return i&&(e[t]=i),e},{})),e.defaultUniforms={...e.defaultUniforms,...a}})(e))}function vv(e,t,r){e.deprecations?.forEach(e=>{e.regex?.test(t)&&(e.deprecated?r.deprecated(e.old,e.new)():r.removed(e.old,e.new)())})}function vb(e){vy(e);let t={},r={};!function e(t){let{modules:r,level:i,moduleMap:n,moduleDepth:s}=t;if(i>=5)throw Error("Possible loop in shader dependency graph");for(let e of r)n[e.name]=e,(void 0===s[e.name]||s[e.name]<i)&&(s[e.name]=i);for(let t of r)t.dependencies&&e({modules:t.dependencies,level:i+1,moduleMap:n,moduleDepth:s})}({modules:e,level:0,moduleMap:t,moduleDepth:r});let i=Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e]);return vy(i),i}let vx=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],vw=[...vx,[vP("attribute"),"in $1"],[vP("varying"),"out $1"]],v_=[...vx,[vP("varying"),"in $1"]];function vk(e,t){for(let[r,i]of t)e=e.replace(r,i);return e}function vP(e){return RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function vS(e,t){let r="";for(let i in e){let n=e[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),t[i]){let e=t[i];for(let t of(e.sort((e,t)=>e.order-t.order),e))r+=`  ${t.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+="}\n"}return r}function vE(e){let t={vertex:{},fragment:{}};for(let r of e){let e,i;"string"!=typeof r?i=(e=r).hook:(e={},i=r);let[n,s]=(i=i.trim()).split(":"),a=i.replace(/\(.+/,""),o=Object.assign(e,{signature:s});switch(n){case"vs":t.vertex[a]=o;break;case"fs":t.fragment[a]=o;break;default:throw Error(n)}}return t}let vA=`

${vg}
`,vM=`\
precision highp float;
`;function vT(e,t){let{source:r,stage:i,language:n="glsl",modules:s,defines:a={},hookFunctions:o=[],inject:l={},prologue:c=!0,log:u}=t;vl("string"==typeof r,"shader source must be a string");let h="glsl"===n?({name:function(e,t="unnamed"){let r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return r?r[1]:t}(r,void 0),language:"glsl",version:function(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&"#version"===r[0]){let e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw Error(`Invalid GLSL version ${t}`);return t}(r)}).version:-1,d=e.shaderLanguageVersion,f=100===h?"#version 100":"#version 300 es",p=r.split("\n").slice(1).join("\n"),g={};s.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,a);let m="";switch(n){case"wgsl":break;case"glsl":m=c?`\
${f}

// ----- PROLOGUE -------------------------
#define SHADER_TYPE_${i.toUpperCase()}

${function(e){switch(e?.gpu.toLowerCase()){case"apple":return`\
#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`\
#define AMD_GPU
`;default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}(e)}
${"fragment"===i?vM:""}

// ----- APPLICATION DEFINES -------------------------

${function(e={}){let t="";for(let r in e){let i=e[r];(i||Number.isFinite(i))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}(g)}

`:`${f}
`}let y=vE(o),v={},b={},x={};for(let e in l){let t="string"==typeof l[e]?{injection:l[e],order:0}:l[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],n=r[3];i?"decl"===n?b[e]=[t]:x[e]=[t]:v[e]=[t]}else x[e]=[t]}for(let e of s){u&&vv(e,p,u),m+=vO(e,i);let t=e.instance?.normalizedInjections[i]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?b:x;i[e]=i[e]||[],i[e].push(t[e])}else v[e]=v[e]||[],v[e].push(t[e])}}return m+="// ----- MAIN SHADER SOURCE -------------------------",m+=vA,m=vm(m,i,b)+vS(y[i],v)+p,m=vm(m,i,x),"glsl"===n&&h!==d&&(m=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return vk(e,vw);case"fragment":return vk(e,v_);default:throw Error(t)}}(m,i)),m.trim()}function vC(e){return function(t){let r={};for(let i of e){let e=i.getUniforms?.(t,r);Object.assign(r,e)}return r}}function vO(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:vl(!1)}if(!e.name)throw Error("Shader module must have a name");let i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`\
// ----- MODULE ${e.name} ---------------

`;return"wgsl"!==t&&(n+=`#define MODULE_${i}
`),n+=`${r}
`}let vI=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,vL=/^\s*\#\s*endif\s*$/;class vj{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return vj.defaultShaderAssembler=vj.defaultShaderAssembler||new vj,vj.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){var t;let r,i=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:a}=(r=vb((t={...e,source:e.source,modules:i,hookFunctions:n}).modules||[]),{source:function(e,t){let{source:r,stage:i,modules:n,hookFunctions:s=[],inject:a={},log:o}=t;vl("string"==typeof r,"shader source must be a string");let l="",c=vE(s),u={},h={},d={};for(let e in a){let t="string"==typeof a[e]?{injection:a[e],order:0}:a[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],n=r[3];i?"decl"===n?h[e]=[t]:d[e]=[t]:u[e]=[t]}else d[e]=[t]}for(let e of n){o&&vv(e,r,o),l+=vO(e,"wgsl");let t=e.injections?.[i]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?h:d;i[e]=i[e]||[],i[e].push(t[e])}else u[e]=u[e]||[],u[e].push(t[e])}}return l+=vA,l=vm(l,i,h)+vS(c[i],u)+r,l=vm(l,i,d)}(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:r}),getUniforms:vC(r)});return{source:"wgsl"===e.platformInfo.shaderLanguage?function(e,t){let r=e.split("\n"),i=[],n=!0;for(let e of r){let t=e.match(vI),r=e.match(vL);t?(t[1],n=!1):r?n=!0:n&&i.push(e)}return i.join("\n")}(s):s,getUniforms:a,modules:i}}assembleGLSLShaderPair(e){let t=this._getModuleList(e.modules),r=this._hookFunctions;return{...function(e){let{vs:t,fs:r}=e,i=vb(e.modules||[]);return{vs:vT(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:vT(e.platformInfo,{...e,source:r,stage:"fragment",modules:i}),getUniforms:vC(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){let t=Array(this._defaultModules.length+e.length),r={},i=0;for(let e=0,n=this._defaultModules.length;e<n;++e){let n=this._defaultModules[e],s=n.name;t[i++]=n,r[s]=!0}for(let n=0,s=e.length;n<s;++n){let s=e[n],a=s.name;r[a]||(t[i++]=s,r[a]=!0)}return t.length=i,vy(t),t}}var vN=e.i(12828);let vD=`\
precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,vR=`\
// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;(_=$||($={}))[_.POINT=0]="POINT",_[_.DIRECTIONAL=1]="DIRECTIONAL";let vz={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:$.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:vR,vs:vD,fs:vD,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...vz.defaultUniforms};e.lights&&(e={...e,...function(e){let t={pointLights:[],directionalLights:[]};for(let r of e||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r)}return t}(e.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:n}=e||{};if(!(r||i&&i.length>0||n&&n.length>0))return{...vz.defaultUniforms,enabled:0};let s={...vz.defaultUniforms,...t,...function({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let i={};i.ambientColor=vF(e);let n=0;for(let e of t){i.lightType=$.POINT;let t=n;i[`lightColor${t}`]=vF(e),i[`lightPosition${t}`]=e.position,i[`lightAttenuation${t}`]=e.attenuation||[1,0,0],n++}for(let e of r){i.lightType=$.DIRECTIONAL;let t=n;i[`lightColor${t}`]=vF(e),i[`lightDirection${t}`]=e.direction,n++}return n>5&&vN.log.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=t.length,i}({ambientLight:r,pointLights:i,directionalLights:n})};return void 0!==e.enabled&&(s.enabled=+!!e.enabled),s}};function vF(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(e=>e*r/255)}let vB=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,vU=`\
#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,v$=`\
struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,vV={props:{},name:"gouraudMaterial",vs:vU.replace("phongMaterial","gouraudMaterial"),fs:vB.replace("phongMaterial","gouraudMaterial"),source:v$.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[vz],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...vV.defaultUniforms,...t}}},vW={name:"phongMaterial",dependencies:[vz],source:v$,vs:vB,fs:vU,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...vW.defaultUniforms,...t}}},vG=`\
uniform layerUniforms {
  uniform float opacity;
} layer;
`,vq={name:"layer",vs:vG,fs:vG,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},vH={name:"color",dependencies:[],source:`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},vK="#define SMOOTH_EDGE_RADIUS 0.5",vZ={name:"geometry",source:`\
const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,vs:`\
${vK}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs:`\
${vK}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`},vY=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,vX="undefined"!=typeof Float32Array?Float32Array:Array,vJ=Math.random;function vQ(e){return e>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e)}function v0(){let e=new vX(16);return vX!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function v1(e){let t=new vX(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function v2(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function v3(e,t,r,i,n,s,a,o,l,c,u,h,d,f,p,g){let m=new vX(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=l,m[9]=c,m[10]=u,m[11]=h,m[12]=d,m[13]=f,m[14]=p,m[15]=g,m}function v4(e,t,r,i,n,s,a,o,l,c,u,h,d,f,p,g,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=g,e[15]=m,e}function v5(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v6(e,t){if(e===t){let r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function v8(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=r*o-i*a,b=r*l-n*a,x=r*c-s*a,w=i*l-n*o,_=i*c-s*o,k=n*c-s*l,P=u*g-h*p,S=u*m-d*p,E=u*y-f*p,A=h*m-d*g,M=h*y-f*g,T=d*y-f*m,C=v*T-b*M+x*A+w*E-_*S+k*P;return C?(C=1/C,e[0]=(o*T-l*M+c*A)*C,e[1]=(n*M-i*T-s*A)*C,e[2]=(g*k-m*_+y*w)*C,e[3]=(d*_-h*k-f*w)*C,e[4]=(l*E-a*T-c*S)*C,e[5]=(r*T-n*E+s*S)*C,e[6]=(m*x-p*k-y*b)*C,e[7]=(u*k-d*x+f*b)*C,e[8]=(a*M-o*E+c*P)*C,e[9]=(i*E-r*M-s*P)*C,e[10]=(p*_-g*x+y*v)*C,e[11]=(h*x-u*_-f*v)*C,e[12]=(o*S-a*A-l*P)*C,e[13]=(r*A-i*S+n*P)*C,e[14]=(g*b-p*w-m*v)*C,e[15]=(u*w-h*b+d*v)*C,e):null}function v7(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=r*o-i*a,b=r*l-n*a,x=r*c-s*a,w=i*l-n*o,_=i*c-s*o,k=n*c-s*l,P=u*g-h*p,S=u*m-d*p,E=u*y-f*p,A=h*m-d*g,M=h*y-f*g,T=d*y-f*m;return e[0]=o*T-l*M+c*A,e[1]=n*M-i*T-s*A,e[2]=g*k-m*_+y*w,e[3]=d*_-h*k-f*w,e[4]=l*E-a*T-c*S,e[5]=r*T-n*E+s*S,e[6]=m*x-p*k-y*b,e[7]=u*k-d*x+f*b,e[8]=a*M-o*E+c*P,e[9]=i*E-r*M-s*P,e[10]=p*_-g*x+y*v,e[11]=h*x-u*_-f*v,e[12]=o*S-a*A-l*P,e[13]=r*A-i*S+n*P,e[14]=g*b-p*w-m*v,e[15]=u*w-h*b+d*v,e}function v9(e){let t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=e[15],y=t*a-r*s,v=t*o-i*s,b=r*o-i*a,x=c*p-u*f,w=c*g-h*f,_=u*g-h*p;return l*(t*_-r*w+i*x)-n*(s*_-a*w+o*x)+m*(c*b-u*v+h*y)-d*(f*b-p*v+g*y)}function be(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],y=t[14],v=t[15],b=r[0],x=r[1],w=r[2],_=r[3];return e[0]=b*i+x*o+w*h+_*g,e[1]=b*n+x*l+w*d+_*m,e[2]=b*s+x*c+w*f+_*y,e[3]=b*a+x*u+w*p+_*v,b=r[4],x=r[5],w=r[6],_=r[7],e[4]=b*i+x*o+w*h+_*g,e[5]=b*n+x*l+w*d+_*m,e[6]=b*s+x*c+w*f+_*y,e[7]=b*a+x*u+w*p+_*v,b=r[8],x=r[9],w=r[10],_=r[11],e[8]=b*i+x*o+w*h+_*g,e[9]=b*n+x*l+w*d+_*m,e[10]=b*s+x*c+w*f+_*y,e[11]=b*a+x*u+w*p+_*v,b=r[12],x=r[13],w=r[14],_=r[15],e[12]=b*i+x*o+w*h+_*g,e[13]=b*n+x*l+w*d+_*m,e[14]=b*s+x*c+w*f+_*y,e[15]=b*a+x*u+w*p+_*v,e}function bt(e,t,r){let i,n,s,a,o,l,c,u,h,d,f,p,g=r[0],m=r[1],y=r[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*y+t[12],e[13]=t[1]*g+t[5]*m+t[9]*y+t[13],e[14]=t[2]*g+t[6]*m+t[10]*y+t[14],e[15]=t[3]*g+t[7]*m+t[11]*y+t[15]):(i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=i*g+o*m+h*y+t[12],e[13]=n*g+l*m+d*y+t[13],e[14]=s*g+c*m+f*y+t[14],e[15]=a*g+u*m+p*y+t[15]),e}function br(e,t,r){let i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function bi(e,t,r,i){let n,s,a,o,l,c,u,h,d,f,p,g,m,y,v,b,x,w,_,k,P,S,E,A,M=i[0],T=i[1],C=i[2],O=Math.sqrt(M*M+T*T+C*C);return O<1e-6?null:(M*=O=1/O,T*=O,C*=O,s=Math.sin(r),a=1-(n=Math.cos(r)),o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],m=t[9],y=t[10],v=t[11],b=M*M*a+n,x=T*M*a+C*s,w=C*M*a-T*s,_=M*T*a-C*s,k=T*T*a+n,P=C*T*a+M*s,S=M*C*a+T*s,E=T*C*a-M*s,A=C*C*a+n,e[0]=o*b+h*x+g*w,e[1]=l*b+d*x+m*w,e[2]=c*b+f*x+y*w,e[3]=u*b+p*x+v*w,e[4]=o*_+h*k+g*P,e[5]=l*_+d*k+m*P,e[6]=c*_+f*k+y*P,e[7]=u*_+p*k+v*P,e[8]=o*S+h*E+g*A,e[9]=l*S+d*E+m*A,e[10]=c*S+f*E+y*A,e[11]=u*S+p*E+v*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function bn(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*i,e[5]=a*n+u*i,e[6]=o*n+h*i,e[7]=l*n+d*i,e[8]=c*n-s*i,e[9]=u*n-a*i,e[10]=h*n-o*i,e[11]=d*n-l*i,e}function bs(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*i,e[1]=a*n-u*i,e[2]=o*n-h*i,e[3]=l*n-d*i,e[8]=s*i+c*n,e[9]=a*i+u*n,e[10]=o*i+h*n,e[11]=l*i+d*n,e}function ba(e,t,r){let i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*i,e[1]=a*n+u*i,e[2]=o*n+h*i,e[3]=l*n+d*i,e[4]=c*n-s*i,e[5]=u*n-a*i,e[6]=h*n-o*i,e[7]=d*n-l*i,e}function bo(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function bl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bc(e,t,r){let i,n,s,a=r[0],o=r[1],l=r[2],c=Math.sqrt(a*a+o*o+l*l);return c<1e-6?null:(a*=c=1/c,o*=c,l*=c,n=Math.sin(t),s=1-(i=Math.cos(t)),e[0]=a*a*s+i,e[1]=o*a*s+l*n,e[2]=l*a*s-o*n,e[3]=0,e[4]=a*o*s-l*n,e[5]=o*o*s+i,e[6]=l*o*s+a*n,e[7]=0,e[8]=a*l*s+o*n,e[9]=o*l*s-a*n,e[10]=l*l*s+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function bu(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bh(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bd(e,t){let r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bf(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,l=n+n,c=s+s,u=i*o,h=i*l,d=i*c,f=n*l,p=n*c,g=s*c,m=a*o,y=a*l,v=a*c;return e[0]=1-(f+g),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(u+g),e[6]=p+m,e[7]=0,e[8]=d+y,e[9]=p-m,e[10]=1-(u+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bp(e,t){let r=new vX(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=i*i+n*n+s*s+a*a;return h>0?(r[0]=(o*a+u*i+l*s-c*n)*2/h,r[1]=(l*a+u*n+c*i-o*s)*2/h,r[2]=(c*a+u*s+o*n-l*i)*2/h):(r[0]=(o*a+u*i+l*s-c*n)*2,r[1]=(l*a+u*n+c*i-o*s)*2,r[2]=(c*a+u*s+o*n-l*i)*2),bf(e,t,r),e}function bg(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function bm(e,t){let r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(s*s+a*a+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e}function by(e,t){let r=new vX(3);bm(r,t);let i=1/r[0],n=1/r[1],s=1/r[2],a=t[0]*i,o=t[1]*n,l=t[2]*s,c=t[4]*i,u=t[5]*n,h=t[6]*s,d=t[8]*i,f=t[9]*n,p=t[10]*s,g=a+u+p,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(h-f)/m,e[1]=(d-l)/m,e[2]=(o-c)/m):a>u&&a>p?(m=2*Math.sqrt(1+a-u-p),e[3]=(h-f)/m,e[0]=.25*m,e[1]=(o+c)/m,e[2]=(d+l)/m):u>p?(m=2*Math.sqrt(1+u-a-p),e[3]=(d-l)/m,e[0]=(o+c)/m,e[1]=.25*m,e[2]=(h+f)/m):(m=2*Math.sqrt(1+p-a-u),e[3]=(o-c)/m,e[0]=(d+l)/m,e[1]=(h+f)/m,e[2]=.25*m),e}function bv(e,t,r,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];let n=i[0],s=i[1],a=i[2],o=i[4],l=i[5],c=i[6],u=i[8],h=i[9],d=i[10];r[0]=Math.sqrt(n*n+s*s+a*a),r[1]=Math.sqrt(o*o+l*l+c*c),r[2]=Math.sqrt(u*u+h*h+d*d);let f=1/r[0],p=1/r[1],g=1/r[2],m=n*f,y=s*p,v=a*g,b=o*f,x=l*p,w=c*g,_=u*f,k=h*p,P=d*g,S=m+x+P,E=0;return S>0?(E=2*Math.sqrt(S+1),e[3]=.25*E,e[0]=(w-k)/E,e[1]=(_-v)/E,e[2]=(y-b)/E):m>x&&m>P?(E=2*Math.sqrt(1+m-x-P),e[3]=(w-k)/E,e[0]=.25*E,e[1]=(y+b)/E,e[2]=(_+v)/E):x>P?(E=2*Math.sqrt(1+x-m-P),e[3]=(_-v)/E,e[0]=(y+b)/E,e[1]=.25*E,e[2]=(w+k)/E):(E=2*Math.sqrt(1+P-m-x),e[3]=(y-b)/E,e[0]=(_+v)/E,e[1]=(w+k)/E,e[2]=.25*E),e}function bb(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=t[3],l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,f=n*u,p=s*c,g=s*u,m=a*u,y=o*l,v=o*c,b=o*u,x=i[0],w=i[1],_=i[2];return e[0]=(1-(p+m))*x,e[1]=(d+b)*x,e[2]=(f-v)*x,e[3]=0,e[4]=(d-b)*w,e[5]=(1-(h+m))*w,e[6]=(g+y)*w,e[7]=0,e[8]=(f+v)*_,e[9]=(g-y)*_,e[10]=(1-(h+p))*_,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bx(e,t,r,i,n){let s=t[0],a=t[1],o=t[2],l=t[3],c=s+s,u=a+a,h=o+o,d=s*c,f=s*u,p=s*h,g=a*u,m=a*h,y=o*h,v=l*c,b=l*u,x=l*h,w=i[0],_=i[1],k=i[2],P=n[0],S=n[1],E=n[2],A=(1-(g+y))*w,M=(f+x)*w,T=(p-b)*w,C=(f-x)*_,O=(1-(d+y))*_,I=(m+v)*_,L=(p+b)*k,j=(m-v)*k,N=(1-(d+g))*k;return e[0]=A,e[1]=M,e[2]=T,e[3]=0,e[4]=C,e[5]=O,e[6]=I,e[7]=0,e[8]=L,e[9]=j,e[10]=N,e[11]=0,e[12]=r[0]+P-(A*P+C*S+L*E),e[13]=r[1]+S-(M*P+O*S+j*E),e[14]=r[2]+E-(T*P+I*S+N*E),e[15]=1,e}function bw(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,c=r*a,u=i*a,h=i*o,d=n*a,f=n*o,p=n*l,g=s*a,m=s*o,y=s*l;return e[0]=1-h-p,e[1]=u+y,e[2]=d-m,e[3]=0,e[4]=u-y,e[5]=1-c-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function b_(e,t,r,i,n,s,a){let o=1/(r-t),l=1/(n-i),c=1/(s-a);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(a+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*c,e[15]=0,e}function bk(e,t,r,i,n){let s=1/Math.tan(t/2);if(e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(i-n);e[10]=(n+i)*t,e[14]=2*n*i*t}else e[10]=-1,e[14]=-2*i;return e}function bP(e,t,r,i,n){let s=1/Math.tan(t/2);if(e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(i-n);e[10]=n*t,e[14]=n*i*t}else e[10]=-1,e[14]=-i;return e}function bS(e,t,r,i){let n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((a-o)*l*.5),e[9]=(n-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function bE(e,t,r,i,n,s,a){let o=1/(t-r),l=1/(i-n),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(a+s)*c,e[15]=1,e}function bA(e,t,r,i,n,s,a){let o=1/(t-r),l=1/(i-n),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=s*c,e[15]=1,e}function bM(e,t,r,i){let n,s,a,o,l,c,u,h,d,f,p=t[0],g=t[1],m=t[2],y=i[0],v=i[1],b=i[2],x=r[0],w=r[1],_=r[2];return 1e-6>Math.abs(p-x)&&1e-6>Math.abs(g-w)&&1e-6>Math.abs(m-_)?v5(e):(n=1/Math.sqrt((h=p-x)*h+(d=g-w)*d+(f=m-_)*f),h*=n,d*=n,f*=n,(n=Math.sqrt((s=v*f-b*d)*s+(a=b*h-y*f)*a+(o=y*d-v*h)*o))?(s*=n=1/n,a*=n,o*=n):(s=0,a=0,o=0),(n=Math.sqrt((l=d*o-f*a)*l+(c=f*s-h*o)*c+(u=h*a-d*s)*u))?(l*=n=1/n,c*=n,u*=n):(l=0,c=0,u=0),e[0]=s,e[1]=l,e[2]=h,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=o,e[9]=u,e[10]=f,e[11]=0,e[12]=-(s*p+a*g+o*m),e[13]=-(l*p+c*g+u*m),e[14]=-(h*p+d*g+f*m),e[15]=1,e)}function bT(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=i[0],l=i[1],c=i[2],u=n-r[0],h=s-r[1],d=a-r[2],f=u*u+h*h+d*d;f>0&&(u*=f=1/Math.sqrt(f),h*=f,d*=f);let p=l*d-c*h,g=c*u-o*d,m=o*h-l*u;return(f=p*p+g*g+m*m)>0&&(p*=f=1/Math.sqrt(f),g*=f,m*=f),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=h*m-d*g,e[5]=d*p-u*m,e[6]=u*g-h*p,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e}function bC(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function bO(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function bI(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function bL(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function bj(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function bN(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function bD(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function bR(e,t){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=t[0],b=t[1],x=t[2],w=t[3],_=t[4],k=t[5],P=t[6],S=t[7],E=t[8],A=t[9],M=t[10],T=t[11],C=t[12],O=t[13],I=t[14],L=t[15];return Math.abs(r-v)<=1e-6*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-x)<=1e-6*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-_)<=1e-6*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-k)<=1e-6*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(l-P)<=1e-6*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-S)<=1e-6*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-E)<=1e-6*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-A)<=1e-6*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-M)<=1e-6*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(f-T)<=1e-6*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-C)<=1e-6*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-O)<=1e-6*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(m-I)<=1e-6*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(y-L)<=1e-6*Math.max(1,Math.abs(y),Math.abs(L))}e.s(["add",()=>bI,"adjoint",()=>v7,"clone",()=>v1,"copy",()=>v2,"create",()=>v0,"decompose",()=>bv,"determinant",()=>v9,"equals",()=>bR,"exactEquals",()=>bD,"frob",()=>bO,"fromQuat",()=>bw,"fromQuat2",()=>bp,"fromRotation",()=>bc,"fromRotationTranslation",()=>bf,"fromRotationTranslationScale",()=>bb,"fromRotationTranslationScaleOrigin",()=>bx,"fromScaling",()=>bl,"fromTranslation",()=>bo,"fromValues",()=>v3,"fromXRotation",()=>bu,"fromYRotation",()=>bh,"fromZRotation",()=>bd,"frustum",()=>b_,"getRotation",()=>by,"getScaling",()=>bm,"getTranslation",()=>bg,"identity",()=>v5,"invert",()=>v8,"lookAt",()=>bM,"mul",0,be,"multiply",()=>be,"multiplyScalar",()=>bj,"multiplyScalarAndAdd",()=>bN,"ortho",0,bE,"orthoNO",()=>bE,"orthoZO",()=>bA,"perspective",0,bk,"perspectiveFromFieldOfView",()=>bS,"perspectiveNO",()=>bk,"perspectiveZO",()=>bP,"rotate",()=>bi,"rotateX",()=>bn,"rotateY",()=>bs,"rotateZ",()=>ba,"scale",()=>br,"set",()=>v4,"str",()=>bC,"sub",0,bL,"subtract",()=>bL,"targetTo",()=>bT,"translate",()=>bt,"transpose",()=>v6],32664);var bz=e.i(32664),bz=bz;function bF(){let e=new vX(4);return vX!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function bB(e){let t=new vX(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bU(e,t,r,i){let n=new vX(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function b$(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function bV(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function bW(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function bG(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function bq(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function bH(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function bK(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function bZ(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function bY(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function bX(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function bJ(e,t){return e[0]=vQ(t[0]),e[1]=vQ(t[1]),e[2]=vQ(t[2]),e[3]=vQ(t[3]),e}function bQ(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function b0(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function b1(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function b2(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function b3(e){let t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function b4(e){let t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function b5(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function b6(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function b8(e,t){let r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a,e}function b7(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function b9(e,t,r,i){let n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],c=r[2]*i[3]-r[3]*i[2],u=t[0],h=t[1],d=t[2],f=t[3];return e[0]=h*c-d*l+f*o,e[1]=-(u*c)+d*a-f*s,e[2]=u*l-h*a+f*n,e[3]=-(u*o)+h*s-d*n,e}function xe(e,t,r,i){let n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function xt(e,t){let r,i,n,s,a,o;t=void 0===t?1:t;do a=(r=2*vJ()-1)*r+(i=2*vJ()-1)*i;while(a>=1)do o=(n=2*vJ()-1)*n+(s=2*vJ()-1)*s;while(o>=1)let l=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*s*l,e}function xr(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function xi(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*s-l*n,h=c*n+l*i-a*s,d=c*s+a*n-o*i,f=-a*i-o*n-l*s;return e[0]=u*c+-(f*a)+-(h*l)- -(d*o),e[1]=h*c+-(f*o)+-(d*a)- -(u*l),e[2]=d*c+-(f*l)+-(u*o)- -(h*a),e[3]=t[3],e}function xn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function xs(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function xa(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function xo(e,t){let r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=1e-6*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=1e-6*Math.max(1,Math.abs(s),Math.abs(c))}let xl=(h=bF(),function(e,t,r,i,n,s){let a,o;for(t||(t=4),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)h[0]=e[a],h[1]=e[a+1],h[2]=e[a+2],h[3]=e[a+3],n(h,h,s),e[a]=h[0],e[a+1]=h[1],e[a+2]=h[2],e[a+3]=h[3];return e});e.s(["add",()=>bW,"ceil",()=>bK,"clone",()=>bB,"copy",()=>b$,"create",()=>bF,"cross",()=>b9,"dist",0,b1,"distance",()=>b1,"div",0,bH,"divide",()=>bH,"dot",()=>b7,"equals",()=>xo,"exactEquals",()=>xa,"floor",()=>bZ,"forEach",0,xl,"fromValues",()=>bU,"inverse",()=>b6,"len",0,b3,"length",()=>b3,"lerp",()=>xe,"max",()=>bX,"min",()=>bY,"mul",0,bq,"multiply",()=>bq,"negate",()=>b5,"normalize",()=>b8,"random",()=>xt,"round",()=>bJ,"scale",()=>bQ,"scaleAndAdd",()=>b0,"set",()=>bV,"sqrDist",0,b2,"sqrLen",0,b4,"squaredDistance",()=>b2,"squaredLength",()=>b4,"str",()=>xs,"sub",0,bG,"subtract",()=>bG,"transformMat4",()=>xr,"transformQuat",()=>xi,"zero",()=>xn],22642);var xc=e.i(22642),xc=xc,xu=e.i(85612);let xh=new xu.Log({id:"deck"});(k=V||(V={}))[k.Start=1]="Start",k[k.Move=2]="Move",k[k.End=4]="End",k[k.Cancel=8]="Cancel",(P=W||(W={}))[P.None=0]="None",P[P.Left=1]="Left",P[P.Right=2]="Right",P[P.Up=4]="Up",P[P.Down=8]="Down",P[P.Horizontal=3]="Horizontal",P[P.Vertical=12]="Vertical",P[P.All=15]="All",(S=G||(G={}))[S.Possible=1]="Possible",S[S.Began=2]="Began",S[S.Changed=4]="Changed",S[S.Ended=8]="Ended",S[S.Recognized=8]="Recognized",S[S.Cancelled=16]="Cancelled",S[S.Failed=32]="Failed";let xd="manipulation",xf="none",xp="pan-x",xg="pan-y";class xm{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));var t=e.join(" ");if(t.includes(xf))return xf;let r=t.includes(xp),i=t.includes(xg);return r&&i?xf:r||i?r?xp:xg:t.includes(xd)?xd:"auto"}}function xy(e){return e.trim().split(/\s+/g)}function xv(e,t,r){if(e)for(let i of xy(t))e.addEventListener(i,r,!1)}function xb(e,t,r){if(e)for(let i of xy(t))e.removeEventListener(i,r,!1)}function xx(e){return(e.ownerDocument||e).defaultView}function xw(e){let t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,i=0,n=0;for(;n<t;)r+=e[n].clientX,i+=e[n].clientY,n++;return{x:Math.round(r/t),y:Math.round(i/t)}}function x_(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:xw(t),deltaX:e.deltaX,deltaY:e.deltaY}}function xk(e,t){let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function xP(e,t){let r=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(r*r+i*i)}function xS(e,t){let r=t.clientX-e.clientX;return 180*Math.atan2(t.clientY-e.clientY,r)/Math.PI}function xE(e,t){return e===t?W.None:Math.abs(e)>=Math.abs(t)?e<0?W.Left:W.Right:t<0?W.Up:W.Down}function xA(e,t,r){return{x:t/e||0,y:r/e||0}}class xM{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){var r;let i,n,s,a,o;r=this.manager,i=t.pointers.length,n=t.changedPointers.length,s=e&V.Start&&i-n==0,a=e&(V.End|V.Cancel)&&i-n==0,t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e,o=function(e,t){var r,i;let n,s,a,o,l,{session:c}=e,{pointers:u}=t,{length:h}=u;c.firstInput||(c.firstInput=x_(t)),h>1&&!c.firstMultiple?c.firstMultiple=x_(t):1===h&&(c.firstMultiple=!1);let{firstInput:d,firstMultiple:f}=c,p=f?f.center:d.center,g=t.center=xw(u);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-d.timeStamp,n=g.x-p.x,t.angle=180*Math.atan2(g.y-p.y,n)/Math.PI,t.distance=xk(p,g);let{deltaX:m,deltaY:y}=(s=t.center,a=c.offsetDelta,o=c.prevDelta,l=c.prevInput,(t.eventType===V.Start||l?.eventType===V.End)&&(o=c.prevDelta={x:l?.deltaX||0,y:l?.deltaY||0},a=c.offsetDelta={x:s.x,y:s.y}),{deltaX:o.x+(s.x-a.x),deltaY:o.y+(s.y-a.y)});t.deltaX=m,t.deltaY=y,t.offsetDirection=xE(t.deltaX,t.deltaY);let v=xA(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=v.x,t.overallVelocityY=v.y,t.overallVelocity=Math.abs(v.x)>Math.abs(v.y)?v.x:v.y,t.scale=f?(r=f.pointers,xP(u[0],u[1])/xP(r[0],r[1])):1,t.rotation=f?(i=f.pointers,xS(u[1],u[0])-xS(i[1],i[0])):0,t.maxPointers=c.prevInput?t.pointers.length>c.prevInput.maxPointers?t.pointers.length:c.prevInput.maxPointers:t.pointers.length;let b=e.element;return function(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}(t.srcEvent.target,b)&&(b=t.srcEvent.target),t.target=b,!function(e,t){let r,i,n,s,a=e.lastInterval||t,o=t.timeStamp-a.timeStamp;if(t.eventType!==V.Cancel&&(o>25||void 0===a.velocity)){let l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,u=xA(o,l,c);i=u.x,n=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,s=xE(l,c),e.lastInterval=t}else r=a.velocity,i=a.velocityX,n=a.velocityY,s=a.direction;t.velocity=r,t.velocityX=i,t.velocityY=n,t.direction=s}(c,t),t}(r,t),r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}init(){xv(this.element,this.evEl,this.domHandler),xv(this.target,this.evTarget,this.domHandler),xv(xx(this.element),this.evWin,this.domHandler)}destroy(){xb(this.element,this.evEl,this.domHandler),xb(this.target,this.evTarget,this.domHandler),xb(xx(this.element),this.evWin,this.domHandler)}}let xT={pointerdown:V.Start,pointermove:V.Move,pointerup:V.End,pointercancel:V.Cancel,pointerout:V.Cancel};class xC extends xM{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:t}=this,r=!1,i=xT[e.type],n=e.pointerType,s="touch"===n,a=t.findIndex(t=>t.pointerId===e.pointerId);i&V.Start&&(e.buttons||s)?a<0&&(t.push(e),a=t.length-1):i&(V.End|V.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:n,srcEvent:e}),r&&t.splice(a,1))}}let xO=["","webkit","Moz","MS","ms","o"],xI={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class xL{constructor(e,t){this.options={...xI,...t,cssProps:{...xI.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new xC(this),this.touchAction=new xm(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){let t,{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let{recognizers:i}=this,{curRecognizer:n}=r;(!n||n&&n.state&G.Recognized)&&(n=r.curRecognizer=null);let s=0;for(;s<i.length;)t=i[s],2!==r.stopped&&(!n||t===n||t.canRecognizeWith(n))?t.recognize(e):t.reset(),!n&&t.state&(G.Began|G.Changed|G.Ended)&&(n=r.curRecognizer=t),s++}get(e){let{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(let t of e)this.add(t);return this}let t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let t of e)this.remove(t);return this}let t="string"==typeof e?this.get(e):e;if(t){let{recognizers:e}=this,r=e.indexOf(t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;let{handlers:r}=this;for(let i of xy(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;let{handlers:r}=this;for(let i of xy(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){let r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<r.length;)r[i](t),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:t}=this;if(t){for(let[r,i]of Object.entries(this.options.cssProps)){let n=function(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let i of xO){let n=i?i+r:t;if(n in e)return n}}(t.style,r);e?(this.oldCssProps[n]=t.style[n],t.style[n]=i):t.style[n]=this.oldCssProps[n]||""}e||(this.oldCssProps={})}}}let xj=1;function xN(e){return e&G.Cancelled?"cancel":e&G.Ended?"end":e&G.Changed?"move":e&G.Began?"start":""}class xD{constructor(e){this.options=e,this.id=xj++,this.state=G.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.recognizeWith(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRecognizeWith(t);return this}return(t="string"==typeof e?this.manager.get(e):e)&&delete this.simultaneous[t.id],this}requireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.requireFailure(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{requireFail:r}=this;return -1===r.indexOf(t)&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRequireFailure(t);return this}if(t="string"==typeof e?this.manager.get(e):e){let e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:t}=this;t<G.Ended&&this.manager.emit(this.options.event+xN(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=G.Ended&&this.manager.emit(this.options.event+xN(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=G.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(G.Failed|G.Possible)))return!1;e++}return!0}recognize(e){let t={...e};if(!this.options.enable){this.reset(),this.state=G.Failed;return}this.state&(G.Recognized|G.Cancelled|G.Failed)&&(this.state=G.Possible),this.state=this.process(t),this.state&(G.Began|G.Changed|G.Ended|G.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class xR extends xD{attrTest(e){let t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){let{state:t}=this,{eventType:r}=e,i=t&(G.Began|G.Changed),n=this.attrTest(e);return i&&(r&V.Cancel||!n)?t|G.Cancelled:i||n?r&V.End?t|G.Ended:t&G.Began?t|G.Changed:G.Began:G.Failed}}class xz extends xD{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[xd]}process(e){let{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&V.Start&&0===this.count)return this.failTimeout();if(i&&n&&r){if(e.eventType!==V.End)return this.failTimeout();let r=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||xk(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&r?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=G.Recognized,this.tryEmit(this._input)},t.interval),G.Began):G.Recognized}return G.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=G.Failed},this.options.interval),G.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===G.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}let xF=["","start","move","end","cancel","up","down","left","right"];class xB extends xR{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:W.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,t=[];return e&W.Horizontal&&t.push(xg),e&W.Vertical&&t.push(xp),t}getEventNames(){return xF.map(e=>this.options.event+e)}directionTest(e){let{options:t}=this,r=!0,{distance:i}=e,{direction:n}=e,s=e.deltaX,a=e.deltaY;return n&t.direction||(t.direction&W.Horizontal?(n=0===s?W.None:s<0?W.Left:W.Right,r=s!==this.pX,i=Math.abs(e.deltaX)):(n=0===a?W.None:a<0?W.Up:W.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=n,r&&i>t.threshold&&!!(n&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&G.Began)||!(this.state&G.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let t=W[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}let xU=["","start","move","end","cancel","in","out"];class x${constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}let xV="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";"undefined"!=typeof window?window:e.g,e.g;let xW=-1!==xV.indexOf("firefox");class xG extends x${constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(xW&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}let xq=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class xH extends x${constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,xq.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){xq.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}let xK=["keydown","keyup"];class xZ extends x${constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=e=>{let t=e.target||e.srcElement;("INPUT"!==t.tagName||"text"!==t.type)&&"TEXTAREA"!==t.tagName&&(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",xK.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){xK.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class xY extends x${constructor(e,t,r){super(e,t,r),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}let xX={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},xJ={srcElement:"root",priority:0};class xQ{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;let t=this._normalizeEvent(e),r=e.srcEvent.target;for(;r&&r!==t.rootElement;){if(this._emit(t,r),t.handled)return;r=r.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,n=!1){let{handlers:s,handlersByElement:a}=this,o={...xJ,...r},l=a.get(o.srcElement);l||(l=[],a.set(o.srcElement,l));let c={type:e,handler:t,srcElement:o.srcElement,priority:o.priority};i&&(c.once=!0),n&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){let{handlers:r,handlersByElement:i}=this;for(let n=r.length-1;n>=0;n--){let s=r[n];if(s.type===e&&s.handler===t){r.splice(n,1);let e=i.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&i.delete(s.srcElement)}}this._active=r.some(e=>!e.passive)}_emit(e,t){let r=this.handlersByElement.get(t);if(r){let t=!1,i=()=>{e.handled=!0},n=()=>{e.handled=!0,t=!0},s=[];for(let a=0;a<r.length;a++){let{type:o,handler:l,once:c}=r[a];if(l({...e,type:o,stopPropagation:i,stopImmediatePropagation:n}),c&&s.push(r[a]),t)break}for(let e=0;e<s.length;e++){let{type:t,handler:r}=s[e];this.remove(t,r)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...function(e){let t=xX[e.srcEvent.type];if(!t)return null;let{buttons:r,button:i}=e.srcEvent,n=!1,s=!1,a=!1;return 2===t?(n=!!(1&r),s=!!(4&r),a=!!(2&r)):(n=0===i,s=1===i,a=2===i),{leftButton:n,middleButton:s,rightButton:a}}(e),...function(e,t){let r=e.center;if(!r)return null;let i=t.getBoundingClientRect(),n=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1,a={x:(r.x-i.left-t.clientLeft)/n,y:(r.y-i.top-t.clientTop)/s};return{center:r,offsetCenter:a}}(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}class x0{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!e)return;for(const t of(this.manager=new xL(e,this.options),this.options.recognizers)){const{recognizer:e,recognizeWith:r,requireFailure:i}=function(e){let t;if("recognizer"in e)return e;let r=Array.isArray(e)?[...e]:[e];return{recognizer:t="function"==typeof r[0]?new(r.shift())(r.shift()||{}):r.shift(),recognizeWith:"string"==typeof r[0]?[r[0]]:r[0],requireFailure:"string"==typeof r[1]?[r[1]]:r[1]}}(t);this.manager.add(e),r&&e.recognizeWith(r),i&&e.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new xG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new xH(e,this._onOtherEvent,{enable:!1}),this.keyInput=new xZ(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new xY(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:r}=this;if(!r)return;let i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,n){if("string"!=typeof e){for(let[s,a]of(r=t,Object.entries(e)))this._addEventHandler(s,a,r,i,n);return}let{manager:s,events:a}=this;if(!s)return;let o=a.get(e);!o&&(o=new xQ(this,this._getRecognizerName(e)||e),a.set(e,o),s&&s.on(e,o.handleEvent)),o.add(e,t,r,i,n),o.isEmpty()||this._toggleRecognizer(o.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(let[t,r]of Object.entries(e))this._removeEventHandler(t,r);return}let{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){let{recognizerName:e}=i,t=!1;for(let i of r.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}let x1={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(x1,"IDENTITY",{get:()=>(xh.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});let x2={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},x3={common:0,meters:1,pixels:2},x4={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},x5={multipan:[xB,{threshold:10,direction:W.Vertical,pointers:2}],pinch:[class extends xR{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[xf]}getEventNames(){return xU.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&G.Began))}emit(e){if(1!==e.scale){let t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[xB,{threshold:1},["pinch"],["multipan"]],dblclick:[xz,{event:"dblclick",taps:2}],click:[xz,{event:"click"},null,["dblclick"]]};function x6(e){let t,r={};return i=>{for(let n in i)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}(i[n],r[n])){t=e(i),r=i;break}return t}}let x8=[0,0,0,0],x7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],x9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],we=[0,0,0],wt=[0,0,0],wr=x6(function({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,r){let{viewMatrixUncentered:i,projectionMatrix:n}=e,{viewMatrix:s,viewProjectionMatrix:a}=e,o=x8,l=x8,c=e.cameraPosition,{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=wi(e,t,r);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,o=xc.transformMat4([],l,a),s=i||s,a=bz.multiply([],n,s),a=bz.multiply([],a,x7)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,r,i),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=xc.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:a.slice(0,3),center:n,pseudoMeters:!!e._pseudoMeters,viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:we,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:x9,cameraPosition:o};if(c){let t=e.getDistanceScales(c);switch(r){case x1.METER_OFFSETS:f.commonUnitsPerWorldUnit=t.unitsPerMeter,f.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case x1.LNGLAT:case x1.LNGLAT_OFFSETS:e._pseudoMeters||(f.commonUnitsPerMeter=t.unitsPerMeter),f.commonUnitsPerWorldUnit=t.unitsPerDegree,f.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case x1.CARTESIAN:f.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f});function wi(e,t,r=wt){let i;r.length<3&&(r=[r[0],r[1],0]);let n=r,s=!0;switch(i=t===x1.LNGLAT_OFFSETS||t===x1.METER_OFFSETS?r:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case x2.WEB_MERCATOR:(t===x1.LNGLAT||t===x1.CARTESIAN)&&(i=[0,0,0],s=!1);break;case x2.WEB_MERCATOR_AUTO_OFFSET:t===x1.LNGLAT?n=i:t===x1.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case x2.IDENTITY:(n=e.position.map(Math.fround))[2]=n[2]||0;break;case x2.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}let wn=Object.keys(x1).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${x1[e]};`).join(""),ws=Object.keys(x2).map(e=>`const PROJECTION_MODE_${e}: i32 = ${x2[e]};`).join(""),wa=Object.keys(x3).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${x3[e]};`).join(""),wo=`\
${wn}
${ws}
${wa}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,wl=`\
${wo}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,wc=Object.keys(x1).map(e=>`const int COORDINATE_SYSTEM_${e} = ${x1[e]};`).join(""),wu=Object.keys(x2).map(e=>`const int PROJECTION_MODE_${e} = ${x2[e]};`).join(""),wh=Object.keys(x3).map(e=>`const int UNIT_${e.toUpperCase()} = ${x3[e]};`).join(""),wd={},wf={name:"project",dependencies:[{name:"fp32",vs:vY},vZ],source:wl,vs:`\
${wc}
${wu}
${wh}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,getUniforms:function(e=wd){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:i=x1.DEFAULT,coordinateOrigin:n=wt,autoWrapLongitude:s=!1}){i===x1.DEFAULT&&(i=e.isGeospatial?x1.LNGLAT:x1.CARTESIAN);let a=wr({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n});return a.wrapLongitude=s,a.modelMatrix=r||x9,a}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},wp={name:"project32",dependencies:[wf],source:`\
// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs:`\
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};let wg=globalThis.mathgl.config;function wm(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wy(e,t,r){return function(e,t,r){if(wm(e)){r=r||(e.clone?e.clone():Array(e.length));for(let i=0;i<r.length&&i<e.length;++i){let n="number"==typeof e?e:e[i];r[i]=t(n,i,r)}return r}return t(e)}(e,e=>Math.max(t,Math.min(r,e)))}function wv(e,t,r){return wm(e)?e.map((e,i)=>wv(e,t[i],r)):r*t+(1-r)*e}function wb(e,t,r){let i=wg.EPSILON;r&&(wg.EPSILON=r);try{if(e===t)return!0;if(wm(e)&&wm(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!wb(e[r],t[r]))return!1;return!0}if(e&&e.equals)return e.equals(t);if(t&&t.equals)return t.equals(e);if("number"==typeof e&&"number"==typeof t)return Math.abs(e-t)<=wg.EPSILON*Math.max(1,Math.abs(e),Math.abs(t));return!1}finally{wg.EPSILON=i}}class wx extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:wm(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(wg)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+function(e,{precision:t=wg.precision}={}){return e=Math.round(e/wg.EPSILON)*wg.EPSILON,`${parseFloat(e.toPrecision(t))}`}(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!wb(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(void 0===r)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){let n=e[i],s="number"==typeof t?t:t[i];this[i]=n+r*(s-n)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(wg.debug&&!this.validate())throw Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function ww(e){if(!Number.isFinite(e))throw Error(`Invalid number ${JSON.stringify(e)}`);return e}function w_(e,t,r=""){if(wg.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function wk(e,t){if(!e)throw Error(`math.gl assertion ${t}`)}class wP extends wx{get x(){return this[0]}set x(e){this[0]=ww(e)}get y(){return this[1]}set y(e){this[1]=ww(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){let i=this[r]-e[r];t+=i*i}return ww(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return ww(t)}normalize(){let e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return wk(e>=0&&e<this.ELEMENTS,"index is out of range"),ww(this[e])}setComponent(e,t){return wk(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}function wS(){let e=new vX(3);return vX!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function wE(e){let t=new vX(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function wA(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function wM(e,t,r){let i=new vX(3);return i[0]=e,i[1]=t,i[2]=r,i}function wT(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wC(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function wO(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function wI(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function wL(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function wj(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function wN(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function wD(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function wR(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function wz(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function wF(e,t){return e[0]=vQ(t[0]),e[1]=vQ(t[1]),e[2]=vQ(t[2]),e}function wB(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function wU(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function w$(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function wV(e,t){let r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function wW(e){let t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function wG(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function wq(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function wH(e,t){let r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function wK(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wZ(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a,e}function wY(e,t,r,i){let n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function wX(e,t,r,i){let n=Math.acos(Math.min(Math.max(wK(t,r),-1),1)),s=Math.sin(n),a=Math.sin((1-i)*n)/s,o=Math.sin(i*n)/s;return e[0]=a*t[0]+o*r[0],e[1]=a*t[1]+o*r[1],e[2]=a*t[2]+o*r[2],e}function wJ(e,t,r,i,n,s){let a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,c=a*(s-1),u=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*o+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*o+r[2]*l+i[2]*c+n[2]*u,e}function wQ(e,t,r,i,n,s){let a=1-s,o=a*a,l=s*s,c=o*a,u=3*s*o,h=3*l*a,d=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*h+n[0]*d,e[1]=t[1]*c+r[1]*u+i[1]*h+n[1]*d,e[2]=t[2]*c+r[2]*u+i[2]*h+n[2]*d,e}function w0(e,t){t=void 0===t?1:t;let r=2*vJ()*Math.PI,i=2*vJ()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function w1(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,e}function w2(e,t,r){let i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function w3(e,t,r){let i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],c=t[2],u=n*c-s*l,h=s*o-i*c,d=i*l-n*o,f=n*d-s*h,p=s*u-i*d,g=i*h-n*u,m=2*a;return u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,e[0]=o+u+f,e[1]=l+h+p,e[2]=c+d+g,e}function w4(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function w5(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function w6(e,t,r,i){let n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function w8(e,t){let r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt((r*r+i*i+n*n)*(s*s+a*a+o*o));return Math.acos(Math.min(Math.max(l&&wK(e,t)/l,-1),1))}function w7(e){return e[0]=0,e[1]=0,e[2]=0,e}function w9(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function _e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function _t(e,t){let r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}let _r=(d=wS(),function(e,t,r,i,n,s){let a,o;for(t||(t=3),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)d[0]=e[a],d[1]=e[a+1],d[2]=e[a+2],n(d,d,s),e[a]=d[0],e[a+1]=d[1],e[a+2]=d[2];return e});function _i(e,t,r){let i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s||1;return e[0]=(r[0]*i+r[4]*n+r[8]*s)/a,e[1]=(r[1]*i+r[5]*n+r[9]*s)/a,e[2]=(r[2]*i+r[6]*n+r[10]*s)/a,e}function _n(e,t,r){let i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[3]*n+r[6]*s,e[1]=r[1]*i+r[4]*n+r[7]*s,e[2]=r[2]*i+r[5]*n+r[8]*s,e[3]=t[3],e}e.s(["add",()=>wO,"angle",()=>w8,"bezier",()=>wQ,"ceil",()=>wN,"clone",()=>wE,"copy",()=>wT,"create",()=>wS,"cross",()=>wZ,"dist",0,w$,"distance",()=>w$,"div",0,wj,"divide",()=>wj,"dot",()=>wK,"equals",()=>_t,"exactEquals",()=>_e,"floor",()=>wD,"forEach",0,_r,"fromValues",()=>wM,"hermite",()=>wJ,"inverse",()=>wq,"len",0,wA,"length",()=>wA,"lerp",()=>wY,"max",()=>wz,"min",()=>wR,"mul",0,wL,"multiply",()=>wL,"negate",()=>wG,"normalize",()=>wH,"random",()=>w0,"rotateX",()=>w4,"rotateY",()=>w5,"rotateZ",()=>w6,"round",()=>wF,"scale",()=>wB,"scaleAndAdd",()=>wU,"set",()=>wC,"slerp",()=>wX,"sqrDist",0,wV,"sqrLen",0,wW,"squaredDistance",()=>wV,"squaredLength",()=>wW,"str",()=>w9,"sub",0,wI,"subtract",()=>wI,"transformMat3",()=>w2,"transformMat4",()=>w1,"transformQuat",()=>w3,"zero",()=>w7],93311);let _s=[0,0,0];class _a extends wP{static get ZERO(){return t||Object.freeze(t=new _a(0,0,0)),t}constructor(e=0,t=0,r=0){super(-0,-0,-0),1==arguments.length&&wm(e)?this.copy(e):(wg.debug&&(ww(e),ww(t),ww(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return wg.debug&&(ww(e.x),ww(e.y),ww(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ww(e)}angle(e){return w8(this,e)}cross(e){return wZ(this,this,e),this.check()}rotateX({radians:e,origin:t=_s}){return w4(this,this,t,e),this.check()}rotateY({radians:e,origin:t=_s}){return w5(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=_s}){return w6(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return w1(this,this,e),this.check()}transformAsVector(e){return _i(this,this,e),this.check()}transformByMatrix3(e){return w2(this,this,e),this.check()}transformByMatrix2(e){let t,r;return t=this[0],r=this[1],this[0]=e[0]*t+e[2]*r,this[1]=e[1]*t+e[3]*r,this[2]=this[2],this.check()}transformByQuaternion(e){return w3(this,this,e),this.check()}}class _o extends wx{toString(){let e="[";if(wg.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+"]"}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=ww(r),this}getColumn(e,t=Array(this.RANK).fill(-0)){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[r+e];return t}setColumn(e,t){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)this[r+e]=t[e];return this}}function _l(){let e=new vX(2);return vX!=Float32Array&&(e[0]=0,e[1]=0),e}function _c(e){let t=new vX(2);return t[0]=e[0],t[1]=e[1],t}function _u(e,t){let r=new vX(2);return r[0]=e,r[1]=t,r}function _h(e,t){return e[0]=t[0],e[1]=t[1],e}function _d(e,t,r){return e[0]=t,e[1]=r,e}function _f(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function _p(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function _g(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function _m(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function _y(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function _v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function _b(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function _x(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function _w(e,t){return e[0]=vQ(t[0]),e[1]=vQ(t[1]),e}function __(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function _k(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function _P(e,t){let r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function _S(e,t){let r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function _E(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function _A(e){let t=e[0],r=e[1];return t*t+r*r}function _M(e,t){return e[0]=-t[0],e[1]=-t[1],e}function _T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function _C(e,t){let r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function _O(e,t){return e[0]*t[0]+e[1]*t[1]}function _I(e,t,r){let i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function _L(e,t,r,i){let n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function _j(e,t){t=void 0===t?1:t;let r=2*vJ()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function _N(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function _D(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function _R(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function _z(e,t,r){let i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function _F(e,t,r,i){let n=t[0]-r[0],s=t[1]-r[1],a=Math.sin(i),o=Math.cos(i);return e[0]=n*o-s*a+r[0],e[1]=n*a+s*o+r[1],e}function _B(e,t){let r=e[0],i=e[1],n=t[0],s=t[1],a=Math.sqrt((r*r+i*i)*(n*n+s*s));return Math.acos(Math.min(Math.max(a&&(r*n+i*s)/a,-1),1))}function _U(e){return e[0]=0,e[1]=0,e}function _$(e){return`vec2(${e[0]}, ${e[1]})`}function _V(e,t){return e[0]===t[0]&&e[1]===t[1]}function _W(e,t){let r=e[0],i=e[1],n=t[0],s=t[1];return Math.abs(r-n)<=1e-6*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}let _G=(f=_l(),function(e,t,r,i,n,s){let a,o;for(t||(t=2),r||(r=0),o=i?Math.min(i*t+r,e.length):e.length,a=r;a<o;a+=t)f[0]=e[a],f[1]=e[a+1],n(f,f,s),e[a]=f[0],e[a+1]=f[1];return e});e.s(["add",()=>_f,"angle",()=>_B,"ceil",()=>_y,"clone",()=>_c,"copy",()=>_h,"create",()=>_l,"cross",()=>_I,"dist",0,_P,"distance",()=>_P,"div",0,_m,"divide",()=>_m,"dot",()=>_O,"equals",()=>_W,"exactEquals",()=>_V,"floor",()=>_v,"forEach",0,_G,"fromValues",()=>_u,"inverse",()=>_T,"len",0,_E,"length",()=>_E,"lerp",()=>_L,"max",()=>_x,"min",()=>_b,"mul",0,_g,"multiply",()=>_g,"negate",()=>_M,"normalize",()=>_C,"random",()=>_j,"rotate",()=>_F,"round",()=>_w,"scale",()=>__,"scaleAndAdd",()=>_k,"set",()=>_d,"sqrDist",0,_S,"sqrLen",0,_A,"squaredDistance",()=>_S,"squaredLength",()=>_A,"str",()=>_$,"sub",0,_p,"subtract",()=>_p,"transformMat2",()=>_N,"transformMat2d",()=>_D,"transformMat3",()=>_R,"transformMat4",()=>_z,"zero",()=>_U],60113),(E=q||(q={}))[E.COL0ROW0=0]="COL0ROW0",E[E.COL0ROW1=1]="COL0ROW1",E[E.COL0ROW2=2]="COL0ROW2",E[E.COL0ROW3=3]="COL0ROW3",E[E.COL1ROW0=4]="COL1ROW0",E[E.COL1ROW1=5]="COL1ROW1",E[E.COL1ROW2=6]="COL1ROW2",E[E.COL1ROW3=7]="COL1ROW3",E[E.COL2ROW0=8]="COL2ROW0",E[E.COL2ROW1=9]="COL2ROW1",E[E.COL2ROW2=10]="COL2ROW2",E[E.COL2ROW3=11]="COL2ROW3",E[E.COL3ROW0=12]="COL3ROW0",E[E.COL3ROW1=13]="COL3ROW1",E[E.COL3ROW2=14]="COL3ROW2",E[E.COL3ROW3=15]="COL3ROW3";let _q=45*Math.PI/180,_H=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class _K extends _o{static get IDENTITY(){return i||Object.freeze(i=new _K),i}static get ZERO(){return r||Object.freeze(r=new _K([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),r}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return q}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,n,s,a,o,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=n,this[5]=s,this[6]=a,this[7]=o,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,r,i,n,s,a,o,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=n,this[2]=l,this[3]=d,this[4]=t,this[5]=s,this[6]=c,this[7]=f,this[8]=r,this[9]=a,this[10]=u,this[11]=p,this[12]=i,this[13]=o,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(_H)}fromObject(e){return this.check()}fromQuaternion(e){return bw(this,e),this.check()}frustum(e){var t,r,i,n,s,a;let{left:o,right:l,bottom:c,top:u,near:h=.1,far:d=500}=e;return d===1/0?(t=this,r=o,i=l,n=c,s=u,a=h,t[0]=2*a/(i-r),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a/(s-n),t[6]=0,t[7]=0,t[8]=(i+r)/(i-r),t[9]=(s+n)/(s-n),t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0):b_(this,o,l,c,u,h,d),this.check()}lookAt(e){let{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return bM(this,t,r,i),this.check()}ortho(e){let{left:t,right:r,bottom:i,top:n,near:s=.1,far:a=500}=e;return bE(this,t,r,i,n,s,a),this.check()}orthographic(e){let{fovy:t=_q,aspect:r=1,focalDistance:i=1,near:n=.1,far:s=500}=e;_Z(t);let a=i*Math.tan(t/2),o=a*r;return this.ortho({left:-o,right:o,bottom:-a,top:a,near:n,far:s})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:n=500}=e;return _Z(t),bk(this,t,r,i,n),this.check()}determinant(){return v9(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],n=1/r[1],s=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*n,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*n,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],n=1/r[1],s=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*n,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*n,e[8]=this[10]*s,e}transpose(){return v6(this,this),this.check()}invert(){return v8(this,this),this.check()}multiplyLeft(e){return be(this,e,this),this.check()}multiplyRight(e){return be(this,this,e),this.check()}rotateX(e){return bn(this,this,e),this.check()}rotateY(e){return bs(this,this,e),this.check()}rotateZ(e){return ba(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return bi(this,this,e,t),this.check()}scale(e){return br(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return bt(this,this,e),this.check()}transform(e,t){return 4===e.length?(w_(t=xr(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let r,{length:i}=e;switch(i){case 2:r=_z(t||[-0,-0],e,this);break;case 3:r=w1(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return w_(r,e.length),r}transformAsVector(e,t){let r;switch(e.length){case 2:var i;let n,s,a;i=t||[-0,-0],n=e[0],s=e[1],a=this[3]*n+this[7]*s||1,i[0]=(this[0]*n+this[4]*s)/a,i[1]=(this[1]*n+this[5]*s)/a,r=i;break;case 3:r=_i(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return w_(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}function _Z(e){if(e>2*Math.PI)throw Error("expected radians")}var xc=xc;function _Y(e,t){let r=xc.transformMat4([],t,e);return xc.scale(r,r,1/r[3]),r}function _X(e,t){let r=e%t;return r<0?t+r:r}function _J(e,t,r){return e<t?t:e>r?r:e}let _Q=Math.log2||function(e){return Math.log(e)*Math.LOG2E};var bz=bz,_0=e.i(60113),_0=_0,_1=e.i(93311),_1=_1;function _2(e,t){if(!e)throw Error(t||"@math.gl/web-mercator: assertion failed.")}let _3=Math.PI,_4=_3/4,_5=_3/180,_6=180/_3;function _8(e){let[t,r]=e;_2(Number.isFinite(t)),_2(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=512*(_3+Math.log(Math.tan(_4+r*_5*.5)))/(2*_3);return[512*(t*_5+_3)/(2*_3),i]}function _7(e){let[t,r]=e,i=2*(Math.atan(Math.exp(r/512*(2*_3)-_3))-_4);return[(t/512*(2*_3)-_3)*_6,i*_6]}function _9(e){return 512/4003e4/Math.cos(e*_5)}function ke(e){let{latitude:t,longitude:r,highPrecision:i=!1}=e;_2(Number.isFinite(t)&&Number.isFinite(r));let n=Math.cos(t*_5),s=512/360/n,a=512/4003e4/n,o={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[512/360,s,a],degreesPerUnit:[1/(512/360),1/s,1/a]};if(i){let e=_5*Math.tan(t*_5)/n,r=512/4003e4*e,i=r/s*a;o.unitsPerDegree2=[0,512/360*e/2,r],o.unitsPerMeter2=[i,0,i]}return o}function kt(e,t){let[r,i,n]=e,[s,a,o]=t,{unitsPerMeter:l,unitsPerMeter2:c}=ke({longitude:r,latitude:i,highPrecision:!0}),u=_8(e);u[0]+=s*(l[0]+c[0]*a),u[1]+=a*(l[1]+c[1]*a);let h=_7(u);return Number.isFinite(n)||Number.isFinite(o)?[h[0],h[1],(n||0)+(o||0)]:h}function kr(e){return 2*Math.atan(.5/e)*_6}function ki(e){return .5/Math.tan(.5*e*_5)}function kn(e,t){let[r,i,n=0]=e;return _2(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),_Y(t,[r,i,n,1])}function ks(e,t,r=0){let[i,n,s]=e;if(_2(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return _Y(t,[i,n,s,1]);let a=_Y(t,[i,n,0,1]),o=_Y(t,[i,n,1,1]),l=a[2],c=o[2];return _0.lerp([],a,o,l===c?0:((r||0)-l)/(c-l))}var _0=_0;let ka=Math.PI/180;function ko(e,t,r){let{pixelUnprojectionMatrix:i}=e,n=_Y(i,[t,0,1,1]),s=_Y(i,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),o=_7(_0.lerp([],n,s,a));return o.push(r),o}var bz=bz,_0=_0,_1=_1,_0=_0;let kl=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,kc=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,ku=`
${kl}
${kc}
`,kh=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,kd=`
${kl}
${kh}
`,kf=x6(function({viewport:e,center:t}){return new _K(e.viewProjectionMatrix).invert().transform(t)}),kp=x6(function({viewport:e,shadowMatrices:t}){let r=[],i=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,s=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>(function(e,t){let[r,i,n]=e,s=ks([r,i,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]})(e,i));for(let i of t){let t=i.clone().translate(new _a(e.center).negate()),n=s.map(e=>t.transform(e)),a=new _K().ortho({left:Math.min(...n.map(e=>e[0])),right:Math.max(...n.map(e=>e[0])),bottom:Math.min(...n.map(e=>e[1])),top:Math.max(...n.map(e=>e[1])),near:Math.min(...n.map(e=>-e[2])),far:Math.max(...n.map(e=>-e[2]))});r.push(a.multiplyRight(i))}return r}),kg=[0,0,0,1],km=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ky={name:"shadow",dependencies:[wf],vs:ku,fs:kd,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let i=wf.getUniforms(r),n=kf({viewport:r.viewport,center:i.center}),s=[],a=kp({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let t=0;t<e.shadowMatrices.length;t++){let e=a[t],o=e.clone().translate(new _a(r.viewport.center).negate());i.coordinateSystem===x1.LNGLAT&&i.projectionMode===x2.WEB_MERCATOR?(a[t]=o,s[t]=n):(a[t]=e.clone().multiplyRight(km),s[t]=o.transform(n))}let o={drawShadowMap:!!e.drawToShadowMap,useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||kg,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let e=0;e<a.length;e++)o[`viewProjectionMatrix${e}`]=a[e],o[`projectCenter${e}`]=s[e];for(let t=0;t<2;t++)o[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return o},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},kv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:function(e={},t){let r={};if(void 0===e.highlightedObjectColor||(null===e.highlightedObjectColor?r.isHighlightActive=!1:(r.isHighlightActive=!0,r.highlightedObjectColor=e.highlightedObjectColor.slice(0,3))),e.highlightColor){let t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),r.highlightColor=t}return void 0!==e.isActive&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),void 0!==e.useFloatColors&&(r.useFloatColors=!!e.useFloatColors),r}},kb={...kv,defaultUniforms:{...kv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},kx=[vZ],kw=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],k_=[],kk=Symbol.for("component"),kP=Symbol.for("propTypes"),kS=Symbol.for("deprecatedProps"),kE=Symbol.for("asyncPropDefaults"),kA=Symbol.for("asyncPropOriginal"),kM=Symbol.for("asyncPropResolved"),kT={};function kC(e){kT=e}function kO(e,t,r,i){xh.level>0&&kT[e]&&kT[e].call(null,t,r,i)}function kI(e,t=()=>!0){return Array.isArray(e)?function e(t,r,i){let n=-1;for(;++n<t.length;){let s=t[n];Array.isArray(s)?e(s,r,i):r(s)&&i.push(s)}return i}(e,t,[]):t(e)?[e]:[]}e.i(23635);var kL=e.i(9685);let kj=e=>null!==e&&"object"==typeof e,kN=e=>kj(e)&&e.constructor===({}).constructor,kD=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,kR=e=>"undefined"!=typeof Blob&&e instanceof Blob,kz=e=>{let t,r;return t=e,"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||kj(t)&&"function"==typeof t.tee&&"function"==typeof t.cancel&&"function"==typeof t.getReader||kj(r=e)&&"function"==typeof r.read&&"function"==typeof r.pipe&&"boolean"==typeof r.readable};function kF(e,t){if(!e)throw Error(t||"loader assertion failed.")}function kB(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function kU(e){let t;return kF(e,"null loader"),kF(kB(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let k$={};class kV extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}let kW=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,kG=/^([-\w.]+\/[-\w.+]+)/;function kq(e,t){return e.toLowerCase()===t.toLowerCase()}function kH(e){let t=kW.exec(e);return t?t[1]:""}let kK=/\?.*/;function kZ(e){return e.replace(kK,"")}function kY(e){return kD(e)?e.url:kR(e)?e.name||"":"string"==typeof e?e:""}function kX(e){if(kD(e)){let t,r=e.headers.get("content-type")||"",i=kZ(e.url);return((t=kG.exec(r))?t[1]:r)||kH(i)}return kR(e)?e.type||"":"string"==typeof e?kH(e):""}async function kJ(e){var t;if(kD(e))return e;let r={},i=kD(t=e)?t.headers["content-length"]||-1:kR(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1;i>=0&&(r["content-length"]=String(i));let n=kY(e),s=kX(e);s&&(r["content-type"]=s);let a=await k1(e);a&&(r["x-first-bytes"]=a),"string"==typeof e&&(e=new TextEncoder().encode(e));let o=new Response(e,{headers:r});return Object.defineProperty(o,"url",{value:n}),o}async function kQ(e){if(!e.ok)throw await k0(e)}async function k0(e){let t=function(e){if(e.length<50)return e;let t=e.slice(e.length-15),r=e.substr(0,32);return`${r}...${t}`}(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:e.statusText,url:e.url,response:e};try{let t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new kV(r,i)}async function k1(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise(e=>{let r=new FileReader;r.onload=t=>e(t?.target?.result),r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){let t=function(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}async function k2(e,t){if("string"==typeof e){var r;let i=function(e){for(let t in k$)if(e.startsWith(t)){let r=k$[t];e=e.replace(t,r)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return!((r=i).startsWith("http:")||r.startsWith("https:"))&&!i.startsWith("data:")&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(i,t):await fetch(i,t)}return await kJ(e)}let k3="4.3.3",k4=k3[0]>="0"&&k3[0]<="9"?`v${k3}`:"",k5=(p=new xu.Log({id:"loaders.gl"}),globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=p,globalThis.loaders.version=k4,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=p,p),k6=new xu.Log({id:"loaders.gl"});class k8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}let k7={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};k7.self||k7.window||k7.global,k7.window||k7.self||k7.global,k7.global||k7.self||k7.window,k7.document;let k9=("object"!=typeof t1.default||"[object process]"!==String(t1.default),!0),Pe=void 0!==t1.default&&t1.default.version&&/v([0-9]*)/.exec(t1.default.version);Pe&&parseFloat(Pe[1]);let Pt={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:k9,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Pr={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Pi(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Pn(){let e=Pi();return e.globalOptions=e.globalOptions||{...Pt},e.globalOptions}function Ps(e,t,r,i,n){let s=t||"Top level",a=t?`${t}.`:"";for(let o in e){let l=!t&&kj(e[o]),c="baseUri"===o&&!t,u="workerUrl"===o&&t;if(!(o in r)&&!c&&!u){if(o in i)k6.warn(`${s} loader option '${a}${o}' no longer supported, use '${i[o]}'`)();else if(!l){let e=function(e,t){let r=e.toLowerCase(),i="";for(let n of t)for(let t in n.options){if(e===t)return`Did you mean '${n.id}.${t}'?`;let s=t.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(i=i||`Did you mean '${n.id}.${t}'?`)}return i}(o,n);k6.warn(`${s} loader option '${a}${o}' not recognized. ${e}`)()}}}}function Pa(e,t){for(let r in t)r in t&&(kN(t[r])&&kN(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r])}function Po(e,t){let r=Pn(),i=e||r;return"function"==typeof i.fetch?i.fetch:kj(i.fetch)?e=>k2(e,i.fetch):t?.fetch?t?.fetch:k2}let Pl={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};Pl.self||Pl.window||Pl.global,Pl.window||Pl.self||Pl.global,Pl.global||Pl.self||Pl.window,Pl.document;let Pc="object"!=typeof t1.default||"[object process]"!==String(t1.default)||!0,Pu="undefined"!=typeof window&&void 0!==window.orientation,Ph=void 0!==t1.default&&t1.default.version&&/v([0-9]*)/.exec(t1.default.version);Ph&&parseFloat(Ph[1]);class Pd{terminate(){}}function Pf(e,t){if(!e)throw Error(t||"loaders.gl assertion failed.")}let Pp=new Map;function Pg(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Pm(e){return!!e&&!!(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}let Py=()=>{};class Pv{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&Pc||!Pc}constructor(e){const{name:t,source:r,url:i}=e;Pf(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=Py,this.onError=e=>console.log(e),this.worker=Pc?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Py,this.onError=Py,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||function e(t,r=!0,i){let n=i||new Set;if(t){if(Pm(t))n.add(t);else if(Pm(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(r&&"object"==typeof t)for(let i in t)e(t[i],r,n)}return void 0===i?Array.from(n):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),Error(t)}_createBrowserWorker(){var e,t,r;let i;this._loadableURL=(Pf((e={source:this.source,url:this.url}).source&&!e.url||!e.source&&e.url),(i=Pp.get(e.source||e.url))||(e.url&&(i=(t=e.url).startsWith("http")?Pg((r=t,`\
try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`)):t,Pp.set(e.url,i)),e.source&&(i=Pg(e.source),Pp.set(e.source,i))),Pf(i),i);let n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(Error("No data received"))},n.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},n.onmessageerror=e=>console.error(e),n}_createNodeWorker(){let e;if(this.url)e=new Pd(this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`,{eval:!1});else if(this.source)e=new Pd(this.source,{eval:!0});else throw Error("no worker");return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class Pb{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Pf(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Pf(this.isRunning),this.isRunning=!1,this._reject(e)}}class Px{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Pv.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,r)=>e.done(r),r=(e,t)=>e.error(t)){let i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let r=new Pb(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Pc||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this._getMaxConcurrency()?(this.count++,new Pv({name:`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`,source:this.source,url:this.url})):null}_getMaxConcurrency(){return Pu?this.maxMobileConcurrency:this.maxConcurrency}}let Pw={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class P_{props;workerPools=new Map;static _workerFarm;static isSupported(){return Pv.isSupported()}static getWorkerFarm(e={}){return P_._workerFarm=P_._workerFarm||new P_({}),P_._workerFarm.setProps(e),P_._workerFarm}constructor(e){this.props={...Pw},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){for(let t of(this.props={...this.props,...e},this.workerPools.values()))t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:r,url:i}=e,n=this.workerPools.get(t);return n||((n=new Px({name:t,source:r,url:i})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}let Pk=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);async function PP(e,t,r,i,n){let s=e.id,a=function(e,t={}){let r=t[e.id]||{},i=Pc?`${e.id}-worker.js`:`${e.id}-worker-node.js`,n=r.workerUrl;if(n||"compression"!==e.id||(n=t.workerUrl),"test"===t._workerType&&(n=Pc?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let t=e.version;"latest"===t&&(t="latest");let r=t?`@${t}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${r}/dist/${i}`}return Pf(n),n}(e,r),o=P_.getWorkerFarm(r).getWorkerPool({name:s,url:a});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let l=await o.startJob("process-on-worker",PS.bind(null,n));l.postMessage("process",{input:t,options:r,context:i});let c=await l.result;return await c.result}async function PS(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(Error(i.error));break;case"process":let{id:n,input:s,options:a}=i;try{let r=await e(s,a);t.postMessage("done",{id:n,result:r})}catch(r){let e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:n,error:e})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}async function PE(e){let t=[];for await(let r of e)t.push(r);return function(...e){var t=e;let r=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),i=new Uint8Array(r.reduce((e,t)=>e+t.byteLength,0)),n=0;for(let e of r)i.set(e,n),n+=e.byteLength;return i.buffer}(...t)}async function*PA(e,t){let r=t?.chunkSize||1048576,i=0;for(;i<e.size;){let t=i+r,n=await e.slice(i,t).arrayBuffer();i=t,yield n}}function PM(e){if(e&&"object"==typeof e&&e.isBuffer||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e)return new TextEncoder().encode(e).buffer;if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw Error("toArrayBuffer")}function PT(e,t){return k9?PC(e,t):PO(e,t)}async function*PC(e,t){let r,i=e.getReader();try{for(;;){let e=r||i.read();t?._streamReadAhead&&(r=i.read());let{done:n,value:s}=await e;if(n)return;yield PM(s)}}catch(e){i.releaseLock()}}async function*PO(e,t){for await(let t of e)yield PM(t)}let PI="Cannot convert supplied data type";async function PL(e,t,r){let i,n,s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s){let r;var a=e;if(t.text&&"string"==typeof a)return a;if((r=a)&&"object"==typeof r&&r.isBuffer&&(a=a.buffer),a instanceof ArrayBuffer){let e=a;return t.text&&!t.binary?new TextDecoder("utf8").decode(e):e}if(ArrayBuffer.isView(a)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(a);let e=a.buffer,r=a.byteLength||a.length;return(0!==a.byteOffset||r!==e.byteLength)&&(e=e.slice(a.byteOffset,a.byteOffset+r)),e}throw Error(PI)}if(kR(e)&&(e=await kJ(e)),kD(e)){let r=e;return await kQ(r),t.binary?await r.arrayBuffer():await r.text()}if(kz(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){let r=t?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<e.length;){let t=Math.min(e.length-i,r),s=e.slice(i,i+t);i+=t,yield n.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){let{chunkSize:r=262144}=t,i=0;for(;i<e.byteLength;){let t=Math.min(e.byteLength-i,r),n=new ArrayBuffer(t),s=new Uint8Array(e,i,t);new Uint8Array(n).set(s),i+=t,yield n}}(e,t);if(kR(e))return PA(e,t);if(kz(e))return PT(e,t);if(kD(e))return PT(e.body,t);throw Error("makeIterator")}(e,r)),(i=e)&&"function"==typeof i[Symbol.iterator]||(n=e)&&"function"==typeof n[Symbol.asyncIterator])return PE(e);throw Error(PI)}function Pj(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function PN(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function PD(...e){return(e=e.map((t,r)=>(r&&(t=t.replace(RegExp("^/"),"")),r!==e.length-1&&(t=t.replace(RegExp("/$"),"")),t))).join("/")}function PR(...e){let t,r=[];for(let t=0;t<e.length;t++)r[t]=e[t];let i="",n=!1;for(let e=r.length-1;e>=-1&&!n;e--){let s;e>=0?s=r[e]:(void 0===t&&(t=function(){if(void 0!==t1.default&&void 0!==t1.default.cwd)return t1.default.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}()),s=t),0!==s.length&&(i=`${s}/${i}`,n=s.charCodeAt(0)===Pz)}return(i=function(e,t){let r,i="",n=-1,s=0,a=!1;for(let o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(r===Pz)break;else r=Pz;if(r===Pz){if(n===o-1||1===s);else if(n!==o-1&&2===s){if(i.length<2||!a||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){let e=i.length-1,t=e;for(;t>=0&&i.charCodeAt(t)!==Pz;--t);if(t!==e){i=-1===t?"":i.slice(0,t),n=o,s=0,a=!1;continue}}else if(2===i.length||1===i.length){i="",n=o,s=0,a=!1;continue}}t&&(i.length>0?i+="/..":i="..",a=!0)}else{let t=e.slice(n+1,o);i.length>0?i+=`/${t}`:i=t,a=!1}n=o,s=0}else 46===r&&-1!==s?++s:s=-1}return i}(i,!n),n)?`/${i}`:i.length>0?i:"."}let Pz=47;e.s(["dirname",()=>PN,"filename",()=>Pj,"join",()=>PD,"resolve",()=>PR],73276);var PF=e.i(73276),PF=PF,PF=PF;let PB=()=>{let e=Pi();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},PU=/\.([^.]+)$/;async function P$(e,t=[],r,i){if(!PW(e))return null;let n=PV(e,t,{...r,nothrow:!0},i);if(n)return n;if(kR(e)&&(n=PV(e=await e.slice(0,10).arrayBuffer(),t,r,i)),!n&&!r?.nothrow)throw Error(PG(e));return n}function PV(e,t=[],r,i){var n,s,a,o,l,c;let u,h,d,f,p,g,m;if(!PW(e))return null;if(t&&!Array.isArray(t))return kU(t);let y=[];t&&(y=y.concat(t)),r?.ignoreRegisteredLoaders||y.push(...PB()),function(e){for(let t of e)kU(t)}(y);let v=(n=e,s=y,a=r,o=i,u=kY(n),h=kX(n),d=kZ(u)||o?.url,f=null,p="",a?.mimeType&&(f=Pq(s,a?.mimeType),p=`match forced by supplied MIME type ${a?.mimeType}`),f=f||(l=s,(m=(g=(c=d)&&PU.exec(c))&&g[1])?function(e,t){for(let r of(t=t.toLowerCase(),e))for(let e of r.extensions)if(e.toLowerCase()===t)return r;return null}(l,m):null),p=p||(f?`matched url ${d}`:""),f=f||Pq(s,h),p=p||(f?`matched MIME type ${h}`:""),f=f||function(e,t){if(!t)return null;for(let r of e)if("string"==typeof t){if(function(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(PH(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&PH(t,0,r))return r;return null}(s,n),p=p||(f?`matched initial data ${PK(n)}`:""),a?.fallbackMimeType&&(f=f||Pq(s,a?.fallbackMimeType),p=p||(f?`matched fallback MIME type ${h}`:"")),p&&k5.log(1,`selectLoader selected ${f?.name}: ${p}.`),f);if(!v&&!r?.nothrow)throw Error(PG(e));return v}function PW(e){return!(e instanceof Response)||204!==e.status}function PG(e){let t=kY(e),r=kX(e),i="No valid loader found (";i+=(t?`${PF.filename(t)}, `:"no url provided, ")+`MIME type: ${r?`"${r}"`:"not provided"}, `;let n=e?PK(e):"";return i+((n?` first bytes: "${n}"`:"first bytes: not available")+")")}function Pq(e,t){for(let r of e)if(r.mimeTypes?.some(e=>kq(t,e))||kq(t,`application/x.${r.id}`))return r;return null}function PH(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(r=>(function(e,t,r,i){if(i instanceof ArrayBuffer)return function(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let i=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==n[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":let n=PZ(e,t,i.length);return i===n;default:return!1}})(e,t,0,r))}function PK(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?PZ(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?PZ(e,0,t):""}function PZ(e,t,r){if(e.byteLength<t+r)return"";let i=new DataView(e),n="";for(let e=0;e<r;e++)n+=String.fromCharCode(i.getUint8(t+e));return n}async function PY(e,t,r,i){var n,s,a,o,l,c,u;let h;!t||Array.isArray(t)||kB(t)||(i=void 0,r=t,t=void 0),e=await e,r=r||{};let d=kY(e),f=function(e,t){let r;if(e&&!Array.isArray(e))return e;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:void 0}(t,i),p=await P$(e,f,r);if(!p)return null;return function(e,t){for(let r of(Ps(e,null,Pt,Pr,t),t)){let i=e&&e[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Ps(i,r.id,n,s,t)}}(n=r,s=Array.isArray(s=(s=f)||[])?s:[s]),i=function(e,t,r){if(r)return r;let i={fetch:Po(t,e),...e};if(i.url){let e,t=kZ(i.url);i.baseUrl=t,e=i.url.match(kK),i.queryString=e&&e[0],i.filename=PF.filename(t),i.baseUrl=PF.dirname(t)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:d,_parse:PY,loaders:f},(a=p,o=n,l=d,c=h={...a.options||{}},!(u=l)||"baseUri"in c||(c.baseUri=u),null===h.log&&(h.log=new k8),Pa(h,Pn()),Pa(h,o),r=h),i||null),await PX(p,e,r,i)}async function PX(e,t,r,i){var n;if(!function(e,t=Pk){Pf(e,"no worker provided");e.version}(e),r=function e(t,r,i=0){if(i>3)return r;let n={...t};for(let[t,s]of Object.entries(r))s&&"object"==typeof s&&!Array.isArray(s)?n[t]=e(n[t]||{},r[t],i+1):n[t]=r[t];return n}(e.options||{},r),kD(t)){let e=t,{ok:r,redirected:n,status:s,statusText:a,type:o,url:l}=e;i.response={headers:Object.fromEntries(e.headers.entries()),ok:r,redirected:n,status:s,statusText:a,type:o,url:l}}if(t=await PL(t,e,r),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,r,i);if(n=r,P_.isSupported()&&(Pc||n?._nodeWorkers)&&e.worker&&n?.worker)return await PP(e,t,r,i,PY);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,i);if(e.parse)return await e.parse(t,r,i);throw Pf(!e.parseSync),Error(`${e.id} loader - no parser found and worker is disabled`)}async function PJ(e,t,r,i){let n,s;Array.isArray(t)||kB(t)?(n=t,s=r):(n=[],s=t);let a=Po(s),o=e;return"string"==typeof e&&(o=await a(e)),kR(e)&&(o=await a(e)),Array.isArray(n),await PY(o,n,s)}class PQ{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let r=++this._loadCount,i=e;for(let t of("string"==typeof e&&(i=PJ(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e),this._subscribers))t.onChange(this.getData())}}class P0{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let n=this._resources[e];n?n.setData(t,r):(n=new PQ(e,t,this._context),this._resources[e]=n),n.persistent=i}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let e in t){let r=t[e],i=this._resources[r.resourceId];i&&i.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){let{_resources:n,protocol:s}=this;e.startsWith(s)&&(n[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));let a=n[e];if(this._track(r,i,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,r,i){let n=this._consumers,s=n[e]=n[e]||{},a=s[t],o=a&&a.resourceId&&this._resources[a.resourceId];o&&(o.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},s[t]=a,r.subscribe(a))}_prune(){for(let e of(this._pruneRequest=null,Object.keys(this._resources))){let t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}let P1=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:n=0,copy:s=!1,initialize:a=!1,maxCount:o}){let l=i||e&&e.constructor||Float32Array,c=t*r+n;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;o&&(u=o*r+n);let h=this._allocate(l,c,a,u);return e&&s?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,r,i){let n=Math.max(Math.ceil(t*this.opts.overAlloc),1);n>i&&(n=i);let s=this._pool,a=e.BYTES_PER_ELEMENT*n,o=s.findIndex(e=>e.byteLength>=a);if(o>=0){let t=new e(s.splice(o,1)[0],0,n);return r&&t.fill(0),t}return new e(n)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:r}=e,{byteLength:i}=r,n=t.findIndex(e=>e.byteLength>=i);n<0?t.push(r):(n>0||t.length<this.opts.poolSize)&&t.splice(n,0,r),t.length>this.opts.poolSize&&t.shift()}};function P2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}let P3=new _a;function P4(e,t,r,i){P3.set(e,t,r);let n=P3.len();return{distance:i/n,normal:new _a(-e/n,-t/n,-r/n)}}function P5(e,t){let{size:r=1,startIndex:i=0}=t,s=void 0!==t.endIndex?t.endIndex:e.length,a=(s-i)/r;n=P1.allocate(n,a,{type:Float32Array,size:2*r});let o=i,l=0;for(;o<s;){for(let t=0;t<r;t++){let i=e[o++];n[l+t]=i,n[l+t+r]=i-Math.fround(i)}l+=2*r}return n.subarray(0,a*r*2)}function P6(e){let t=null,r=!1;for(let i of e)i&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}var bz=bz;let P8=Math.PI/180,P7=P2(),P9=[0,0,0],Se={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class St{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Se,this.focalDistance=e.focalDistance||1,this.position=e.position||P9,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?x2.WEB_MERCATOR:x2.WEB_MERCATOR_AUTO_OFFSET:x2.IDENTITY}equals(e){return e instanceof St&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&wb(e.projectionMatrix,this.projectionMatrix)&&wb(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){let r=kn(this.projectPosition(e),this.pixelProjectionMatrix),[i,n]=r,s=t?n:this.height-n;return 2===e.length?[i,s]:[i,s,r[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let[i,n,s]=e,a=t?n:this.height-n,o=r&&r*this.distanceScales.unitsPerMeter[2],l=ks([i,a,s],this.pixelUnprojectionMatrix,o),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,h]:Number.isFinite(r)?[c,u,r]:[c,u]}projectPosition(e){let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){let[t,r]=this.unprojectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){let t=_8(e);return t[1]=wy(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?_7(e):e}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],n[0],s[0]),Math.min(r[1],i[1],n[1],s[1]),Math.max(r[0],i[0],n[0],s[0]),Math.max(r[1],i[1],n[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?ke({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){var e;return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,{left:P4((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:P4(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:P4(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:P4(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:P4(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:P4(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){let{latitude:t}=e;return _2(Number.isFinite(t)),_Q(4003e4*Math.cos(t*_5))-9}({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ke({latitude:r,longitude:t}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:n,modelMatrix:s}=e,a=P9;if(n&&(a=s?new _K(s).transformAsVector(n,[]):n),this.isGeospatial){let e=this.projectPosition([t,r,0]);this.center=new _a(a).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(a)}_initMatrices(e){var t;let{viewMatrix:r=P7,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new _K().multiplyRight(r).translate(new _a(this.center).negate()),this.projectionMatrix=i||function({width:e,height:t,orthographic:r,fovyRadians:i,focalDistance:n,padding:s,near:a,far:o}){let l=e/t,c=r?new _K().orthographic({fovy:i,aspect:l,focalDistance:n,near:a,far:o}):new _K().perspective({fovy:i,aspect:l,near:a,far:o});if(s){let{left:r=0,right:i=0,top:n=0,bottom:a=0}=s,o=wy((r+e-i)/2,0,e)-e/2,l=wy((n+t-a)/2,0,t)-t/2;c[8]-=2*o/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:n,fovyRadians:s||a*P8,focalDistance:u,padding:c,near:o,far:l});let h=P2();bz.multiply(h,h,this.projectionMatrix),bz.multiply(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=bz.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(t=this.viewMatrixInverse)[12],t[13],t[14]];let d=P2(),f=P2();bz.scale(d,d,[this.width/2,-this.height/2,1]),bz.translate(d,d,[1,-1,0]),bz.multiply(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=bz.invert(P2(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||xh.warn("Pixel project matrix not invertible")()}}St.displayName="Viewport";let Sr=St;class Si{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{kO("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:r,stats:i,viewport:n,timeline:s}=t||{};this.layers=[],this.resourceManager=new P0({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:function(e){let t=vj.getDefaultShaderAssembler();for(let e of kx)t.addDefaultModule(e);for(let r of(t._hookFunctions.length=0,"glsl"===e?kw:k_))t.addShaderHook(r);return t}(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[vq],renderPass:void 0,stats:i||new kL.Stats({id:"deck.gl"}),viewport:n||new Sr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new vo,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){for(let e of(this.resourceManager.finalize(),this.layers))this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;for(let r of(e.clearRedrawFlags&&(this._needsRedraw=!1),this.layers)){let i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){kO("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;let r=kI(e,Boolean);for(let e of r)e.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,r=t.findIndex(t=>t.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){let r={};for(let t of e)r[t.id]?xh.warn(`Multiple old layers with same id ${t.id}`)():r[t.id]=t;if(this._defaultShaderModulesChanged){for(let t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let n=!1;for(let e of i)if(e.hasUniformTransition()){n=`Uniform transition in ${e}`;break}this._needsUpdate=n,this.layers=i}_updateSublayersRecursively(e,t,r){for(let i of e){i.context=this.context;let e=t[i.id];null===e&&xh.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let n=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),n=i.isComposite?i.getSubLayers():null}catch(e){this._handleError("matching",e,i)}n&&this._updateSublayersRecursively(n,t,r)}}_finalizeOldLayers(e){for(let t in e){let r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function Sn(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Sn(e[i],t[i],r-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){let i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let n of i)if(!t.hasOwnProperty(n)||!Sn(e[n],t[n],r-1))return!1;return!0}return!1}class Ss{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t="string"==typeof e?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){let r=this.getViewports(),i={x:e[0],y:e[1]};for(let n=r.length-1;n>=0;--n){let s=r[n];if(s.containsPixel(i)){let r=e.slice();return r[0]-=s.x,r[1]-=s.y,s.unproject(r,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=kI(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(Sn(e,this.viewState,3)||this.setNeedsUpdate("viewState changed"),this.viewState=e):xh.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new t.type({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,r,i){let n=e.controller;if(n&&r){let s={...t,...n,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return i&&i.constructor===n.type||(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){let n=e[i],s=this.getViewState(n),a=n.makeViewport({viewState:s,width:this.width,height:this.height}),o=t[n.id],l=!!n.controller;l&&!o&&(r=!0),(r||!l)&&o&&(o.finalize(),o=null),this.controllers[n.id]=this._updateController(n,s,a,o),a&&this._viewports.unshift(a)}for(let e in t){let r=t[e];r&&!this.controllers[e]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((r,i)=>!e[i].equals(t[i]))}}let Sa=/([0-9]+\.?[0-9]*)(%|px)/;function So(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=Sa.exec(e);if(t&&t.length>=3){let e="%"===t[2],r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw Error(`Could not parse position string ${e}`)}}function Sl(e,t){return e.relative?Math.round(e.position*t):e.position}class Sc{constructor(e){const{id:t,x:r=0,y:i=0,width:n="100%",height:s="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=So(r),this._y=So(i),this._width=So(n),this._height=So(s),this._padding=a&&{left:So(a.left||0),right:So(a.right||0),top:So(a.top||0),bottom:So(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&Sn(this.props,e.props,2)}clone(e){return new this.constructor({...this.props,...e})}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);let i=this.getDimensions({width:e,height:t});return i.height&&i.width?new(this.getViewportType(r))({...r,...this.props,...i}):null}getViewStateId(){let{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){let r={x:Sl(this._x,e),y:Sl(this._y,t),width:Sl(this._width,e),height:Sl(this._height,t)};return this._padding&&(r.padding={left:Sl(this._padding.left,e),top:Sl(this._padding.top,t),right:Sl(this._padding.right,e),bottom:Sl(this._padding.bottom,t)}),r}get controller(){let e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}var _0=_0;class Su extends Sr{constructor(e={}){let t;const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:d,repeat:f=!1,worldOffset:p=0,position:g,padding:m,legacyMeterSizes:y=!1}=e;let{width:v,height:b,altitude:x=1.5}=e;const w=Math.pow(2,n);v=v||1,b=b||1;let _=null;if(d)t=kr(x=d[5]/2);else{let i;if(e.fovy?x=ki(t=e.fovy):t=kr(x),m){const{top:e=0,bottom:t=0}=m;i=[0,wy((e+b-t)/2,0,b)-b/2]}_=function(e){let{width:t,height:r,altitude:i,pitch:n=0,offset:s,center:a,scale:o,nearZMultiplier:l=1,farZMultiplier:c=1}=e,{fovy:u=kr(1.5)}=e;void 0!==i&&(u=kr(i));let h=u*_5,d=n*_5,f=ki(u),p=f;a&&(p+=a[2]*o/Math.cos(d)/r);let g=h*(.5+(s?s[1]:0)/r),m=Math.sin(g)*p/Math.sin(_J(Math.PI/2-d-g,.01,Math.PI-.01));return{fov:h,aspect:t/r,focalDistance:f,near:l,far:Math.min((Math.sin(d)*m+p)*c,10*p)}}({width:v,height:b,scale:w,center:g&&[0,0,g[2]*_9(r)],offset:i,pitch:s,fovy:t,nearZMultiplier:o,farZMultiplier:l}),Number.isFinite(c)&&(_.near=c),Number.isFinite(u)&&(_.far=u)}let k=function(e){let{height:t,pitch:r,bearing:i,altitude:n,scale:s,center:a}=e,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];bz.translate(o,o,[0,0,-n]),bz.rotateX(o,o,-r*_5),bz.rotateZ(o,o,i*_5);let l=s/t;return bz.scale(o,o,[l,l,l]),a&&bz.translate(o,o,_1.negate([],a)),o}({height:b,pitch:s,bearing:a,scale:w,altitude:x});p&&(k=new _K().translate([512*p,0,0]).multiplyLeft(k)),super({...e,width:v,height:b,viewMatrix:k,longitude:i,latitude:r,zoom:n,..._,fovy:t,focalDistance:x}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=a,this.altitude=x,this.fovy=t,this.orthographic=h,this._subViewports=f?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let e=t;e<=r;e++){let t=e?new Su({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*_9(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,r]=this.unprojectFlat(e),i=(e[2]||0)/_9(r);return[t,r,i]}addMetersToLngLat(e,t){return kt(e,t)}panByPosition(e,t){let r=ks(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),n=_0.add([],i,_0.negate([],r)),s=_0.add([],this.center,n),[a,o]=this.unprojectFlat(s);return{longitude:a,latitude:o}}getBounds(e={}){let t=function(e,t=0){let r,i,{width:n,height:s,unproject:a}=e,o={targetZ:t},l=a([0,s],o),c=a([n,s],o);return(e.fovy?.5*e.fovy*ka:Math.atan(.5/e.altitude))>(90-e.pitch)*ka-.01?(r=ko(e,0,t),i=ko(e,n,t)):(r=a([0,0],o),i=a([n,0],o)),[l,c,i,r]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:r,height:i}=this,{longitude:n,latitude:s,zoom:a}=function(e){let{width:t,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:a=[0,0]}=e,[[o,l],[c,u]]=i,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(_2(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=_8([o,_J(u,-85.051129,85.051129)]),f=_8([c,_J(l,-85.051129,85.051129)]),p=[Math.max(Math.abs(f[0]-d[0]),n),Math.max(Math.abs(f[1]-d[1]),n)],g=[t-h.left-h.right-2*Math.abs(a[0]),r-h.top-h.bottom-2*Math.abs(a[1])];_2(g[0]>0&&g[1]>0);let m=g[0]/p[0],y=g[1]/p[1],v=(h.right-h.left)/2/m,b=(h.top-h.bottom)/2/y,x=_7([(f[0]+d[0])/2+v,(f[1]+d[1])/2+b]),w=Math.min(s,_Q(Math.abs(Math.min(m,y))));return _2(Number.isFinite(w)),{longitude:x[0],latitude:x[1],zoom:w}}({width:r,height:i,bounds:e,...t});return new Su({width:r,height:i,longitude:n,latitude:s,zoom:a})}}Su.displayName="WebMercatorViewport";class Sh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}let Sd=()=>{},Sf=e=>e;class Sp{constructor(e){this._onTransitionUpdate=e=>{let{time:t,settings:{interpolator:r,startProps:i,endProps:n,duration:s,easing:a}}=e,o=a(t/s),l=r.interpolateProps(i,n,o);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Sh(e.timeline),this.onViewStateChange=e.onViewStateChange||Sd,this.onStateChange=e.onStateChange||Sd}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){let{interruption:e,endProps:t}=this.transition.settings;i={...r,...2===e?t:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||"auto"===t)&&!!r}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&!!this.propsInTransition&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){let r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),n=t.transitionInterpolator,s=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0===s)return;let a=n.initializeProps(e,i);this.propsInTransition={};let o={duration:s,easing:t.transitionEasing||Sf,interpolator:n,interruption:t.transitionInterruption||1,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Sg(e,t){if(!e)throw Error(t||"deck.gl: assertion failed.")}class Sm{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(let r of this._propsToCompare)if(!(r in e)||!(r in t)||!wb(e[r],t[r]))return!1;return!0}initializeProps(e,t){let r={},i={};for(let n of this._propsToExtract)(n in e||n in t)&&(r[n]=e[n],i[n]=t[n]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{let r=e[t];Sg(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}let Sy=["longitude","latitude","zoom","bearing","pitch"],Sv=["longitude","latitude","zoom"];class Sb extends Sm{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Sy,required:Sv},super(r.transitionProps),this.opts=r}initializeProps(e,t){let r=super.initializeProps(e,t),{makeViewport:i,around:n}=this.opts;if(i&&n){let s=i(e),a=i(t),o=s.unproject(n);r.start.around=n,Object.assign(r.end,{around:a.project(o),aroundPosition:o,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){let i={};for(let n of this._propsToExtract)i[n]=wv(e[n]||0,t[n]||0,r);if(t.aroundPosition&&this.opts.makeViewport){let n=this.opts.makeViewport({...t,...i});Object.assign(i,n.panByPosition(t.aroundPosition,wv(e.around,t.around,r)))}return i}}let Sx={transitionDuration:0},Sw=e=>1-(1-e)*(1-e),S_=["wheel"],Sk=["panstart","panmove","panend"],SP=["pinchstart","pinchmove","pinchend"],SS=["multipanstart","multipanmove","multipanend"],SE=["dblclick"],SA=["keydown"],SM={};class ST{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Sp({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){let{width:r,height:i}=this.props;if(t&&t.handled)return!1;let n=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return n&&t&&t.stopPropagation(),n}isFunctionKeyPressed(e){let{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:300*(!0===t);let{scrollZoom:r=!0,dragPan:i=!0,dragRotate:n=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:o=!1,keyboard:l=!0}=e,c=!!this.onViewStateChange;this.toggleEvents(S_,c&&r),this.toggleEvents(Sk,c),this.toggleEvents(SP,c&&(a||o)),this.toggleEvents(SS,c&&o),this.toggleEvents(SE,c&&s),this.toggleEvents(SA,c&&l),this.scrollZoom=r,this.dragPan=i,this.dragRotate=n,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=o,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,r={}){let i={...e.getViewportProps(),...t},n=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),n){let e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(r=!r);let i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,Sx,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Sx,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],n=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sw},{isDragging:!1,isPanning:!0})}else{let e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Sx,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],n=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sw},{isDragging:!1,isRotating:!0})}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:r=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:n}=e,s=2/(1+Math.exp(-Math.abs(n*r)));n<0&&0!==s&&(s=1/s);let a=i?{...this._getTransitionProps({around:t}),transitionDuration:250}:Sx,o=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(o,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Sx,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Sx,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],n=this.controllerState.rotate({pos:i});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Sw},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return SM._startPinchRotation=e.rotation,SM._lastPinchEvent=e,this.updateViewport(r,Sx,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){let{rotation:r}=e;t=t.rotate({deltaAngleX:SM._startPinchRotation-r})}return this.updateViewport(t,Sx,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),SM._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:r}=SM;if(this.touchZoom&&t&&r&&e.scale!==r.scale){let i=this.getCenter(e),n=this.controllerState.rotateEnd(),s=Math.log2(e.scale),a=(s-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),o=Math.pow(2,s+a*t/2);n=n.zoom({pos:i,scale:o}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Sw},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return SM._startPinchRotation=null,SM._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){let t;if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:a}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this,l={};switch(e.srcEvent.code){case"Minus":t=r?o.zoomOut(i).zoomOut(i):o.zoomOut(i),l.isZooming=!0;break;case"Equal":t=r?o.zoomIn(i).zoomIn(i):o.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":r?(t=o.rotateLeft(s),l.isRotating=!0):(t=o.moveLeft(n),l.isPanning=!0);break;case"ArrowRight":r?(t=o.rotateRight(s),l.isRotating=!0):(t=o.moveRight(n),l.isPanning=!0);break;case"ArrowUp":r?(t=o.rotateUp(a),l.isRotating=!0):(t=o.moveUp(n),l.isPanning=!0);break;case"ArrowDown":r?(t=o.rotateDown(a),l.isRotating=!0):(t=o.moveDown(n),l.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),l),!0}_getTransitionProps(e){let{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Sb({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Sx}}class SC{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class SO extends SC{constructor(e){const{width:t,height:r,latitude:i,longitude:n,zoom:s,bearing:a=0,pitch:o=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:b,normalize:x=!0}=e;Sg(Number.isFinite(n)),Sg(Number.isFinite(i)),Sg(Number.isFinite(s)),super({width:t,height:r,latitude:i,longitude:n,zoom:s,bearing:a,pitch:o,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:x,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:b}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){let i,{startRotatePos:n,startBearing:s,startPitch:a}=this.getState();return n&&void 0!==s&&void 0!==a?(i=e?this._getNewRotation(e,n,a,s):{bearing:s+t,pitch:a+r},this._getUpdatedState(i)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:n}=this.getState();if(n||(i=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),o=i+Math.log2(r);o=wy(o,a,s);let l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:n}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(n-t.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}applyConstraints(e){let{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=wy(i,r,t);let{maxPitch:n,minPitch:s,pitch:a}=e;e.pitch=wy(a,s,n);let{normalize:o=!0}=e;return o&&Object.assign(e,function(e){let{width:t,height:r,pitch:i=0}=e,{longitude:n,latitude:s,zoom:a,bearing:o=0}=e;(n<-180||n>180)&&(n=_X(n+180,360)-180),(o<-180||o>180)&&(o=_X(o+180,360)-180);let l=_Q(r/512);if(a<=l)a=l,s=0;else{let e=r/2/Math.pow(2,a),t=_7([0,e])[1];if(s<t)s=t;else{let t=_7([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:r,longitude:n,latitude:s,zoom:a,pitch:i,bearing:o}}(e)),e}_zoomFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){let n=e[0]-t[0],s=e[1]-t[1],a=e[1],o=t[1],{width:l,height:c}=this.getViewportProps(),u=0;s>0?Math.abs(c-o)>5&&(u=s/(o-c)*1.2):s<0&&o>5&&(u=1-a/o),u=wy(u,-1,1);let{minPitch:h,maxPitch:d}=this.getViewportProps(),f=r;return u>0?f=r+u*(d-r):u<0&&(f=r-u*(h-r)),{pitch:f,bearing:i+n/l*180}}}class SI extends ST{constructor(){super(...arguments),this.ControllerState=SO,this.transition={transitionDuration:300,transitionInterpolator:new Sb({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),t&&t.height===e.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class SL extends Sc{constructor(e={}){super(e)}getViewportType(){return Su}get ControllerType(){return SI}}SL.displayName="MapView";let Sj=[255,255,255],SN=0;class SD{constructor(e={}){this.type="ambient";const{color:t=Sj}=e,{intensity:r=1}=e;this.id=e.id||`ambient-${SN++}`,this.color=t,this.intensity=r}}let SR=[255,255,255],Sz=[0,0,-1],SF=0;class SB{constructor(e={}){this.type="directional";const{color:t=SR}=e,{intensity:r=1}=e,{direction:i=Sz}=e,{_shadow:n=!1}=e;this.id=e.id||`directional-${SF++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new _a(i).normalize().toArray(),this.shadow=n}getProjectedLight(e){return this}}class SU{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class S$ extends SU{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,n=e.clearColor??(!!i&&[0,0,0,0]),s=e.colorMask??15,a={viewport:[0,0,t,r]};e.colorMask&&(a.colorMask=s),e.scissorRect&&(a.scissorRect=e.scissorRect);let o=this.device.beginRenderPass({framebuffer:e.target,parameters:a,clearColor:n,clearDepth:!!i&&1,clearStencil:!!i&&0});try{return this._drawLayers(o,e)}finally{o.end(),this.device.submit()}}_drawLayers(e,t){let{target:r,shaderModuleProps:i,viewports:n,views:s,onViewportActive:a,clearStack:o=!0}=t;t.pass=t.pass||"unknown",o&&(this._lastRenderIndex=-1);let l=[];for(let o of n){let n=s&&s[o.id];a?.(o);let c=this._getDrawLayerParams(o,t);for(let s of o.subViewports||[o]){let a=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:s,view:n,pass:t.pass,layers:t.layers},c);l.push(a)}}return l}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:n,cullRect:s,effects:a,shaderModuleProps:o},l=!1){let c=[],u=function e(t=0,r={}){let i={},n=(s,a)=>{let o,l=s.props._offset,c=s.id,u=s.parent&&s.parent.id;if(!u||u in r||n(s.parent,!1),u in i){let t=i[u]=i[u]||e(r[u],r);o=t(s,a),i[c]=t}else Number.isFinite(l)?(o=l+(r[u]||0),i[c]=null):o=t;return a&&o>=t&&(t=o+1),r[c]=o,o};return n}(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:s},d={};for(let i=0;i<t.length;i++){let s=t[i],f=this._shouldDrawLayer(s,h,n,d),p={shouldDrawLayer:f};f&&!l&&(p.shouldDrawLayer=!0,p.layerRenderIndex=u(s,f),p.shaderModuleProps=this._getShaderModuleProps(s,a,r,o),p.layerParameters={...s.context.deck?.props.parameters,...this.getLayerParameters(s,i,e)}),c[i]=p}return c}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:n,viewport:s,view:a},o){let l=function(e,{shaderModuleProps:t,target:r,viewport:i}){let n=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),a=r?r.height:s;return[i.x*n,a-(i.y+i.height)*n,i.width*n,i.height*n]}(this.device,{shaderModuleProps:r,target:n,viewport:s});if(a){let{clear:e,clearColor:t,clearDepth:r,clearStencil:i}=a.props;if(e){let e=[0,0,0,0],s=1,a=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==r&&(s=r),void 0!==i&&(a=i),this.device.beginRenderPass({framebuffer:n,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:s,clearStencil:a}).end()}}let c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let r=0;r<t.length;r++){let n=t[r],a=o[r],{shouldDrawLayer:l}=a;if(l&&n.props.pickable&&c.pickableCount++,n.isComposite&&c.compositeCount++,n.isDrawable&&a.shouldDrawLayer){let{layerRenderIndex:t,shaderModuleProps:r,layerParameters:o}=a;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),r.project&&(r.project.viewport=s),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:r,uniforms:{layerIndex:t},parameters:o})}catch(e){n.raiseError(e,`drawing ${n} to ${i}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let n=e.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(t))return!1;t.layer=n,n=n.parent}if(r){let e=t.layer.id;if(e in i||(i[e]=r(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){let n=this.device.canvasContext.cssToDeviceRatio(),s=e.internalState?.propsInTransition||e.props,a={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:n,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(let r of t)SV(a,r.getShaderModuleProps?.(e,a));return SV(a,this.getShaderModuleProps(e,t,a),i)}}function SV(e,...t){for(let r of t)if(r)for(let t in r)e[t]?Object.assign(e[t],r[t]):e[t]=r[t];return e}class SW extends S${constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],n=i.width*r,s=i.height*r;(n!==t.width||s!==t.height)&&t.resize({width:n,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}let SG={color:[255,255,255],intensity:1},Sq=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],SH=[0,0,0,200/255];class SK{constructor(e={}){this.id="lighting-effect",this.shadowColor=SH,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(ky),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){for(let t in this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[],e){let r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:n,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){let r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},n=e.props.material;return{shadow:r,lighting:i,phongMaterial:n,gouraudMaterial:n}}cleanup(e){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ky))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let r=new _K().lookAt({eye:new _a(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let r=new SW(e);this.shadowPasses[t]=r}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:r}=this;e||0!==t.length||0!==r.length||(this.ambientLight=new SD(SG),this.directionalLights.push(new SB(Sq[0]),new SB(Sq[1])))}}let SZ=new SK;class SY{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){let r=t.findIndex(t=>(t.order??1/0)-(e.order??1/0)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&!Sn(e.effects,this.effects,1)&&this._setEffects(e.effects)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let e of this.effects)t[e.id]=e;let r=[];for(let i of e){let e=t[i.id],n=i;e&&e!==i?e.setProps?(e.setProps(i.props),n=e):e.cleanup(this._context):e||i.setup(this._context),r.push(n),delete t[i.id]}for(let e in t)t[e].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(e=>e instanceof SK)||this._resolvedEffects.push(SZ),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class SX extends S${shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}let SJ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class SQ extends S${constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,pickingFBO:s,deviceRect:{x:a,y:o,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;let g=this._resetColorEncoder(f),m=super.render({target:s,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,cullRect:u,effects:h?.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:[a,o,l,c]});return this._colorEncoderState=null,{decodePickingColor:g&&S0.bind(null,g),stats:m}}shouldDrawLayer(e){let{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){let i={...e.props.parameters},{pickable:n,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:n&&s.includes("draw")&&(Object.assign(i,SJ),i.blend=!0,i.blendColor=function(e,t,r){let i,{byLayer:n,byAlpha:s}=e,a=n.get(t);return a?(a.viewports.push(r),i=a.a):(i=n.size+1)<=255?(a={a:i,layer:t,viewports:[r]},n.set(t,a),s[i]=a):(xh.warn("Too many pickable layers, only picking the first 255")(),i=0),[0,0,0,i/255]}(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function S0(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}class S1{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new SX(e),this.pickLayersPass=new SQ(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);let i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);let n=t.render({...r,target:i});r.effects&&(this.lastPostProcessEffect&&(r.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(r.effects,r)),this.renderCount++,kO("deckRenderer.renderLayers",this,n,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){for(let r of(this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{},e))t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[r,i]=t;for(let n of(0===e.length&&[0,1].map(t=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:r,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))}),e))n.resize(t)}_postRender(e,t){let{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(let n of e)if(n.postRender){i.target=n.id===this.lastPostProcessEffect?t.target:void 0;let e=n.postRender(i);i.inputBuffer=e,i.swapBuffer=e===r[0]?r[1]:r[0]}}}let S2={pickedColor:null,pickedObjectIndex:-1};function S3({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:s}){let{x:a,y:o,width:l,height:c}=s,u=n*n,h=-1,d=0;for(let t=0;t<c;t++){let n=t+o-i,s=n*n;if(s>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){let e=t+a-r,i=e*e+s;i<=u&&(u=i,h=d)}d+=4}}if(h>=0){let r=e.slice(h,h+4),i=t(r);if(i){let e=Math.floor(h/4/l),t=h/4-e*l;return{...i,pickedColor:r,pickedX:a+t,pickedY:o+e}}xh.error("Picked non-existent layer. Is picking buffer corrupt?")()}return S2}function S4({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){let n=e.slice(i,i+4),s=n.join(",");if(!r.has(s)){let e=t(n);e?r.set(s,{...e,color:n}):xh.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function S5({pickInfo:e,viewports:t,pixelRatio:r,x:i,y:n,z:s}){let a,o=t[0];if(t.length>1&&(o=function(e,t){for(let r=e.length-1;r>=0;r--){let i=e[r];if(i.containsPixel(t))return i}return e[0]}(e?.pickedViewports||t,{x:i,y:n})),o){let e=[i-o.x,n-o.y];void 0!==s&&(e[2]=s),a=o.unproject(e)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function S6(e){let{pickInfo:t,lastPickedInfo:r,mode:i,layers:n}=e,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,l=a?[a]:[];if("hover"===i){let e=r.index,t=r.layerId,i=a?a.props.id:null;if(i!==t||o!==e){if(i!==t){let e=n.find(e=>e.props.id===t);e&&l.unshift(e)}r.layerId=i,r.index=o,r.info=null}}let c=S5(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===a&&(t.color=s,t.index=o,t.picked=!0);let n=(t=S8({layer:e,info:t,mode:i})).layer;e===a&&"hover"===i&&(r.info=t),u.set(n.id,t),"hover"===i&&n.updateAutoHighlight(t)}),u}function S8({layer:e,info:t,mode:r}){for(;e&&t;){let i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:i}),e=e.parent}return t}class S7{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new SQ(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},n=this.lastPickedInfo.info){let s=n&&n.layer&&n.layer.id,a=n&&n.viewport&&n.viewport.id,o=s?r.find(e=>e.id===s):null,l=a&&i.find(e=>e.id===a)||i[0],c=l&&l.unproject([e-l.x,t-l.y]);return{...n,x:e,y:t,viewport:l,coordinate:c,layer:o}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;let t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:r,x:i,y:n,radius:s=0,depth:a=1,mode:o="query",unproject3D:l,onViewportActive:c,effects:u}){let h,d=this.device.canvasContext.cssToDeviceRatio(),f=this._getPickable(e);if(!f||0===r.length)return{result:[],emptyInfo:S5({viewports:r,x:i,y:n,pixelRatio:d})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*d),{width:y,height:v}=this.pickingFBO,b=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:y,deviceHeight:v}),x={x:i-s,y:n-s,width:2*s+1,height:2*s+1},w=[],_=new Set;for(let e=0;e<a;e++){let s,p;if((s=b?S3({...this._drawAndSample({layers:f,views:t,viewports:r,onViewportActive:c,deviceRect:b,cullRect:x,effects:u,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:b}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[s.pickedLayer],views:t,viewports:r,onViewportActive:c,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:x,effects:u,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(s.pickedLayer&&e+1<a&&(_.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),(h=S6({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:o,layers:f,viewports:r,x:i,y:n,z:p,pixelRatio:d})).values()))t.layer&&w.push(t);if(!s.pickedColor)break}for(let e of _)e.restorePickingColors();return{result:w,emptyInfo:h.get(null)}}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:n,radius:s=0,depth:a=1,mode:o="query",unproject3D:l,onViewportActive:c,effects:u}){let h,d=this.device.canvasContext.cssToDeviceRatio(),f=this._getPickable(e);if(!f||0===r.length)return{result:[],emptyInfo:S5({viewports:r,x:i,y:n,pixelRatio:d})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([i,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*d),{width:y,height:v}=this.pickingFBO,b=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:y,deviceHeight:v}),x={x:i-s,y:n-s,width:2*s+1,height:2*s+1},w=[],_=new Set;for(let e=0;e<a;e++){let s,p;if((s=b?S3({...this._drawAndSample({layers:f,views:t,viewports:r,onViewportActive:c,deviceRect:b,cullRect:x,effects:u,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:b}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[s.pickedLayer],views:t,viewports:r,onViewportActive:c,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:x,effects:u,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(s.pickedLayer&&e+1<a&&(_.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),(h=S6({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:o,layers:f,viewports:r,x:i,y:n,z:p,pixelRatio:d})).values()))t.layer&&w.push(t);if(!s.pickedColor)break}for(let e of _)e.restorePickingColors();return{result:w,emptyInfo:h.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:r,x:i,y:n,width:s=1,height:a=1,mode:o="query",maxObjects:l=null,onViewportActive:c,effects:u}){let h=this._getPickable(e);if(!h||0===r.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([i,n],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([i+s,n+a],!0),y=m.x+m.width,v=m.y,b=this._drawAndSample({layers:h,views:t,viewports:r,onViewportActive:c,deviceRect:{x:p,y:v,width:y-p,height:g-v},cullRect:{x:i,y:n,width:s,height:a},effects:u,pass:`picking:${o}`}),x=S4(b),w=new Map,_=[],k=Number.isFinite(l);for(let e=0;e<x.length&&(!k||!(_.length>=l));e++){let t=x[e],r={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:n,pixelRatio:d},s=(r=S8({layer:t.pickedLayer,info:r,mode:o})).layer.id;w.has(s)||w.set(s,new Set);let a=w.get(s),l=r.object??r.index;a.has(l)||(a.add(l),_.push(r))}return _}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:n,width:s=1,height:a=1,mode:o="query",maxObjects:l=null,onViewportActive:c,effects:u}){let h=this._getPickable(e);if(!h||0===r.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([i,n],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([i+s,n+a],!0),y=m.x+m.width,v=m.y,b=this._drawAndSample({layers:h,views:t,viewports:r,onViewportActive:c,deviceRect:{x:p,y:v,width:y-p,height:g-v},cullRect:{x:i,y:n,width:s,height:a},effects:u,pass:`picking:${o}`}),x=S4(b),w=new Map,_=[],k=Number.isFinite(l);for(let e=0;e<x.length&&(!k||!(_.length>=l));e++){let t=x[e],r={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:n,pixelRatio:d},s=(r=S8({layer:t.pickedLayer,info:r,mode:o})).layer.id;w.has(s)||w.set(s,new Set);let a=w.get(s),l=r.object??r.index;a.has(l)||(a.add(l),_.push(r))}return _}async _drawAndSampleAsync({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:n,cullRect:s,effects:a,pass:o},l=!1){let c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:c,deviceRect:n,cullRect:s,effects:a,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of a)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));let{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=n,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:n,cullRect:s,effects:a,pass:o},l=!1){let c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:c,deviceRect:n,cullRect:s,effects:a,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of a)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));let{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=n,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:n}){let s=Math.max(0,e-r),a=Math.max(0,t-r),o=Math.min(i,e+r+1)-s,l=Math.min(n,t+r+1)-a;return o<=0||l<=0?null:{x:s,y:a,width:o,height:l}}}let S9={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Ee="__root";class Et{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!Sn(e.widgets,this.widgets,1)){let t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(let e of this.getWidgets())this._removeWidget(e);for(let e in this.defaultWidgets.length=0,this.resolvedWidgets.length=0,this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){let r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(let i of this.getWidgets()){let{viewId:n}=i;if(n){let e=r[n];e&&(i.onViewportChange&&i.onViewportChange(e),i.onRedraw?.({viewports:[e],layers:t}))}else{if(i.onViewportChange)for(let t of e)i.onViewportChange(t);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(let r of this.getWidgets()){let{viewId:i}=r;i&&i!==e.viewport?.id||r.onHover?.(e,t)}}onEvent(e,t){let r=x4[t.type];if(r)for(let i of this.getWidgets()){let{viewId:n}=i;n&&n!==e.viewport?.id||i[r]?.(e,t)}}_setWidgets(e){let t={};for(let e of this.resolvedWidgets)t[e.id]=e;for(let e of(this.resolvedWidgets.length=0,this.defaultWidgets))t[e.id]=null,this.resolvedWidgets.push(e);for(let r of e){let e=t[r.id];e?e.viewId!==r.viewId||e.placement!==r.placement?(this._removeWidget(e),this._addWidget(r)):r!==e&&(e.setProps(r.props),r=e):this._addWidget(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(let e in t){let r=t[e];r&&this._removeWidget(r)}this.widgets=e}_addWidget(e){let{viewId:t=null,placement:r="top-left"}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,r).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){let r=e||Ee,i=this.containers[r];i||((i=document.createElement("div")).style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let n=i.querySelector(`.${t}`);return n||((n=globalThis.document.createElement("div")).className=t,n.style.position="absolute",n.style.zIndex="2",Object.assign(n.style,S9[t]),i.append(n)),n}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let r in this.containers){let i=this.lastViewports[r]||null,n=r===Ee||i,s=this.containers[r];n?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}}function Er(e,t){t&&Object.entries(t).map(([t,r])=>{t.startsWith("--")?e.style.setProperty(t,r):e.style[t]=r})}class Ei{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){let t=this.props,r=this.rootElement;if(r&&t.className!==e.className&&(t.className&&r.classList.remove(t.className),e.className&&r.classList.add(e.className)),r&&!Sn(t.style,e.style,1)){var i;(i=t.style)&&Object.keys(i).map(e=>{e.startsWith("--")?r.style.removeProperty(e):r.style[e]=""}),Er(r,e.style)}Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){let e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),Er(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Ei.defaultProps={id:"widget",style:{},className:""};let En={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Es extends Ei{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){let e=document.createElement("div");return e.className=this.className,Object.assign(e.style,En),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;let i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){let i=this.rootElement;if(i){if("string"==typeof e)i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}Es.defaultProps={...Ei.defaultProps};let Ea=globalThis.loaders?.parseImageNode,Eo="undefined"!=typeof Image,El="undefined"!=typeof ImageBitmap,Ec=!!k9||!!Ea,Eu=/^data:image\/svg\+xml/,Eh=/\.svg((\?|#).*)?$/;function Ed(e){return e&&(Eu.test(e)||Eh.test(e))}function Ef(e,t){if(Ed(t))throw Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Ep(e,t,r){let i=function(e,t){if(Ed(t)){let t=new TextDecoder().decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return Ef(e,t)}(e,r),n=self.URL||self.webkitURL,s="string"!=typeof i&&n.createObjectURL(i);try{return await Eg(s||i,t)}finally{s&&n.revokeObjectURL(s)}}async function Eg(e,t){let r=new Image;return(r.src=e,t.image&&t.image.decode&&r.decode)?(await r.decode(),r):await new Promise((e,t)=>{try{r.onload=()=>e(r),r.onerror=e=>{let r=e instanceof Error?e.message:"error";t(Error(r))}}catch(e){t(e)}})}let Em={},Ey=!0;async function Ev(e,t,r){let i;i=Ed(r)?await Ep(e,t,r):Ef(e,r);let n=t&&t.imagebitmap;return await Eb(i,n)}async function Eb(e,t=null){if((function(e){for(let t in e||Em)return!1;return!0}(t)||!Ey)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Ey=!1}return await createImageBitmap(e)}function Ex(e){var t,r;let i,n,s,a,o=Ew(e);return((i=Ew(o)).byteLength>=24&&0x89504e47===i.getUint32(0,!1)?{mimeType:"image/png",width:i.getUint32(16,!1),height:i.getUint32(20,!1)}:null)||function(e){let t=Ew(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;let{tableMarkers:r,sofMarkers:i}=function(){let e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=2;for(;n+9<t.byteLength;){let e=t.getUint16(n,!1);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(n+5,!1),width:t.getUint16(n+7,!1)};if(!r.has(e))break;n+=2,n+=t.getUint16(n,!1)}return null}(o)||((n=Ew(o)).byteLength>=10&&0x47494638===n.getUint32(0,!1)?{mimeType:"image/gif",width:n.getUint16(6,!0),height:n.getUint16(8,!0)}:null)||((s=Ew(o)).byteLength>=14&&16973===s.getUint16(0,!1)&&s.getUint32(2,!0)===s.byteLength?{mimeType:"image/bmp",width:s.getUint32(18,!0),height:s.getUint32(22,!0)}:null)||((a=!function(e,t,r=0){let i=[...t].map(e=>e.charCodeAt(0));for(let t=0;t<i.length;++t)if(i[t]!==e[t+r])return!1;return!0}(r=new Uint8Array((t=o)instanceof DataView?t.buffer:t),"ftyp",4)||(96&r[8])==0?null:function(e){switch(String.fromCharCode(...e.slice(8,12)).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(r))?{mimeType:a.mimeType,width:0,height:0}:null)}function Ew(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw Error("toDataView")}async function E_(e,t){let{mimeType:r}=Ex(e)||{},i=globalThis.loaders?.parseImageNode;return kF(i),await i(e,r)}let Ek={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function e(e,t,r){let i,n=((t=t||{}).image||{}).type||"auto",{url:s}=r||{};switch(function(e){switch(e){case"auto":case"data":if(El)return"imagebitmap";if(Eo)return"image";if(Ec)return"data";throw Error("Install '@loaders.gl/polyfills' to parse images under Node.js");default:return!function(e){switch(e){case"auto":return El;case"imagebitmap":case"image":case"data":return;default:throw Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":i=await Ev(e,t,s);break;case"image":i=await Ep(e,t,s);break;case"data":i=await E_(e,t);break;default:kF(!1)}return"data"===n&&(i=function(e){switch(function(e){var t;let r=(t=e,"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null);if(!r)throw Error("Not an image");return r}(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw Error("getImageData")}}(i)),i},tests:[e=>!!Ex(new DataView(e))],options:{image:{type:"auto",decode:!0}}},EP={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){let t=e[0],r=e[e.length-1];return"{"===t&&"}"===r||"["===t&&"]"===r},parseTextSync:JSON.parse},ES=function(){let e="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);if(!t){xh.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:xh,_registerLoggers:kC};var r=[EP,[Ek,{imagebitmap:{premultiplyAlpha:"none"}}]];let t=PB();for(let e of r=Array.isArray(r)?r:[r]){let r=kU(e);t.find(e=>r===e)||t.unshift(r)}}return e}();var EE=e.i(9900),EA=e.i(4819);let EM="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class ET{static defaultProps={...EE.Device.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=EA.lumaStats;log=vN.log;VERSION="9.2.3";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw vN.log.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),vN.log.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),Error("luma.gl - multiple versions detected: see console log");vN.log.error("This version of luma.gl has already been initialized")()}vN.log.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(e={}){let t={...ET.defaultProps,...e},r=this.selectAdapter(t.type,t.adapters);if(!r)throw Error(EM);return t.waitForPageLoad&&await r.pageLoaded,await r.create(t)}async attachDevice(e,t){let r=this._getTypeFromHandle(e,t.adapters),i=r&&this.selectAdapter(r,t.adapters);if(!i)throw Error(EM);return await i?.attach?.(e,t)}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){return Array.from(this._getAdapterMap(e)).map(([,e])=>e).filter(e=>e.isSupported?.()).map(e=>e.type)}getBestAvailableAdapterType(e=[]){let t=this._getAdapterMap(e);for(let e of["webgpu","webgl","null"])if(t.get(e)?.isSupported?.())return e;return null}selectAdapter(e,t=[]){let r=e;"best-available"===e&&(r=this.getBestAvailableAdapterType(t));let i=this._getAdapterMap(t);return r&&i.get(r)||null}enforceWebGL2(e=!0,t=[]){let r=this._getAdapterMap(t).get("webgl");r||vN.log.warn("enforceWebGL2: webgl adapter not found")(),r?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(ET.defaultProps,e)}_getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let r of e)t.set(r.type,r);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||e?.queue?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?vN.log.warn("WebGL1 is not supported",e)():vN.log.warn("Unknown handle type",e)(),null)}}let EC=new ET;var EO=e.i(40021);class EI{get pageLoaded(){return Ej||(Ej=EL&&"complete"===document.readyState||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),Ej}}let EL=(0,EO.isBrowser)()&&"undefined"!=typeof document,Ej=null,EN={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}};var ED=e.i(31934),ER=e.i(7784);let Ez=new class extends EI{type="webgl";constructor(){super(),EE.Device.defaultProps={...EE.Device.defaultProps,...ED.DEFAULT_SPECTOR_PROPS}}enforceWebGL2(e){!function(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){let e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");let t={...EN,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:{drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067},OES_vertex_array_object:{VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)},ANGLE_instanced_arrays:{VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)}},r=e.getExtension;e.getExtension=function(i){let n=r.call(e,i);return n||(i in t?t[i]:null)};let i=e.getSupportedExtensions;e.getSupportedExtensions=function(){let r=i.apply(e)||[];return r?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return!!("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&vN.log.warn("WebGL1 is not supported",e)(),!1)}async attach(t,r={}){var i;let{WebGLDevice:n}=await e.A(76084);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(i=t,!("undefined"!=typeof WebGL2RenderingContext&&i instanceof WebGL2RenderingContext||i&&Number.isFinite(i._version)))throw Error("Invalid WebGL2RenderingContext");let s=!0===r.createCanvasContext?{}:r.createCanvasContext;return new n({...r,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...s}})}async create(t={}){let{WebGLDevice:r}=await e.A(76084);vN.log.groupCollapsed(1,"WebGLDevice created")();try{let e=[];for(let r of((t.debugWebGL||t.debug)&&e.push((0,ER.loadWebGLDeveloperTools)()),t.debugSpectorJS&&e.push((0,ED.loadSpectorJS)(t)),await Promise.allSettled(e)))"rejected"===r.status&&vN.log.error(`Failed to initialize debug libraries ${r.reason}`)();let i=new r(t),n=`\
${i._reused?"Reusing":"Created"} device with WebGL2 ${i.props.debug?"debug ":""}context: \
${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return vN.log.probe(1,n)(),vN.log.table(1,i.info)(),i}finally{vN.log.groupEnd(1)()}}},EF=0;class EB{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:EC.stats.get(`animation-loop-${EF++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...EB.defaultAnimationLoopProps,...e},!(e=this.props).device)throw Error("No device provided");this.stats=e.stats||new kL.Stats({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;if(this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),!this._running)return null;return!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this}catch(t){let e=t instanceof Error?t:Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){if(this._running){var e;this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60))}}_cancelAnimationFrame(){if(null!==this._animationFrameId){var e;e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null}}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw Error("loop");let t=e?.canvas,r=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:r,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1],r=1,i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function EU(){}let E$={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:EU,onWebGLInitialized:EU,onResize:EU,onViewStateChange:EU,onInteractionStateChange:EU,onBeforeRender:EU,onAfterRender:EU,onLoad:EU,onError:e=>xh.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class EV{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new kL.Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{let{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;let r=e.offsetCenter;if(!r)return;t.x=r.x,t.y=r.y,t.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{let t=x4[e.type],r=e.offsetCenter;if(!t||!r||!this.layerManager)return;let i=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:i,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:s}=n,a=s&&(s[t]||s.props[t]),o=this.props[t],l=!1;a&&(l=a.call(s,n,e)),l||(o?.(n,e),this.widgetManager.onEvent(n,e))},this._onPointerDown=e=>{if(this.device?.type==="webgpu")return;let t=e.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...E$,...e},(e=this.props).viewState&&e.initialViewState&&xh.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&xh.error("WebGL1 context not supported.")(),t=Ez.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&P1.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&xh.removed("onLayerHover","onHover")(),"onLayerClick"in e&&xh.removed("onLayerClick","onClick")(),e.initialViewState&&!Sn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),xh.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),void 0!==e.useDevicePixels&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;let t=this.device.canvasContext.canvas,r={target:t,contentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],devicePixelContentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],borderBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}]};this.device.canvasContext._handleResize([r])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t||r||i||n||s}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});(t=e||t)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return Sg(this.viewManager),this.viewManager.views}getViewports(e){return Sg(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){Sg(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();let n=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),n}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&Sg(t=document.getElementById(t)),t||((t=document.createElement("canvas")).id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:r}=e;if(t||0===t){let e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(r||0===r){let t=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){let{gl:r,onError:i}=t;return new EB({device:e,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){let t=this.props.deviceProps?.createCanvasContext,r={adapters:[],...e.deviceProps};r.adapters.includes(Ez)||r.adapters.push(Ez);let i={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return EC.createDevice({_reuseDevices:!0,type:"webgl",...r,createCanvasContext:{...i,..."object"==typeof t?t:void 0,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new SL({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,n=!1;for(let r of t)i=r,n=r.layer?.onHover(r,e.event)||n;n||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);let t=new vo;for(let e in t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new x0(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(x5).map(e=>{let[t,r,i,n]=x5[e],s=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...r,...s,event:e}),recognizeWith:i,requestFailure:n}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),x4)this.eventManager.on(e,this._onEvent);this.viewManager=new Ss({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let r=this.viewManager.getViewports()[0];this.layerManager=new Si(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new SY({deck:this,device:this.device}),this.deckRenderer=new S1(this.device),this.deckPicker=new S7(this.device),this.widgetManager=new Et({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Es),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});let n={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(n),"screen"===n.pass&&this.widgetManager.onRedraw({viewports:n.viewports,layers:n.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),xh.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},!this.props.viewState&&this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let r=EC.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}EV.defaultProps=E$,EV.VERSION=ES;let EW="undefined"!=typeof window?Q.useLayoutEffect:Q.useEffect;function EG(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}var Eq=e.i(6145),EH=e.i(95002),EK=e.i(44135);let EZ=EK.getDataType;function EY(e,t,r){let i="webgpu"===r&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function EX(e){return e.stride||e.size*e.bytesPerElement}function EJ(e,t){t.offset&&xh.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=EX(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*r+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:r}}class EQ{constructor(e,t,r){let i;this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,s="float64"===n;let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||Array(this.size).fill(0),i=s?"float32":!n&&t.isIndexed?"uint32":n||"float32";let o=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return(0,EK.getTypedArrayConstructor)(e)}}(n||i);this.doublePrecision=s,s&&!1===t.fp64&&(o=Float32Array),this.value=null,this.settings={...t,defaultType:o,defaultValue:a,logicalType:n,type:i,normalized:i.includes("norm"),size:this.size,bytesPerElement:o.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*EX(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),P1.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let r={};if(this.state.constant){let i=this.value;if(t){let n=EJ(this.getAccessor(),t),s=n.offset/i.BYTES_PER_ELEMENT,a=n.size||this.size;r[e]=i.subarray(s,s+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){let r=this.getAccessor(),i=[],n={name:this.id,byteStride:EX(r),attributes:i};if(this.doublePrecision){let n,s={high:n=EJ(r,t||{}),low:{...n,offset:n.offset+4*r.size}};i.push(EY(e,{...r,...s.high},this.device.type),EY(`${e}64Low`,{...r,...s.low},this.device.type))}else if(t){let n=EJ(r,t);i.push(EY(e,{...r,...n},this.device.type))}else i.push(EY(e,r,this.device.type));return n}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:r,size:i}=this,n=r*i;if(t&&n&&t.length>=n){let r=Array(i).fill(1/0),s=Array(i).fill(-1/0);for(let e=0;e<n;)for(let n=0;n<i;n++){let i=t[e++];i<r[n]&&(r[n]=i),i>s[n]&&(s[n]=i)}e=[r,s]}}return this.state.bounds=e,e}setData(e){let t,{state:r}=this;t=ArrayBuffer.isView(e)?{value:e}:e instanceof Eq.Buffer?{buffer:e}:e;let i={...this.settings,...t};if(ArrayBuffer.isView(t.value)){if(!t.type)if(this.doublePrecision&&t.value instanceof Float64Array)i.type="float32";else{let e=EZ(t.value);i.type=i.normalized?e.replace("int","norm"):e}i.bytesPerElement=t.value.BYTES_PER_ELEMENT,i.stride=EX(i)}if(r.bounds=null,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),!(!r.constant||!this._areValuesEqual(e,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(t.buffer)r.externalBuffer=t.buffer,r.constant=!1,this.value=t.value||null;else if(t.value){this._checkExternalBuffer(t);let e=t.value;r.externalBuffer=null,r.constant=!1,this.value=e;let{buffer:n}=this,s=EX(i),a=(i.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=P5(e,i)),this.settings.isIndexed){let t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}let o=e.byteLength+a+2*s;(!n||n.byteLength<o)&&(n=this._createBuffer(o)),n.write(e,a)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?P5(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:r}=this,i=r.allocatedValue,n=P1.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=n;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<n.byteLength+s)&&(a=this._createBuffer(n.byteLength+s),t&&i&&a.write(i instanceof Float64Array?P5(i,this):i,s)),r.allocatedValue=n,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw Error(`Attribute ${this.id} value is not TypedArray`);let r=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof r||!this.settings.normalized||"normalized"in e||xh.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,r){let{defaultValue:i,size:n}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let e=n;for(;--e>=0;)t[r+e]=i[e];return t}switch(n){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=n;for(;--s>=0;)t[r+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Eq.Buffer.INDEX:Eq.Buffer.VERTEX)|Eq.Buffer.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}let E0=[],E1=[];function E2(e,t=0,r=1/0){let i=E0,n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(E1.length=e.length,i=E1):i=E0,(t>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),n.index=t-1),{iterable:i,objectInfo:n}}function E3(e){return e&&e[Symbol.asyncIterator]}function E4(e,t){let{size:r,stride:i,offset:n,startIndices:s,nested:a}=t,o=e.BYTES_PER_ELEMENT,l=i?i/o:r,c=n?n/o:0,u=Math.floor((e.length-c)/l);return(t,{index:i,target:n})=>{let o;if(!s){let t=i*l+c;for(let i=0;i<r;i++)n[i]=e[t+i];return n}let h=s[i],d=s[i+1]||u;if(a){o=Array(d-h);for(let t=h;t<d;t++){let i=t*l+c;n=Array(r);for(let t=0;t<r;t++)n[t]=e[i+t];o[t-h]=n}}else if(l===r)o=e.subarray(h*r+c,d*r+c);else{o=new e.constructor((d-h)*r);let t=0;for(let i=h;i<d;i++){let n=i*l+c;for(let i=0;i<r;i++)o[t++]=e[n+i]}}return o}}let E5=[],E6=[[0,1/0]],E8={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function E7(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...E8[r],...t,...e,type:r}}class E9 extends EQ{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:E6}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,r;(t=this.state).layoutChanged||(r=this.getAccessor(),t.layoutChanged=e.type!==r.type||e.size!==r.size||EX(e)!==EX(r)||(e.offset||0)!==(r.offset||0)),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,r=this.settings.transition;return E7(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:e=0,endRow:r=1/0}=t;this.state.updateRanges=function(e,t){if(e===E6||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],i=e.length,n=0;for(let s=0;s<i;s++){let i=e[s];i[1]<t[0]?(r.push(i),n=s+1):i[0]>t[1]?r.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return r.splice(n,0,t),r}(this.state.updateRanges,[e,r])}else this.state.updateRanges=E6}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=E5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:r}=this;return!r.noAlloc&&!!r.update&&(super.allocate(e,t.updateRanges!==E6),!0)}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:n},settings:{update:s,noAlloc:a}}=this,o=!0;if(s){for(let[a,o]of n)s.call(i,this,{data:t,startRow:a,endRow:o,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[t,r]of n){let i=Number.isFinite(t)?this.getVertexOffset(t):0,n=Number.isFinite(r)?this.getVertexOffset(r):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:n})}this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e,t){let r="webgpu"===this.device.type;if(r||void 0===t||"function"==typeof t){if(r&&"function"!=typeof t){let e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}let i=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e),!0)):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let n=e;Sg(ArrayBuffer.isView(n.value),`invalid ${i.accessor}`);let s=!!n.size&&n.size!==this.size;return r.binaryAccessor=E4(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if("dynamic"===i?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(let e in t){let i=super._getBufferLayout(e,t[e]);r.attributes.push(...i.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:n,numInstances:s}){if(e.constant&&"webgpu"!==this.context.device.type)return;let{settings:a,state:o,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=a,f=o.binaryAccessor||("function"==typeof h?h:n[h]);"function"!=typeof f&&"string"==typeof h&&(f=()=>n[h]),Sg("function"==typeof f,`accessor "${h}" is not a function`);let p=e.getVertexOffset(r),{iterable:g,objectInfo:m}=E2(t,r,i);for(let t of g){m.index++;let r=f(t,m);if(d&&(r=d.call(this,r)),u){let t=(m.index<u.length-1?u[m.index+1]:s)-u[m.index];if(r&&Array.isArray(r[0])){let t=p;for(let i of r)e._normalizeValue(i,l,t),t+=c}else r&&r.length>c?l.set(r,p):(e._normalizeValue(r,m.target,0),function({target:e,source:t,start:r=0,count:i=1}){let n=t.length,s=i*n,a=0;for(let i=r;a<n;a++)e[i++]=t[a];for(;a<s;)a<s-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+s-a),a=s)}({target:l,source:m.target,start:p,count:t}));p+=t*c}else e._normalizeValue(r,l,p),p+=c}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw Error(`Illegal attribute generated for ${this.id}`)}}}let Ae=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,At=`#version 300 es
${Ae}`;var Ar=e.i(25458),Ai=e.i(96204),An=e.i(88396),As=e.i(49494);function Aa(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:ArrayBuffer.isView(e)&&!(e instanceof DataView)}class Ao{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(t=>"uniform"===t.type&&t.name===e?.name);if(!t)throw Error(e?.name);for(const e of t.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(let[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){!function(e,t,r=16){if(e!==t||!Aa(e))return!1;if(Aa(t)&&e.length===t.length){for(let r=0;r<e.length;++r)if(t[r]!==e[r])return!1}return!0}(this.uniforms[e],t)&&(this.uniforms[e]=Aa(t)?t.slice():t,this.modifiedUniforms[e]=!0,this.modified=!0)}}var Al=e.i(72288),Ac=e.i(53746);class Au{layout={};byteLength;constructor(e,t={}){let r=0;for(const[i,n]of Object.entries(e)){const{type:e,components:s}=(0,Al.getVariableShaderTypeInfo)(n),a=s*(t?.[i]??1),o=r=(0,EK.alignTo)(r,a);r+=a,this.layout[i]={type:e,size:a,offset:o}}const i=4*(r+=(4-r%4)%4);this.byteLength=Math.max(i,1024)}getData(e){let t=(0,Ac.getScratchArrayBuffer)(this.byteLength),r={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(let[t,i]of Object.entries(e)){let e=this.layout[t];if(!e){vN.log.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}let{type:n,size:s,offset:a}=e,o=r[n];if(1===s){if("number"!=typeof i&&"boolean"!=typeof i){vN.log.warn(`Supplied value for single component uniform ${t} is not a number: ${i}`)();continue}o[a]=Number(i)}else{if(!Aa(i)){vN.log.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${i}`)();continue}o.set(i,a)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}class Ah{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,r]of Object.entries(e)){const e=new Au(r.uniformTypes??{},r.uniformSizes??{});this.uniformBufferLayouts.set(t,e);const i=new Ao({name:t});i.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(t,i)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);let i=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:Eq.Buffer.UNIFORM|Eq.Buffer.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return n.write(s),n}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Eq.Buffer.UNIFORM|Eq.Buffer.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let r=this.updateUniformBuffer(t);e||=r}return e&&vN.log.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||=t.needsRedraw;let n=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(n);let s=this.uniformBlocks.get(e)?.getAllUniforms();vN.log.log(4,`Writing to uniform buffer ${String(e)}`,n,s)()}return i}}var Ad=e.i(65880);class Af{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Ap{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ag extends Af{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Am extends Af{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Ay extends Af{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Av extends Af{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}(A=H||(H={}))[A.Uniform=0]="Uniform",A[A.Storage=1]="Storage",A[A.Texture=2]="Texture",A[A.Sampler=3]="Sampler",A[A.StorageTexture=4]="StorageTexture";class Ab{constructor(e,t,r,i,n,s,a){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=n,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ax{constructor(e,t){this.name=e,this.type=t}}class Aw{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class A_{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class Ak{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class AP{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class AS{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class AE{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let AA=new Float32Array(1),AM=new Int32Array(AA.buffer),AT=new Uint16Array(1),AC=new Uint32Array(1),AO=new Float32Array(AC.buffer,0,1);function AI(e){return AC[0]=112+(e>>6&31)<<23|(63&e)<<17,AO[0]}function AL(e,t,r,i){let n=[0,0,0,0];for(let s=0;s<i;++s)switch(r){case"8unorm":n[s]=e[t]/255,t++;break;case"8snorm":n[s]=e[t]/255*2-1,t++;break;case"8uint":n[s]=e[t],t++;break;case"8sint":n[s]=e[t]-127,t++;break;case"16uint":n[s]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":n[s]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":n[s]=function(e){var t=(32768&e)>>15,r=(31744&e)>>10,i=1023&e;return 0==r?(t?-1:1)*6103515625e-14*(i/1024):31==r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/1024)}(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":n[s]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":n[s]=new Float32Array(e.buffer,t,1)[0],t+=4}return n}function Aj(e,t,r,i,n){for(let s=0;s<i;++s)switch(r){case"8unorm":e[t]=255*n[s],t++;break;case"8snorm":e[t]=.5*(n[s]+1)*255,t++;break;case"8uint":e[t]=n[s],t++;break;case"8sint":e[t]=n[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=n[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=n[s],t+=2;break;case"16float":{let r=function(e){AA[0]=e;let t=AM[0],r=t>>31&1,i=t>>23&255,n=8388607&t;if(255===i)return AT[0]=r<<15|31744|512*(0!==n),AT[0];if(0===i){if(0===n)return AT[0]=r<<15,AT[0];n|=8388608;let e=113;for(;!(8388608&n);)n<<=1,e--;return n&=8388607,(i=127-e)>0?(n=(n>>126-i)+(n>>127-i&1),AT[0]=r<<15|i<<10|n>>13):AT[0]=r<<15,AT[0]}return(i=i-127+15)>=31?AT[0]=r<<15|31744:i<=0?i<-10?AT[0]=r<<15:(n=(8388608|n)>>1-i,AT[0]=r<<15|n>>13):(n>>=13,AT[0]=r<<15|i<<10|n),AT[0]}(n[s]);new Uint16Array(e.buffer,t,1)[0]=r,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=n[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=n[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=n[s],t+=4}return n}let AN={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class AD{constructor(){this.id=AD._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){for(let r of(t(AR.instance),e))r instanceof Array?this.searchBlock(r,t):r.search(t);t(Az.instance)}}constEvaluate(e,t){throw Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}AD._id=0;class AR extends AD{}AR.instance=new AR;class Az extends AD{}Az.instance=new Az;let AF=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class AB extends AD{constructor(){super()}}class AU extends AB{constructor(e,t,r,i,n,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=n,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(let t of this.attributes)e(t);for(let t of(e(this),this.args))e(t);this.searchBlock(this.body,e)}}class A$ extends AB{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class AV extends AB{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class AW extends AB{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class AG extends AB{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;null==(t=this.init)||t.search(e),null==(r=this.condition)||r.search(e),null==(i=this.increment)||i.search(e),this.searchBlock(this.body,e)}}class Aq extends AB{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"var"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class AH extends AB{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;null==(t=this.value)||t.search(e)}}class AK extends AB{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"let"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class AZ extends AB{constructor(e,t,r,i,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=n}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}(M=K||(K={})).increment="++",M.decrement="--",(T=K||(K={})).parse=function(e){if("parse"==e)throw Error("Invalid value for IncrementOperator");return T[e]};class AY extends AB{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(C=Z||(Z={})).assign="=",C.addAssign="+=",C.subtractAssin="-=",C.multiplyAssign="*=",C.divideAssign="/=",C.moduloAssign="%=",C.andAssign="&=",C.orAssign="|=",C.xorAssign="^=",C.shiftLeftAssign="<<=",C.shiftRightAssign=">>=",(Z||(Z={})).parse=function(e){if("parse"==e)throw Error("Invalid value for AssignOperator");return e};class AX extends AB{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class AJ extends AB{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return AF.has(this.name)}search(e){for(let t of this.args)t.search(e);e(this)}}class AQ extends AB{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null==(t=this.continuing)||t.search(e)}}class A0 extends AB{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){for(let t of(e(this),this.cases))t.search(e)}}class A1 extends AB{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class A2 extends AB{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null==(t=this.value)||t.search(e)}}class A3 extends AB{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class A4 extends AB{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class A5 extends AB{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class A6 extends AB{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class A8 extends AB{constructor(){super()}get astNodeType(){return"discard"}}class A7 extends AB{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class A9 extends AB{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Me extends AB{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let r=1;r<e.length;++r){let i=Me._priority.get(t.name);Me._priority.get(e[r].name)<i&&(t=e[r])}return"x32"===t.name?Me.i32:t}getTypeName(){return this.name}}Me.x32=new Me("x32"),Me.f32=new Me("f32"),Me.i32=new Me("i32"),Me.u32=new Me("u32"),Me.f16=new Me("f16"),Me.bool=new Me("bool"),Me.void=new Me("void"),Me._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Mt extends Me{constructor(e){super(e)}}class Mr extends Me{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return -1}search(e){for(let t of this.members)e(t)}}class Mi extends Me{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}Mi.vec2f=new Mi("vec2",Me.f32,null),Mi.vec3f=new Mi("vec3",Me.f32,null),Mi.vec4f=new Mi("vec4",Me.f32,null),Mi.vec2i=new Mi("vec2",Me.i32,null),Mi.vec3i=new Mi("vec3",Me.i32,null),Mi.vec4i=new Mi("vec4",Me.i32,null),Mi.vec2u=new Mi("vec2",Me.u32,null),Mi.vec3u=new Mi("vec3",Me.u32,null),Mi.vec4u=new Mi("vec4",Me.u32,null),Mi.vec2h=new Mi("vec2",Me.f16,null),Mi.vec3h=new Mi("vec3",Me.f16,null),Mi.vec4h=new Mi("vec4",Me.f16,null),Mi.vec2b=new Mi("vec2",Me.bool,null),Mi.vec3b=new Mi("vec3",Me.bool,null),Mi.vec4b=new Mi("vec4",Me.bool,null),Mi.mat2x2f=new Mi("mat2x2",Me.f32,null),Mi.mat2x3f=new Mi("mat2x3",Me.f32,null),Mi.mat2x4f=new Mi("mat2x4",Me.f32,null),Mi.mat3x2f=new Mi("mat3x2",Me.f32,null),Mi.mat3x3f=new Mi("mat3x3",Me.f32,null),Mi.mat3x4f=new Mi("mat3x4",Me.f32,null),Mi.mat4x2f=new Mi("mat4x2",Me.f32,null),Mi.mat4x3f=new Mi("mat4x3",Me.f32,null),Mi.mat4x4f=new Mi("mat4x4",Me.f32,null),Mi.mat2x2h=new Mi("mat2x2",Me.f16,null),Mi.mat2x3h=new Mi("mat2x3",Me.f16,null),Mi.mat2x4h=new Mi("mat2x4",Me.f16,null),Mi.mat3x2h=new Mi("mat3x2",Me.f16,null),Mi.mat3x3h=new Mi("mat3x3",Me.f16,null),Mi.mat3x4h=new Mi("mat3x4",Me.f16,null),Mi.mat4x2h=new Mi("mat4x2",Me.f16,null),Mi.mat4x3h=new Mi("mat4x3",Me.f16,null),Mi.mat4x4h=new Mi("mat4x4",Me.f16,null),Mi.mat2x2i=new Mi("mat2x2",Me.i32,null),Mi.mat2x3i=new Mi("mat2x3",Me.i32,null),Mi.mat2x4i=new Mi("mat2x4",Me.i32,null),Mi.mat3x2i=new Mi("mat3x2",Me.i32,null),Mi.mat3x3i=new Mi("mat3x3",Me.i32,null),Mi.mat3x4i=new Mi("mat3x4",Me.i32,null),Mi.mat4x2i=new Mi("mat4x2",Me.i32,null),Mi.mat4x3i=new Mi("mat4x3",Me.i32,null),Mi.mat4x4i=new Mi("mat4x4",Me.i32,null),Mi.mat2x2u=new Mi("mat2x2",Me.u32,null),Mi.mat2x3u=new Mi("mat2x3",Me.u32,null),Mi.mat2x4u=new Mi("mat2x4",Me.u32,null),Mi.mat3x2u=new Mi("mat3x2",Me.u32,null),Mi.mat3x3u=new Mi("mat3x3",Me.u32,null),Mi.mat3x4u=new Mi("mat3x4",Me.u32,null),Mi.mat4x2u=new Mi("mat4x2",Me.u32,null),Mi.mat4x3u=new Mi("mat4x3",Me.u32,null),Mi.mat4x4u=new Mi("mat4x4",Me.u32,null);class Mn extends Me{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Ms extends Me{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Ma extends Me{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Mo extends AD{constructor(){super(),this.postfix=null}}class Ml extends Mo{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Mc extends Mo{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Mu extends Mo{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return AF.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(let t of this.args)t.search(e);e(this)}}class Mh extends Mo{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Md extends Mo{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){let t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Mf extends Mo{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof MC}get isVector(){return this.value instanceof MO||this.value instanceof MI}get scalarValue(){return this.value instanceof MC?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof MO||this.value instanceof MI?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Mp extends Mo{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Mg extends Mo{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Mm extends Mo{constructor(){super()}}class My extends Mm{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Mv extends Mm{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?Me.f32:"u32"===e.name||"u32"===t.name?Me.u32:Me.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Mb extends AD{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Mx extends Mo{constructor(){super()}get astNodeType(){return"default"}}class Mw extends Mb{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class M_ extends Mb{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Mk extends AD{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class MP extends AD{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class MS extends AD{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class ME extends AD{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class MA{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=MA._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}MA._id=0;class MM extends MA{constructor(){super(new Af("void",null),null)}toString(){return"void"}}MM.void=new MM;class MT extends MA{constructor(e){super(new Ay("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class MC extends MA{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new MC(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new MC(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new MC(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof MC))return void console.error("SetDataValue: Invalid value",t);let n=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?n=Math.floor(n):"bool"===this.typeInfo.name&&(n=+!!n),this.data[0]=n}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}class MO extends MA{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new MO(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new MO(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new MO(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof Ml?console.error("TODO: Set vector postfix"):t instanceof MO?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Av)i=this.typeInfo.format||i;else{let t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let n=this;for(;null!==t&&null!==n;){if(t instanceof Mg){let s=t.index,a=-1;if(s instanceof Mf){if(!(s.value instanceof MC))return console.error(`GetSubData: Invalid array index ${s.value}`),null;a=s.value.value}else{let t=e.evalExpression(s,r);if(!(t instanceof MC))return console.error("GetSubData: Unknown index type",s),null;a=t.value}if(a<0||a>=n.data.length)return console.error("GetSubData: Index out of range",a),null;if(n.data instanceof Float32Array)return new MC(new Float32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);if(n.data instanceof Int32Array)return new MC(new Int32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);if(n.data instanceof Uint32Array)return new MC(new Uint32Array(n.data.buffer,n.data.byteOffset+4*a,1),i);throw"GetSubData: Invalid data type"}if(!(t instanceof Ml))return console.error("GetSubData: Unknown postfix",t),null;{let r=t.value.toLowerCase();if(1===r.length){let e=0;if("x"===r||"r"===r)e=0;else if("y"===r||"g"===r)e=1;else if("z"===r||"b"===r)e=2;else{if("w"!==r&&"a"!==r)return console.error(`GetSubData: Unknown member ${r}`),null;e=3}if(this.data instanceof Float32Array)return new MC(new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this);if(this.data instanceof Int32Array)return new MC(new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this);if(this.data instanceof Uint32Array)return new MC(new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1),i,this)}let s=[];for(let e of r)"x"===e||"r"===e?s.push(this.data[0]):"y"===e||"g"===e?s.push(this.data[1]):"z"===e||"b"===e?s.push(this.data[2]):"w"===e||"a"===e?s.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);n=function(e,t,r){let i=t.length;return 2===i?"f32"===r?new MO(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===r||"bool"===r?new MO(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===r?new MO(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===r?new MO(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):3===i?"f32"===r?new MO(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===r||"bool"===r?new MO(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===r?new MO(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===r?new MO(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):4===i?"f32"===r?new MO(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===r||"bool"===r?new MO(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===r?new MO(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===r?new MO(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}(e,s,i.name)}t=t.postfix}return n}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class MI extends MA{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new MI(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof Ml?console.error("TODO: Set matrix postfix"):t instanceof MI?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(null===t)return this;let i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Av)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof Mg){let n,s=t.index,a=-1;if(s instanceof Mf){if(!(s.value instanceof MC))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;a=s.value.value}else{let t=e.evalExpression(s,r);if(!(t instanceof MC))return console.error("GetDataValue: Unknown index type",s),null;a=t.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;let o=i.endsWith("h")?"h":"f";if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)n=new MO(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)n=new MO(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return console.error(`GetDataValue: Unknown type ${i}`),null;n=new MO(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?n.getSubData(e,t.postfix,r):n}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ML extends MA{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){return new ML(new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size)).buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(null===t)return void console.log("setDataValue: NULL data.");let n=this.offset,s=this.typeInfo;for(;r;){if(r instanceof Mg)if(s instanceof Am){let t=r.index;if(t instanceof Mf){if(!(t.value instanceof MC))return void console.error(`SetDataValue: Invalid index type ${t.value}`);n+=t.value.value*s.stride}else{let r=e.evalExpression(t,i);if(!(r instanceof MC))return void console.error("SetDataValue: Unknown index type",t);n+=r.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(r instanceof Ml))return void console.error("SetDataValue: Unknown postfix type",r);{let e=r.value;if(s instanceof Ag){let t=!1;for(let r of s.members)if(r.name===e){n+=r.offset,s=r.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(s instanceof Af){let r=s.getTypeName(),i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);i=3}if(!(t instanceof MC))return void console.error("SetDataValue: Invalid value",t);let a=t.value;return"vec2f"===r?void(new Float32Array(this.buffer,n,2)[i]=a):"vec3f"===r?void(new Float32Array(this.buffer,n,3)[i]=a):"vec4f"===r?void(new Float32Array(this.buffer,n,4)[i]=a):"vec2i"===r?void(new Int32Array(this.buffer,n,2)[i]=a):"vec3i"===r?void(new Int32Array(this.buffer,n,3)[i]=a):"vec4i"===r?void(new Int32Array(this.buffer,n,4)[i]=a):"vec2u"===r?void(new Uint32Array(this.buffer,n,2)[i]=a):"vec3u"===r?void(new Uint32Array(this.buffer,n,3)[i]=a):"vec4u"===r?void(new Uint32Array(this.buffer,n,4)[i]=a):void console.error(`SetDataValue: Type ${r} is not a struct`)}}}r=r.postfix}this.setData(e,t,s,n,i)}setData(e,t,r,i,n){let s=r.getTypeName();if("f32"!==s&&"f16"!==s)if("i32"!==s&&"atomic<i32>"!==s&&"x32"!==s)if("u32"!==s&&"atomic<u32>"!==s)if("bool"!==s){if("vec2f"===s||"vec2h"===s){let e=new Float32Array(this.buffer,i,2);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===s||"vec3h"===s){let e=new Float32Array(this.buffer,i,3);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===s||"vec4h"===s){let e=new Float32Array(this.buffer,i,4);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===s){let e=new Int32Array(this.buffer,i,2);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===s){let e=new Int32Array(this.buffer,i,3);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===s){let e=new Int32Array(this.buffer,i,4);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===s){let e=new Uint32Array(this.buffer,i,2);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===s){let e=new Uint32Array(this.buffer,i,3);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===s){let e=new Uint32Array(this.buffer,i,4);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===s){let e=new Uint32Array(this.buffer,i,2);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===s){let e=new Uint32Array(this.buffer,i,3);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===s){let e=new Uint32Array(this.buffer,i,4);return void(t instanceof MO?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===s||"mat2x2h"===s){let e=new Float32Array(this.buffer,i,4);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===s||"mat2x3h"===s){let e=new Float32Array(this.buffer,i,6);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===s||"mat2x4h"===s){let e=new Float32Array(this.buffer,i,8);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===s||"mat3x2h"===s){let e=new Float32Array(this.buffer,i,6);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===s||"mat3x3h"===s){let e=new Float32Array(this.buffer,i,9);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===s||"mat3x4h"===s){let e=new Float32Array(this.buffer,i,12);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===s||"mat4x2h"===s){let e=new Float32Array(this.buffer,i,8);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===s||"mat4x3h"===s){let e=new Float32Array(this.buffer,i,12);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===s||"mat4x4h"===s){let e=new Float32Array(this.buffer,i,16);return void(t instanceof MI?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof ML){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",s,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else t instanceof MC&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof MC&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof MC&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof MC&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,n,s;if(null===t)return this;let a=this.offset,o=this.typeInfo;for(;t;){if(t instanceof Mg){let i=t.index,n=i instanceof Mo?e.evalExpression(i,r):i,s=0;if(n instanceof MC?s=n.value:"number"==typeof n?s=n:console.error("GetDataValue: Invalid index type",i),o instanceof Am)a+=s*o.stride,o=o.format;else{let t=o.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(a+=16*s,o=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${o.getTypeName()} is not an array`)}}else{if(!(t instanceof Ml))return console.error("GetDataValue: Unknown postfix type",t),null;{let r=t.value;if(o instanceof Ag){let e=!1;for(let t of o.members)if(t.name===r){a+=t.offset,o=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${r} not found`),null}else if(o instanceof Af){let t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(r.length>0&&r.length<5){let i="f",n=[];for(let s=0;s<r.length;++s){let o=r[s].toLowerCase(),l=0;if("x"===o||"r"===o)l=0;else if("y"===o||"g"===o)l=1;else if("z"===o||"b"===o)l=2;else{if("w"!==o&&"a"!==o)return console.error(`Unknown member ${r}`),null;l=3}if(1===r.length){if(t.endsWith("f"))return this.buffer.byteLength<a+4*l+4?(console.log("Insufficient buffer data"),null):new MC(new Float32Array(this.buffer,a+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new MC(new Float32Array(this.buffer,a+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new MC(new Int32Array(this.buffer,a+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new MC(new Int32Array(this.buffer,a+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new MC(new Uint32Array(this.buffer,a+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)n.push(new Float32Array(this.buffer,a,2)[l]);else if("vec3f"===t){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let e=new Float32Array(this.buffer,a,3);n.push(e[l])}else if("vec4f"===t)n.push(new Float32Array(this.buffer,a,4)[l]);else if("vec2i"===t)i="i",n.push(new Int32Array(this.buffer,a,2)[l]);else if("vec3i"===t)i="i",n.push(new Int32Array(this.buffer,a,3)[l]);else if("vec4i"===t)i="i",n.push(new Int32Array(this.buffer,a,4)[l]);else if("vec2u"===t){i="u";let e=new Uint32Array(this.buffer,a,2);n.push(e[l])}else"vec3u"===t?(i="u",n.push(new Uint32Array(this.buffer,a,3)[l])):"vec4u"===t&&(i="u",n.push(new Uint32Array(this.buffer,a,4)[l]))}return 2===n.length?o=e.getTypeInfo(`vec2${i}`):3===n.length?o=e.getTypeInfo(`vec3${i}`):4===n.length?o=e.getTypeInfo(`vec4${i}`):console.error(`GetDataValue: Invalid vector length ${n.length}`),new MO(n,o,null)}return console.error(`GetDataValue: Unknown member ${r}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}let l=o.getTypeName();return"f32"===l?new MC(new Float32Array(this.buffer,a,1),o,this):"i32"===l?new MC(new Int32Array(this.buffer,a,1),o,this):"u32"===l?new MC(new Uint32Array(this.buffer,a,1),o,this):"vec2f"===l?new MO(new Float32Array(this.buffer,a,2),o,this):"vec3f"===l?new MO(new Float32Array(this.buffer,a,3),o,this):"vec4f"===l?new MO(new Float32Array(this.buffer,a,4),o,this):"vec2i"===l?new MO(new Int32Array(this.buffer,a,2),o,this):"vec3i"===l?new MO(new Int32Array(this.buffer,a,3),o,this):"vec4i"===l?new MO(new Int32Array(this.buffer,a,4),o,this):"vec2u"===l?new MO(new Uint32Array(this.buffer,a,2),o,this):"vec3u"===l?new MO(new Uint32Array(this.buffer,a,3),o,this):"vec4u"===l?new MO(new Uint32Array(this.buffer,a,4),o,this):o instanceof Av&&"atomic"===o.name?"u32"===(null==(i=o.format)?void 0:i.name)?new MC(new Uint32Array(this.buffer,a,1)[0],o.format,this):"i32"===(null==(n=o.format)?void 0:n.name)?new MC(new Int32Array(this.buffer,a,1)[0],o.format,this):(console.error(`GetDataValue: Invalid atomic format ${null==(s=o.format)?void 0:s.name}`),null):new ML(this.buffer,o,a,this)}toString(){let e="";if(this.typeInfo instanceof Am)if("f32"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("i32"===this.typeInfo.format.name){let t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("u32"===this.typeInfo.format.name){let t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if("vec2f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if("vec3f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if("vec4f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Ag?e+="{...}":e="[...]";return e}}class Mj extends MA{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new Mj(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>0?null!=(e=r[0])?e:0:r instanceof Object&&null!=(t=r.width)?t:0}get height(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>1?null!=(e=r[1])?e:0:r instanceof Object&&null!=(t=r.height)?t:0}get depthOrArrayLayers(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>2?null!=(e=r[2])?e:0:r instanceof Object&&null!=(t=r.depthOrArrayLayers)?t:0}get format(){var e;return this.descriptor&&null!=(e=this.descriptor.format)?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!=(e=this.descriptor.sampleCount)?e:1}get mipLevelCount(){var e;return this.descriptor&&null!=(e=this.descriptor.mipLevelCount)?e:1}get dimension(){var e;return this.descriptor&&null!=(e=this.descriptor.dimension)?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){let e=AN[this.format];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=AN[this.format];return!!e&&e.isDepthStencil}getGpuSize(){let e=this.format,t=AN[e],r=this.width;if(!e||r<=0||!t)return -1;let i=this.height,n=this.depthOrArrayLayers,s=this.dimension;return r/t.blockWidth*("1d"===s?1:i/t.blockHeight)*t.bytesPerBlock*n}getPixel(e,t,r=0,i=0){let n=this.texelByteSize,s=this.bytesPerRow,a=this.height;return function(e,t,r,i,n,s,a,o,l){let c=i*(a>>=n)*(s>>=n)+r*a+t*o;switch(l){case"r8unorm":return[AL(e,c,"8unorm",1)[0]];case"r8snorm":return[AL(e,c,"8snorm",1)[0]];case"r8uint":return[AL(e,c,"8uint",1)[0]];case"r8sint":return[AL(e,c,"8sint",1)[0]];case"rg8unorm":{let t=AL(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{let t=AL(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{let t=AL(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{let t=AL(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let t=AL(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{let t=AL(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{let t=AL(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{let t=AL(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let t=AL(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[AL(e,c,"16uint",1)[0]];case"r16sint":return[AL(e,c,"16sint",1)[0]];case"r16float":return[AL(e,c,"16float",1)[0]];case"rg16uint":{let t=AL(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{let t=AL(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{let t=AL(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{let t=AL(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{let t=AL(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{let t=AL(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[AL(e,c,"32uint",1)[0]];case"r32sint":return[AL(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[AL(e,c,"32float",1)[0]];case"rg32uint":{let t=AL(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{let t=AL(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{let t=AL(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{let t=AL(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{let t=AL(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{let t=AL(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{var u;let t=new Uint32Array(e.buffer,c,1)[0];return[AI(2047&t),AI((4192256&t)>>11),(u=(0xffc00000&t)>>22,AC[0]=112+(u>>5&31)<<23|(31&u)<<18,AO[0]),1]}}return null}(new Uint8Array(this.data[i]),e,t,r,i,a,s,n,this.format)}setPixel(e,t,r,i,n){let s=this.texelByteSize,a=this.bytesPerRow,o=this.height;!function(e,t,r,i,n,s,a,o,l,c){let u=i*(a>>=n)*(s>>=n)+r*a+t*o;switch(l){case"r8unorm":return Aj(e,u,"8unorm",1,c);case"r8snorm":return Aj(e,u,"8snorm",1,c);case"r8uint":return Aj(e,u,"8uint",1,c);case"r8sint":return Aj(e,u,"8sint",1,c);case"rg8unorm":return Aj(e,u,"8unorm",2,c);case"rg8snorm":return Aj(e,u,"8snorm",2,c);case"rg8uint":return Aj(e,u,"8uint",2,c);case"rg8sint":return Aj(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return Aj(e,u,"8unorm",4,c);case"rgba8snorm":return Aj(e,u,"8snorm",4,c);case"rgba8uint":return Aj(e,u,"8uint",4,c);case"rgba8sint":return Aj(e,u,"8sint",4,c);case"r16uint":return Aj(e,u,"16uint",1,c);case"r16sint":return Aj(e,u,"16sint",1,c);case"r16float":return Aj(e,u,"16float",1,c);case"rg16uint":return Aj(e,u,"16uint",2,c);case"rg16sint":return Aj(e,u,"16sint",2,c);case"rg16float":return Aj(e,u,"16float",2,c);case"rgba16uint":return Aj(e,u,"16uint",4,c);case"rgba16sint":return Aj(e,u,"16sint",4,c);case"rgba16float":return Aj(e,u,"16float",4,c);case"r32uint":return Aj(e,u,"32uint",1,c);case"r32sint":return Aj(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return Aj(e,u,"32float",1,c);case"rg32uint":return Aj(e,u,"32uint",2,c);case"rg32sint":return Aj(e,u,"32sint",2,c);case"rg32float":return Aj(e,u,"32float",2,c);case"rgba32uint":return Aj(e,u,"32uint",4,c);case"rgba32sint":return Aj(e,u,"32sint",4,c);case"rgba32float":return Aj(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(this.data[i]),e,t,r,i,o,a,s,this.format,n)}}(O=Y||(Y={}))[O.token=0]="token",O[O.keyword=1]="keyword",O[O.reserved=2]="reserved";class MN{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class MD{}MD.none=new MN("",Y.reserved,""),MD.eof=new MN("EOF",Y.token,""),MD.reserved={asm:new MN("asm",Y.reserved,"asm"),bf16:new MN("bf16",Y.reserved,"bf16"),do:new MN("do",Y.reserved,"do"),enum:new MN("enum",Y.reserved,"enum"),f16:new MN("f16",Y.reserved,"f16"),f64:new MN("f64",Y.reserved,"f64"),handle:new MN("handle",Y.reserved,"handle"),i8:new MN("i8",Y.reserved,"i8"),i16:new MN("i16",Y.reserved,"i16"),i64:new MN("i64",Y.reserved,"i64"),mat:new MN("mat",Y.reserved,"mat"),premerge:new MN("premerge",Y.reserved,"premerge"),regardless:new MN("regardless",Y.reserved,"regardless"),typedef:new MN("typedef",Y.reserved,"typedef"),u8:new MN("u8",Y.reserved,"u8"),u16:new MN("u16",Y.reserved,"u16"),u64:new MN("u64",Y.reserved,"u64"),unless:new MN("unless",Y.reserved,"unless"),using:new MN("using",Y.reserved,"using"),vec:new MN("vec",Y.reserved,"vec"),void:new MN("void",Y.reserved,"void")},MD.keywords={array:new MN("array",Y.keyword,"array"),atomic:new MN("atomic",Y.keyword,"atomic"),bool:new MN("bool",Y.keyword,"bool"),f32:new MN("f32",Y.keyword,"f32"),i32:new MN("i32",Y.keyword,"i32"),mat2x2:new MN("mat2x2",Y.keyword,"mat2x2"),mat2x3:new MN("mat2x3",Y.keyword,"mat2x3"),mat2x4:new MN("mat2x4",Y.keyword,"mat2x4"),mat3x2:new MN("mat3x2",Y.keyword,"mat3x2"),mat3x3:new MN("mat3x3",Y.keyword,"mat3x3"),mat3x4:new MN("mat3x4",Y.keyword,"mat3x4"),mat4x2:new MN("mat4x2",Y.keyword,"mat4x2"),mat4x3:new MN("mat4x3",Y.keyword,"mat4x3"),mat4x4:new MN("mat4x4",Y.keyword,"mat4x4"),ptr:new MN("ptr",Y.keyword,"ptr"),sampler:new MN("sampler",Y.keyword,"sampler"),sampler_comparison:new MN("sampler_comparison",Y.keyword,"sampler_comparison"),struct:new MN("struct",Y.keyword,"struct"),texture_1d:new MN("texture_1d",Y.keyword,"texture_1d"),texture_2d:new MN("texture_2d",Y.keyword,"texture_2d"),texture_2d_array:new MN("texture_2d_array",Y.keyword,"texture_2d_array"),texture_3d:new MN("texture_3d",Y.keyword,"texture_3d"),texture_cube:new MN("texture_cube",Y.keyword,"texture_cube"),texture_cube_array:new MN("texture_cube_array",Y.keyword,"texture_cube_array"),texture_multisampled_2d:new MN("texture_multisampled_2d",Y.keyword,"texture_multisampled_2d"),texture_storage_1d:new MN("texture_storage_1d",Y.keyword,"texture_storage_1d"),texture_storage_2d:new MN("texture_storage_2d",Y.keyword,"texture_storage_2d"),texture_storage_2d_array:new MN("texture_storage_2d_array",Y.keyword,"texture_storage_2d_array"),texture_storage_3d:new MN("texture_storage_3d",Y.keyword,"texture_storage_3d"),texture_depth_2d:new MN("texture_depth_2d",Y.keyword,"texture_depth_2d"),texture_depth_2d_array:new MN("texture_depth_2d_array",Y.keyword,"texture_depth_2d_array"),texture_depth_cube:new MN("texture_depth_cube",Y.keyword,"texture_depth_cube"),texture_depth_cube_array:new MN("texture_depth_cube_array",Y.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new MN("texture_depth_multisampled_2d",Y.keyword,"texture_depth_multisampled_2d"),texture_external:new MN("texture_external",Y.keyword,"texture_external"),u32:new MN("u32",Y.keyword,"u32"),vec2:new MN("vec2",Y.keyword,"vec2"),vec3:new MN("vec3",Y.keyword,"vec3"),vec4:new MN("vec4",Y.keyword,"vec4"),bitcast:new MN("bitcast",Y.keyword,"bitcast"),block:new MN("block",Y.keyword,"block"),break:new MN("break",Y.keyword,"break"),case:new MN("case",Y.keyword,"case"),continue:new MN("continue",Y.keyword,"continue"),continuing:new MN("continuing",Y.keyword,"continuing"),default:new MN("default",Y.keyword,"default"),diagnostic:new MN("diagnostic",Y.keyword,"diagnostic"),discard:new MN("discard",Y.keyword,"discard"),else:new MN("else",Y.keyword,"else"),enable:new MN("enable",Y.keyword,"enable"),fallthrough:new MN("fallthrough",Y.keyword,"fallthrough"),false:new MN("false",Y.keyword,"false"),fn:new MN("fn",Y.keyword,"fn"),for:new MN("for",Y.keyword,"for"),function:new MN("function",Y.keyword,"function"),if:new MN("if",Y.keyword,"if"),let:new MN("let",Y.keyword,"let"),const:new MN("const",Y.keyword,"const"),loop:new MN("loop",Y.keyword,"loop"),while:new MN("while",Y.keyword,"while"),private:new MN("private",Y.keyword,"private"),read:new MN("read",Y.keyword,"read"),read_write:new MN("read_write",Y.keyword,"read_write"),return:new MN("return",Y.keyword,"return"),requires:new MN("requires",Y.keyword,"requires"),storage:new MN("storage",Y.keyword,"storage"),switch:new MN("switch",Y.keyword,"switch"),true:new MN("true",Y.keyword,"true"),alias:new MN("alias",Y.keyword,"alias"),type:new MN("type",Y.keyword,"type"),uniform:new MN("uniform",Y.keyword,"uniform"),var:new MN("var",Y.keyword,"var"),override:new MN("override",Y.keyword,"override"),workgroup:new MN("workgroup",Y.keyword,"workgroup"),write:new MN("write",Y.keyword,"write"),r8unorm:new MN("r8unorm",Y.keyword,"r8unorm"),r8snorm:new MN("r8snorm",Y.keyword,"r8snorm"),r8uint:new MN("r8uint",Y.keyword,"r8uint"),r8sint:new MN("r8sint",Y.keyword,"r8sint"),r16uint:new MN("r16uint",Y.keyword,"r16uint"),r16sint:new MN("r16sint",Y.keyword,"r16sint"),r16float:new MN("r16float",Y.keyword,"r16float"),rg8unorm:new MN("rg8unorm",Y.keyword,"rg8unorm"),rg8snorm:new MN("rg8snorm",Y.keyword,"rg8snorm"),rg8uint:new MN("rg8uint",Y.keyword,"rg8uint"),rg8sint:new MN("rg8sint",Y.keyword,"rg8sint"),r32uint:new MN("r32uint",Y.keyword,"r32uint"),r32sint:new MN("r32sint",Y.keyword,"r32sint"),r32float:new MN("r32float",Y.keyword,"r32float"),rg16uint:new MN("rg16uint",Y.keyword,"rg16uint"),rg16sint:new MN("rg16sint",Y.keyword,"rg16sint"),rg16float:new MN("rg16float",Y.keyword,"rg16float"),rgba8unorm:new MN("rgba8unorm",Y.keyword,"rgba8unorm"),rgba8unorm_srgb:new MN("rgba8unorm_srgb",Y.keyword,"rgba8unorm_srgb"),rgba8snorm:new MN("rgba8snorm",Y.keyword,"rgba8snorm"),rgba8uint:new MN("rgba8uint",Y.keyword,"rgba8uint"),rgba8sint:new MN("rgba8sint",Y.keyword,"rgba8sint"),bgra8unorm:new MN("bgra8unorm",Y.keyword,"bgra8unorm"),bgra8unorm_srgb:new MN("bgra8unorm_srgb",Y.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new MN("rgb10a2unorm",Y.keyword,"rgb10a2unorm"),rg11b10float:new MN("rg11b10float",Y.keyword,"rg11b10float"),rg32uint:new MN("rg32uint",Y.keyword,"rg32uint"),rg32sint:new MN("rg32sint",Y.keyword,"rg32sint"),rg32float:new MN("rg32float",Y.keyword,"rg32float"),rgba16uint:new MN("rgba16uint",Y.keyword,"rgba16uint"),rgba16sint:new MN("rgba16sint",Y.keyword,"rgba16sint"),rgba16float:new MN("rgba16float",Y.keyword,"rgba16float"),rgba32uint:new MN("rgba32uint",Y.keyword,"rgba32uint"),rgba32sint:new MN("rgba32sint",Y.keyword,"rgba32sint"),rgba32float:new MN("rgba32float",Y.keyword,"rgba32float"),static_assert:new MN("static_assert",Y.keyword,"static_assert")},MD.tokens={decimal_float_literal:new MN("decimal_float_literal",Y.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new MN("hex_float_literal",Y.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new MN("int_literal",Y.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new MN("uint_literal",Y.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new MN("name",Y.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new MN("ident",Y.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new MN("and",Y.token,"&"),and_and:new MN("and_and",Y.token,"&&"),arrow:new MN("arrow ",Y.token,"->"),attr:new MN("attr",Y.token,"@"),forward_slash:new MN("forward_slash",Y.token,"/"),bang:new MN("bang",Y.token,"!"),bracket_left:new MN("bracket_left",Y.token,"["),bracket_right:new MN("bracket_right",Y.token,"]"),brace_left:new MN("brace_left",Y.token,"{"),brace_right:new MN("brace_right",Y.token,"}"),colon:new MN("colon",Y.token,":"),comma:new MN("comma",Y.token,","),equal:new MN("equal",Y.token,"="),equal_equal:new MN("equal_equal",Y.token,"=="),not_equal:new MN("not_equal",Y.token,"!="),greater_than:new MN("greater_than",Y.token,">"),greater_than_equal:new MN("greater_than_equal",Y.token,">="),shift_right:new MN("shift_right",Y.token,">>"),less_than:new MN("less_than",Y.token,"<"),less_than_equal:new MN("less_than_equal",Y.token,"<="),shift_left:new MN("shift_left",Y.token,"<<"),modulo:new MN("modulo",Y.token,"%"),minus:new MN("minus",Y.token,"-"),minus_minus:new MN("minus_minus",Y.token,"--"),period:new MN("period",Y.token,"."),plus:new MN("plus",Y.token,"+"),plus_plus:new MN("plus_plus",Y.token,"++"),or:new MN("or",Y.token,"|"),or_or:new MN("or_or",Y.token,"||"),paren_left:new MN("paren_left",Y.token,"("),paren_right:new MN("paren_right",Y.token,")"),semicolon:new MN("semicolon",Y.token,";"),star:new MN("star",Y.token,"*"),tilde:new MN("tilde",Y.token,"~"),underscore:new MN("underscore",Y.token,"_"),xor:new MN("xor",Y.token,"^"),plus_equal:new MN("plus_equal",Y.token,"+="),minus_equal:new MN("minus_equal",Y.token,"-="),times_equal:new MN("times_equal",Y.token,"*="),division_equal:new MN("division_equal",Y.token,"/="),modulo_equal:new MN("modulo_equal",Y.token,"%="),and_equal:new MN("and_equal",Y.token,"&="),or_equal:new MN("or_equal",Y.token,"|="),xor_equal:new MN("xor_equal",Y.token,"^="),shift_right_equal:new MN("shift_right_equal",Y.token,">>="),shift_left_equal:new MN("shift_left_equal",Y.token,"<<=")},MD.simpleTokens={"@":MD.tokens.attr,"{":MD.tokens.brace_left,"}":MD.tokens.brace_right,":":MD.tokens.colon,",":MD.tokens.comma,"(":MD.tokens.paren_left,")":MD.tokens.paren_right,";":MD.tokens.semicolon},MD.literalTokens={"&":MD.tokens.and,"&&":MD.tokens.and_and,"->":MD.tokens.arrow,"/":MD.tokens.forward_slash,"!":MD.tokens.bang,"[":MD.tokens.bracket_left,"]":MD.tokens.bracket_right,"=":MD.tokens.equal,"==":MD.tokens.equal_equal,"!=":MD.tokens.not_equal,">":MD.tokens.greater_than,">=":MD.tokens.greater_than_equal,">>":MD.tokens.shift_right,"<":MD.tokens.less_than,"<=":MD.tokens.less_than_equal,"<<":MD.tokens.shift_left,"%":MD.tokens.modulo,"-":MD.tokens.minus,"--":MD.tokens.minus_minus,".":MD.tokens.period,"+":MD.tokens.plus,"++":MD.tokens.plus_plus,"|":MD.tokens.or,"||":MD.tokens.or_or,"*":MD.tokens.star,"~":MD.tokens.tilde,_:MD.tokens.underscore,"^":MD.tokens.xor,"+=":MD.tokens.plus_equal,"-=":MD.tokens.minus_equal,"*=":MD.tokens.times_equal,"/=":MD.tokens.division_equal,"%=":MD.tokens.modulo_equal,"&=":MD.tokens.and_equal,"|=":MD.tokens.or_equal,"^=":MD.tokens.xor_equal,">>=":MD.tokens.shift_right_equal,"<<=":MD.tokens.shift_left_equal},MD.regexTokens={decimal_float_literal:MD.tokens.decimal_float_literal,hex_float_literal:MD.tokens.hex_float_literal,int_literal:MD.tokens.int_literal,uint_literal:MD.tokens.uint_literal,ident:MD.tokens.ident},MD.storage_class=[MD.keywords.function,MD.keywords.private,MD.keywords.workgroup,MD.keywords.uniform,MD.keywords.storage],MD.access_mode=[MD.keywords.read,MD.keywords.write,MD.keywords.read_write],MD.sampler_type=[MD.keywords.sampler,MD.keywords.sampler_comparison],MD.sampled_texture_type=[MD.keywords.texture_1d,MD.keywords.texture_2d,MD.keywords.texture_2d_array,MD.keywords.texture_3d,MD.keywords.texture_cube,MD.keywords.texture_cube_array],MD.multisampled_texture_type=[MD.keywords.texture_multisampled_2d],MD.storage_texture_type=[MD.keywords.texture_storage_1d,MD.keywords.texture_storage_2d,MD.keywords.texture_storage_2d_array,MD.keywords.texture_storage_3d],MD.depth_texture_type=[MD.keywords.texture_depth_2d,MD.keywords.texture_depth_2d_array,MD.keywords.texture_depth_cube,MD.keywords.texture_depth_cube_array,MD.keywords.texture_depth_multisampled_2d],MD.texture_external_type=[MD.keywords.texture_external],MD.any_texture_type=[...MD.sampled_texture_type,...MD.multisampled_texture_type,...MD.storage_texture_type,...MD.depth_texture_type,...MD.texture_external_type],MD.texel_format=[MD.keywords.r8unorm,MD.keywords.r8snorm,MD.keywords.r8uint,MD.keywords.r8sint,MD.keywords.r16uint,MD.keywords.r16sint,MD.keywords.r16float,MD.keywords.rg8unorm,MD.keywords.rg8snorm,MD.keywords.rg8uint,MD.keywords.rg8sint,MD.keywords.r32uint,MD.keywords.r32sint,MD.keywords.r32float,MD.keywords.rg16uint,MD.keywords.rg16sint,MD.keywords.rg16float,MD.keywords.rgba8unorm,MD.keywords.rgba8unorm_srgb,MD.keywords.rgba8snorm,MD.keywords.rgba8uint,MD.keywords.rgba8sint,MD.keywords.bgra8unorm,MD.keywords.bgra8unorm_srgb,MD.keywords.rgb10a2unorm,MD.keywords.rg11b10float,MD.keywords.rg32uint,MD.keywords.rg32sint,MD.keywords.rg32float,MD.keywords.rgba16uint,MD.keywords.rgba16sint,MD.keywords.rgba16float,MD.keywords.rgba32uint,MD.keywords.rgba32sint,MD.keywords.rgba32float],MD.const_literal=[MD.tokens.int_literal,MD.tokens.uint_literal,MD.tokens.decimal_float_literal,MD.tokens.hex_float_literal,MD.keywords.true,MD.keywords.false],MD.literal_or_ident=[MD.tokens.ident,MD.tokens.int_literal,MD.tokens.uint_literal,MD.tokens.decimal_float_literal,MD.tokens.hex_float_literal,MD.tokens.name],MD.element_count_expression=[MD.tokens.int_literal,MD.tokens.uint_literal,MD.tokens.ident],MD.template_types=[MD.keywords.vec2,MD.keywords.vec3,MD.keywords.vec4,MD.keywords.mat2x2,MD.keywords.mat2x3,MD.keywords.mat2x4,MD.keywords.mat3x2,MD.keywords.mat3x3,MD.keywords.mat3x4,MD.keywords.mat4x2,MD.keywords.mat4x3,MD.keywords.mat4x4,MD.keywords.atomic,MD.keywords.bitcast,...MD.any_texture_type],MD.attribute_name=[MD.tokens.ident,MD.keywords.block,MD.keywords.diagnostic],MD.assignment_operators=[MD.tokens.equal,MD.tokens.plus_equal,MD.tokens.minus_equal,MD.tokens.times_equal,MD.tokens.division_equal,MD.tokens.modulo_equal,MD.tokens.and_equal,MD.tokens.or_equal,MD.tokens.xor_equal,MD.tokens.shift_right_equal,MD.tokens.shift_left_equal],MD.increment_operators=[MD.tokens.plus_plus,MD.tokens.minus_minus];class MR{constructor(e,t,r,i,n){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=n}toString(){return this.lexeme}isTemplateType(){return -1!=MD.template_types.indexOf(this.type)}isArrayType(){return this.type==MD.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Mz{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new MR(MD.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0&&!this._isAtEnd();)if("\n"==(e=this._advance()))this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),0==--t))break}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++);return!0}}let t=MD.simpleTokens[e];if(t)return this._addToken(t),!0;let r=MD.none,i=this._isAlpha(e),n="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){let t=MD.keywords[e];if(t)return this._addToken(t),!0}if(i||n)return this._addToken(MD.tokens.ident),!0;for(;;){let t=this._findType(e),i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(MD.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(MD.tokens.minus_minus),!0;let r=this._tokens.length-1;if((-1!=MD.literal_or_ident.indexOf(this._tokens[r].type)||this._tokens[r].type==MD.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,r=this._tokens.length-1;for(let t=0;t<5&&r>=0&&-1===MD.assignment_operators.indexOf(this._tokens[r].type);++t,--r)if(this._tokens[r].type===MD.tokens.less_than){r>0&&this._tokens[r-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===MD.none){let i=e,n=0;for(let e=0;e<2;++e)if(i+=this._peekAhead(e),(t=this._findType(i))!==MD.none){n=e;break}if(t===MD.none)return r!==MD.none&&(this._current--,this._addToken(r),!0);e=i,this._current+=n+1}if(r=t,this._isAtEnd())break;e+=this._advance()}return r!==MD.none&&(this._addToken(r),!0)}_findType(e){for(let t in MD.regexTokens){let r=MD.regexTokens[t];if(this._match(e,r.rule))return r}return MD.literalTokens[e]||MD.none}_match(e,t){let r=t.exec(e);return r&&0==r.index&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"	"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"	"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new MR(e,t,this._line,this._start,this._current))}}function MF(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}let MB=new Float32Array(1),MU=new Uint32Array(MB.buffer),M$=new Uint32Array(MB.buffer),MV=new Int32Array(1),MW=new Float32Array(MV.buffer),MG=new Uint32Array(MV.buffer),Mq=new Uint32Array(1),MH=new Float32Array(Mq.buffer),MK=new Int32Array(Mq.buffer);function MZ(e,t,r){if(t===r)return e;if("f32"===t){if("i32"===r||"x32"===r)return MB[0]=e,MU[0];if("u32"===r)return MB[0]=e,M$[0]}else if("i32"===t||"x32"===t){if("f32"===r)return MV[0]=e,MW[0];if("u32"===r)return MV[0]=e,MG[0]}else if("u32"===t){if("f32"===r)return Mq[0]=e,MH[0];if("i32"===r||"x32"===r)return Mq[0]=e,MK[0]}return console.error(`Unsupported cast from ${t} to ${r}`),e}class MY{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class MX{constructor(e,t){this.align=e,this.size=t}}class MJ{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new AE,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(let t of e)t instanceof AU&&this._functions.set(t.name,new MY(t));for(let t of e)if(t instanceof Mr){let e=this.getTypeInfo(t,null);e instanceof Ag&&this.structs.push(e)}for(let t of e)if(t instanceof A6)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof AH){let e=this._getAttributeNum(t.attributes,"id",0),r=null!=t.type?this.getTypeInfo(t.type,t.attributes):null;this.overrides.push(new Ak(t.name,r,t.attributes,e));continue}if(this._isUniformVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=new Ab(t.name,i,e,r,t.attributes,H.Uniform,t.access);n.access||(n.access="read"),this.uniforms.push(n);continue}if(this._isStorageVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(i),s=new Ab(t.name,i,e,r,t.attributes,n?H.StorageTexture:H.Storage,t.access);s.access||(s.access="read"),this.storage.push(s);continue}if(this._isTextureVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(i),s=new Ab(t.name,i,e,r,t.attributes,n?H.StorageTexture:H.Texture,t.access);s.access||(s.access="read"),n?this.storage.push(s):this.textures.push(s);continue}if(this._isSamplerVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),i=this.getTypeInfo(t.type,t.attributes),n=new Ab(t.name,i,e,r,t.attributes,H.Sampler,t.access);this.samplers.push(n);continue}}for(let t of e)if(t instanceof AU){let e=this._getAttribute(t,"vertex"),r=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),n=e||r||i,s=new AS(t.name,null==n?void 0:n.name,t.attributes);s.attributes=t.attributes,s.startLine=t.startLine,s.endLine=t.endLine,this.functions.push(s),this._functions.get(t.name).info=s,n&&(this._functions.get(t.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(t,!!n),s.inputs=this._getInputs(t.args),s.outputs=this._getOutputs(t.returnType),this.entry[n.name].push(s)),s.arguments=t.args.map(e=>new AP(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),s.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(let e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(let e of this._functions.values())e.node.search(t=>{var r,i,n;if(t instanceof ME){if(t.value)if(MF(t.value))for(let i of t.value)for(let t of this.overrides)i===t.name&&(null==(r=e.info)||r.overrides.push(t));else for(let r of this.overrides)t.value===r.name&&(null==(i=e.info)||i.overrides.push(r))}else if(t instanceof Mh)for(let r of this.overrides)t.name===r.name&&(null==(n=e.info)||n.overrides.push(r))});for(let e of this.uniforms)this._markStructsInUse(e.type);for(let e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(e){for(let t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(let t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(let t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(let i of e.calls){let e=null==(r=this._functions.get(i.name))?void 0:r.info;e&&t.add(e)}}findResource(e,t,r){if(r){for(let i of this.entry.compute)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}for(let i of this.entry.vertex)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}for(let i of this.entry.fragment)if(i.name===r){for(let r of i.resources)if(r.group==e&&r.binding==t)return r}}for(let r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(let r of this.storage)if(r.group==e&&r.binding==t)return r;for(let r of this.textures)if(r.group==e&&r.binding==t)return r;for(let r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(let t of this.uniforms)if(t.name==e)return t;for(let t of this.storage)if(t.name==e)return t;for(let t of this.textures)if(t.name==e)return t;for(let t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){let t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){let r=[],i=this,n=[];return e.search(s=>{if(s instanceof AR)n.push({});else if(s instanceof Az)n.pop();else if(s instanceof Aq)t&&null!==s.type&&this._markStructsFromAST(s.type),n.length>0&&(n[n.length-1][s.name]=s);else if(s instanceof Mc)t&&null!==s.type&&this._markStructsFromAST(s.type);else if(s instanceof AK)t&&null!==s.type&&this._markStructsFromAST(s.type),n.length>0&&(n[n.length-1][s.name]=s);else if(s instanceof Mh){if(n.length>0&&n[n.length-1][s.name])return;let e=i._findResource(s.name);e&&r.push(e)}else if(s instanceof Mu){let n=i._functions.get(s.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=i._findResources(n.node,t)),r.push(...n.resources))}else if(s instanceof AJ){let n=i._functions.get(s.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=i._findResources(n.node,t)),r.push(...n.resources))}}),[...new Map(r.map(e=>[e.name,e])).values()]}getBindGroups(){let e=[];function t(t,r){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),r>=e[t].length&&(e[t].length=r+1)}for(let r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t){if(void 0===t&&(t=[]),e instanceof Mr)this._getStructOutputs(e,t);else{let r=this._getOutputInfo(e);null!==r&&t.push(r)}return t}_getStructOutputs(e,t){for(let r of e.members)if(r.type instanceof Mr)this._getStructOutputs(r.type,t);else{let e=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(null!==e){let i=this.getTypeInfo(r.type,r.type.attributes),n=this._parseInt(e.value),s=new A_(r.name,i,e.name,n);t.push(s)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new A_("",r,t.name,i)}return null}_getInputs(e,t){for(let r of(void 0===t&&(t=[]),e))if(r.type instanceof Mr)this._getStructInputs(r.type,t);else{let e=this._getInputInfo(r);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(let r of e.members)if(r.type instanceof Mr)this._getStructInputs(r.type,t);else{let e=this._getInputInfo(r);null!==e&&t.push(e)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),n=this._parseInt(t.value),s=new Aw(e.name,i,t.name,n);return null!==r&&(s.interpolation=this._parseString(r.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Ax(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let t of this.structs)if(t.name==e)return t;for(let t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Mn){let r=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new Ay(e.name,r,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Ms){let r=e.format?this.getTypeInfo(e.format,e.attributes):null,i=new Am(e.name,t);return i.format=r,i.count=e.count,this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Mr){let r=new Ag(e.name,t);for(let t of(r.startLine=e.startLine,r.endLine=e.endLine,e.members)){let e=this.getTypeInfo(t.type,t.attributes);r.members.push(new Ap(t.name,e,t.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Ma){let r=e.format instanceof Me,i=e.format?r?this.getTypeInfo(e.format,null):new Af(e.format,null):null,n=new Av(e.name,i,t,e.access);return this._types.set(e,n),this._updateTypeInfo(n),n}if(e instanceof Mi){let r=e.format?this.getTypeInfo(e.format,null):null,i=new Av(e.name,r,t,e.access);return this._types.set(e,i),this._updateTypeInfo(i),i}let r=new Af(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;let n=this._getTypeSize(e);if(e.size=null!=(t=null==n?void 0:n.size)?t:0,e instanceof Am&&e.format){let t=this._getTypeSize(e.format);e.stride=Math.max(null!=(r=null==t?void 0:t.size)?r:0,null!=(i=null==t?void 0:t.align)?i:0),this._updateTypeInfo(e.format)}e instanceof Ay&&this._updateTypeInfo(e.format),e instanceof Ag&&this._updateStructInfo(e)}_updateStructInfo(e){let t=0,r=0,i=0,n=0;for(let s=0,a=e.members.length;s<a;++s){let a=e.members[s],o=this._getTypeSize(a);if(!o)continue;null!=this._getAlias(a.type.name)||a.type;let l=o.align,c=o.size;t=this._roundUp(l,t+r),r=c,i=t,n=Math.max(n,l),a.offset=t,a.size=c,this._updateTypeInfo(a.type)}e.size=this._roundUp(n,i+r),e.align=n}_getTypeSize(e){var t,r;if(null==e)return null;let i=this._getAttributeNum(e.attributes,"size",0),n=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ap&&(e=e.type),e instanceof Af){let t=this._getAlias(e.name);null!==t&&(e=t)}{let r=MJ._typeInfo[e.name];if(void 0!==r){let s="f16"===(null==(t=e.format)?void 0:t.name)?2:1;return new MX(Math.max(n,r.align/s),Math.max(i,r.size/s))}}{let t=MJ._typeInfo[e.name.substring(0,e.name.length-1)];if(t){let r="h"===e.name[e.name.length-1]?2:1;return new MX(Math.max(n,t.align/r),Math.max(i,t.size/r))}}if(e instanceof Am){let t=e,s=8,a=8,o=this._getTypeSize(t.format);return null!==o&&(a=o.size,s=o.align),a=t.count*this._getAttributeNum(null!=(r=null==e?void 0:e.attributes)?r:null,"stride",this._roundUp(s,a)),i&&(a=i),new MX(Math.max(n,s),Math.max(i,a))}if(e instanceof Ag){let t=0,r=0,s=0,a=0,o=0;for(let r of e.members){let e=this._getTypeSize(r.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+a),a=e.size,o=s)}return r=this._roundUp(t,o+a),new MX(Math.max(n,t),Math.max(i,r))}return null}_isUniformVar(e){return e instanceof Aq&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Aq&&"storage"==e.storage}_isTextureVar(e){return e instanceof Aq&&null!==e.type&&-1!=MJ._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Aq&&null!==e.type&&-1!=MJ._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){if(!e||!e.attributes)return null;for(let r of e.attributes)if(r.name==t)return r;return null}_getAttributeNum(e,t,r){if(null===e)return r;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:r;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}MJ._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},MJ._textureTypes=MD.any_texture_type.map(e=>e.name),MJ._samplerTypes=MD.sampler_type.map(e=>e.name);let MQ=0;class M0{constructor(e,t,r){this.id=MQ++,this.name=e,this.value=t,this.node=r}clone(){return new M0(this.name,this.value,this.node)}}class M1{constructor(e){this.id=MQ++,this.name=e.name,this.node=e}clone(){return new M1(this.node)}}class M2{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=MQ++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!=(t=this.variables.get(e))?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!=(t=this.functions.get(e))?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new M0(e,t,null!=r?r:null))}setVariable(e,t,r){let i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;let r=this.getVariable(e);return null!=(t=null==r?void 0:r.value)?t:null}clone(){return new M2(this)}}class M3{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class M4{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){let r=this.exec.evalExpression(e.args[0],t),i=!0;if(r instanceof MO)return r.data.forEach(e=>{e||(i=!1)}),new MC(+!!i,this.getTypeInfo("bool"));throw Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MO)return new MC(+!!r.data.some(e=>e),this.getTypeInfo("bool"));throw Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){let r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof MC))throw Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.evalExpression(r,t);if(i instanceof ML&&0===i.typeInfo.size){let e=i.typeInfo;return new MC(i.buffer.byteLength/e.stride,this.getTypeInfo("u32"))}return new MC(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.abs(e)),r.typeInfo):new MC(Math.abs(r.value),r.typeInfo)}Acos(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.acos(e)),r.typeInfo):new MC(Math.acos(r.value),r.typeInfo)}Acosh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.acosh(e)),r.typeInfo):new MC(Math.acosh(r.value),r.typeInfo)}Asin(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.asin(e)),r.typeInfo):new MC(Math.asin(r.value),r.typeInfo)}Asinh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.asinh(e)),r.typeInfo):new MC(Math.asinh(r.value),r.typeInfo)}Atan(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.atan(e)),r.typeInfo):new MC(Math.atan(r.value),r.typeInfo)}Atanh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.atanh(e)),r.typeInfo):new MC(Math.atanh(r.value),r.typeInfo)}Atan2(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>Math.atan2(e,i.data[t])),r.typeInfo):new MC(Math.atan2(r.value,i.value),r.typeInfo)}Ceil(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.ceil(e)),r.typeInfo):new MC(Math.ceil(r.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MO&&i instanceof MO&&n instanceof MO?new MO(r.data.map((e,t)=>this._clamp(e,i.data[t],n.data[t])),r.typeInfo):new MC(this._clamp(r.value,i.value,n.value),r.typeInfo)}Cos(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.cos(e)),r.typeInfo):new MC(Math.cos(r.value),r.typeInfo)}Cosh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.cosh(e)),r.typeInfo):new MC(Math.cos(r.value),r.typeInfo)}CountLeadingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.clz32(e)),r.typeInfo):new MC(Math.clz32(r.value),r.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>this._countOneBits(e)),r.typeInfo):new MC(this._countOneBits(r.value),r.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>this._countTrailingZeros(e)),r.typeInfo):new MC(this._countTrailingZeros(r.value),r.typeInfo)}Cross(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MO&&i instanceof MO){if(3!==r.data.length||3!==i.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let t=r.data,n=i.data;return new MO([t[1]*n[2]-n[1]*t[2],t[2]*n[0]-n[2]*t[0],t[0]*n[1]-n[0]*t[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){let r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof MO?new MO(r.data.map(e=>e*i),r.typeInfo):new MC(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MI){let e=r.data,t=r.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new MC(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new MC(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new MC(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MO&&i instanceof MO){let e=0;for(let t=0;t<r.data.length;++t)e+=(r.data[t]-i.data[t])*(r.data[t]-i.data[t]);return new MC(Math.sqrt(e),this.getTypeInfo("f32"))}return new MC(Math.abs(r.value-i.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MC(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.exp(e)),r.typeInfo):new MC(Math.exp(r.value),r.typeInfo)}Exp2(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.pow(2,e)),r.typeInfo):new MC(Math.pow(2,r.value),r.typeInfo)}ExtractBits(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let s=i.value,a=n.value;return r instanceof MO?new MO(r.data.map(e=>e>>s&(1<<a)-1),r.typeInfo):"i32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name?(console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null):new MC(r.value>>s&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MO&&i instanceof MO&&n instanceof MO?new MO(0>this._dot(i.data,n.data)?Array.from(r.data):r.data.map(e=>-e),r.typeInfo):(console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null)}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>this._firstLeadingBit(e)),r.typeInfo):new MC(this._firstLeadingBit(r.value),r.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>this._firstTrailingBit(e)),r.typeInfo):new MC(this._firstTrailingBit(r.value),r.typeInfo)}Floor(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.floor(e)),r.typeInfo):new MC(Math.floor(r.value),r.typeInfo)}Fma(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MO&&i instanceof MO&&n instanceof MO?r.data.length!==i.data.length||r.data.length!==n.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new MO(r.data.map((e,t)=>e*i.data[t]+n.data[t]),r.typeInfo):new MC(r.value*i.value+n.value,r.typeInfo)}Fract(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>e-Math.floor(e)),r.typeInfo):new MC(r.value-Math.floor(r.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let a=n.value,o=(1<<s.value)-1<<a,l=~o;return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>e&l|i.data[t]<<a&o),r.typeInfo):new MC(r.value&l|i.value<<a&o,r.typeInfo)}InverseSqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>1/Math.sqrt(e)),r.typeInfo):new MC(1/Math.sqrt(r.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MO){let e=0;return r.data.forEach(t=>{e+=t*t}),new MC(Math.sqrt(e),this.getTypeInfo("f32"))}return new MC(Math.abs(r.value),r.typeInfo)}Log(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.log(e)),r.typeInfo):new MC(Math.log(r.value),r.typeInfo)}Log2(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.log2(e)),r.typeInfo):new MC(Math.log2(r.value),r.typeInfo)}Max(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>Math.max(e,i.data[t])),r.typeInfo):new MC(Math.max(r.value,i.value),r.typeInfo)}Min(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>Math.min(e,i.data[t])),r.typeInfo):new MC(Math.min(r.value,i.value),r.typeInfo)}Mix(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return r instanceof MO&&i instanceof MO&&n instanceof MO?new MO(r.data.map((e,t)=>r.data[t]*(1-n.data[t])+i.data[t]*n.data[t]),r.typeInfo):new MC(r.value*(1-n.value)+i.value*n.value,r.typeInfo)}Modf(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>e%i.data[t]),r.typeInfo):new MC(r.value%i.value,r.typeInfo)}Normalize(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof MO){let i=this.Length(e,t).value;return new MO(r.data.map(e=>e/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof MO&&i instanceof MO?new MO(r.data.map((e,t)=>Math.pow(e,i.data[t])),r.typeInfo):new MC(Math.pow(r.value,i.value),r.typeInfo)}QuantizeToF16(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>e),r.typeInfo):new MC(r.value,r.typeInfo)}Radians(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>e*Math.PI/180),r.typeInfo):new MC(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof MO&&i instanceof MO){let e=this._dot(r.data,i.data);return new MO(r.data.map((t,r)=>t-2*e*i.data[r]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if(r instanceof MO&&i instanceof MO&&n instanceof MC){let e=this._dot(i.data,r.data);return new MO(r.data.map((t,r)=>{let s=1-n.value*n.value*(1-e*e);if(s<0)return 0;let a=Math.sqrt(s);return n.value*t-(n.value*e+a)*i.data[r]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.round(e)),r.typeInfo):new MC(Math.round(r.value),r.typeInfo)}Saturate(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.min(Math.max(e,0),1)),r.typeInfo):new MC(Math.min(Math.max(r.value,0),1),r.typeInfo)}Sign(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.sign(e)),r.typeInfo):new MC(Math.sign(r.value),r.typeInfo)}Sin(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.sin(e)),r.typeInfo):new MC(Math.sin(r.value),r.typeInfo)}Sinh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.sinh(e)),r.typeInfo):new MC(Math.sinh(r.value),r.typeInfo)}_smoothstep(e,t,r){let i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return n instanceof MO&&r instanceof MO&&i instanceof MO?new MO(n.data.map((e,t)=>this._smoothstep(r.data[t],i.data[t],e)),n.typeInfo):new MC(this._smoothstep(r.value,i.value,n.value),n.typeInfo)}Sqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.sqrt(e)),r.typeInfo):new MC(Math.sqrt(r.value),r.typeInfo)}Step(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return i instanceof MO&&r instanceof MO?new MO(i.data.map((e,t)=>e<r.data[t]?0:1),i.typeInfo):new MC(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.tan(e)),r.typeInfo):new MC(Math.tan(r.value),r.typeInfo)}Tanh(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.tanh(e)),r.typeInfo):new MC(Math.tanh(r.value),r.typeInfo)}_getTransposeType(e){let t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){let r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof MI))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let i=this._getTransposeType(r.typeInfo);if("mat2x2"===r.typeInfo.name||"mat2x2f"===r.typeInfo.name||"mat2x2h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===r.typeInfo.name||"mat2x3f"===r.typeInfo.name||"mat2x3h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===r.typeInfo.name||"mat2x4f"===r.typeInfo.name||"mat2x4h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===r.typeInfo.name||"mat3x2f"===r.typeInfo.name||"mat3x2h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===r.typeInfo.name||"mat3x3f"===r.typeInfo.name||"mat3x3h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===r.typeInfo.name||"mat3x4f"===r.typeInfo.name||"mat3x4h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===r.typeInfo.name||"mat4x2f"===r.typeInfo.name||"mat4x2h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===r.typeInfo.name||"mat4x3f"===r.typeInfo.name||"mat4x3h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===r.typeInfo.name||"mat4x4f"===r.typeInfo.name||"mat4x4h"===r.typeInfo.name){let e=r.data;return new MI([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof MO?new MO(r.data.map(e=>Math.trunc(e)),r.typeInfo):new MC(Math.trunc(r.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){let r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Mh){let n=r.name,s=t.getVariableValue(n);if(s instanceof Mj){if(i<0||i>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let t=s.getMipLevelSize(i),r=s.dimension;return"1d"===r?new MC(t[0],this.getTypeInfo("u32")):"3d"===r?new MO(t,this.getTypeInfo("vec3u")):"2d"===r?new MO(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${r} not found. Line ${e.line}`),null)}return console.error(`Texture ${n} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){let r=e.args[0],i=this.exec.evalExpression(e.args[1],t),n=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof MO)||2!==i.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Mh){let s=r.name,a=t.getVariableValue(s);if(a instanceof Mj){let t=Math.floor(i.data[0]),r=Math.floor(i.data[1]);if(t<0||t>=a.width||r<0||r>=a.height)return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;let o=a.getPixel(t,r,0,n);return null===o?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new MO(o,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){let r=e.args[0];if(r instanceof Mh){let i=r.name,n=t.getVariableValue(i);return n instanceof Mj?new MC(n.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){let r=e.args[0];if(r instanceof Mh){let i=r.name,n=t.getVariableValue(i);return n instanceof Mj?new MC(n.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){let r=e.args[0];if(r instanceof Mh){let i=r.name,n=t.getVariableValue(i);return n instanceof Mj?new MC(n.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){let r=e.args[0],i=this.exec.evalExpression(e.args[1],t),n=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,s=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==s.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof MO)||2!==i.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Mh){let a=r.name,o=t.getVariableValue(a);if(o instanceof Mj){let t=o.getMipLevelSize(0),r=Math.floor(i.data[0]),l=Math.floor(i.data[1]);return r<0||r>=t[0]||l<0||l>=t[1]?console.error(`Texture ${a} out of bounds. Line ${e.line}`):o.setPixel(r,l,0,n,Array.from(s)),null}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t);return o instanceof MC&&a instanceof MC&&(o.value=a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value+=a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicSub(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value-=a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicMax(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=Math.max(o.value,a.value)),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicMin(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=Math.min(o.value,a.value)),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicAnd(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=o.value&a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicOr(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=o.value|a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicXor(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=o.value^a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicExchange(e,t){let r=e.args[0];r instanceof My&&(r=r.right);let i=this.exec.getVariableName(r,t),n=t.getVariable(i),s=e.args[1],a=this.exec.evalExpression(s,t),o=n.value.getSubData(this.exec,r.postfix,t),l=new MC(o.value,o.typeInfo);return o instanceof MC&&a instanceof MC&&(o.value=a.value),n.value instanceof ML&&n.value.setDataValue(this.exec,o,r.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}let M5={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},M6={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class M8 extends M3{constructor(e,t){var r;super(),this.ast=null!=e?e:[],this.reflection=new MJ,this.reflection.updateAST(this.ast),this.context=null!=(r=null==t?void 0:t.clone())?r:new M2,this.builtins=new M4(this),this.typeInfo={bool:this.getTypeInfo(Me.bool),i32:this.getTypeInfo(Me.i32),u32:this.getTypeInfo(Me.u32),f32:this.getTypeInfo(Me.f32),f16:this.getTypeInfo(Me.f16),vec2f:this.getTypeInfo(Mi.vec2f),vec2u:this.getTypeInfo(Mi.vec2u),vec2i:this.getTypeInfo(Mi.vec2i),vec2h:this.getTypeInfo(Mi.vec2h),vec3f:this.getTypeInfo(Mi.vec3f),vec3u:this.getTypeInfo(Mi.vec3u),vec3i:this.getTypeInfo(Mi.vec3i),vec3h:this.getTypeInfo(Mi.vec3h),vec4f:this.getTypeInfo(Mi.vec4f),vec4u:this.getTypeInfo(Mi.vec4u),vec4i:this.getTypeInfo(Mi.vec4i),vec4h:this.getTypeInfo(Mi.vec4h),mat2x2f:this.getTypeInfo(Mi.mat2x2f),mat2x3f:this.getTypeInfo(Mi.mat2x3f),mat2x4f:this.getTypeInfo(Mi.mat2x4f),mat3x2f:this.getTypeInfo(Mi.mat3x2f),mat3x3f:this.getTypeInfo(Mi.mat3x3f),mat3x4f:this.getTypeInfo(Mi.mat3x4f),mat4x2f:this.getTypeInfo(Mi.mat4x2f),mat4x3f:this.getTypeInfo(Mi.mat4x3f),mat4x4f:this.getTypeInfo(Mi.mat4x4f)}}getVariableValue(e){var t,r;let i=null!=(r=null==(t=this.context.getVariable(e))?void 0:t.value)?r:null;if(null===i)return null;if(i instanceof MC)return i.value;if(i instanceof MO||i instanceof MI)return Array.from(i.data);if(i instanceof ML&&i.typeInfo instanceof Am){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){let n=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,n),this._execStatements(this.ast,n);let s=n.getFunction(e);if(!s)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}let a=t[0],o=t[1],l=t[2],c=this.getTypeInfo("vec3u");n.setVariable("@num_workgroups",new MO(t,c));let u=this.reflection.getFunctionInfo(e);for(let t in null===u&&console.error(`Function ${e} not found in reflection data`),r)for(let e in r[t]){let i=r[t][e];n.variables.forEach(r=>{var n;let s=r.node;if(null==s?void 0:s.attributes){let a=null,o=null;for(let e of s.attributes)"binding"===e.name?a=e.value:"group"===e.name&&(o=e.value);if(e==a&&t==o){let a=!1;for(let i of u.resources)if(i.name===r.name&&i.group===parseInt(t)&&i.binding===parseInt(e)){a=!0;break}a&&(void 0!==i.texture&&void 0!==i.descriptor?r.value=new Mj(i.texture,this.getTypeInfo(s.type),i.descriptor,null!=(n=i.texture.view)?n:null):void 0!==i.uniform?r.value=new ML(i.uniform,this.getTypeInfo(s.type)):r.value=new ML(i,this.getTypeInfo(s.type)))}}})}for(let e=0;e<l;++e)for(let t=0;t<o;++t)for(let r=0;r<a;++r)n.setVariable("@workgroup_id",new MO([r,t,e],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[r,t,e],n)}execStatement(e,t){if(e instanceof A2)return this.evalExpression(e.value,t);if(e instanceof A7){if(e.condition){let r=this.evalExpression(e.condition,t);if(!(r instanceof MC))throw Error("Invalid break-if condition");if(!r.value)return null}return M8._breakObj}if(e instanceof A9)return M8._continueObj;if(e instanceof AK)this._let(e,t);else if(e instanceof Aq)this._var(e,t);else if(e instanceof AZ)this._const(e,t);else if(e instanceof AU)this._function(e,t);else{if(e instanceof A1)return this._if(e,t);if(e instanceof A0)return this._switch(e,t);if(e instanceof AG)return this._for(e,t);if(e instanceof AV)return this._while(e,t);if(e instanceof AQ)return this._loop(e,t);if(e instanceof AW){let r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof AX)this._assign(e,t);else if(e instanceof AY)this._increment(e,t);else{if(e instanceof Mr)return null;if(e instanceof AH){let r=e.name;null===t.getVariable(r)&&t.setVariable(r,new MC(0,this.getTypeInfo("u32")))}else if(e instanceof AJ)this._call(e,t);else{if(e instanceof A5||e instanceof A6)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Mv?this._evalBinaryOp(e,t):e instanceof Mf?this._evalLiteral(e,t):e instanceof Mh?this._evalVariable(e,t):e instanceof Mu?this._evalCall(e,t):e instanceof Mc?this._evalCreate(e,t):e instanceof Md?this._evalConst(e,t):e instanceof Mp?this._evalBitcast(e,t):e instanceof My?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Me){let t=this.reflection.getTypeInfo(e);if(null!==t)return t}let r=null!=(t=this.typeInfo[e])?t:null;return null!==r||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(let r in e){let i=e[r],n=this.reflection.getOverrideInfo(r);null!==n?(null===n.type&&(n.type=this.getTypeInfo("u32")),"u32"===n.type.name||"i32"===n.type.name||"f32"===n.type.name||"f16"===n.type.name?t.setVariable(r,new MC(i,n.type)):"bool"===n.type.name?t.setVariable(r,new MC(+!!i,n.type)):"vec2"===n.type.name||"vec3"===n.type.name||"vec4"===n.type.name||"vec2f"===n.type.name||"vec3f"===n.type.name||"vec4f"===n.type.name||"vec2i"===n.type.name||"vec3i"===n.type.name||"vec4i"===n.type.name||"vec2u"===n.type.name||"vec3u"===n.type.name||"vec4u"===n.type.name||"vec2h"===n.type.name||"vec3h"===n.type.name||"vec4h"===n.type.name?t.setVariable(r,new MO(i,n.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){let i=[1,1,1];for(let t of e.node.attributes)if("workgroup_size"===t.name){if(t.value.length>0){let e=r.getVariableValue(t.value[0]);i[0]=e instanceof MC?e.value:parseInt(t.value[0])}if(t.value.length>1){let e=r.getVariableValue(t.value[1]);i[1]=e instanceof MC?e.value:parseInt(t.value[1])}if(t.value.length>2){let e=r.getVariableValue(t.value[2]);i[2]=e instanceof MC?e.value:parseInt(t.value[2])}}let n=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new MO(i,n));let a=i[0],o=i[1],l=i[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<o;++l)for(let o=0;o<a;++o,++u){let a=[o,l,c],h=[o+t[0]*i[0],l+t[1]*i[1],c+t[2]*i[2]];r.setVariable("@local_invocation_id",new MO(a,n)),r.setVariable("@global_invocation_id",new MO(h,n)),r.setVariable("@local_invocation_index",new MC(u,s)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(let r of e.node.args)for(let e of r.attributes)if("builtin"===e.name){let i=`@${e.value}`,n=t.getVariable(i);void 0!==n&&t.variables.set(r.name,n)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof My;)e=e.right;return e instanceof Mh?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(let r of e){if(r instanceof Array){let e=t.clone(),i=this._execStatements(r,e);if(i)return i;continue}let e=this.execStatement(r,t);if(e)return e}return null}_call(e,t){let r=t.clone();r.currentFunctionName=e.name;let i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){let n=i.node.args[t],s=this.evalExpression(e.args[t],r);r.setVariable(n.name,s,n)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){let r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?"++"===e.operator?i.value instanceof MC?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):"--"===e.operator?i.value instanceof MC?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Mh){let r=this.getVariableName(e,t),i=t.getVariable(r);return null===i?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof My){if("*"===e.operator){let r=this._getVariableData(e.right,t);return r instanceof MT?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator)return new MT(this._getVariableData(e.right,t))}return null}_assign(e,t){let r=null,i="<var>",n=null;if(e.variable instanceof My){let r=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),n=e.operator;if("="===n){if(r instanceof MC||r instanceof MO||r instanceof MI){if(i instanceof MC||i instanceof MO||i instanceof MI&&r.data.length===i.data.length)return void r.data.set(i.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(r instanceof ML&&i instanceof ML&&r.buffer.byteLength-r.offset>=i.buffer.byteLength-i.offset)return void(r.buffer.byteLength%4==0?new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(r.buffer,r.offset,r.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===n)return r instanceof MC||r instanceof MO||r instanceof MI?i instanceof MC||i instanceof MO||i instanceof MI?void r.data.set(i.data.map((e,t)=>r.data[t]+e)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===n)return(r instanceof MC||r instanceof MO||r instanceof MI)&&(i instanceof MC||i instanceof MO||i instanceof MI)?void r.data.set(i.data.map((e,t)=>r.data[t]-e)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof My){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);let n=t.getVariable(i);if(!(n&&n.value instanceof MT))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=n.value.reference;let s=e.variable.postfix;if(!s){let t=e.variable.right;for(;t instanceof My;){if(t.postfix){s=t.postfix;break}t=t.right}}s&&(r=r.getSubData(this,s,t))}}else{n=e.variable.postfix,i=this.getVariableName(e.variable,t);let s=t.getVariable(i);if(null===s)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=s.value}if(r instanceof MT&&(r=r.reference),null===r)return void console.error(`Variable ${i} not found. Line ${e.line}`);let s=this.evalExpression(e.value,t),a=e.operator;if("="!==a){let i=r.getSubData(this,n,t);if(i instanceof MO&&s instanceof MC){let t=i.data,r=s.value;if("+="===a)for(let e=0;e<t.length;++e)t[e]+=r;else if("-="===a)for(let e=0;e<t.length;++e)t[e]-=r;else if("*="===a)for(let e=0;e<t.length;++e)t[e]*=r;else if("/="===a)for(let e=0;e<t.length;++e)t[e]/=r;else if("%="===a)for(let e=0;e<t.length;++e)t[e]%=r;else if("&="===a)for(let e=0;e<t.length;++e)t[e]&=r;else if("|="===a)for(let e=0;e<t.length;++e)t[e]|=r;else if("^="===a)for(let e=0;e<t.length;++e)t[e]^=r;else if("<<="===a)for(let e=0;e<t.length;++e)t[e]<<=r;else if(">>="===a)for(let e=0;e<t.length;++e)t[e]>>=r;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(i instanceof MO&&s instanceof MO){let t=i.data,r=s.data;if(t.length!==r.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===a)for(let e=0;e<t.length;++e)t[e]+=r[e];else if("-="===a)for(let e=0;e<t.length;++e)t[e]-=r[e];else if("*="===a)for(let e=0;e<t.length;++e)t[e]*=r[e];else if("/="===a)for(let e=0;e<t.length;++e)t[e]/=r[e];else if("%="===a)for(let e=0;e<t.length;++e)t[e]%=r[e];else if("&="===a)for(let e=0;e<t.length;++e)t[e]&=r[e];else if("|="===a)for(let e=0;e<t.length;++e)t[e]|=r[e];else if("^="===a)for(let e=0;e<t.length;++e)t[e]^=r[e];else if("<<="===a)for(let e=0;e<t.length;++e)t[e]<<=r[e];else if(">>="===a)for(let e=0;e<t.length;++e)t[e]>>=r[e];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(i instanceof MC&&s instanceof MC))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===a?i.value+=s.value:"-="===a?i.value-=s.value:"*="===a?i.value*=s.value:"/="===a?i.value/=s.value:"%="===a?i.value%=s.value:"&="===a?i.value&=s.value:"|="===a?i.value|=s.value:"^="===a?i.value^=s.value:"<<="===a?i.value<<=s.value:">>="===a?i.value>>=s.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof ML&&r.setDataValue(this,i,n,t))}if(r instanceof ML)r.setDataValue(this,s,n,t);else if(n){if(!(r instanceof MO||r instanceof MI))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(n instanceof Mg){let a=this.evalExpression(n.index,t).value;if(r instanceof MO){if(!(s instanceof MC))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[a]=s.value}else{if(!(r instanceof MI))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{let a=this.evalExpression(n.index,t).value;if(a<0||!(s instanceof MO))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{let t=r.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(a<2&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(a<2&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(a<2&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(a<3&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(a<3&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(a<3&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(a<4&&2===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*a]=s.data[0],r.data[2*a+1]=s.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(a<4&&3===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*a]=s.data[0],r.data[3*a+1]=s.data[1],r.data[3*a+2]=s.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||!(a<4&&4===s.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*a]=s.data[0],r.data[4*a+1]=s.data[1],r.data[4*a+2]=s.data[2],r.data[4*a+3]=s.data[3]}}}}}else if(n instanceof Ml){let t=n.value;if(!(r instanceof MO))return void console.error(`Invalid assignment to ${t}. Variable ${i} is not a vector. Line ${e.line}`);if(s instanceof MC){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);if("x"===t)r.data[0]=s.value;else if("y"===t){if(r.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[1]=s.value}else if("z"===t){if(r.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[2]=s.value}else if("w"===t){if(r.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);r.data[3]=s.value}}else{if(!(s instanceof MO))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(t.length!==s.data.length)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);for(let n=0;n<t.length;++n){let a=t[n];if("x"===a||"r"===a)r.data[0]=s.data[n];else if("y"===a||"g"===a){if(s.data.length<2)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[1]=s.data[n]}else if("z"===a||"b"===a){if(s.data.length<3)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[2]=s.data[n]}else{if("w"!==a&&"a"!==a||s.data.length<4)return void console.error(`Invalid assignment to ${a} for variable ${i}. Line ${e.line}`);r.data[3]=s.data[n]}}}}}else r instanceof MC&&s instanceof MC?r.value=s.value:r instanceof MO&&s instanceof MO||r instanceof MI&&s instanceof MI?r.data.set(s.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){let r=new M1(e);t.functions.set(e.name,r)}_const(e,t){let r=null;null!==e.value&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(null!==e.value){if(null===(r=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof My||(r=r.clone())}else{let i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){let i=new Mc(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(null!==e.value){if(null===(r=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof My||(r=r.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof Ms||e.type instanceof Mr||e.type instanceof Mi){let i=new Mc(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof MC))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(let n of e.cases)if(n instanceof Mw)for(let s of n.selectors){if(s instanceof Mx){i=n;continue}let a=this.evalExpression(s,t);if(!(a instanceof MC))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(n.body,t)}else n instanceof M_&&(i=n);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof MC))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(let r of e.elseif){let i=this.evalExpression(r.condition,t);if(!(i instanceof MC))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof MC?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===M8._breakObj)break;if(null!==r&&r!==M8._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){let r=this._execStatements(e.body,t);if(r===M8._breakObj)break;if(r===M8._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===M8._breakObj)break}else if(null!==r)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===M8._breakObj)break;if(r!==M8._continueObj&&null!==r)return r}return null}_evalBitcast(e,t){let r=this.evalExpression(e.value,t),i=e.type;if(r instanceof MC)return new MC(MZ(r.value,r.typeInfo.name,i.name),this.getTypeInfo(i));if(r instanceof MO){let t=r.typeInfo.getTypeName(),n="";if(t.endsWith("f"))n="f32";else if(t.endsWith("i"))n="i32";else if(t.endsWith("u"))n="u32";else if(t.endsWith("b"))n="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;n="f16"}let s=i.getTypeName(),a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;a="f16"}return new MO(function(e,t,r){if(t===r)return e;let i=Array(e.length);for(let n=0;n<e.length;n++)i[n]=MZ(e[n],t,r);return i}(Array.from(r.data),n,a),this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Mc){if(null===e.type)return MM.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}let i=e instanceof Mc?e.type.name:e.name,n=e instanceof Mc?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===n)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(0===n.size)return null;let s=new ML(new ArrayBuffer(n.size),n,0);if(n instanceof Ag){if(e.args)for(let r=0;r<e.args.length;++r){let i=n.members[r],a=e.args[r],o=this.evalExpression(a,t);s.setData(this,o,i.type,i.offset,t)}}else if(n instanceof Am){let i=0;if(e.args)for(let a=0;a<e.args.length;++a){let o=e.args[a],l=this.evalExpression(o,t);null===n.format&&("x32"===(null==(r=l.typeInfo)?void 0:r.name)?n.format=this.getTypeInfo("i32"):n.format=l.typeInfo),s.setData(this,l,n.format,i,t),i+=n.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Mc?s.getSubData(this,e.postfix,t):s}_evalLiteral(e,t){let r=this.getTypeInfo(e.type),i=r.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new MC(e.scalarValue,r):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){let r=t.getVariableValue(e.name);return null===r?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let r=1;r<e.length;++r){let i=M8._priority.get(t.name);M8._priority.get(e[r].name)<i&&(t=e[r])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){let r=this.evalExpression(e.right,t);if("&"===e.operator)return new MT(r);if("*"===e.operator)return r instanceof MT?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);let i=r instanceof MC?r.value:r instanceof MO?Array.from(r.data):null;switch(e.operator){case"+":if(MF(i))return new MO(i.map((e,t)=>+e),r.typeInfo);return new MC(+i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"-":if(MF(i))return new MO(i.map((e,t)=>-e),r.typeInfo);return new MC(-i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"!":if(MF(i))return new MO(i.map((e,t)=>+!e),r.typeInfo);return new MC(+!i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]));case"~":if(MF(i))return new MO(i.map((e,t)=>~e),r.typeInfo);return new MC(~i,this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]))}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){let r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),n=r instanceof MC?r.value:r instanceof MO||r instanceof MI?Array.from(r.data):null,s=i instanceof MC?i.value:i instanceof MO||i instanceof MI?Array.from(i.data):null;switch(e.operator){case"+":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e+s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e+s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n+e),i.typeInfo);return new MC(n+s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"-":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e-s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e-s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n-e),i.typeInfo);return new MC(n-s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"*":if(MF(n)&&MF(s)){if(r instanceof MI&&i instanceof MI){let t=function(e,t,r,i){if(void 0===M6[t.name]||void 0===M6[i.name])return null;let n=M6[t.name][0],s=M6[t.name][1],a=M6[i.name][0];if(n!==M6[i.name][1])return null;let o=Array(a*s);for(let t=0;t<s;t++)for(let i=0;i<a;i++){let l=0;for(let a=0;a<n;a++)l+=e[a*s+t]*r[i*n+a];o[t*a+i]=l}return o}(n,r.typeInfo,s,i.typeInfo);if(null===t)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let a=M6[i.typeInfo.name][0],o=M6[r.typeInfo.name][1];return new MI(t,this.getTypeInfo(`mat${a}x${o}f`))}if(r instanceof MI&&i instanceof MO){let t=function(e,t,r,i){if(void 0===M6[t.name]||void 0===M5[i.name])return null;let n=M6[t.name][0],s=M6[t.name][1];if(n!==r.length)return null;let a=Array(s);for(let t=0;t<s;t++){let i=0;for(let a=0;a<n;a++)i+=e[a*s+t]*r[a];a[t]=i}return a}(n,r.typeInfo,s,i.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new MO(t,i.typeInfo)}if(r instanceof MO&&i instanceof MI){let t=function(e,t,r,i){if(void 0===M5[t.name]||void 0===M6[i.name])return null;let n=M6[i.name][0],s=M6[i.name][1];if(s!==e.length)return null;let a=[];for(let t=0;t<n;t++){let i=0;for(let a=0;a<s;a++)i+=e[a]*r[a*n+t];a[t]=i}return a}(n,r.typeInfo,s,i.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new MO(t,r.typeInfo)}if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e*s[t]),r.typeInfo)}if(MF(n)){let e=n.map((e,t)=>e*s);return r instanceof MI?new MI(e,r.typeInfo):new MO(e,r.typeInfo)}if(MF(s)){let e=s.map((e,t)=>n*e);return i instanceof MI?new MI(e,i.typeInfo):new MO(e,i.typeInfo)}return new MC(n*s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"%":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e%s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e%s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n%e),i.typeInfo);return new MC(n%s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"/":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e/s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e/s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n/e),i.typeInfo);return new MC(n/s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"&":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e&s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e&s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n&e),i.typeInfo);return new MC(n&s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"|":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e|s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e|s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n|e),i.typeInfo);return new MC(n|s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"^":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e^s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e^s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n^e),i.typeInfo);return new MC(n^s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case"<<":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e<<s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e<<s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n<<e),i.typeInfo);return new MC(n<<s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case">>":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e>>s[t]),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e>>s),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n>>e),i.typeInfo);return new MC(n>>s,this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]));case">":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e>s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e>s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n>e)),i.typeInfo);return new MC(+(n>s),this.getTypeInfo("bool"));case"<":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e<s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e<s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n<e)),i.typeInfo);return new MC(+(n<s),this.getTypeInfo("bool"));case"==":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e===s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e==s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n==e)),i.typeInfo);return new MC(+(n===s),this.getTypeInfo("bool"));case"!=":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e!==s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e!==s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n!==e)),i.typeInfo);return new MC(+(n!==s),this.getTypeInfo("bool"));case">=":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e>=s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e>=s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n>=e)),i.typeInfo);return new MC(+(n>=s),this.getTypeInfo("bool"));case"<=":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>+(e<=s[t])),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>+(e<=s)),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>+(n<=e)),i.typeInfo);return new MC(+(n<=s),this.getTypeInfo("bool"));case"&&":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e&&s[t]?1:0),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e&&s?1:0),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n&&e?1:0),i.typeInfo);return new MC(n&&s?1:0,this.getTypeInfo("bool"));case"||":if(MF(n)&&MF(s)){if(n.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new MO(n.map((e,t)=>e||s[t]?1:0),r.typeInfo)}if(MF(n))return new MO(n.map((e,t)=>e||s?1:0),r.typeInfo);if(MF(s))return new MO(s.map((e,t)=>n||e?1:0),i.typeInfo);return new MC(n||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;let r=t.clone();r.currentFunctionName=e.name;let i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let t=0;t<i.node.args.length;++t){let n=i.node.args[t],s=this.evalExpression(e.args[t],r);r.createVariable(n.name,s,n)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}let r=t.getFunction(e.name);if(r){let i=t.clone();for(let t=0;t<r.node.args.length;++t){let n=r.node.args[t],s=this.evalExpression(e.args[t],i);i.setVariable(n.name,s,n)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new MC(0,this.getTypeInfo(e.type));let r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){let r=this.getTypeInfo(e.type),i=e.type.getTypeName(),n=M5[i];if(void 0===n)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;let s=[];if(e instanceof Mf)if(e.isVector)for(let t of e.vectorValue)s.push(t);else s.push(e.scalarValue);else if(e.args)for(let r of e.args){let e=this.evalExpression(r,t);if(e instanceof MO){let t=e.data;for(let e=0;e<t.length;++e){let r=t[e];s.push(r)}}else if(e instanceof MC){let t=e.value;s.push(t)}}if(e.type instanceof Mi&&null===e.type.format&&(e.type.format=Mi.f32),0===s.length)return new MO(Array(n).fill(0),r).getSubData(this,e.postfix,t);if(1===s.length)for(;s.length<n;)s.push(s[0]);return s.length<n?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new MO(s.length>n?s.slice(0,n):s,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){let r=this.getTypeInfo(e.type),i=e.type.getTypeName(),n=M6[i];if(void 0===n)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;let s=[];if(e instanceof Mf)if(e.isVector)for(let t of e.vectorValue)s.push(t);else s.push(e.scalarValue);else if(e.args)for(let r of e.args){let e=this.evalExpression(r,t);e instanceof MO?s.push(...e.data):e instanceof MC?s.push(e.value):e instanceof MI&&s.push(...e.data)}return(r instanceof Av&&null===r.format&&(r.format=this.getTypeInfo("f32")),0===s.length)?new MI(Array(n[2]).fill(0),r).getSubData(this,e.postfix,t):s.length!==n[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new MI(s,r).getSubData(this,e.postfix,t)}}M8._breakObj=new MA(new Af("BREAK",null),null),M8._continueObj=new MA(new Af("CONTINUE",null),null),M8._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class M7{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class M9{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new M7,this._exec=new M8,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let t=[];for(;!this._isAtEnd();){let e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(let e of this._deferArrayCountEval){let t=e.arrayType,r=e.countNode;if(r instanceof Mh){let e=r.name,i=this._context.constants.get(e);if(i)try{t.count=i.constEvaluate(this._exec)}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let e of t)e.search(e=>{e instanceof MS||e instanceof Mn?e.type=this._forwardType(e.type):e instanceof Ms?e.format=this._forwardType(e.format):e instanceof Aq||e instanceof AK||e instanceof AZ?e.type=this._forwardType(e.type):e instanceof AU?e.returnType=this._forwardType(e.returnType):e instanceof Mk&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof Mt){let t=this._getType(e.name);if(t)return t}else e instanceof Mn?e.type=this._forwardType(e.type):e instanceof Ms&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){let t=new Mz(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==MD.eof}_match(e){if(e instanceof MN)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){let r=e[t];if(this._check(r))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let r=t.type,i=!1;for(let t of e){if(r===t)return!0;t===MD.tokens.name&&(i=!0)}if(i){let e=MD.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===MD.tokens.name){let e=MD.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!=(t=null==(e=this._peek())?void 0:e.line)?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(MD.tokens.semicolon)&&!this._isAtEnd(););if(this._match(MD.keywords.alias)){let e=this._type_alias();return this._consume(MD.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MD.keywords.diagnostic)){let e=this._diagnostic();return this._consume(MD.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MD.keywords.requires)){let e=this._requires_directive();return this._consume(MD.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(MD.keywords.enable)){let e=this._enable_directive();return this._consume(MD.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}let e=this._attribute();if(this._check(MD.keywords.var)){let t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(MD.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MD.keywords.override)){let t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(MD.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MD.keywords.let)){let t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(MD.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MD.keywords.const)){let t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(MD.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(MD.keywords.struct)){let t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(MD.keywords.fn)){let t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(MD.keywords.fn))return null;let e=this._currentLine,t=this._consume(MD.tokens.ident,"Expected function name.").toString();this._consume(MD.tokens.paren_left,"Expected '(' for function arguments.");let r=[];if(!this._check(MD.tokens.paren_right))do{if(this._check(MD.tokens.paren_right))break;let e=this._attribute(),t=this._consume(MD.tokens.name,"Expected argument name.").toString();this._consume(MD.tokens.colon,"Expected ':' for argument type.");let i=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=i,r.push(this._updateNode(new Mk(t,n,e))))}while(this._match(MD.tokens.comma))this._consume(MD.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(MD.tokens.arrow)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}let n=this._compound_statement(),s=this._currentLine;return this._updateNode(new AU(t,r,i,n,e,s),e)}_compound_statement(){let e=[];for(this._consume(MD.tokens.brace_left,"Expected '{' for block.");!this._check(MD.tokens.brace_right);){let t=this._statement();null!==t&&e.push(t)}return this._consume(MD.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(MD.tokens.semicolon)&&!this._isAtEnd(););if(this._check(MD.tokens.attr)&&this._attribute(),this._check(MD.keywords.if))return this._if_statement();if(this._check(MD.keywords.switch))return this._switch_statement();if(this._check(MD.keywords.loop))return this._loop_statement();if(this._check(MD.keywords.for))return this._for_statement();if(this._check(MD.keywords.while))return this._while_statement();if(this._check(MD.keywords.continuing))return this._continuing_statement();if(this._check(MD.keywords.static_assert))return this._static_assert_statement();if(this._check(MD.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(MD.keywords.return))e=this._return_statement();else if(this._check([MD.keywords.var,MD.keywords.let,MD.keywords.const]))e=this._variable_statement();else if(this._match(MD.keywords.discard))e=this._updateNode(new A8);else if(this._match(MD.keywords.break)){let t=this._updateNode(new A7);this._currentLoop.length>0&&(t.loopId=this._currentLoop[this._currentLoop.length-1].id),e=t,this._check(MD.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(MD.keywords.continue)){let t=this._updateNode(new A9);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);t.loopId=this._currentLoop[this._currentLoop.length-1].id,e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(MD.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(MD.keywords.static_assert))return null;let e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new A$(t),e)}_while_statement(){if(!this._match(MD.keywords.while))return null;let e=this._updateNode(new AV(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(MD.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(MD.keywords.continuing))return null;let t=this._currentLine,r=this._compound_statement();return this._updateNode(new AW(r,e),t)}_for_statement(){if(!this._match(MD.keywords.for))return null;this._consume(MD.tokens.paren_left,"Expected '('.");let e=this._updateNode(new AG(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(MD.tokens.semicolon)?null:this._for_init(),this._consume(MD.tokens.semicolon,"Expected ';'."),e.condition=this._check(MD.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(MD.tokens.semicolon,"Expected ';'."),e.increment=this._check(MD.tokens.paren_right)?null:this._for_increment(),this._consume(MD.tokens.paren_right,"Expected ')'."),this._check(MD.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(MD.keywords.var)){let e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(MD.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Aq(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(MD.keywords.let)){let e=this._currentLine,t=this._consume(MD.tokens.name,"Expected name for let.").toString(),r=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}this._consume(MD.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return this._updateNode(new AK(t,r,null,null,i),e)}if(this._match(MD.keywords.const)){let e=this._currentLine,t=this._consume(MD.tokens.name,"Expected name for const.").toString(),r=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}this._consume(MD.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return null===r&&i instanceof Mf&&(r=i.type),this._updateNode(new AZ(t,r,null,null,i),e)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(MD.increment_operators))return this._current=e,null;let r=this._consume(MD.increment_operators,"Expected increment operator");return this._updateNode(new AY(r.type===MD.tokens.plus_plus?K.increment:K.decrement,t))}_assignment_statement(){let e=null,t=this._currentLine;if(this._check(MD.tokens.brace_right))return null;let r=this._match(MD.tokens.underscore);if(r||(e=this._unary_expression()),!r&&null==e)return null;let i=this._consume(MD.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return this._updateNode(new AX(Z.parse(i.lexeme),e,n),t)}_func_call_statement(){if(!this._check(MD.tokens.ident))return null;let e=this._currentLine,t=this._current,r=this._consume(MD.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new AJ(r.lexeme,i),e)}_loop_statement(){if(!this._match(MD.keywords.loop))return null;this._check(MD.tokens.attr)&&this._attribute(),this._consume(MD.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new AQ([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof AW){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(MD.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(MD.keywords.switch))return null;let e=this._updateNode(new A0(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(MD.tokens.attr)&&this._attribute(),this._consume(MD.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(MD.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],t=!1;for(;this._check([MD.keywords.default,MD.keywords.case]);){if(this._match(MD.keywords.case)){let r=this._case_selectors();for(let e of r)if(e instanceof Mx){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(MD.tokens.colon),this._check(MD.tokens.attr)&&this._attribute(),this._consume(MD.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(MD.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Mw(r,i)))}if(this._match(MD.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(MD.tokens.colon),this._check(MD.tokens.attr)&&this._attribute(),this._consume(MD.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(MD.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new M_(r)))}}return e}_case_selectors(){let e=[];for(this._match(MD.keywords.default)?e.push(this._updateNode(new Mx)):e.push(this._shift_expression());this._match(MD.tokens.comma);)this._match(MD.keywords.default)?e.push(this._updateNode(new Mx)):e.push(this._shift_expression());return e}_case_body(){if(this._match(MD.keywords.fallthrough))return this._consume(MD.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);let t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(MD.keywords.if))return null;let e=this._currentLine,t=this._optional_paren_expression();this._check(MD.tokens.attr)&&this._attribute();let r=this._compound_statement(),i=[];this._match_elseif()&&(this._check(MD.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(MD.keywords.else)&&(this._check(MD.tokens.attr)&&this._attribute(),n=this._compound_statement()),this._updateNode(new A1(t,r,i,n),e)}_match_elseif(){return this._tokens[this._current].type===MD.keywords.else&&this._tokens[this._current+1].type===MD.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new MP(t,r))),this._match_elseif()&&(this._check(MD.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(MD.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new A2(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(MD.tokens.or_or);)e=this._updateNode(new Mv(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(MD.tokens.and_and);)e=this._updateNode(new Mv(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(MD.tokens.or);)e=this._updateNode(new Mv(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(MD.tokens.xor);)e=this._updateNode(new Mv(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(MD.tokens.and);)e=this._updateNode(new Mv(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([MD.tokens.equal_equal,MD.tokens.not_equal])?this._updateNode(new Mv(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([MD.tokens.less_than,MD.tokens.greater_than,MD.tokens.less_than_equal,MD.tokens.greater_than_equal]);)e=this._updateNode(new Mv(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([MD.tokens.shift_left,MD.tokens.shift_right]);)e=this._updateNode(new Mv(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([MD.tokens.plus,MD.tokens.minus]);)e=this._updateNode(new Mv(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([MD.tokens.star,MD.tokens.forward_slash,MD.tokens.modulo]);)e=this._updateNode(new Mv(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([MD.tokens.minus,MD.tokens.bang,MD.tokens.tilde,MD.tokens.star,MD.tokens.and])?this._updateNode(new My(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(MD.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(MD.tokens.bracket_right,"Expected ']'.");let t=this._updateNode(new Mg(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(MD.tokens.period)){let e=this._consume(MD.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new Ml(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return Me.void;case"bool":return Me.bool;case"i32":return Me.i32;case"u32":return Me.u32;case"f32":return Me.f32;case"f16":return Me.f16;case"vec2f":return Mi.vec2f;case"vec3f":return Mi.vec3f;case"vec4f":return Mi.vec4f;case"vec2i":return Mi.vec2i;case"vec3i":return Mi.vec3i;case"vec4i":return Mi.vec4i;case"vec2u":return Mi.vec2u;case"vec3u":return Mi.vec3u;case"vec4u":return Mi.vec4u;case"vec2h":return Mi.vec2h;case"vec3h":return Mi.vec3h;case"vec4h":return Mi.vec4h;case"mat2x2f":return Mi.mat2x2f;case"mat2x3f":return Mi.mat2x3f;case"mat2x4f":return Mi.mat2x4f;case"mat3x2f":return Mi.mat3x2f;case"mat3x3f":return Mi.mat3x3f;case"mat3x4f":return Mi.mat3x4f;case"mat4x2f":return Mi.mat4x2f;case"mat4x3f":return Mi.mat4x3f;case"mat4x4f":return Mi.mat4x4f;case"mat2x2h":return Mi.mat2x2h;case"mat2x3h":return Mi.mat2x3h;case"mat2x4h":return Mi.mat2x4h;case"mat3x2h":return Mi.mat3x2h;case"mat3x3h":return Mi.mat3x3h;case"mat3x4h":return Mi.mat3x4h;case"mat4x2h":return Mi.mat4x2h;case"mat4x3h":return Mi.mat4x3h;case"mat4x4h":return Mi.mat4x4h;case"mat2x2i":return Mi.mat2x2i;case"mat2x3i":return Mi.mat2x3i;case"mat2x4i":return Mi.mat2x4i;case"mat3x2i":return Mi.mat3x2i;case"mat3x3i":return Mi.mat3x3i;case"mat3x4i":return Mi.mat3x4i;case"mat4x2i":return Mi.mat4x2i;case"mat4x3i":return Mi.mat4x3i;case"mat4x4i":return Mi.mat4x4i;case"mat2x2u":return Mi.mat2x2u;case"mat2x3u":return Mi.mat2x3u;case"mat2x4u":return Mi.mat2x4u;case"mat3x2u":return Mi.mat3x2u;case"mat3x3u":return Mi.mat3x3u;case"mat3x4u":return Mi.mat3x4u;case"mat4x2u":return Mi.mat4x2u;case"mat4x3u":return Mi.mat4x3u;case"mat4x4u":return Mi.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-0x80000000||e>0x7fffffff)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>0xffffffff))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(MD.tokens.ident)){let e=this._previous().toString();if(this._check(MD.tokens.paren_left)){let t=this._argument_expression_list(),r=this._getType(e);return null!==r?this._updateNode(new Mc(r,t)):this._updateNode(new Mu(e,t))}if(this._context.constants.has(e)){let t=this._context.constants.get(e);return this._updateNode(new Md(e,t.value))}return this._updateNode(new Mh(e))}if(this._match(MD.tokens.int_literal)){let e=this._previous().toString(),t=e.endsWith("i")||e.endsWith("i")?Me.i32:e.endsWith("u")||e.endsWith("U")?Me.u32:Me.x32,r=parseInt(e);return this._validateTypeRange(r,t),this._updateNode(new Mf(new MC(r,this._exec.getTypeInfo(t)),t))}if(this._match(MD.tokens.uint_literal)){let e=parseInt(this._previous().toString());return this._validateTypeRange(e,Me.u32),this._updateNode(new Mf(new MC(e,this._exec.getTypeInfo(Me.u32)),Me.u32))}if(this._match([MD.tokens.decimal_float_literal,MD.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));let r=parseFloat(e);this._validateTypeRange(r,t?Me.f16:Me.f32);let i=t?Me.f16:Me.f32;return this._updateNode(new Mf(new MC(r,this._exec.getTypeInfo(i)),i))}if(this._match([MD.keywords.true,MD.keywords.false])){let e=this._previous().toString()===MD.keywords.true.rule;return this._updateNode(new Mf(new MC(+!!e,this._exec.getTypeInfo(Me.bool)),Me.bool))}if(this._check(MD.tokens.paren_left))return this._paren_expression();if(this._match(MD.keywords.bitcast)){this._consume(MD.tokens.less_than,"Expected '<'.");let e=this._type_decl();this._consume(MD.tokens.greater_than,"Expected '>'.");let t=this._paren_expression();return this._updateNode(new Mp(e,t))}let e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Mc(e,t))}_argument_expression_list(){if(!this._match(MD.tokens.paren_left))return null;let e=[];do{if(this._check(MD.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(MD.tokens.comma))return this._consume(MD.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(MD.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(MD.tokens.paren_right),e}_paren_expression(){this._consume(MD.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(MD.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(MD.keywords.struct))return null;let e=this._currentLine,t=this._consume(MD.tokens.ident,"Expected name for struct.").toString();this._consume(MD.tokens.brace_left,"Expected '{' for struct body.");let r=[];for(;!this._check(MD.tokens.brace_right);){let e=this._attribute(),t=this._consume(MD.tokens.name,"Expected variable name.").toString();this._consume(MD.tokens.colon,"Expected ':' for struct member type.");let i=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=i),this._check(MD.tokens.brace_right)?this._match(MD.tokens.comma):this._consume(MD.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new MS(t,n,e)))}this._consume(MD.tokens.brace_right,"Expected '}' after struct body.");let i=this._currentLine,n=this._updateNode(new Mr(t,r,e,i),e);return this._context.structs.set(t,n),n}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(MD.tokens.equal)&&(e.value=this._const_expression()),null!==e.type&&e.value instanceof Mf){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Mf&&(e.type="x32"===e.value.type.name?Me.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(MD.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(MD.keywords.const))return null;let t=this._consume(MD.tokens.name,"Expected variable name"),r=this._currentLine,i=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}let n=null;this._consume(MD.tokens.equal,"const declarations require an assignment");let s=this._short_circuit_or_expression();try{let e=[Me.f32],r=s.constEvaluate(this._exec,e);r instanceof MC&&this._validateTypeRange(r.value,e[0]),e[0]instanceof Mi&&null===e[0].format&&r.typeInfo instanceof Av&&null!==r.typeInfo.format&&("f16"===r.typeInfo.format.name?e[0].format=Me.f16:"f32"===r.typeInfo.format.name?e[0].format=Me.f32:"i32"===r.typeInfo.format.name?e[0].format=Me.i32:"u32"===r.typeInfo.format.name?e[0].format=Me.u32:"bool"===r.typeInfo.format.name?e[0].format=Me.bool:console.error(`TODO: impelement template format type ${r.typeInfo.format.name}`)),n=this._updateNode(new Mf(r,e[0])),this._exec.context.setVariable(t.toString(),r)}catch(e){n=s}if(null!==i&&n instanceof Mf){if("x32"!==n.type.name&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i,n.isScalar&&this._validateTypeRange(n.scalarValue,n.type)}else null===i&&n instanceof Mf&&(i=null!=(e=null==n?void 0:n.type)?e:Me.f32)===Me.x32&&(i=Me.i32);let a=this._updateNode(new AZ(t.toString(),i,"","",n),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(MD.keywords.let))return null;let e=this._currentLine,t=this._consume(MD.tokens.name,"Expected variable name"),r=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}let i=null;if(this._match(MD.tokens.equal)&&(i=this._const_expression()),null!==r&&i instanceof Mf){if("x32"!==i.type.name&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else null===r&&i instanceof Mf&&(r="x32"===i.type.name?Me.i32:i.type);return i instanceof Mf&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new AK(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(MD.keywords.var))return null;let e=this._currentLine,t="",r="";this._match(MD.tokens.less_than)&&(t=this._consume(MD.storage_class,"Expected storage_class.").toString(),this._match(MD.tokens.comma)&&(r=this._consume(MD.access_mode,"Expected access_mode.").toString()),this._consume(MD.tokens.greater_than,"Expected '>'."));let i=this._consume(MD.tokens.name,"Expected variable name"),n=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(n=this._type_decl())&&(n.attributes=e)}return this._updateNode(new Aq(i.toString(),n,t,r,null),e)}_override_decl(){if(!this._match(MD.keywords.override))return null;let e=this._consume(MD.tokens.name,"Expected variable name"),t=null;if(this._match(MD.tokens.colon)){let e=this._attribute();null!=(t=this._type_decl())&&(t.attributes=e)}return this._updateNode(new AH(e.toString(),t,null))}_diagnostic(){this._consume(MD.tokens.paren_left,"Expected '('");let e=this._consume(MD.tokens.ident,"Expected severity control name.");this._consume(MD.tokens.comma,"Expected ','");let t=this._consume(MD.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(MD.tokens.period)&&(t+=`.${this._consume(MD.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(MD.tokens.paren_right,"Expected ')'"),this._updateNode(new A5(e.toString(),t))}_enable_directive(){let e=this._consume(MD.tokens.ident,"identity expected.");return this._updateNode(new A3(e.toString()))}_requires_directive(){let e=[this._consume(MD.tokens.ident,"identity expected.").toString()];for(;this._match(MD.tokens.comma);){let t=this._consume(MD.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new A4(e))}_type_alias(){let e=this._consume(MD.tokens.ident,"identity expected.");this._consume(MD.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let r=this._updateNode(new A6(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([MD.tokens.ident,...MD.texel_format,MD.keywords.bool,MD.keywords.f32,MD.keywords.i32,MD.keywords.u32])){let e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){let t=this._updateNode(new Mt(e));return this._forwardTypeCount++,t}return this._updateNode(new Me(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(MD.template_types)){let e=this._advance().toString(),t=null,r=null;return this._match(MD.tokens.less_than)&&(t=this._type_decl(),r=null,this._match(MD.tokens.comma)&&(r=this._consume(MD.access_mode,"Expected access_mode for pointer").toString()),this._consume(MD.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Mi(e,t,r))}if(this._match(MD.keywords.ptr)){let e=this._previous().toString();this._consume(MD.tokens.less_than,"Expected '<' for pointer.");let t=this._consume(MD.storage_class,"Expected storage_class for pointer");this._consume(MD.tokens.comma,"Expected ',' for pointer.");let r=this._type_decl(),i=null;return this._match(MD.tokens.comma)&&(i=this._consume(MD.access_mode,"Expected access_mode for pointer").toString()),this._consume(MD.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Mn(e,t.toString(),r,i))}let t=this._attribute();if(this._match(MD.keywords.array)){let e=null,r=-1,i=this._previous(),n=null;if(this._match(MD.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(MD.tokens.comma)){n=this._shift_expression();try{t=n.constEvaluate(this._exec).toString(),n=null}catch(e){t="1"}}this._consume(MD.tokens.greater_than,"Expected '>' for array."),r=t?parseInt(t):0}let s=this._updateNode(new Ms(i.toString(),t,e,r));return n&&this._deferArrayCountEval.push({arrayType:s,countNode:n}),s}return null}_texture_sampler_types(){if(this._match(MD.sampler_type)||this._match(MD.depth_texture_type))return this._updateNode(new Ma(this._previous().toString(),null,null));if(this._match(MD.sampled_texture_type)||this._match(MD.multisampled_texture_type)){let e=this._previous();this._consume(MD.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(MD.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ma(e.toString(),t,null))}if(this._match(MD.storage_texture_type)){let e=this._previous();this._consume(MD.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(MD.texel_format,"Invalid texel format.").toString();this._consume(MD.tokens.comma,"Expected ',' after texel format.");let r=this._consume(MD.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(MD.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ma(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(MD.tokens.attr);){let t=this._consume(MD.attribute_name,"Expected attribute name"),r=this._updateNode(new ME(t.toString(),null));if(this._match(MD.tokens.paren_left)){if(r.value=this._consume(MD.literal_or_ident,"Expected attribute value").toString(),this._check(MD.tokens.comma)){this._advance();do{let e=this._consume(MD.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(e)}while(this._match(MD.tokens.comma))}this._consume(MD.tokens.paren_right,"Expected ')'")}e.push(r)}return 0==e.length?null:e}}class Te extends MJ{constructor(e){super(),e&&this.update(e)}update(e){let t=(new M9).parse(e);this.updateAST(t)}}function Tt(e){return e?.format?`${e.name}<${e.format.name}>`:e.name}var Tr=e.i(36932);let Ti={};function Tn(e="id"){Ti[e]=Ti[e]||1;let t=Ti[e]++;return`${e}-${t}`}class Ts{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Tn("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Eq.Buffer.INDEX))throw Error("Index buffer must have INDEX usage")}destroy(){for(let e of(this.indices?.destroy(),Object.values(this.attributes)))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}var Ta=e.i(81905);class To extends Ta.Resource{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,To.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Ta.Resource.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Tl{static defaultProps={...As.RenderPipeline.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Tl(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);let t={...As.RenderPipeline.defaultProps,...e},r=this._renderPipelineCache,i=this._hashRenderPipeline(t),n=r[i]?.pipeline;return n?(r[i].useCount++,this.debug&&vN.log.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):((n=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:Tn("unnamed-cached")})).hash=i,r[i]={pipeline:n,useCount:1},this.debug&&vN.log.warn(`${this}: ${n} created, count=${r[i].useCount}`)()),n}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);let t={...To.defaultProps,...e},r=this._computePipelineCache,i=this._hashComputePipeline(t),n=r[i]?.pipeline;return n?(r[i].useCount++,this.debug&&vN.log.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):((n=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0})).hash=i,r[i]={pipeline:n,useCount:1},this.debug&&vN.log.warn(`${this}: ${n} created, count=${r[i].useCount}`)()),n}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._getCache(e),r=e.hash;t[r].useCount--,0===t[r].useCount?(this._destroyPipeline(e),this.debug&&vN.log.warn(`${this}: ${e} released and destroyed`)()):t[r].useCount<0?(vN.log.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[r].useCount=0):this.debug&&vN.log.warn(`${this}: ${e} released, count=${t[r].useCount}`)()}_destroyPipeline(e){let t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof To&&(t=this._computePipelineCache),e instanceof As.RenderPipeline&&(t=this._renderPipelineCache),!t)throw Error(`${this}`);if(!t[e.hash])throw Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){let{type:t}=this.device,r=this._getHash(e.shader.source);return`${t}/C/${r}`}_hashRenderPipeline(e){let t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout)),{type:n}=this.device;if("webgl"===n)return`${n}/R/${t}/${r}V-BL${i}`;{let s=this._getHash(JSON.stringify(e.parameters));return`${n}/R/${t}/${r}V-T${e.topology}P${s}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}var Tc=e.i(45453);class Tu{static defaultProps={...Tc.Shader.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Tu(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);let t=this._hashShader(e),r=this._cache[t];if(r)r.useCount++,this.debug&&vN.log.warn(`${this}: Reusing shader ${r.shader.id} count=${r.useCount}`)();else{let i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:1},this.debug&&vN.log.warn(`${this}: Created new shader ${i.id}`)()}return r.shader}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._hashShader(e),r=this._cache[t];if(r)if(r.useCount--,0===r.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],r.shader.destroy(),this.debug&&vN.log.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else if(r.useCount<0)throw Error(`ShaderFactory: Shader ${e.id} released too many times`);else this.debug&&vN.log.warn(`${this}: Releasing shader ${e.id} count=${r.useCount}`)()}_hashShader(e){return`${e.stage}:${e.source}`}}let Th=null,Td=null;class Tf{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){let r=[...e];for(let e of t){let t=r.findIndex(t=>t.name===e.name);t<0?r.push(e):r[t]=e}return r}getBufferIndex(e){let t=this.bufferLayouts.findIndex(t=>t.name===e);return -1===t&&vN.log.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}class Tp{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){for(const r of(Object.assign(this.options,t),vb(Object.values(e).filter(e=>e.dependencies))))e[r.name]=r;for(const[t,r]of(vN.log.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={},Object.entries(e)))this._addModule(r),r.name&&t!==r.name&&!this.options.disableWarnings&&vN.log.warn(`Module name: ${t} vs ${r.name}`)()}destroy(){}setProps(e){for(let t of Object.keys(e)){let r=e[t]||{},i=this.modules[t];if(!i){this.options.disableWarnings||vN.log.warn(`Module ${t} not found`)();continue}let n=this.moduleUniforms[t],s=this.moduleBindings[t],{uniforms:a,bindings:o}=function(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let i=e[r];(!ArrayBuffer.isView(i)||i instanceof DataView)&&(Array.isArray(i)?0!==i.length&&"number"!=typeof i[0]:1)&&"number"!=typeof i&&"boolean"!=typeof i?t.bindings[r]=i:t.uniforms[r]=i}),t}(i.getUniforms?.(r,n)||r);this.moduleUniforms[t]={...n,...a},this.moduleBindings[t]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,r]of Object.entries(this.moduleUniforms))for(let[i,n]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(n)};return e}_addModule(e){let t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}async function Tg(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:""+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}let Tm=["+X","-X","+Y","-Y","+Z","-Z"],Ty=["+X","-X","+Y","-Y","+Z","-Z"];class Tv{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const r=Tn("async-texture");this.props={...Tv.defaultProps,id:r,...t},this.id=this.props.id,t={...t},"string"==typeof t?.data&&"2d"===t.dimension&&(t.data=Tg(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){let t=e.data,r=await Tb(t).then(void 0,this.rejectReady);if(this.destroyed)return;let i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(r);if(!i)throw Error("Texture size could not be determined");let n={...i,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(n.width,n.height);if(n.mipLevels="auto"===this.props.mipLevels?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,r);break;case"2d":this._setTexture2DData(r);break;case"3d":this._setTexture3DData(this.texture,r);break;case"2d-array":this._setTextureArrayData(this.texture,r);break;case"cube":this._setTextureCubeData(this.texture,r);break;case"cube-array":this._setTextureCubeArrayData(this.texture,r)}this.props.mipmaps&&this.generateMipmaps(),vN.log.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof An.Sampler?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){return ArrayBuffer.isView(e?.data)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){let t=Object.values(e)[0];return{width:t.width,height:t.height}}throw Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw Error("Texture not initialized");let r=this._normalizeTextureData(e);r.length>1&&!1!==this.props.mipmaps&&vN.log.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let e=0;e<r.length;e++){let i=r[e];this.device.isExternalImage(i)?this.texture.copyExternalImage({image:i,depth:t,mipLevel:e,flipY:!0}):this.texture.copyImageData({data:i.data,mipLevel:e})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw Error(this.id);for(let[e,r]of Object.entries(t)){let t=Ty.indexOf(e);this._setTexture2DData(r,t)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeArrayData(e,t){throw Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,r,i=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&vN.log.warn(`${this.id} has mipmap and multiple LODs.`)();let n=Tm.indexOf(r);this._setTexture2DData(t,n)}_normalizeTextureData(e){let t=this.texture;return ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e]}static defaultProps={...Ar.Texture.defaultProps,data:null,mipmaps:!1}}async function Tb(e){if(Array.isArray(e=await e))return await Promise.all(e.map(Tb));if(e&&"object"==typeof e&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),i=Object.keys(t),n={};for(let e=0;e<i.length;e++)n[i[e]]=r[e];return n}return e}class Tx{static defaultProps={...As.RenderPipeline.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:vj.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Tx.defaultProps,...t},t=this.props,this.id=t.id||Tn("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(e=>[e.name,e])||[]),i=t.shaderInputs||new Tp(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const n=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:n,...this.props,modules:s});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=function(e){let t,r={attributes:[],bindings:[]};try{t=function(e){try{return new Te(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&t?.message&&(e+=`: ${t.message} `),"object"==typeof t&&t?.token&&(e+=t.token.line||""),Error(e,{cause:t})}}(e)}catch(e){return vN.log.error(e.message)(),r}for(let e of t.uniforms){let t=[];for(let r of e.type?.members||[])t.push({name:r.name,type:Tt(r.type)});r.bindings.push({type:"uniform",name:e.name,group:e.group,location:e.binding,members:t})}for(let e of t.textures)r.bindings.push({type:"texture",name:e.name,group:e.group,location:e.binding});for(let e of t.samplers)r.bindings.push({type:"sampler",name:e.name,group:e.group,location:e.binding});let i=t.entry.vertex[0],n=i?.inputs.length||0;for(let e=0;e<n;e++){let t=i.inputs[e];if("location"===t.locationType){let e=Tt(t.type);r.attributes.push({name:t.name,location:Number(t.location),type:e})}}return r}(this.source)}else{const{vs:e,fs:t,getUniforms:r}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:n,...this.props,modules:s});this.vs=e,this.fs=t,this._getModuleUniforms=r}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Tl.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Tu.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t,r=this._areBindingsLoading();if(r)return vN.log.info(2,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings});let{indexBuffer:i}=this.vertexArray,n=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&function(e,t){if(t instanceof Ts)return t;let r=function(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:Eq.Buffer.INDEX,data:r})}(e,t),{attributes:i,bufferLayout:n}=function(e,t){let r=[],i={};for(let[n,s]of Object.entries(t.attributes)){let t=n;switch(n){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(s){i[t]=e.createBuffer({data:s.value,id:`${n}-buffer`});let{value:a,size:o,normalized:l}=s;r.push({name:t,format:(0,Tr.getVertexFormatFromAttribute)(a,o,l)})}}return{attributes:i,bufferLayout:r,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new Ts({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:r,attributes:i})}(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");let e=new Tf(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let t=new Tf(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){!function e(t,r,i){if(t===r)return!0;if(!i||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n],i-1))return!1;return!0}if(Array.isArray(r))return!1;if("object"==typeof t&&"object"==typeof r){let n=Object.keys(t),s=Object.keys(r);if(n.length!==s.length)return!1;for(let s of n)if(!r.hasOwnProperty(s)||!e(t[s],r[s],i-1))return!1;return!0}return!1}(e,this.parameters,2)&&(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){for(let[r,i]of(this.shaderInputs=e,this._uniformStore=new Ah(this.shaderInputs.modules),Object.entries(this.shaderInputs.modules))){var t;if((t=i).uniformTypes&&!function(e){for(let t in e)return!1;return!0}(t.uniformTypes)){let e=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=e}}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){var r,i;let n,s,a=t?.disableWarnings??this.props.disableWarnings;e.indices&&vN.log.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=(r=this.pipeline.shaderLayout,i=this.bufferLayout,n=Object.fromEntries(r.attributes.map(e=>[e.name,e.location])),(s=i.slice()).sort((e,t)=>{let r=e.attributes?e.attributes.map(e=>e.attribute):[e.name],i=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...r.map(e=>n[e]))-Math.min(...i.map(e=>n[e]))}),s);let o=new Tf(this.bufferLayout);for(let[t,r]of Object.entries(e)){let e=o.getBufferLayout(t);if(!e){a||vN.log.warn(`Model(${this.id}): Missing layout for buffer "${t}".`)();continue}let i=o.getAttributeNamesForBuffer(e),n=!1;for(let e of i){let t=this._attributeInfos[e];if(t){let e="webgpu"===this.device.type?o.getBufferIndex(t.bufferName):t.location;this.vertexArray.setBuffer(e,r),n=!0}}n||a||vN.log.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${t}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[r,i]of Object.entries(e)){let e=this._attributeInfos[r];e?this.vertexArray.setConstantWebGL(e.location,i):(t?.disableWarnings??this.props.disableWarnings)||vN.log.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof Tv&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[t,r]of Object.entries(this.bindings))r instanceof Tv?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof Ai.TextureView?e=Math.max(e,t.texture.updateTimestamp):t instanceof Eq.Buffer||t instanceof Ar.Texture?e=Math.max(e,t.updateTimestamp):t instanceof Tv?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof An.Sampler||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(t=>t.name===e)||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(vN.log.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=(0,Ad.getAttributeInfosFromLayouts)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=vN.log.level>3?0:1e4;vN.log.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,vN.log.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:vN.log.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=function(e,t){let r={},i="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let t of e.attributes)if(t){let e=`${t.location} ${t.name}: ${t.type}`;r[`in ${e}`]={[i]:t.stepMode||"vertex"}}for(let t of e.varyings||[]){let e=`${t.location} ${t.name}`;r[`out ${e}`]={[i]:JSON.stringify(t)}}return r}(this.pipeline.shaderLayout,this.id);vN.log.table(2,e)();let t=this.shaderInputs.getDebugTable();vN.log.table(2,t)();let r=this._getAttributeDebugTable();vN.log.table(2,this._attributeInfos)(),vN.log.table(2,r)(),vN.log.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;let r=e.props.framebuffer;r&&function(e,{id:t,minimap:r,opaque:i,top:n="0",left:s="0",rgbaScale:a=1}){Th||((Th=document.createElement("canvas")).id=t,Th.title=t,Th.style.zIndex="100",Th.style.position="absolute",Th.style.top=n,Th.style.left=s,Th.style.border="blue 5px solid",Th.style.transform="scaleY(-1)",document.body.appendChild(Th),Td=Th.getContext("2d")),(Th.width!==e.width||Th.height!==e.height)&&(Th.width=e.width/2,Th.height=e.height/2,Th.style.width="400px",Th.style.height="400px");let o=e.device.readPixelsToArrayWebGL(e),l=Td?.createImageData(e.width,e.height);if(l){for(let e=0;e<o.length;e+=4)l.data[0+e+0]=o[e+0]*a,l.data[0+e+1]=o[e+1]*a,l.data[0+e+2]=o[e+2]*a,l.data[0+e+3]=i?255:o[e+3]*a;Td?.putImageData(l,0,0)}}(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,r]of Object.entries(this._attributeInfos)){let i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,r="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){let r=(0,EK.getTypedArrayConstructor)(t);return(e instanceof Eq.Buffer?new r(e.debugData):e).toString()}}class Tw{device;model;transformFeedback;static defaultProps={...Tx.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Tw.defaultProps){if(!Tw.isSupported(e))throw Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Tx(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||function(e){let{input:t,inputChannels:r,output:i}={};if(!t)return At;if(!r)throw Error("inputChannels");let n=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`invalid channels: ${e}`)}}(r),s=function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw Error(`invalid channels: ${t}`)}}(t,r);return`\
#version 300 es
in ${n} ${t};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(!t)throw Error("BufferTransform#getBuffer");if(t instanceof Eq.Buffer)return t.readAsync();let{buffer:r,byteOffset:i=0,byteLength:n=r.byteLength}=t;return r.readAsync(i,n)}}function T_(e,t=[],r=0){let i=Math.fround(e),n=e-i;return t[r]=i,t[r+1]=n,t}let Tk={name:"fp64arithmetic",vs:`\

uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:T_,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let n=4*r+i;T_(e[4*i+r],t,2*n)}return t}};function TP(e){let{source:t,target:r,start:i=0,size:n,getData:s}=e,a=e.end||r.length,o=t.length,l=a-i;if(o>l)return void r.set(t.subarray(0,l),i);if(r.set(t,i),!s)return;let c=o;for(;c<l;){let e=s(c,t);for(let t=0;t<n;t++)r[i+c]=e[t]||0,c++}}function TS(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`No defined attribute type for size "${e}"`)}}function TE(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw Error("invalid type size")}}function TA(e){e.push(e.shift())}function TM({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function TT({device:e,buffer:t,attribute:r,fromLength:i,toLength:n,fromStartIndices:s,getData:a=e=>e}){let o=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*o,c=r.byteOffset,u=r.settings.bytesPerElement<4?c/r.settings.bytesPerElement*4:c,h=r.startIndices,d=s&&h,f=r.isConstant;if(!d&&t&&i>=n)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=f?r.value:new p(r.getBuffer().readSyncWebGL(c,n*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!f){let e=a;a=(t,i)=>r.normalizeConstant(e(t,i))}let m=f?(e,t)=>a(g,t):(e,t)=>a(g.subarray(e+c,e+c+l),t),y=new Float32Array(t?t.readSyncWebGL(u,4*i).buffer:0),v=new Float32Array(n);return!function({source:e,target:t,size:r,getData:i,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return TP({source:e,target:t,size:r,getData:i});let a=0,o=0,l=i&&((e,t)=>i(e+o,t)),c=Math.min(n.length,s.length);for(let i=1;i<c;i++){let c=n[i]*r,u=s[i]*r;TP({source:e.subarray(a,c),target:t,start:o,end:u,size:r,getData:l}),a=c,o=u}o<t.length&&TP({source:[],target:t,start:o,size:r,getData:l})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<v.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:v.byteLength+u,usage:35050})),t.write(v,u),t}class TC{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Sh(r),this.attribute=t,this.attributeInTransition=function(e){let{device:t,settings:r,value:i}=e,n=new E9(t,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){let{doublePrecision:r,settings:i,value:n,size:s}=e,a=r&&n instanceof Float64Array?2:1,o=0,{shaderAttributes:l}=e.settings;if(l)for(let e of Object.values(l))o=Math.max(o,e.vertexOffset??0);return(i.noAlloc?n.length:(t+o)*s)*a}(this.attribute,t),this.transition.start({...e,duration:r})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){for(let e of(this.cancel(),this.buffers))e.destroy();this.buffers.length=0}}let TO={name:"interpolation",vs:`\
uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},TI=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,TL=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Tj(e){return e.doublePrecision&&e.value instanceof Float64Array}let TN={name:"spring",vs:`\
uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},TD=`\
#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,TR=`\
#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`,Tz={interpolation:class extends TC{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=function(e,t){let r=t.size,i=TS(r),n=TE(r),s=t.getBufferLayout();return Tj(t)?new Tw(e,{vs:TL,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[Tk,TO],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Tw(e,{vs:TI,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],modules:[TO],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();let{buffers:n,attribute:s}=this;TA(n),n[0]=TT({device:this.device,buffer:n[0],attribute:s,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),n[1]=TM({device:this.device,source:n[0],target:n[1]}),this.setBuffer(n[1]);let{transform:a}=this,o=a.model,l=Math.floor(this.currentLength/s.size);Tj(s)&&(l/=2),o.setVertexCount(l),s.isConstant?(o.setAttributes({aFrom:n[0]}),o.setConstantAttributes({aTo:s.value})):o.setAttributes({aFrom:n[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:n[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:r}=this.transition,i=r/e;t&&(i=t(i));let{model:n}=this.transform,s={time:i};n.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends TC{constructor({device:e,attribute:t,timeline:r}){var i,n;super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1}),this.framebuffer=(i=e,n=this.texture,i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[n]})),this.transform=function(e,t){let r=TS(t.size),i=TE(t.size);return new Tw(e,{vs:TD,fs:TR,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[TN],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;super.start(e,t);let{buffers:n,attribute:s}=this;for(let t=0;t<2;t++)n[t]=TT({device:this.device,buffer:n[t],attribute:s,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});n[2]=TM({device:this.device,source:n[0],target:n[2]}),this.setBuffer(n[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:r,transition:i}=this,n=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});let s={stiffness:n.stiffness,damping:n.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),TA(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class TF{constructor(e,{id:t,timeline:r}){if(!e)throw Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){for(let i in this.numInstances=r||1,e){let r=e[i],n=r.getTransitionSetting(t);n&&this._updateAttribute(i,r,n)}for(let r in this.transitions){let i=e[r];i&&i.getTransitionSetting(t)||this._removeTransition(r)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(let e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){let i=this.transitions[e],n=!i||i.type!==r.type;if(n){i&&this._removeTransition(e);let s=Tz[r.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(xh.error(`unsupported transition type '${r.type}'`)(),n=!1)}(n||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}let TB="attributeManager.invalidate";class TU{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=x6(P6),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new TF(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let r=this._invalidateTrigger(e,t);kO(TB,this,e,r)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);kO(TB,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:n={},buffers:s={},context:a={}}){let o=!1;for(let i in kO("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){let l=this.attributes[i],c=l.settings.accessor;l.startIndices=r,l.numInstances=t,n[i]&&xh.removed(`props.${i}`,`data.attributes.${i}`)(),l.setExternalBuffer(s[i])||l.setBinaryValue("string"==typeof c?s[c]:void 0,e.startIndices)||"string"==typeof c&&!s[c]&&l.setConstantValue(a,n[c])||l.needsUpdate()&&(o=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:n,context:a})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}o&&kO("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map(e=>this.attributes[e]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(let n in t){let s=t[n];s.needsRedraw(e)&&!r.hasAttribute(n)&&(i[n]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(let r in e){let i=e[r],n={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new E9(this.device,n)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:r,updateTriggers:i}=this,n=i[e];return n&&n.forEach(e=>{let i=r[e];i&&i.setNeedsUpdate(i.id,t)}),n}_updateAttribute(e){let{attribute:t,numInstances:r}=e;(kO("attribute.updateStart",t),t.constant)?t.setConstantValue(e.context,t.value):(t.allocate(r)&&kO("attribute.allocate",t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,kO("attribute.updateEnd",t,r)))}}function T$(e,t,r,i,n){let s=t-e;return(r-t)*n+-s*i+s+t}function TV(e,t){if(Array.isArray(e)){let r=0;for(let i=0;i<e.length;i++){let n=e[i]-t[i];r+=n*n}return Math.sqrt(r)}return Math.abs(e-t)}let TW={interpolation:class extends Sh{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:n}}=this,s=n(e/i);this._value=wv(t,r,s)}},spring:class extends Sh{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:n=e,_currValue:s=e}=this,a=function(e,t,r,i,n){if(Array.isArray(r)){let s=[];for(let a=0;a<r.length;a++)s[a]=T$(e[a],t[a],r[a],i,n);return s}return T$(e,t,r,i,n)}(n,s,t,r,i),o=TV(a,t),l=TV(a,s);o<1e-5&&l<1e-5&&(a=t,this.end()),this._prevValue=s,this._currValue=a}}};class TG{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){let{transitions:n}=this;if(n.has(e)){let r=n.get(e),{value:i=r.settings.fromValue}=r;t=i,this.remove(e)}if(!(i=E7(i)))return;let s=TW[i.type];if(!s)return void xh.error(`unsupported transition type '${i.type}'`)();let a=new s(this.timeline);a.start({...i,fromValue:t,toValue:r}),n.set(e,a)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}}function Tq({newProps:e,oldProps:t,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(t===e)return!1;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return`${n} changed shallowly`;for(let s of Object.keys(e))if(!(s in r)){if(!(s in t))return`${n}.${s} added`;let r=TH(e[s],t[s],i[s]);if(r)return`${n}.${s} ${r}`}for(let s of Object.keys(t))if(!(s in r)){if(!(s in e))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){let r=TH(e[s],t[s],i[s]);if(r)return`${n}.${s} ${r}`}}return!1}function TH(e,t,r){let i=r&&r.equal;return i&&!i(e,t,r)||!i&&(i=e&&t&&e.equals)&&!i.call(e,t)?"changed deeply":i||t===e?null:"changed shallowly"}function TK(e,t,r){let i=e.updateTriggers[r];i=null==i?{}:i;let n=t.updateTriggers[r];return Tq({oldProps:n=null==n?{}:n,newProps:i,triggerName:r})}function TZ(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){let e=r.modules.findIndex(e=>"project32"===e.name);e>=0&&r.modules.splice(e,1)}if("inject"in t)if(e.inject){let i={...e.inject};for(let e in t.inject)i[e]=(i[e]||"")+t.inject[e];r.inject=i}else r.inject=t.inject;return r}var _1=_1,xc=xc;let TY=[0,0,0];function TX(e,t,r=!1){let i=t.projectPosition(e);if(r&&t instanceof Su){let[r,n,s=0]=e,a=t.getDistanceScales([r,n]);i[2]=s*a.unitsPerMeter[2]}return i}function TJ(e,{viewport:t,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:s}){let[a,o,l=0]=e;switch(r&&([a,o,l]=xc.transformMat4([],[a,o,l,1],r)),i){case x1.LNGLAT:return TX([a,o,l],t,s);case x1.LNGLAT_OFFSETS:return TX([a+n[0],o+n[1],l+(n[2]||0)],t,s);case x1.METER_OFFSETS:return TX(kt(n,[a,o,l]),t,s);case x1.CARTESIAN:default:return t.isGeospatial?[a+n[0],o+n[1],l+n[2]]:t.projectPosition([a,o,l])}}let TQ={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},T0={},T1={boolean:{validate:(e,t)=>!0,equal:(e,t,r)=>!!e==!!t},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||T3(e)&&(3===e.length||4===e.length),equal:(e,t,r)=>Sn(e,t,1)},accessor:{validate(e,t){let r=T4(e);return"function"===r||r===T4(t.value)},equal:(e,t,r)=>"function"==typeof t||Sn(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||T3(e),equal(e,t,r){let{compare:i}=r,n=Number.isInteger(i)?i:+!!i;return i?Sn(e,t,n):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:i}=r,n=Number.isInteger(i)?i:+!!i;return i?Sn(e,t,n):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,r)=>!r.compare&&!1!==r.ignore||e===t},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:i}=r.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let i=r.context;return i&&i.device?function(e,t,r,i){if(r instanceof Ar.Texture)return r;r.constructor&&"Object"!==r.constructor.name&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let{width:s,height:a}=r.data,o=t.createTexture({...r,sampler:{...TQ,...n,...i},mipLevels:t.getMipLevelCount(s,a)});return o.generateMipmapsWebGL(),T0[o.id]=e,o}(r.id,i.device,e,{...t.parameters,...r.props.textureParameters}):null},release:(e,t,r)=>{var i;i=r.id,e&&e instanceof Ar.Texture&&T0[e.id]===i&&(e.delete(),delete T0[e.id])}}};function T2(e,t){return"type"in t?{name:e,...T1[t.type],...t}:"value"in t?{name:e,type:T4(t.value),...t}:{name:e,type:"object",value:t}}function T3(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function T4(e){return T3(e)?"array":null===e?"null":typeof e}function T5(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let T6=0;class T8{constructor(...e){this.props=function(e,t){let r;for(let e=t.length-1;e>=0;e--){let i=t[e];"extensions"in i&&(r=i.extensions)}let i=Object.create(function e(t,r){var i,n;if(!(t instanceof T7.constructor))return{};let s="_mergedDefaultProps";if(r)for(let e of r){let t=e.constructor;t&&(s+=`:${t.extensionName||t.name}`)}let a=T5(i=t,n=s)&&i[n];return a||(t[s]=function(t,r){var i;let n;if(!t.prototype)return null;let s=e(Object.getPrototypeOf(t)),a=function(e){let t={},r={},i={};for(let[n,s]of Object.entries(e)){let e=s?.deprecatedFor;if(e)i[n]=Array.isArray(e)?e:[e];else{let e=function(e,t){switch(T4(t)){case"object":return T2(e,t);case"array":return T2(e,{type:"array",value:t,compare:!1});case"boolean":return T2(e,{type:"boolean",value:t});case"number":return T2(e,{type:"number",value:t});case"function":return T2(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}(n,s);t[n]=e,r[n]=e.value}}return{propTypes:t,defaultProps:r,deprecatedProps:i}}(function(e,t){return T5(e,t)&&e[t]}(t,"defaultProps")||{}),o=Object.assign(Object.create(null),s,a.defaultProps),l=Object.assign(Object.create(null),s?.[kP],a.propTypes),c=Object.assign(Object.create(null),s?.[kS],a.deprecatedProps);for(let t of r){let r=e(t.constructor);r&&(Object.assign(o,r),Object.assign(l,r[kP]),Object.assign(c,r[kS]))}return Object.defineProperties(o,{id:{writable:!0,value:((n=(i=t).componentName)||xh.warn(`${i.name}.componentName not specified`)(),n||i.name)}}),function(e,t){let r={},i={};for(let e in t){let n=t[e],{name:s,value:a}=n;n.async&&(r[s]=a,i[s]=function(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||E3(t)?this[kA][e]=t:this[kM][e]=t},get(){if(this[kM]){if(e in this[kM])return this[kM][e]||this[kE][e];if(e in this[kA]){let t=this[kk]&&this[kk].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[kE][e]}}return this[kE][e]}}}(s))}e[kE]=r,e[kA]={},Object.defineProperties(e,i)}(o,l),function(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(e){let i=`${this.id}: ${r}`;for(let i of t[r])T5(this,i)||(this[i]=e);xh.deprecated(i,t[r].join("/"))()}})}(o,c),o[kP]=l,o[kS]=c,0!==r.length||T5(t,"_propTypes")||(t._propTypes=l),o}(t,r||[]))}(e.constructor,r));i[kk]=e,i[kA]={},i[kM]={};for(let e=0;e<t.length;++e){let r=t[e];for(let e in r)i[e]=r[e]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=T6++}clone(e){let{props:t}=this,r={};for(let e in t[kE])e in t[kM]?r[e]=t[kM][e]:e in t[kA]&&(r[e]=t[kA][e]);return new this.constructor({...t,...r,...e})}}T8.componentName="Component",T8.defaultProps={};let T7=T8,T9=Object.freeze({});class Ce{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||T9}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[kk]||this.component;let t=e[kM]||{},r=e[kA]||e,i=e[kE]||{};for(let e in t){let r=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,r),t[e]=this.getAsyncProp(e)}for(let e in r){let t=r[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise)return void this._watchPromise(e,t);if(E3(t))return void this._resolveAsyncIterable(e,t);this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps)for(let e in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}_didAsyncInputValueChange(e,t){let r=this.asyncProps[e];return t!==r.resolvedValue&&t!==r.lastValue&&(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){let i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let r=this.asyncProps[e];if(r){r.pendingLoadCount++;let i=r.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(r,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);let r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;let i=r.pendingLoadCount,n=[],s=0;for await(let r of t){if(!this.component)return;let{dataTransform:t}=this.component.props;Object.defineProperty(n=t?t(r,n):n.concat(r),"__diff",{enumerable:!1,value:[{startRow:s,endRow:n.length}]}),s=n.length,this._setAsyncPropValue(e,n,i)}this._onResolve(e,n)}_postProcessValue(e,t){let r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let r=this.component&&this.component.props[kP];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Ct extends Ce{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){let r=this.layer;if(r){let i=r.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){let r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}let Cr=Object.freeze([]),Ci=x6(({oldViewport:e,viewport:t})=>e.equals(t)),Cn=new Uint8ClampedArray(0),Cs={data:{type:"data",value:Cr,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:i,loadOptions:n,signal:s})=>{let{resourceManager:a}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let o=a.contains(e);return(o||n||(a.add({resourceId:e,data:PJ(e,i),persistent:!1}),o=!0),o)?a.subscribe({resourceId:e,onChange:e=>r.internalState?.reloadAsyncProp(t,e),consumerId:r.id,requestId:t}):PJ(e,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:x1.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-(100*e)]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ca extends T7{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){let e=this.constructor.layerName||this.constructor.name;return`${e}({id: '${this.props.id}'})`}project(e){Sg(this.internalState);let t=this.internalState.viewport||this.context.viewport,[r,i,n]=kn(TJ(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),t.pixelProjectionMatrix);return 2===e.length?[r,i]:[r,i,n]}unproject(e){return Sg(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return Sg(this.internalState),function(e,t){let{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=function(e){let{viewport:t,modelMatrix:r,coordinateOrigin:i}=e,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}=e;return n===x1.DEFAULT&&(n=t.isGeospatial?x1.LNGLAT:x1.CARTESIAN),void 0===s&&(s=n),void 0===a&&(a=i),{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:a}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=TY,shaderCoordinateOrigin:u=TY,offsetMode:h=!1}=l?wi(r,i,n):{},d=TJ(e,{viewport:r,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:h});if(h){let e=r.projectPosition(c||u);_1.sub(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===x1.DEFAULT||e===x1.LNGLAT||e===x1.CARTESIAN}onHover(e,t){return!!this.props.onHover&&(this.props.onHover(e,t)||!1)}onClick(e,t){return!!this.props.onClick&&(this.props.onClick(e,t)||!1)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Sg(e instanceof Uint8Array);let[t,r,i]=e;return t+256*r+65536*i-1}getNumInstances(){if(Number.isFinite(this.props.numInstances))return this.props.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;var e,t,r=this.props.data;if(null===(e=r)||"object"!=typeof e)throw Error("count(): argument not an object");if("function"==typeof r.count)return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(null!==(t=r)&&"object"==typeof t&&t.constructor===Object)return Object.keys(r).length;throw Error("count(): argument not a container")}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){for(let t of(e=TZ(e,{disableWarnings:!0,modules:this.context.defaultShaderModules}),this.props.extensions))e=TZ(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(let e of r)t.invalidateAll(e);else t.invalidateAll();if(t){let{props:r}=e,i=this.internalState.hasPickingBuffer,n=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==n){this.internalState.hasPickingBuffer=n;let{pickingColors:e,instancePickingColors:r}=t.attributes,i=e||r;i&&(n&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||n||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(let e of this.getModels())e.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){let{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,t&&Ci({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let r in e)e[r].layoutChanged()&&(t=!0);for(let r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),r=Object.create(this.props);for(let e in t)Object.defineProperty(r,e,{value:t[e]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let r=Math.floor(Cn.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>0xffffff&&xh.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")();let e=Math.floor((Cn=P1.allocate(Cn,t,{size:4,copy:!0,maxCount:Math.max(t,0xffffff)})).length/4),i=[0,0,0];for(let t=r;t<e;t++)this.encodePickingColor(t,i),Cn[4*t+0]=i[0],Cn[4*t+1]=i[1],Cn[4*t+2]=i[2],Cn[4*t+3]=0}e.value=Cn.subarray(0,4*t)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){let r=this.getAttributeManager();e.setBufferLayout(r.getBufferLayouts(e)),t=r.getAttributes()}let i=e.userData?.excludeAttributes||{},n={},s={};for(let r in t){if(i[r])continue;let a=t[r].getValue();for(let i in a){let o=a[i];o instanceof Eq.Buffer?t[r].settings.isIndexed?e.setIndexBuffer(o):n[i]=o:o&&(s[i]=o)}}e.setAttributes(n),e.setConstantAttributes(s)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i,s=n&&t.attributes&&t.attributes[n.id];if(s&&s.value){let r=s.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){let t=n.getVertexOffset(e);r[t]===i[0]&&r[t+1]===i[1]&&r[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;let n=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-n),n)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Cn.buffer&&(r.value=Cn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Sg(!this.internalState),Sg(Number.isFinite(this.props.coordinateSystem)),kO("layer.initialize",this);let e=this._getAttributeManager();for(let t of(e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Ct({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(xh.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new TG(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context),this.props.extensions))t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){kO("layer.matched",this,this===e);let{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(kO("layer.update",this,e),!e)return;let t=this.props,r=this.context,i=this.internalState,n=r.viewport,s=this._updateUniformTransition();i.propsInTransition=s,r.viewport=i.viewport||n,this.props=s;try{let e=this._getUpdateParams(),t=this.getModels();if(r.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(let t of this.props.extensions)t.updateState.call(this,e,t);this.setNeedsRedraw(),this._updateAttributes();let i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{r.viewport=n,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){for(let e of(kO("layer.finalize",this),this.finalizeState(this.context),this.props.extensions))e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();let n=this.props,s=this.context;this.props=this.internalState.propsInTransition||n;try{t&&this.setShaderModuleProps(t);let{getPolygonOffset:n}=this.props,a=n&&n(r)||[0,0];for(let e of(s.device instanceof EH.WebGLDevice&&s.device.setParametersWebGL({polygonOffset:a}),this.getModels()))"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(s.device instanceof EH.WebGLDevice)s.device.withParametersWebGL(i,()=>{let n={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:s};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)});else{let n={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:s};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)}}finally{this.props=n}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let r in e)if(e[r]){let i=!1;if("dataChanged"===r){let n=e[r],s=t[r];n&&Array.isArray(s)&&(t.dataChanged=Array.isArray(n)?s.concat(n):n,i=!0)}t[r]||(t[r]=e[r],i=!0),i&&kO("layer.changeFlag",this,r,e)}let r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let r,i,n,s=(r=Tq({newProps:e,oldProps:t,propTypes:e[kP],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:n}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&n&&(r=n(e.data,t.data)||r),r}(e,t),n=!1,i||(n=function(e,t){if(null===t||"all"in e.updateTriggers&&TK(e,t,"all"))return{all:!0};let r={},i=!1;for(let n in e.updateTriggers)"all"!==n&&TK(e,t,n)&&(r[n]=!0,i=!0);return!!i&&r}(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:function(e,t){if(null===t)return!0;let r=t.extensions,{extensions:i}=e;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(r[e]))return!0;return!1}(e,t),transitionsChanged:function(e,t){if(!e.transitions)return!1;let r={},i=e[kP],n=!1;for(let s in e.transitions){let a=i[s],o=a&&a.type;("number"===o||"color"===o||"array"===o)&&TH(e[s],t[s],a)&&(r[s]=!0,n=!0)}return!!n&&r}(e,t)});if(s.updateTriggersChanged)for(let e in s.updateTriggersChanged)s.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(s.transitionsChanged)for(let r in s.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],e.transitions?.[r]);return this.setChangeFlags(s)}validateProps(){!function(e){let t=e[kP];for(let r in t){let i=t[r],{validate:n}=i;if(n&&!n(e[r],i))throw Error(`Invalid prop ${r}: ${e[r]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&"function"==typeof r&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new TU(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:r,oldProps:i}=e,n=this.state.model;n?.isInstanced&&n.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:o}=r;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==a||i.highlightColor!==o){let e={};Array.isArray(o)&&(e.highlightColor=o),(t||i.autoHighlight!==s||a!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=this.internalState.needsRedraw&&this.id;let r=this.getAttributeManager(),i=!!r&&r.getNeedsRedraw(e);if(t=t||i)for(let e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ca.defaultProps=Cs,Ca.layerName="Layer";let Co=Ca,Cl={position:"absolute",zIndex:-1};function Cc(e){return e&&"object"==typeof e&&"type"in e||!1}let Cu=(0,Q.createContext)(),Ch={mixBlendMode:null};function Cd(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}let Cf=Q.forwardRef(function(e,t){let[r,i]=(0,Q.useState)(0),n=(0,Q.useRef)({control:null,version:r,forceUpdate:()=>i(e=>e+1)}).current,s=(0,Q.useRef)(null),a=(0,Q.useRef)(null),o=(0,Q.useMemo)(()=>(function({children:e,layers:t=[],views:r=null}){let i=[],n=[],s={};return Q.Children.forEach(function e(t){if("function"==typeof t)return(0,Q.createElement)(Sc,{},t);if(Array.isArray(t))return t.map(e);if(Cc(t)){if(t.type===Q.Fragment)return e(t.props.children);EG(t.type,Sc)}return t}(e),e=>{if(Cc(e)){let t=e.type;if(EG(t,Co)){let r=function(e,t){let r={},i=e.defaultProps||{};for(let e in t)i[e]!==t[e]&&(r[e]=t[e]);return new e(r)}(t,e.props);n.push(r)}else i.push(e);if(EG(t,Sc)&&t!==Sc&&e.props.id){let r=new t(e.props);s[r.id]=r}}else e&&i.push(e)}),Object.keys(s).length>0&&(Array.isArray(r)?r.forEach(e=>{s[e.id]=e}):r&&(s[r.id]=r),r=Object.values(s)),{layers:t=n.length>0?[...n,...t]:t,children:i,views:r}})(e),[e.layers,e.views,e.children]),l=!0,c=t=>l&&e.viewState?(n.viewStateUpdateRequested=t,null):(n.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),u=t=>{l?n.interactionStateUpdateRequested=t:(n.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},h=(0,Q.useMemo)(()=>{let t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:a.current,layers:o.layers,views:o.views,onViewStateChange:c,onInteractionStateChange:u};return delete t._customRender,n.deck&&n.deck.setProps(t),t},[e]);(0,Q.useEffect)(()=>{var t;let r;return r=new(e.Deck||EV)({...t={...h,parent:s.current,canvas:a.current},_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:e=>{n.redrawReason=e;let t=r.getViewports();n.lastRenderedViewports!==t?n.forceUpdate():Cd(n)}}),n.deck=r,()=>n.deck?.finalize()},[]),EW(()=>{Cd(n);let{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=n;e&&c(e),t&&u(t),n.deck?.isInitialized&&n.deck.redraw("Initial render")}),(0,Q.useImperativeHandle)(t,()=>({get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}),[]);let d=n.deck&&n.deck.isInitialized?n.deck.getViewports():void 0,{ContextProvider:f,width:p="100%",height:g="100%",id:m,style:y}=e,{containerStyle:v,canvasStyle:b}=(0,Q.useMemo)(()=>(function({width:e,height:t,style:r}){let i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},n={left:0,top:0};if(r)for(let e in r)e in Ch?n[e]=r[e]:i[e]=r[e];return{containerStyle:i,canvasStyle:n}})({width:p,height:g,style:y}),[p,g,y]);if(!n.viewStateUpdateRequested&&n.lastRenderedViewports===d||n.version!==r){n.lastRenderedViewports=d,n.version=r;let e=function({children:e,deck:t,ContextProvider:r=Cu.Provider}){let{viewManager:i}=t||{};if(!i||!i.views.length)return[];let n={},s=i.views[0].id;for(let t of e){let e=s,r=t;Cc(t)&&EG(t.type,Sc)&&(e=t.props.id||s,r=t.props.children);let a=i.getViewport(e),o=i.getViewState(e);if(a){o.padding=a.padding;let{x:t,y:i,width:s,height:l}=a;r=function e(t,r){if("function"==typeof t)return t(r);if(Array.isArray(t))return t.map(t=>e(t,r));if(Cc(t)){var i;if(i=t,i.props?.mapStyle)return r.style=Cl,(0,Q.cloneElement)(t,r);if(function(e){let t=e.type;return t&&t.deckGLViewProps}(t))return(0,Q.cloneElement)(t,r)}return t}(r,{x:t,y:i,width:s,height:l,viewport:a,viewState:o}),n[e]||(n[e]={viewport:a,children:[]}),n[e].children.push(r)}}return Object.keys(n).map(e=>{let{viewport:i,children:s}=n[e],{x:a,y:o,width:l,height:c}=i,u=`view-${e}`,h=(0,Q.createElement)("div",{key:u,id:u,style:{position:"absolute",left:a,top:o,width:l,height:c}},...s),d={deck:t,viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:r=>{r.viewId=e,t._onViewStateChange(r)},widgets:[]},f=`view-${e}-context`;return(0,Q.createElement)(r,{key:f,value:d},h)})}({children:o.children,deck:n.deck,ContextProvider:f}),t=(0,Q.createElement)("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:b});n.control=(0,Q.createElement)("div",{id:`${m||"deckgl"}-wrapper`,ref:s,style:v},[t,e])}return l=!1,n.control});class Cp{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:r=null,vertexCount:i=null}=e;for(const[i,n]of(this.id=e.id||Tn("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={},Object.entries(t))){const e=ArrayBuffer.isView(n)?{value:n}:n;if(!ArrayBuffer.isView(e.value))throw Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(let t of Object.values(e)){let{value:e,size:i,constant:n}=t;!n&&e&&void 0!==i&&i>=1&&(r=Math.min(r,e.length/i))}return r}}let Cg=`\
uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Cm={name:"scatterplot",vs:Cg,fs:Cg,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Cy=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Cv=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cb=`\
// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Cx=[0,0,0,255],Cw={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Cx},getLineColor:{type:"accessor",value:Cx},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class C_ extends Co{getShaders(){return super.getShaders({vs:Cy,fs:Cv,source:Cb,modules:[wp,vH,kb,Cm]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,stroked:s,filled:a,billboard:o,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,f={stroked:s,filled:a,billboard:o,antialiasing:l,radiusUnits:x3[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,lineWidthUnits:x3[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d},p=this.state.model;p.shaderInputs.setProps({scatterplot:f}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){let e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new Tx(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cp({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}C_.defaultProps=Cw,C_.layerName="ScatterplotLayer";let Ck=Math.PI/180,CP=23.4397*Ck;function CS(e,t,r){var i,n,s,a,o,l,c;let u,h,d,f,{azimuth:p,altitude:g}=(u=Ck*t,d=function(e){var t;let r,i=(t=Ck*(357.5291+.98560028*e),r=Ck*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t)),t+r+102.9372*Ck+Math.PI);return{declination:Math.asin(0*Math.cos(CP)+Math.sin(CP)*Math.sin(i)),rightAscension:Math.atan2(Math.sin(i)*Math.cos(CP)-Math.tan(0)*Math.sin(CP),Math.cos(i))}}(h=function(e){return("number"==typeof e?e:e.getTime())/864e5-.5+2440588-2451545}(e)),{azimuth:Math.atan2(Math.sin(s=f=(i=h,n=-(Ck*r),Ck*(280.147+360.9856235*i)-n-d.rightAscension)),Math.cos(s)*Math.sin(a=u)-Math.tan(d.declination)*Math.cos(a)),altitude:(o=f,Math.asin(Math.sin(l=u)*Math.sin(c=d.declination)+Math.cos(l)*Math.cos(c)*Math.cos(o)))});return[Math.sin(p)*Math.cos(g),Math.cos(p)*Math.cos(g),-Math.sin(g)]}let CE=new Uint32Array([0,2,1,0,3,2]),CA=new Float32Array([0,1,0,0,1,0,1,1]),CM=`\
uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,CT={name:"bitmap",vs:CM,fs:CM,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},CC=`\
#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,CO=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,CI=`\
#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${CO}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,CL={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:x1.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Cj extends Co{getShaders(){return super.getShaders({vs:CC,fs:CI,modules:[wp,kb,CT]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]),e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:!0},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:!0},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:!0}})}updateState({props:e,oldProps:t,changeFlags:r}){let i=this.getAttributeManager();if(r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==t.bounds){let e=this.state.mesh,t=this._createMesh();for(let r in this.state.model.setVertexCount(t.vertexCount),t)e&&e[r]!==t[r]&&i.invalidate(r);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;let{width:i,height:n}=t;r.index=0;let s=function(e){let[t,r,i]=e;return[(t+(15&i)/16)/256,(r+(240&i)/256)/256]}(r.color);return r.bitmap={size:{width:i,height:n},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*n)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,t=e;return CN(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),function(e,t){if(!t){var r,i,n,s=e;let t=new Float64Array(12);for(let e=0;e<s.length;e++)t[3*e+0]=s[e][0],t[3*e+1]=s[e][1],t[3*e+2]=s[e][2]||0;return{vertexCount:6,positions:t,indices:CE,texCoords:CA}}let a=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),o=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),l=Math.ceil(a/t)+1,c=Math.ceil(o/t)+1,u=(l-1)*(c-1)*6,h=new Uint32Array(u),d=new Float32Array(l*c*2),f=new Float64Array(l*c*3),p=0,g=0;for(let t=0;t<l;t++){let s=t/(l-1);for(let a=0;a<c;a++){let o=a/(c-1),l=(r=e,i=s,n=o,wv(wv(r[0],r[1],n),wv(r[3],r[2],n),i));f[3*p+0]=l[0],f[3*p+1]=l[1],f[3*p+2]=l[2]||0,d[2*p+0]=s,d[2*p+1]=1-o,t>0&&a>0&&(h[g++]=p-c,h[g++]=p-c-1,h[g++]=p-1,h[g++]=p-c,h[g++]=p-1,h[g++]=p),p++}}return{vertexCount:u,positions:f,indices:h,texCoords:d}}(t,this.context.viewport.resolution)}_getModel(){return new Tx(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:t}=e,{model:r,coordinateConversion:i,bounds:n,disablePicking:s}=this.state,{image:a,desaturate:o,transparentColor:l,tintColor:c}=this.props;if((!t.picking.isActive||!s)&&a&&r){let e={bitmapTexture:a,bounds:n,coordinateConversion:i,desaturate:o,tintColor:c.slice(0,3).map(e=>e/255),transparentColor:l.map(e=>e/255)};r.shaderInputs.setProps({bitmap:e}),r.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=x1,{_imageCoordinateSystem:i}=this.props;if(i!==r){let{bounds:r}=this.props;if(!CN(r))throw Error("_imageCoordinateSystem only supports rectangular bounds");let n=this.context.viewport.resolution?e:t;if((i=i===e?e:t)===e&&n===t)return{coordinateConversion:-1,bounds:r};if(i===t&&n===e){let e=_8([r[0],r[1]]),t=_8([r[2],r[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function CN(e){return Number.isFinite(e[0])}Cj.layerName="BitmapLayer",Cj.defaultProps=CL;class CD extends Co{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if("function"==typeof e){let t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){let{opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:o,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m,_subLayerProps:y}=this.props,v={id:"",updateTriggers:{},opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:o,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m},b=y&&e.id&&y[e.id],x=b&&b.updateTriggers,w=e.id||"sublayer";if(b){let t=this.props[kP],r=e.type?e.type._propTypes:{};for(let e in b){let i=r[e]||t[e];i&&"accessor"===i.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}for(let t of(Object.assign(v,e,b),v.id=`${this.props.id}-${w}`,v.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...x},p)){let e=t.getSubLayerProps.call(this,t);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers,i=!r||this.needsUpdate();for(let e of(i&&(r=kI(this.renderLayers(),Boolean),this.internalState.subLayers=r),kO("compositeLayer.renderLayers",this,i,r),r))e.parent=this}}CD.layerName="CompositeLayer";let CR=CD,Cz=`\
uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,CF={name:"icon",vs:Cz,fs:Cz,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},CB=`\
#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,CU=`\
#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,C$=()=>{},CV={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},CW={x:0,y:0,width:0,height:0};function CG(e){return e&&(e.id||e.url)}function Cq(e,t,r){for(let i=0;i<t.length;i++){let{icon:n,xOffset:s}=t[i];e[CG(n)]={...n,x:s,y:r}}}class CH{constructor(e,{onUpdate:t=C$,onError:r=C$}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let t=this._autoPacking?CG(e):e;return this._mapping[t]||CW}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,textureParameters:n}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),i&&(this._mapping=i),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),n&&(this._samplerParameters=n)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"==typeof document)return;let r=Object.values(function(e,t,r){if(!e||!t)return null;r=r||{};let i={},{iterable:n,objectInfo:s}=E2(e);for(let e of n){s.index++;let n=t(e,s),a=CG(n);if(!n)throw Error("Icon is missing.");if(!n.url)throw Error("Icon url is missing.");i[a]||r[a]&&n.url===r[a].url||(i[a]={...n,source:e,sourceIndex:s.index})}return i}(e,t,this._mapping)||{});if(r.length>0){let{mapping:e,xOffset:t,yOffset:i,rowHeight:n,canvasHeight:s}=function({icons:e,buffer:t,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:s=0,canvasWidth:a}){let o=[];for(let l=0;l<e.length;l++){let c=e[l];if(!r[CG(c)]){let{height:e,width:l}=c;i+l+t>a&&(Cq(r,o,n),i=0,n=s+n+t,s=0,o=[]),o.push({icon:c,xOffset:i}),i=i+l+t,s=Math.max(s,e)}}return o.length>0&&Cq(r,o,n),{mapping:r,rowHeight:s,xOffset:i,yOffset:n,canvasWidth:a,canvasHeight:Math.pow(2,Math.ceil(Math.log2(s+n+t)))}}({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=n,this._mapping=e,this._xOffset=t,this._yOffset=i,this._canvasHeight=s,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||CV,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,r,i){let{width:n,height:s,device:a}=e,o=a.createTexture({format:"rgba8unorm",width:t,height:r,sampler:i,mipLevels:a.getMipLevelCount(t,r)}),l=a.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:e,destinationTexture:o,width:n,height:s}),l.finish(),o.generateMipmapsWebGL(),e.destroy(),o}(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||CV)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r),this._texture?.generateMipmapsWebGL()}}_loadIcons(e){let t=this._canvas.getContext("2d",{willReadFrequently:!0});for(let r of e)this._pendingCount++,PJ(r.url,this._loadOptions).then(e=>{let i=CG(r),n=this._mapping[i],{x:s,y:a,width:o,height:l}=n,{image:c,width:u,height:h}=function(e,t,r,i){let n=Math.min(r/t.width,i/t.height),s=Math.floor(t.width*n),a=Math.floor(t.height*n);return 1===n?{image:t,width:s,height:a}:(e.canvas.height=a,e.canvas.width=s,e.clearRect(0,0,s,a),e.drawImage(t,0,0,t.width,t.height,0,0,s,a),{image:e.canvas,width:s,height:a})}(t,e,o,l);this._texture?.copyExternalImage({image:c,x:s+(o-u)/2,y:a+(l-h)/2,width:u,height:h}),n.width=u,n.height=h,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(e=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:e})}).finally(()=>{this._pendingCount--})}}let CK=[0,0,0,255],CZ={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:CK},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class CY extends Co{getShaders(){return super.getShaders({vs:CB,fs:CU,modules:[wp,kb,CF]})}initializeState(){this.state={iconManager:new CH(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:CK},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:t,oldProps:r,changeFlags:i}=e,n=this.getAttributeManager(),{iconAtlas:s,iconMapping:a,data:o,getIcon:l,textureParameters:c}=t,{iconManager:u}=this.state;if("string"==typeof s)return;let h=s||this.internalState.isAsyncPropLoading("iconAtlas");u.setProps({loadOptions:t.loadOptions,autoPacking:!h,iconAtlas:s,iconMapping:h?a:null,textureParameters:c}),h?r.iconMapping!==t.iconMapping&&n.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&u.packIcons(o,l),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:t,sizeBasis:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:s,billboard:a,alphaCutoff:o}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){let e=this.state.model,l={iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:x3[s],sizeScale:t,sizeBasis:+("height"===r),sizeMinPixels:i,sizeMaxPixels:n,billboard:a,alphaCutoff:o};e.shaderInputs.setProps({icon:l}),e.draw(this.context.renderPass)}}_getModel(){return new Tx(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cp({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let t=this.getCurrentLayer()?.props.onIconError;t?t(e):xh.error(e.error.message)()}getInstanceOffset(e){let{width:t,height:r,anchorX:i=t/2,anchorY:n=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,r/2-n]}getInstanceColorMode(e){return+!!this.state.iconManager.getIconMapping(e).mask}getInstanceIconFrame(e){let{x:t,y:r,width:i,height:n}=this.state.iconManager.getIconMapping(e);return[t,r,i,n]}}CY.defaultProps=CZ,CY.layerName="IconLayer";let CX=CY,CJ=`\
uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,CQ={name:"sdf",vs:CJ,fs:CJ,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},C0=`\
#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,C1=[];class C2 extends CX{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,CQ],fs:C0}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:r})=>this.encodePickingColor(t,r)}})}updateState(e){super.updateState(e);let{props:t,oldProps:r}=e,{outlineColor:i}=t;i!==r.outlineColor&&((i=i.map(e=>e/255))[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&xh.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:t,smoothing:r,outlineWidth:i}=this.props,{outlineColor:n}=this.state,s=i?Math.max(r,.75*(1-i)):-1,a=this.state.model,o={buffer:.75,outlineBuffer:s,gamma:r,enabled:!!t,outlineColor:n};if(a.shaderInputs.setProps({sdf:o}),super.draw(e),t&&i){let{iconManager:e}=this.state;e.getTexture()&&(a.shaderInputs.setProps({sdf:{...o,outlineBuffer:.75}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(e=>super.getInstanceOffset(e)):C1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(e=>super.getInstanceIconFrame(e)):C1}}C2.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},C2.layerName="MultiIconLayer";class C3{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:n="sans-serif",fontWeight:s="normal",fontStyle:a="normal",lang:o=null}={}){this.buffer=t,this.cutoff=i,this.radius=r,this.lang=o;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${s} ${e}px ${n}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:n,actualBoundingBoxRight:s}=this.ctx.measureText(e),a=Math.ceil(r),o=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-n))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),c=o+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:o,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return f;let{ctx:p,buffer:g,gridInner:m,gridOuter:y}=this;this.lang&&(p.lang=this.lang),p.clearRect(g,g,o,l),p.fillText(e,g,g+a);let v=p.getImageData(g,g,o,l);y.fill(1e20,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<o;t++){let r=v.data[4*(e*o+t)+3]/255;if(0===r)continue;let i=(e+g)*c+t+g;if(1===r)y[i]=0,m[i]=1e20;else{let e=.5-r;y[i]=e>0?e*e:0,m[i]=e<0?e*e:0}}C4(y,0,0,c,u,c,this.f,this.v,this.z),C4(m,g,g,o,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){let t=Math.sqrt(y[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}}function C4(e,t,r,i,n,s,a,o,l){for(let c=t;c<t+i;c++)C5(e,r*s+c,s,n,a,o,l);for(let c=r;c<r+n;c++)C5(e,c*s+t,1,i,a,o,l)}function C5(e,t,r,i,n,s,a){s[0]=0,a[0]=-1e20,a[1]=1e20,n[0]=e[t];for(let o=1,l=0,c=0;o<i;o++){n[o]=e[t+o*r];let i=o*o;do{let e=s[l];c=(n[o]-n[e]+i-e*e)/(o-e)/2}while(c<=a[l]&&--l>-1)s[++l]=o,a[l]=c,a[l+1]=1e20}for(let o=0,l=0;o<i;o++){for(;a[l+1]<o;)l++;let i=s[l],c=o-i;e[t+o*r]=n[i]+c*c}}let C6=[];function C8(e,t,r,i){let n=0;for(let s=t;s<r;s++){let t=e[s];n+=i[t]?.layoutWidth||0}return n}function C7(e,t,r,i,n,s){let a=t,o=0;for(let l=t;l<r;l++){let t=C8(e,l,l+1,n);o+t>i&&(a<l&&s.push(l),a=l,o=0),o+=t}return o}class C9{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?this.delete(e):Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e)}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}let Oe={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Ot=new C9(3);function Or(e,t,r,i){e.font=`${i} ${r}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class Oi{constructor(){this.props={...Oe}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let t=function(e,t){let r;r=new Set("string"==typeof t?Array.from(t):t);let i=Ot.get(e);if(!i)return r;for(let e in i.mapping)r.has(e)&&r.delete(e);return r}(this._key,this.props.characterSet),r=Ot.get(this._key);if(r&&0===t.size){this._atlas!==r&&(this._atlas=r);return}let i=this._generateFontAtlas(t,r);this._atlas=i,Ot.set(this._key,i)}_generateFontAtlas(e,t){let{fontFamily:r,fontWeight:i,fontSize:n,buffer:s,sdf:a,radius:o,cutoff:l}=this.props,c=t&&t.data;c||((c=document.createElement("canvas")).width=1024);let u=c.getContext("2d",{willReadFrequently:!0});Or(u,r,n,i);let{mapping:h,canvasHeight:d,xOffset:f,yOffset:p}=function({characterSet:e,getFontWidth:t,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:s={},xOffset:a=0,yOffset:o=0}){let l=0,c=a,u=r+2*i;for(let a of e)if(!s[a]){let e=t(a);c+e+2*i>n&&(c=0,l++),s[a]={x:c+i,y:o+l*u+i,width:e,height:u,layoutWidth:e,layoutHeight:r},c+=e+2*i}return{mapping:s,xOffset:c,yOffset:o+l*u,canvasHeight:Math.pow(2,Math.ceil(Math.log2(o+(l+1)*u)))}}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*n,buffer:s,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(c.height!==d){let e=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(e,0,0)}if(Or(u,r,n,i),a){let t=new C3({fontSize:n,buffer:s,radius:o,cutoff:l,fontFamily:r,fontWeight:`${i}`});for(let r of e){let{data:e,width:i,height:s,glyphTop:a}=t.draw(r);h[r].width=i,h[r].layoutOffsetY=.9*n-a;let o=u.createImageData(i,s);for(let t=0;t<e.length;t++)o.data[4*t+3]=e[t];u.putImageData(o,h[r].x,h[r].y)}}else for(let t of e)u.fillText(t,h[t].x,h[t].y+s+.9*n);return{xOffset:f,yOffset:p,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){let{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:n,radius:s,cutoff:a}=this.props;return n?`${e} ${t} ${r} ${i} ${s} ${a}`:`${e} ${t} ${r} ${i}`}}let On=`\
uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Os={name:"textBackground",vs:On,fs:On,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},Oa=`\
#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Oo=`\
#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ol={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Oc extends Co{getShaders(){return super.getShaders({vs:Oa,fs:Oo,modules:[wp,kb,Os]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:n,sizeMaxPixels:s,getLineWidth:a}=this.props,{padding:o,borderRadius:l}=this.props;o.length<4&&(o=[o[0],o[1],o[0],o[1]]),Array.isArray(l)||(l=[l,l,l,l]);let c=this.state.model,u={billboard:t,stroked:!!a,borderRadius:l,padding:o,sizeUnits:x3[i],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:s};c.shaderInputs.setProps({textBackground:u}),c.draw(this.context.renderPass)}_getModel(){return new Tx(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cp({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,0,1,1,1])}}}),isInstanced:!0})}}Oc.defaultProps=Ol,Oc.layerName="TextBackgroundLayer";let Ou={start:1,middle:0,end:-1},Oh={top:1,center:0,bottom:-1},Od=[0,0,0,255],Of={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Od},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Oe.characterSet},fontFamily:Oe.fontFamily,fontWeight:Oe.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Od},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:Od},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Op extends CR{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,i]}=this.transformParagraph(e,t),{fontSize:n}=this.state.fontAtlasManager.props;r/=n,i/=n;let{getTextAnchor:s,getAlignmentBaseline:a}=this.props;return[(Ou["function"==typeof s?s(e,t):s]-1)*r/2,(Oh["function"==typeof a?a(e,t):a]-1)*i/2,r,i]},this.getIconOffsets=(e,t)=>{let{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:n,y:s,rowWidth:a,size:[o,l]}=this.transformParagraph(e,t),c=Ou["function"==typeof r?r(e,t):r],u=Oh["function"==typeof i?i(e,t):i],h=n.length,d=Array(2*h),f=0;for(let e=0;e<h;e++){let t=(1-c)*(o-a[e])/2;d[f++]=(c-1)*o/2+t+n[e],d[f++]=(u-1)*l/2+s[e]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Oi},this.props.maxWidth>0&&xh.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:t,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:n}=this.state,s={...e,characterSet:n,fontFamily:t,fontWeight:r};if(!i.mapping)return i.setProps(s),!0;for(let e in s)if(s[e]!==i.props[e])return i.setProps(s),!0;return!1}_updateText(){let e,{data:t,characterSet:r}=this.props,i=t.attributes?.getText,{getText:n}=this.props,s=t.startIndices,a="auto"===r&&new Set;if(i&&s){let{texts:r,characterCount:o}=function({value:e,length:t,stride:r,offset:i,startIndices:n,characterSet:s}){let a=e.BYTES_PER_ELEMENT,o=r?r/a:1,l=i?i/a:0,c=n[t]||Math.ceil((e.length-l)/o),u=s&&new Set,h=Array(t),d=e;if(o>1||l>0){d=new e.constructor(c);for(let t=0;t<c;t++)d[t]=e[t*o+l]}for(let e=0;e<t;e++){let t=n[e],r=n[e+1]||c,i=d.subarray(t,r);h[e]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(let e of u)s.add(String.fromCodePoint(e));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:s,characterSet:a});e=o,n=(e,{index:t})=>r[t]}else{let{iterable:r,objectInfo:i}=E2(t);for(let t of(s=[0],e=0,r)){i.index++;let r=Array.from(n(t,i)||"");a&&r.forEach(a.add,a),e+=r.length,s.push(e)}}this.setState({getText:n,startIndices:s,numInstances:e,characterSet:a||r})}transformParagraph(e,t){let{fontAtlasManager:r}=this.state,i=r.mapping,n=this.state.getText,{wordBreak:s,lineHeight:a,maxWidth:o}=this.props;return function(e,t,r,i,n){let s=Array.from(e),a=s.length,o=Array(a),l=Array(a),c=Array(a),u=("break-word"===r||"break-all"===r)&&isFinite(i)&&i>0,h=[0,0],d=[0,0],f=0,p=0,g=0;for(let e=0;e<=a;e++){let m=s[e];if(("\n"===m||e===a)&&(g=e),g>p){let e=u?function(e,t,r,i,n=0,s){void 0===s&&(s=e.length);let a=[];return"break-all"===t?C7(e,n,s,r,i,a):!function(e,t,r,i,n,s){let a=t,o=t,l=t,c=0;for(let u=t;u<r;u++)if(" "===e[u]?l=u+1:(" "===e[u+1]||u+1===r)&&(l=u+1),l>o){let t=C8(e,o,l,n);c+t>i&&(a<o&&(s.push(o),a=o,c=0),t>i&&(t=C7(e,o,l,i,n,s),a=s[s.length-1])),o=l,c+=t}}(e,n,s,r,i,a),a}(s,r,i,n,p,g):C6;for(let r=0;r<=e.length;r++){let i=0===r?p:e[r-1],a=r<e.length?e[r]:g;!function(e,t,r,i,n,s){let a=0,o=0;for(let s=t;s<r;s++){let t=e[s],r=i[t];r?(o||(o=r.layoutHeight),n[s]=a+r.layoutWidth/2,a+=r.layoutWidth):(xh.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),n[s]=a,a+=32)}s[0]=a,s[1]=o}(s,i,a,n,o,d);for(let e=i;e<a;e++){let t=s[e],r=n[t]?.layoutOffsetY||0;l[e]=f+d[1]/2+r,c[e]=d[0]}f+=d[1]*t,h[0]=Math.max(h[0],d[0])}p=g}"\n"===m&&(o[p]=0,l[p]=0,c[p]=0,p++)}return h[1]=f,{x:o,y:l,rowWidth:c,size:h}}(n(e,t)||"",a,s,o*r.props.fontSize,i)}renderLayers(){let{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,atlas:n,mapping:s},styleVersion:a}=this.state,{data:o,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:g,getBorderWidth:m,backgroundBorderRadius:y,backgroundPadding:v,background:b,billboard:x,fontSettings:w,outlineWidth:_,outlineColor:k,sizeScale:P,sizeUnits:S,sizeMinPixels:E,sizeMaxPixels:A,transitions:M,updateTriggers:T}=this.props,C=this.getSubLayerClass("characters",C2),O=this.getSubLayerClass("background",Oc);return[b&&new O({getFillColor:p,getLineColor:g,getLineWidth:m,borderRadius:y,padding:v,getPosition:c,getSize:h,getAngle:d,getPixelOffset:f,billboard:x,sizeScale:P,sizeUnits:S,sizeMinPixels:E,sizeMaxPixels:A,transitions:M&&{getPosition:M.getPosition,getAngle:M.getAngle,getSize:M.getSize,getFillColor:M.getBackgroundColor,getLineColor:M.getBorderColor,getLineWidth:M.getBorderWidth,getPixelOffset:M.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:T.getPosition,getAngle:T.getAngle,getSize:T.getSize,getFillColor:T.getBackgroundColor,getLineColor:T.getBorderColor,getLineWidth:T.getBorderWidth,getPixelOffset:T.getPixelOffset,getBoundingRect:{getText:T.getText,getTextAnchor:T.getTextAnchor,getAlignmentBaseline:T.getAlignmentBaseline,styleVersion:a}}}),{data:o.attributes&&o.attributes.background?{length:o.length,attributes:o.attributes.background}:o,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new C({sdf:w.sdf,smoothing:Number.isFinite(w.smoothing)?w.smoothing:Oe.smoothing,outlineWidth:_/(w.radius||Oe.radius),outlineColor:k,iconAtlas:n,iconMapping:s,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,billboard:x,sizeScale:P*i,sizeUnits:S,sizeMinPixels:E*i,sizeMaxPixels:A*i,transitions:M&&{getPosition:M.getPosition,getAngle:M.getAngle,getColor:M.getColor,getSize:M.getSize,getPixelOffset:M.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:T.getText,getPosition:T.getPosition,getAngle:T.getAngle,getColor:T.getColor,getSize:T.getSize,getPixelOffset:T.getPixelOffset,getIconOffsets:{getTextAnchor:T.getTextAnchor,getAlignmentBaseline:T.getAlignmentBaseline,styleVersion:a}}}),{data:o,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){xh.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),Ot=new C9(e)}}Op.defaultProps=Of,Op.layerName="TextLayer";class Og{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=P1,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:t,buffers:r={},getGeometry:i,geometryBuffer:n,positionFormat:s,dataChanged:a,normalize:o=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=n&&n.size||("XY"===s?2:3),this.buffers=r,this.normalize=o,n&&(Sg(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(n),o||(r.vertexPositions=n)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(let e of a)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){let t=e.value||e;return ArrayBuffer.isView(t)?E4(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){let{attributes:r,buffers:i,_attributeDefs:n,typedArrayManager:s}=this;for(let a in n)if(a in i)s.release(r[a]),r[a]=null;else{let i=n[a];i.copy=t,r[a]=s.allocate(r[a],e,i)}}_forEachGeometry(e,t,r){let{data:i,getGeometry:n}=this,{iterable:s,objectInfo:a}=E2(i,t,r);for(let t of s)a.index++,e(n?n(t,a):null,a.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:i}=this,{data:n,geometryBuffer:s}=this,{startRow:a=0,endRow:o=1/0}=e||{},l={};if(e||(t=[0],r=[0]),this.normalize||!s)this._forEachGeometry((e,t)=>{let i=e&&this.normalizeGeometry(e);l[t]=i,r[t+1]=r[t]+(i?this.getGeometrySize(i):0)},a,o),i=r[r.length-1];else if(i=(r=n.startIndices)[n.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Eq.Buffer){let e=4*this.positionSize;i=i||s.byteLength/e}else if(s.buffer){let e=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/e}else if(s.value){let e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=i;let c={};this._forEachGeometry((e,n)=>{let s=l[n]||e;c.vertexStart=r[n],c.indexStart=t[n],c.geometrySize=(n<r.length-1?r[n+1]:i)-r[n],c.geometryIndex=n,this.updateGeometryAttributes(s,c)},a,o),this.vertexCount=t[t.length-1]}}function Om(e,t,r={}){return function(e,t={}){return Math.sign(function(e,t={}){let{start:r=0,end:i=e.length,plane:n="xy"}=t,s=t.size||2,a=0,o=Oy[n[0]],l=Oy[n[1]];for(let t=r,n=i-s;t<i;t+=s)a+=(e[t+o]-e[n+o])*(e[t+l]+e[n+l]),n=t;return a/2}(e,t))}(e,r)!==t&&(function(e,t){let{start:r=0,end:i=e.length,size:n=2}=t,s=(i-r)/n,a=Math.floor(s/2);for(let t=0;t<a;++t){let i=r+t*n,a=r+(s-1-t)*n;for(let t=0;t<n;++t){let r=e[i+t];e[i+t]=e[a+t],e[a+t]=r}}}(e,r),!0)}let Oy={x:0,y:1,z:2};function Ov(e,t){let r=t.length,i=e.length;if(i>0){let n=!0;for(let s=0;s<r;s++)if(e[i-r+s]!==t[s]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)e[i+n]=t[n];return!0}function Ob(e,t){let r=t.length;for(let i=0;i<r;i++)e[i]=t[i]}function Ox(e,t,r,i,n=[]){let s=i+t*r;for(let t=0;t<r;t++)n[t]=e[s+t];return n}function Ow(e,t,r,i,n=[]){let s,a;if(8&r)s=(i[3]-e[1])/(t[1]-e[1]),a=3;else if(4&r)s=(i[1]-e[1])/(t[1]-e[1]),a=1;else if(2&r)s=(i[2]-e[0])/(t[0]-e[0]),a=2;else{if(!(1&r))return null;s=(i[0]-e[0])/(t[0]-e[0]),a=0}for(let r=0;r<e.length;r++)n[r]=(1&a)===r?i[a]:s*(t[r]-e[r])+e[r];return n}function O_(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function Ok(e,t){let r,i,{size:n=2,broken:s=!1,gridResolution:a=10,gridOffset:o=[0,0],startIndex:l=0,endIndex:c=e.length}=t||{},u=(c-l)/n,h=[],d=[h],f=Ox(e,0,n,l),p=OE(f,a,o,[]),g=[];Ov(h,f);for(let t=1;t<u;t++){for(i=O_(r=Ox(e,t,n,l,r),p);i;){var m,y,v;Ow(f,r,i,p,g);let e=O_(g,p);e&&(Ow(f,g,e,p,g),i=e),Ov(h,g),Ob(f,g),m=p,y=a,8&(v=i)?(m[1]+=y,m[3]+=y):4&v?(m[1]-=y,m[3]-=y):2&v?(m[0]+=y,m[2]+=y):1&v&&(m[0]-=y,m[2]-=y),s&&h.length>n&&(h=[],d.push(h),Ov(h,f)),i=O_(r,p)}Ov(h,r),Ob(f,r)}return s?d:d[0]}function OP(e,t=null,r){if(!e.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:a=!1}=r||{},o=[],l=[{pos:e,types:a?Array(e.length/i).fill(1):null,holes:t||[]}],c=[[],[]],u=[];for(;l.length;){let{pos:e,types:t,holes:r}=l.shift();(function(e,t,r,i){let n=1/0,s=-1/0,a=1/0,o=-1/0;for(let i=0;i<r;i+=t){let t=e[i],r=e[i+1];n=t<n?t:n,s=t>s?t:s,a=r<a?r:a,o=r>o?r:o}i[0][0]=n,i[0][1]=a,i[1][0]=s,i[1][1]=o})(e,i,r[0]||e.length,c),u=OE(c[0],n,s,u);let h=O_(c[1],u);if(h){let n=OS(e,t,i,0,r[0]||e.length,u,h),s={pos:n[0].pos,types:n[0].types,holes:[]},o={pos:n[1].pos,types:n[1].types,holes:[]};l.push(s,o);for(let l=0;l<r.length;l++)(n=OS(e,t,i,r[l],r[l+1]||e.length,u,h))[0]&&(s.holes.push(s.pos.length),s.pos=OA(s.pos,n[0].pos),a&&(s.types=OA(s.types,n[0].types))),n[1]&&(o.holes.push(o.pos.length),o.pos=OA(o.pos,n[1].pos),a&&(o.types=OA(o.types,n[1].types)))}else{let i={positions:e};a&&(i.edgeTypes=t),r.length&&(i.holeIndices=r),o.push(i)}}return o}function OS(e,t,r,i,n,s,a){let o,l,c,u=(n-i)/r,h=[],d=[],f=[],p=[],g=[],m=Ox(e,u-1,r,i),y=Math.sign(8&a?m[1]-s[3]:m[0]-s[2]),v=t&&t[u-1],b=0,x=0;for(let n=0;n<u;n++)o=Ox(e,n,r,i,o),l=Math.sign(8&a?o[1]-s[3]:o[0]-s[2]),c=t&&t[i/r+n],l&&y&&y!==l&&(Ow(m,o,a,s,g),Ov(h,g)&&f.push(v),Ov(d,g)&&p.push(v)),l<=0?(Ov(h,o)&&f.push(c),b-=l):f.length&&(f[f.length-1]=0),l>=0?(Ov(d,o)&&p.push(c),x+=l):p.length&&(p[p.length-1]=0),Ob(m,o),y=l,v=c;return[b?{pos:h,types:t&&f}:null,x?{pos:d,types:t&&p}:null]}function OE(e,t,r,i){let n=Math.floor((e[0]-r[0])/t)*t+r[0],s=Math.floor((e[1]-r[1])/t)*t+r[1];return i[0]=n,i[1]=s,i[2]=n+t,i[3]=s+t,i}function OA(e,t){for(let r=0;r<t.length;r++)e.push(t[r]);return e}function OM(e,t,r,i){let n,s=e[0];for(let a=r;a<i;a+=t){let t=(n=e[a])-s;(t>180||t<-180)&&(n-=360*Math.round(t/360)),e[a]=s=n}}function OT(e,t){let r,i=e.length/t;for(let n=0;n<i&&((r=e[n*t])+180)%360==0;n++);let n=-(360*Math.round(r/360));if(0!==n)for(let r=0;r<i;r++)e[r*t]+=n}class OC extends Og{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,r,i){let n;if(Array.isArray(e[0])){n=Array(e.length*t);for(let r=0;r<e.length;r++)for(let i=0;i<t;i++)n[r*t+i]=e[r][i]||0}else n=e;return r?Ok(n,{size:t,gridResolution:r}):i?function(e,t){let{size:r=2,startIndex:i=0,endIndex:n=e.length,normalize:s=!0}=t||{},a=e.slice(i,n);OM(a,r,0,n-i);let o=Ok(a,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let e of o)OT(e,r);return o}(n,{size:t}):n}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(OO(e)){let t=0;for(let r of e)t+=this.getGeometrySize(r);return t}let t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&OO(e))for(let r of e){let e=this.getGeometrySize(r);t.geometrySize=e,this.updateGeometryAttributes(r,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){let r=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:n,geometrySize:s}=t;r.fill(0,n,n+s),i?(r[n]=4,r[n+s-2]=4):(r[n]+=1,r[n+s-2]+=2),r[n+s-1]=4}_updatePositions(e,t){let{positions:r}=this.attributes;if(!r||!e)return;let{vertexStart:i,geometrySize:n}=t,s=[,,,];for(let t=i,a=0;a<n;t++,a++)this.getPointOnPath(e,a,s),r[3*t]=s[0],r[3*t+1]=s[1],r[3*t+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){let{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);let n=t*i;return r[0]=e[n],r[1]=e[n+1],r[2]=3===i&&e[n+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(2===t||e[2]===e[r+2])}}function OO(e){return Array.isArray(e[0])}let OI=`\
uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,OL={name:"path",vs:OI,fs:OI,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Oj=`\
#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ON=`\
#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OD=[0,0,0,255],OR={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:OD},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Oz={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class OF extends Co{getShaders(){return super.getShaders({vs:Oj,fs:ON,modules:[wp,kb,OL]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Oz,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Oz,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Oz,defaultValue:OD},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r)}}),this.setState({pathTesselator:new OC({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:t,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){let{pathTesselator:e}=this.state,n=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:n.getPath,buffers:n,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:t,capRounded:r,billboard:i,miterLimit:n,widthUnits:s,widthScale:a,widthMinPixels:o,widthMaxPixels:l}=this.props,c=this.state.model,u={jointType:Number(t),capType:Number(r),billboard:i,widthUnits:x3[s],widthScale:a,miterLimit:n,widthMinPixels:o,widthMaxPixels:l};c.shaderInputs.setProps({path:u}),c.draw(this.context.renderPass)}_getModel(){return new Tx(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Cp({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}OF.defaultProps=OR,OF.layerName="PathLayer";var OB=e.i(54008);let OU={isClosed:!0};function O$(e){return"positions"in e?e.positions:e}function OV(e){return"holeIndices"in e?e.holeIndices:null}function OW(e,t,r,i,n){let s,a,o=t,l=r.length;for(let t=0;t<l;t++)for(let n=0;n<i;n++)e[o++]=r[t][n]||0;if(s=r[0],a=r[r.length-1],s[0]!==a[0]||s[1]!==a[1]||s[2]!==a[2])for(let t=0;t<i;t++)e[o++]=r[0][t]||0;return OU.start=t,OU.end=o,OU.size=i,Om(e,n,OU),o}function OG(e,t,r,i,n=0,s,a){let o=(s=s||r.length)-n;if(o<=0)return t;let l=t;for(let t=0;t<o;t++)e[l++]=r[n+t];if(!function(e,t,r,i){for(let n=0;n<t;n++)if(e[r+n]!==e[i-t+n])return!1;return!0}(r,i,n,s))for(let t=0;t<i;t++)e[l++]=r[n+t];return OU.start=t,OU.end=l,OU.size=i,Om(e,a,OU),l}function Oq(e,t,r){let i=e.length/3,n=0;for(let s=0;s<i;s++){let a=(s+1)%i;n+=e[3*s+t]*e[3*a+r],n-=e[3*a+t]*e[3*s+r]}return Math.abs(n/2)}function OH(e,t,r,i){let n=e.length/3;for(let s=0;s<n;s++){let n=3*s,a=e[n+0],o=e[n+1],l=e[n+2];e[n+t]=a,e[n+r]=o,e[n+i]=l}}class OK extends Og{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){let{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);let t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let t=function(e,t){var r,i=e;if(!Array.isArray(i=i&&i.positions||i)&&!ArrayBuffer.isView(i))throw Error("invalid polygon");let n=[],s=[];if("positions"in e){let{positions:r,holeIndices:i}=e;if(i){let e=0;for(let a=0;a<=i.length;a++)e=OG(n,e,r,t,i[a-1],i[a],0===a?1:-1),s.push(e);return s.pop(),{positions:n,holeIndices:s}}e=r}if(!Array.isArray(e[0]))return OG(n,0,e,t,0,n.length,1),n;if(!((r=e).length>=1&&r[0].length>=2&&Number.isFinite(r[0][0]))){let r=0;for(let[i,a]of e.entries())r=OW(n,r,a,t,0===i?1:-1),s.push(r);return s.pop(),{positions:n,holeIndices:s}}return OW(n,0,e,t,1),n}(e,this.positionSize);return this.opts.resolution?OP(O$(t),OV(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,r){let{size:i=2,normalize:n=!0,edgeTypes:s=!1}=r||{};t=t||[];let a=[],o=[],l=0,c=0;for(let n=0;n<=t.length;n++){let s=t[n]||e.length,u=c,h=function(e,t,r,i){let n=-1,s=-1;for(let a=r+1;a<i;a+=t){let t=Math.abs(e[a]);t>n&&(n=t,s=a-1)}return s}(e,i,l,s);for(let t=h;t<s;t++)a[c++]=e[t];for(let t=l;t<h;t++)a[c++]=e[t];OM(a,i,u,c),function(e,t,r,i,n=85.051129){let s=e[r],a=e[i-t];if(Math.abs(s-a)>180){let i=Ox(e,0,t,r);i[0]+=360*Math.round((a-s)/360),Ov(e,i),i[1]=Math.sign(i[1])*n,Ov(e,i),i[0]=s,Ov(e,i)}}(a,i,u,c,r?.maxLatitude),l=s,o[n]=c}o.pop();let u=OP(a,o,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let e of u)OT(e.positions,i);return u}(O$(t),OV(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(OZ(e)){let t=0;for(let r of e)t+=this.getGeometrySize(r);return t}return O$(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&OZ(e))for(let r of e){let e=this.getGeometrySize(r);t.geometrySize=e,this.updateGeometryAttributes(r,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:i}){let{attributes:n,indexStarts:s,typedArrayManager:a}=this,o=n.indices;if(!o||!e)return;let l=i,c=function(e,t,r,i){let n=OV(e);n&&(n=n.map(e=>e/t));let s=O$(e),a=i&&3===t;if(r){let e=s.length;s=s.slice();let i=[];for(let n=0;n<e;n+=t){i[0]=s[n],i[1]=s[n+1],a&&(i[2]=s[n+2]);let e=r(i);s[n]=e[0],s[n+1]=e[1],a&&(s[n+2]=e[2])}}if(a){let e=Oq(s,0,1),t=Oq(s,0,2),i=Oq(s,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(r||(s=s.slice()),OH(s,0,2,1)):(r||(s=s.slice()),OH(s,2,0,1)))}return(0,OB.default)(s,n,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);o=a.allocate(o,i+c.length,{copy:!0});for(let e=0;e<c.length;e++)o[l++]=c[e]+r;s[t+1]=i+c.length,n.indices=o}_updatePositions(e,{vertexStart:t,geometrySize:r}){let{attributes:{positions:i},positionSize:n}=this;if(!i||!e)return;let s=O$(e);for(let e=t,a=0;a<r;e++,a++){let t=s[a*n],r=s[a*n+1],o=n>2?s[a*n+2]:0;i[3*e]=t,i[3*e+1]=r,i[3*e+2]=o}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){let{positionSize:i}=this,n=this.attributes.vertexValid,s=e&&OV(e);if(e&&e.edgeTypes?n.set(e.edgeTypes,t):n.fill(1,t,t+r),s)for(let e=0;e<s.length;e++)n[t+s[e]/i-1]=0;n[t+r-1]=0}}function OZ(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}let OY=`\
uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,OX={name:"solidPolygon",vs:OY,fs:OY,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},OJ=`\
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OQ=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${OJ}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,O0=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${OJ}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,O1=`\
#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,O2=[0,0,0,255],O3={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class O4 extends Co{getShaders(e){return super.getShaders({vs:"top"===e?OQ:O0,fs:O1,defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[wp,vV,kb,OX]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let e,{viewport:t}=this.context,{coordinateSystem:r}=this.props,{_full3d:i}=this.props;t.isGeospatial&&r===x1.DEFAULT&&(r=x1.LNGLAT),r===x1.LNGLAT&&(e=i?t.projectPosition.bind(t):t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new OK({preproject:e,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:O3,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,stepMode:"dynamic",transition:O3,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:O3,accessor:"getFillColor",defaultValue:O2},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:O3,accessor:"getLineColor",defaultValue:O2},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r)}})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:t,filled:r,wireframe:i,elevationScale:n}=this.props,{topModel:s,sideModel:a,wireframeModel:o,polygonTesselator:l}=this.state,c={extruded:!!t,elevationScale:n,isWireframe:!1};o&&i&&(o.setInstanceCount(l.instanceCount-1),o.shaderInputs.setProps({solidPolygon:{...c,isWireframe:!0}}),o.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:c}),a.draw(this.context.renderPass)),s&&r&&(s.setVertexCount(l.vertexCount),s.shaderInputs.setProps({solidPolygon:c}),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:t,oldProps:r,changeFlags:i}=e,n=this.getAttributeManager();(i.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&(this.state.models?.forEach(e=>e.destroy()),this.setState(this._getModels()),n.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){let{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let e,t,r,{id:i,filled:n,extruded:s}=this.props;if(n){let t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;let r=this.getAttributeManager().getBufferLayouts({isInstanced:!1});e=new Tx(this.context.device,{...t,id:`${i}-top`,topology:"triangle-list",bufferLayout:r,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(s){let e=this.getAttributeManager().getBufferLayouts({isInstanced:!0});t=new Tx(this.context.device,{...this.getShaders("side"),id:`${i}-side`,bufferLayout:e,geometry:new Cp({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),r=new Tx(this.context.device,{...this.getShaders("side"),id:`${i}-wireframe`,bufferLayout:e,geometry:new Cp({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[t,r,e].filter(Boolean),topModel:e,sideModel:t,wireframeModel:r}}calculateIndices(e){let{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){let{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}O4.defaultProps={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:O2},getLineColor:{type:"accessor",value:O2},material:!0},O4.layerName="SolidPolygonLayer";let O5={circle:{type:C_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:CX,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Op,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},O6={type:OF,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},O8={type:O4,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function O7({type:e,props:t}){let r={};for(let i in t)r[i]=e.defaultProps[t[i]];return r}function O9(e,t){let{transitions:r,updateTriggers:i}=e.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let s in t){let a=t[s],o=e.props[s];s.startsWith("get")&&(o=e.getSubLayerAccessor(o),n.updateTriggers[a]=i[s],r&&(n.transitions[a]=r[s])),n[a]=o}return n}function Ie(e,t,r={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=e.length}=r;for(let r=n;r<s;r++){let n=e[r],{geometry:s}=n;if(s)if("GeometryCollection"===s.type){xh.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");let{geometries:e}=s;for(let s=0;s<e.length;s++)It(e[s],i,t,n,r)}else It(s,i,t,n,r)}return i}function It(e,t,r,i,n){let{type:s,coordinates:a}=e,{pointFeatures:o,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(!function(e,t){let r=Ir[e];for(xh.assert(r,`Unknown GeoJSON type ${e}`);t&&--r>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,a))return void xh.warn(`${s} coordinates are malformed`)();switch(s){case"Point":o.push(r({geometry:e},i,n));break;case"MultiPoint":a.forEach(e=>{o.push(r({geometry:{type:"Point",coordinates:e}},i,n))});break;case"LineString":l.push(r({geometry:e},i,n));break;case"MultiLineString":a.forEach(e=>{l.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"Polygon":c.push(r({geometry:e},i,n)),a.forEach(e=>{u.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"MultiPolygon":a.forEach(e=>{c.push(r({geometry:{type:"Polygon",coordinates:e}},i,n)),e.forEach(e=>{u.push(r({geometry:{type:"LineString",coordinates:e}},i,n))})})}}let Ir={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ii(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function In(e){return e.geometry.coordinates}let Is=["points","linestrings","polygons"],Ia={...O7(O5.circle),...O7(O5.icon),...O7(O5.text),...O7(O6),...O7(O8),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Io extends CR{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;let{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){let r=function(e,t){let r=Ii(),{points:i,lines:n,polygons:s}=e,a=function(e,t){let r={points:null,lines:null,polygons:null};for(let i in r){let n=e[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(4*n.length);let s=[];for(let e=0;e<n.length;e++)t(n[e],s),r[i][4*e+0]=s[0],r[i][4*e+1]=s[1],r[i][4*e+2]=s[2],r[i][4*e+3]=255}return r}(e,t);r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:a.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open";let o=Array(s.positions.value.length/s.positions.size).fill(1);for(let e of s.primitivePolygonIndices.value)o[e-1]=0;return r.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,instanceVertexValid:{size:1,value:new Uint16Array(o)},pickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygons._normalize=!1,s.triangles&&(r.polygons.data.attributes.indices=s.triangles.value),r.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygonsOutline._pathType="open",r}(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){let r=function(e){if(Array.isArray(e))return e;switch(xh.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return xh.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this),n={},s={};if(Array.isArray(t.dataChanged)){let e=this.state.features;for(let t in e)n[t]=e[t].slice(),s[t]=[];for(let a of t.dataChanged){let t=Ie(r,i,a);for(let r in e)s[r].push(function({data:e,getIndex:t,dataRange:r,replace:i}){let{startRow:n=0,endRow:s=1/0}=r,a=e.length,o=a,l=a;for(let r=0;r<a;r++){let i=t(e[r]);if(o>r&&i>=n&&(o=r),i>=s){l=r;break}}let c=o,u=l-o!==i.length?e.slice(l):void 0;for(let t=0;t<i.length;t++)e[c++]=i[t];if(u){for(let t=0;t<u.length;t++)e[c++]=u[t];e.length=c}return{startRow:o,endRow:o+i.length}}({data:n[r],getIndex:e=>e.__source.index,dataRange:a,replace:t[r]}))}}else n=Ie(r,i);let a=function(e,t){let r=Ii(),{pointFeatures:i,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:a}=e;return r.points.data=i,r.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),r.points.getPosition=In,r.lines.data=n,r.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),r.lines.getPath=In,r.polygons.data=s,r.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),r.polygons.getPolygon=In,r.polygonsOutline.data=a,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),r.polygonsOutline.getPath=In,r}(n,s);this.setState({features:n,featuresDiff:s,layerProps:a})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:r,sourceLayer:i}=t;return t.featureType=Is.find(e=>i.id.startsWith(`${this.id}-${e}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){let t=`${this.id}-points-`,r="points"===e.featureType;for(let i of this.getSubLayers())i.id.startsWith(t)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,i="polygons-fill",n=this.shouldRenderSubLayer(i,r.polygons?.data)&&this.getSubLayerClass(i,O8.type);if(n){let s=O9(this,O8.props),a=e&&t;return a||delete s.getLineColor,s.updateTriggers.lineColors=a,new n(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),r.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,i="polygons-stroke",n="linestrings",s=!e&&t&&this.shouldRenderSubLayer(i,r.polygonsOutline?.data)&&this.getSubLayerClass(i,O6.type),a=this.shouldRenderSubLayer(n,r.lines?.data)&&this.getSubLayerClass(n,O6.type);if(s||a){let e=O9(this,O6.props);return[s&&new s(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),r.polygonsOutline),a&&new a(e,this.getSubLayerProps({id:n,updateTriggers:e.updateTriggers}),r.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:t,binary:r}=this.state,{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=t.points.data.findIndex(e=>e.__source.index===i));let n=new Set(e.split("+")),s=[];for(let e of n){let n=`points-${e}`,a=O5[e],o=a&&this.shouldRenderSubLayer(n,t.points?.data)&&this.getSubLayerClass(n,a.type);if(o){let l=O9(this,a.props),c=t.points;if("text"===e&&r){let{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}s.push(new o(l,this.getSubLayerProps({id:n,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),c))}}return s}renderLayers(){let{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){let{binary:t}=this.state;return t&&"function"==typeof e?(t,r)=>{let{data:i,index:n}=r;return e(function(e,t){if(!e)return null;let r="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[r];return -1!==r?function(e,t,r){let i={properties:{...e.properties[t]}};for(let t in e.numericProps)i.properties[t]=e.numericProps[t].value[r];return i}(e,i,r):null}(i,n),r)}:super.getSubLayerAccessor(e)}}Io.layerName="GeoJsonLayer",Io.defaultProps=Ia;let Il={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Ic{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...Il,...e},this.stats=new kL.Stats({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let r={handle:e,priority:0,getPriority:t},i=new Promise(e=>(r.resolve=e,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){let{handle:t,resolve:r}=e,i=!1,n=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:n}):Promise.resolve({done:n})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){let e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let r=e[t];!this._updateRequest(r)&&(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((e,t)=>e.priority-t.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}class Iu{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:r,onError:i}){let n,{index:s,id:a,bbox:o,userData:l,zoom:c}=this,u=this._loaderId;this._abortController=new AbortController;let{signal:h}=this._abortController,d=await t.scheduleRequest(this,e=>e.isSelected?1:-1);if(!d){this._isCancelled=!0;return}if(this._isCancelled)return void d.done();let f=null;try{f=await e({index:s,id:a,bbox:o,userData:l,zoom:c,signal:h})}catch(e){n=e||!0}finally{d.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=f,this._isCancelled&&!f){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,n?i(n,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}var _1=_1,xc=xc;let Ih=Math.PI/180,Id=180/Math.PI;class If extends Sr{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:n=1,resolution:s=10}=e;let{latitude:a=0,height:o,altitude:l=1.5,fovy:c}=e;a=Math.max(Math.min(a,85.051129),-85.051129),o=o||1,c?l=ki(c):c=kr(l);const u=1/Math.PI/Math.cos(a*Math.PI/180)*Math.pow(2,r),h=e.nearZ??i,d=e.farZ??(l+512*u/o)*n,f=new _K().lookAt({eye:[0,-l,0],up:[0,0,1]});f.rotateX(a*Ih),f.rotateZ(-t*Ih),f.scale(u/o),super({...e,height:o,viewMatrix:f,longitude:t,latitude:a,zoom:r,distanceScales:function(){let e=Math.PI/180*256;return{unitsPerMeter:[4018225162502676e-20,4018225162502676e-20,4018225162502676e-20],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[e,e,4018225162502676e-20],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,24886.609375]}}(),fovy:c,focalDistance:l,near:h,far:d}),this.scale=u,this.latitude=a,this.longitude=t,this.resolution=s}get projectionMode(){return x2.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),n=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return n[0]<this.longitude&&(n[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],n[0],i[0],s[0]),Math.min(r[1],n[1],i[1],s[1]),Math.max(r[0],n[0],i[0],s[0]),Math.max(r[1],n[1],i[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let i,[n,s,a]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:l}=this;if(Number.isFinite(a))i=Ip(l,[n,o,a,1]);else{let e=Ip(l,[n,o,-1,1]),t=Ip(l,[n,o,1,1]),s=((r||0)/6370972+1)*256,a=_1.sqrLen(_1.sub([],e,t)),c=_1.sqrLen(e),u=_1.sqrLen(t),h=(4*c*u-(a-c-u)**2)/16*4/a,d=(Math.sqrt(c-h)-Math.sqrt(Math.max(0,s*s-h)))/Math.sqrt(a);i=_1.lerp([],e,t,d)}let[c,u,h]=this.unprojectPosition(i);return Number.isFinite(a)?[c,u,h]:Number.isFinite(r)?[c,u,r]:[c,u]}projectPosition(e){let[t,r,i=0]=e,n=t*Ih,s=r*Ih,a=Math.cos(s),o=(i/6370972+1)*256;return[Math.sin(n)*a*o,-Math.cos(n)*a*o,Math.sin(s)*o]}unprojectPosition(e){let[t,r,i]=e,n=_1.len(e);return[Math.atan2(t,-r)*Id,Math.asin(i/n)*Id,(n/256-1)*6370972]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function Ip(e,t){let r=xc.transformMat4([],t,e);return xc.scale(r,r,1/r[3]),r}let Ig=new _a,Im=new _a;class Iy{constructor(e=[0,0,0],t=[0,0,0],r){r=r||Ig.copy(e).add(t).scale(.5),this.center=new _a(r),this.halfDiagonal=new _a(t).subtract(this.center),this.minimum=new _a(e),this.maximum=new _a(t)}clone(){return new Iy(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:t}=this,r=Im.from(e.normal),i=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),n=this.center.dot(r)+e.distance;return n-i>0?1:n+i<0?-1:0}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t,r=Ig.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0;return(t=Math.abs(r.x)-i.x)>0&&(n+=t*t),(t=Math.abs(r.y)-i.y)>0&&(n+=t*t),(t=Math.abs(r.z)-i.z)>0&&(n+=t*t),n}}var bz=bz;let Iv=new _a,Ib=new _a;class Ix{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new _a,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Iv.from(t),this.center=new _a().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ix(this.center,this.radius)}union(e){let t=this.center,r=this.radius,i=e.center,n=e.radius,s=Iv.copy(i).subtract(t),a=s.magnitude();if(r>=a+n)return this.clone();if(n>=a+r)return e.clone();let o=(r+a+n)*.5;return Ib.copy(s).scale((-r+o)/a).add(t),this.center.copy(Ib),this.radius=o,this}expand(e){let t=Iv.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);let t=bz.getScaling(Iv,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){return Math.max(0,Iv.from(e).subtract(this.center).len()-this.radius)}intersectPlane(e){let t=this.center,r=this.radius,i=e.normal.dot(t)+e.distance;return i<-r?-1:i<r?0:1}}function Iw(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],f=r[1],p=r[2],g=r[3],m=r[4],y=r[5],v=r[6],b=r[7],x=r[8];return e[0]=d*i+f*a+p*c,e[1]=d*n+f*o+p*u,e[2]=d*s+f*l+p*h,e[3]=g*i+m*a+y*c,e[4]=g*n+m*o+y*u,e[5]=g*s+m*l+y*h,e[6]=v*i+b*a+x*c,e[7]=v*n+b*o+x*u,e[8]=v*s+b*l+x*h,e}function I_(e,t,r){let i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}(I=X||(X={}))[I.COL0ROW0=0]="COL0ROW0",I[I.COL0ROW1=1]="COL0ROW1",I[I.COL0ROW2=2]="COL0ROW2",I[I.COL1ROW0=3]="COL1ROW0",I[I.COL1ROW1=4]="COL1ROW1",I[I.COL1ROW2=5]="COL1ROW2",I[I.COL2ROW0=6]="COL2ROW0",I[I.COL2ROW1=7]="COL2ROW1",I[I.COL2ROW2=8]="COL2ROW2";let Ik=Object.freeze([1,0,0,0,1,0,0,0,1]);class IP extends _o{static get IDENTITY(){return IS||Object.freeze(IS=new IP),IS}static get ZERO(){return s||Object.freeze(s=new IP([0,0,0,0,0,0,0,0,0])),s}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return X}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Ik)}fromObject(e){return this.check()}fromQuaternion(e){let t,r,i,n,s,a,o,l,c,u,h,d,f,p,g,m;return t=e[0],r=e[1],i=e[2],n=e[3],s=t+t,a=r+r,o=i+i,l=t*s,c=r*s,u=r*a,h=i*s,d=i*a,f=i*o,p=n*s,g=n*a,m=n*o,this[0]=1-u-f,this[3]=c-m,this[6]=h+g,this[1]=c+m,this[4]=1-l-f,this[7]=d-p,this[2]=h-g,this[5]=d+p,this[8]=1-l-u,this.check()}set(e,t,r,i,n,s,a,o,l){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=n,this[5]=s,this[6]=a,this[7]=o,this[8]=l,this.check()}setRowMajor(e,t,r,i,n,s,a,o,l){return this[0]=e,this[1]=i,this[2]=a,this[3]=t,this[4]=n,this[5]=o,this[6]=r,this[7]=s,this[8]=l,this.check()}determinant(){let e,t,r,i,n,s,a,o,l;return e=this[0],t=this[1],r=this[2],i=this[3],n=this[4],s=this[5],a=this[6],o=this[7],e*((l=this[8])*n-s*o)+t*(-l*i+s*a)+r*(o*i-n*a)}transpose(){return!function(e,t){if(e===t){let r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){let e,t,r,i,n,s,a,o,l,c,u,h,d;return e=this[0],t=this[1],r=this[2],i=this[3],n=this[4],s=this[5],a=this[6],o=this[7],c=(l=this[8])*n-s*o,(d=e*c+t*(u=-l*i+s*a)+r*(h=o*i-n*a))&&(d=1/d,this[0]=c*d,this[1]=(-l*t+r*o)*d,this[2]=(s*t-r*n)*d,this[3]=u*d,this[4]=(l*e-r*a)*d,this[5]=(-s*e+r*i)*d,this[6]=h*d,this[7]=(-o*e+t*a)*d,this[8]=(n*e-t*i)*d),this.check()}multiplyLeft(e){return Iw(this,e,this),this.check()}multiplyRight(e){return Iw(this,this,e),this.check()}rotate(e){let t,r,i,n,s,a,o,l,c,u,h;return t=this[0],r=this[1],i=this[2],n=this[3],s=this[4],a=this[5],o=this[6],l=this[7],c=this[8],u=Math.sin(e),h=Math.cos(e),this[0]=h*t+u*n,this[1]=h*r+u*s,this[2]=h*i+u*a,this[3]=h*n-u*t,this[4]=h*s-u*r,this[5]=h*a-u*i,this[6]=o,this[7]=l,this[8]=c,this.check()}scale(e){return Array.isArray(e)?I_(this,this,e):I_(this,this,[e,e]),this.check()}translate(e){let t,r,i,n,s,a,o,l,c,u,h;return t=this[0],r=this[1],i=this[2],n=this[3],s=this[4],a=this[5],o=this[6],l=this[7],c=this[8],u=e[0],h=e[1],this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=u*t+h*n+o,this[7]=u*r+h*s+l,this[8]=u*i+h*a+c,this.check()}transform(e,t){let r;switch(e.length){case 2:r=_R(t||[-0,-0],e,this);break;case 3:r=w2(t||[-0,-0,-0],e,this);break;case 4:r=_n(t||[-0,-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return w_(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let IS=null;class IE extends wP{static get ZERO(){return a||Object.freeze(a=new IE(0,0,0,0)),a}constructor(e=0,t=0,r=0,i=0){super(-0,-0,-0,-0),wm(e)&&1==arguments.length?this.copy(e):(wg.debug&&(ww(e),ww(t),ww(r),ww(i)),this[0]=e,this[1]=t,this[2]=r,this[3]=i)}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return wg.debug&&(ww(e.x),ww(e.y),ww(e.z),ww(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ww(e)}get w(){return this[3]}set w(e){this[3]=ww(e)}transform(e){return w1(this,this,e),this.check()}transformByMatrix3(e){return _n(this,this,e),this.check()}transformByMatrix2(e){let t,r;return t=this[0],r=this[1],this[0]=e[0]*t+e[2]*r,this[1]=e[1]*t+e[3]*r,this[2]=this[2],this[3]=this[3],this.check()}transformByQuaternion(e){return w3(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function IA(){let e=new vX(4);return vX!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function IM(e,t,r){let i=Math.sin(r*=.5);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function IT(e,t,r){let i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+a*o+n*c-s*l,e[1]=n*u+a*l+s*o-i*c,e[2]=s*u+a*c+i*l-n*o,e[3]=a*u-i*o-n*l-s*c,e}let IC=(g=wS(),m=wM(1,0,0),y=wM(0,1,0),function(e,t,r){let i=wK(t,r);return i<-.999999?(wZ(g,m,t),1e-6>wA(g)&&wZ(g,y,t),wH(g,g),IM(e,g,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(wZ(g,t,r),e[0]=g[0],e[1]=g[1],e[2]=g[2],e[3]=1+i,b8(e,e))});IA(),IA(),v=new vX(9),vX!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1;let IO=[0,0,0,1];class II extends wx{constructor(e=0,t=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1==arguments.length?this.copy(e):this.set(e,t,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return!function(e,t){let r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let n=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*s+s]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+s]-t[3*s+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[s]=(t[3*s+i]+t[3*i+s])*r}}(this,e),this.check()}fromAxisRotation(e,t){return IM(this,e,t),this.check()}identity(){return this[0]=0,this[1]=0,this[2]=0,this[3]=1,this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ww(e)}get y(){return this[1]}set y(e){this[1]=ww(e)}get z(){return this[2]}set z(e){this[2]=ww(e)}get w(){return this[3]}set w(e){this[3]=ww(e)}len(){return b3(this)}lengthSquared(){return b4(this)}dot(e){return b7(this,e)}rotationTo(e,t){return IC(this,e,t),this.check()}add(e){return bW(this,this,e),this.check()}calculateW(){let e,t,r;return e=this[0],t=this[1],r=this[2],this[0]=e,this[1]=t,this[2]=r,this[3]=Math.sqrt(Math.abs(1-e*e-t*t-r*r)),this.check()}conjugate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this[3]=this[3],this.check()}invert(){let e,t,r,i,n,s;return e=this[0],t=this[1],r=this[2],s=(n=e*e+t*t+r*r+(i=this[3])*i)?1/n:0,this[0]=-e*s,this[1]=-t*s,this[2]=-r*s,this[3]=i*s,this.check()}lerp(e,t,r){return void 0===r?this.lerp(this,e,t):(xe(this,e,t,r),this.check())}multiplyRight(e){return IT(this,this,e),this.check()}multiplyLeft(e){return IT(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o+s*a,this[1]=i*o+n*a,this[2]=n*o-i*a,this[3]=s*o-r*a,this.check()}rotateY(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o-n*a,this[1]=i*o+s*a,this[2]=n*o+r*a,this[3]=s*o-i*a,this.check()}rotateZ(e){var t;let r,i,n,s,a,o;return t=.5*e,r=this[0],i=this[1],n=this[2],s=this[3],a=Math.sin(t),o=Math.cos(t),this[0]=r*o+i*a,this[1]=i*o-r*a,this[2]=n*o+s*a,this[3]=s*o-n*a,this.check()}scale(e){return bQ(this,this,e),this.check()}slerp(e,t,r){var i,n,s;let a,o,l,c,u,h,d,f,p,g,m,y,v,b,x,w;switch(arguments.length){case 1:({start:a=IO,target:o,ratio:l}=e);break;case 2:a=this,o=e,l=t;break;default:a=e,o=t,l=r}return i=a,n=o,s=l,p=i[0],g=i[1],m=i[2],y=i[3],v=n[0],b=n[1],(c=p*v+g*b+m*(x=n[2])+y*(w=n[3]))<0&&(c=-c,v=-v,b=-b,x=-x,w=-w),1-c>1e-6?(f=Math.sin(u=Math.acos(c)),h=Math.sin((1-s)*u)/f,d=Math.sin(s*u)/f):(h=1-s,d=s),this[0]=h*p+d*v,this[1]=h*g+d*b,this[2]=h*m+d*x,this[3]=h*y+d*w,this.check()}transformVector4(e,t=new IE){return xi(t,e,this),w_(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}let IL=new _a,Ij=new _a,IN=new _a,ID=new _a,IR=new _a,Iz=new _a,IF=new _a;class IB{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new _a().from(e),this.halfAxes=new IP(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new _a(e).len(),new _a(t).len(),new _a(r).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new _a(e).normalize(),n=new _a(t).normalize(),s=new _a(r).normalize();return new II().fromMatrix3(new IP([...i,...n,...s]))}fromCenterHalfSizeQuaternion(e,t,r){let i=new II(r),n=new IP().fromQuaternion(i);return n[0]=n[0]*t[0],n[1]=n[1]*t[0],n[2]=n[2]*t[0],n[3]=n[3]*t[1],n[4]=n[4]*t[1],n[5]=n[5]*t[1],n[6]=n[6]*t[2],n[7]=n[7]*t[2],n[8]=n[8]*t[2],this.center=new _a().from(e),this.halfAxes=n,this}clone(){return new IB(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ix){let t=this.halfAxes,r=t.getColumn(0,IN),i=t.getColumn(1,ID),n=t.getColumn(2,IR),s=IL.copy(r).add(i).add(n);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){let t=this.center,r=e.normal,i=this.halfAxes,n=r.x,s=r.y,a=r.z,o=Math.abs(n*i[0]+s*i[1]+a*i[2])+Math.abs(n*i[3]+s*i[4]+a*i[5])+Math.abs(n*i[6]+s*i[7]+a*i[8]),l=r.dot(t)+e.distance;return l<=-o?-1:1*!!(l>=o)}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t,r=Ij.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,IN),s=i.getColumn(1,ID),a=i.getColumn(2,IR),o=n.magnitude(),l=s.magnitude(),c=a.magnitude();n.normalize(),s.normalize(),a.normalize();let u=0;return(t=Math.abs(r.dot(n))-o)>0&&(u+=t*t),(t=Math.abs(r.dot(s))-l)>0&&(u+=t*t),(t=Math.abs(r.dot(a))-c)>0&&(u+=t*t),u}computePlaneDistances(e,t,r=[-0,-0]){let i=1/0,n=-1/0,s=this.center,a=this.halfAxes,o=a.getColumn(0,IN),l=a.getColumn(1,ID),c=a.getColumn(2,IR),u=Iz.copy(o).add(l).add(c).add(s),h=IF.copy(u).subtract(e),d=t.dot(h);return i=Math.min(d,i),n=Math.max(d,n),u.copy(s).add(o).add(l).subtract(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),u.copy(s).add(o).subtract(l).add(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),u.copy(s).add(o).subtract(l).subtract(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),s.copy(u).subtract(o).add(l).add(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),s.copy(u).subtract(o).add(l).subtract(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),s.copy(u).subtract(o).subtract(l).add(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),s.copy(u).subtract(o).subtract(l).subtract(c),h.copy(u).subtract(e),i=Math.min(d=t.dot(h),i),n=Math.max(d,n),r[0]=i,r[1]=n,r}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,IN);t.transformAsPoint(e);let r=this.halfAxes.getColumn(1,ID);r.transformAsPoint(e);let i=this.halfAxes.getColumn(2,IR);return i.transformAsPoint(e),this.halfAxes=new IP([...t,...r,...i]),this}getTransform(){throw Error("not implemented")}}let IU=new _a,I$=new _a;class IV{constructor(e=[0,0,1],t=0){this.normal=new _a,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return wk(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=IU.from(e),this.normal.from(t).normalize();let r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,i){return this.normal.set(e,t,r),wk(wb(this.normal.len(),1)),this.distance=i,this}clone(){return new IV(this.normal,this.distance)}equals(e){return wb(this.distance,e.distance)&&wb(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=I$.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){let r=IU.from(e),i=this.getPointDistance(r),n=I$.copy(this.normal).scale(i);return r.subtract(n).to(t)}}let IW=[new _a([1,0,0]),new _a([0,1,0]),new _a([0,0,1])],IG=new _a,Iq=new _a;class IH{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*IW.length;let t=e.center,r=e.radius,i=0;for(let e of IW){let n=this.planes[i],s=this.planes[i+1];n||(n=this.planes[i]=new IV),s||(s=this.planes[i+1]=new IV);let a=IG.copy(e).scale(-r).add(t);n.fromPointNormal(a,e);let o=IG.copy(e).scale(r).add(t),l=Iq.copy(e).negate();s.fromPointNormal(o,l),i+=2}return this}computeVisibility(e){let t=1;for(let r of this.planes)switch(e.intersectPlane(r)){case -1:return -1;case 0:t=0}return t}computeVisibilityWithPlaneMask(e,t){if(wk(Number.isFinite(t),"parentPlaneMask is required."),t===IH.MASK_OUTSIDE||t===IH.MASK_INSIDE)return t;let r=IH.MASK_INSIDE,i=this.planes;for(let n=0;n<this.planes.length;++n){let s=n<31?1<<n:0;if(n<31&&(t&s)==0)continue;let a=i[n],o=e.intersectPlane(a);if(-1===o)return IH.MASK_OUTSIDE;0===o&&(r|=s)}return r}}IH.MASK_OUTSIDE=0xffffffff,IH.MASK_INSIDE=0,IH.MASK_INDETERMINATE=0x7fffffff,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a,new _a;let IK=Math.PI/2,IZ=Math.PI/4,IY=Math.PI/6,IX=2*Math.PI;e.s(["EPSILON1",0,.1,"EPSILON10",0,1e-10,"EPSILON11",0,1e-11,"EPSILON12",0,1e-12,"EPSILON13",0,1e-13,"EPSILON14",0,1e-14,"EPSILON15",0,1e-15,"EPSILON16",0,1e-16,"EPSILON17",0,1e-17,"EPSILON18",0,1e-18,"EPSILON19",0,1e-19,"EPSILON2",0,.01,"EPSILON20",0,1e-20,"EPSILON3",0,.001,"EPSILON4",0,1e-4,"EPSILON5",0,1e-5,"EPSILON6",0,1e-6,"EPSILON7",0,1e-7,"EPSILON8",0,1e-8,"EPSILON9",0,1e-9,"PI_OVER_FOUR",0,IZ,"PI_OVER_SIX",0,IY,"PI_OVER_TWO",0,IK,"TWO_PI",0,IX],94069);var IJ=e.i(94069),IJ=IJ;let IQ=new IP,I0=new IP,I1=new IP,I2=new IP,I3=new IP,I4=[1,0,0],I5=[2,2,1],I6=new _a,I8=new _a,I7=new _a,I9=new _a,Le=new _a,Lt=new IP,Lr={diagonal:new IP,unitary:new IP},Li=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Ln=Li.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Ls=Ln.concat([[.25,.5],[.75,.5]]);class La{constructor(e,t,r){this.x=e,this.y=t,this.z=r}get children(){if(!this._children){let e=2*this.x,t=2*this.y,r=this.z+1;this._children=[new La(e,t,r),new La(e,t+1,r),new La(e+1,t,r),new La(e+1,t+1,r)]}return this._children}update(e){let{viewport:t,cullingVolume:r,elevationBounds:i,minZ:n,maxZ:s,bounds:a,offset:o,project:l}=e,c=this.getBoundingVolume(i,o,l);if(a&&!this.insideBounds(a)||0>r.computeVisibility(c))return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=n&&(e+=Math.floor(Math.log2(c.distanceTo(t.cameraPosition)*t.scale/t.height))),e>=s)return this.selected=!0,!0}for(let t of(this.selected=!1,this.childVisible=!0,this.children))t.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let t of this._children)t.getSelected(e);return e}insideBounds([e,t,r,i]){let n=512/Math.pow(2,this.z);return this.x*n<r&&this.y*n<i&&(this.x+1)*n>e&&(this.y+1)*n>t}getBoundingVolume(e,t,r){if(r){let t=this.z<1?Ls:this.z<2?Ln:Li,i=[];for(let n of t){let t=Lh(this.x+n[0],this.y+n[1],this.z);t[2]=e[0],i.push(r(t)),e[0]!==e[1]&&(t[2]=e[1],i.push(r(t)))}return function(e,t=new IB){if(!e||0===e.length)return t.halfAxes=new IP([0,0,0,0,0,0,0,0,0]),t.center=new _a,t;let r=e.length,i=new _a(0,0,0);for(let t of e)i.add(t);let n=1/r;i.multiplyByScalar(n);let s=0,a=0,o=0,l=0,c=0,u=0;for(let t of e){let e=I6.copy(t).subtract(i);s+=e.x*e.x,a+=e.x*e.y,o+=e.x*e.z,l+=e.y*e.y,c+=e.y*e.z,u+=e.z*e.z}s*=n,a*=n,o*=n,l*=n,c*=n,u*=n,Lt[0]=s,Lt[1]=a,Lt[2]=o,Lt[3]=a,Lt[4]=l,Lt[5]=c,Lt[6]=o,Lt[7]=c,Lt[8]=u;let{unitary:h}=function(e,t={}){let r=IJ.EPSILON20,i=0,n=0;I0.identity(),I1.copy(e);let s=r*function(e){let t=0;for(let r=0;r<9;++r){let i=e[r];t+=i*i}return Math.sqrt(t)}(I1);for(;n<10&&function(e){let t=0;for(let r=0;r<3;++r){let i=e[IQ.getElementIndex(I5[r],I4[r])];t+=2*i*i}return Math.sqrt(t)}(I1)>s;)(function(e,t){let r=IJ.EPSILON15,i=0,n=1;for(let t=0;t<3;++t){let r=Math.abs(e[IQ.getElementIndex(I5[t],I4[t])]);r>i&&(n=t,i=r)}let s=I4[n],a=I5[n],o=1,l=0;if(Math.abs(e[IQ.getElementIndex(a,s)])>r){let t,r=(e[IQ.getElementIndex(a,a)]-e[IQ.getElementIndex(s,s)])/2/e[IQ.getElementIndex(a,s)];o=1/Math.sqrt(1+(t=r<0?-1/(-r+Math.sqrt(1+r*r)):1/(r+Math.sqrt(1+r*r)))*t),l=t*o}IP.IDENTITY.to(t),t[IQ.getElementIndex(s,s)]=t[IQ.getElementIndex(a,a)]=o,t[IQ.getElementIndex(a,s)]=l,t[IQ.getElementIndex(s,a)]=-l})(I1,I2),I3.copy(I2).transpose(),I1.multiplyRight(I2),I1.multiplyLeft(I3),I0.multiplyRight(I2),++i>2&&(++n,i=0);return t.unitary=I0.toTarget(t.unitary),t.diagonal=I1.toTarget(t.diagonal),t}(Lt,Lr),d=t.halfAxes.copy(h),f=d.getColumn(0,I7),p=d.getColumn(1,I9),g=d.getColumn(2,Le),m=-Number.MAX_VALUE,y=-Number.MAX_VALUE,v=-Number.MAX_VALUE,b=Number.MAX_VALUE,x=Number.MAX_VALUE,w=Number.MAX_VALUE;for(let t of e)I6.copy(t),m=Math.max(I6.dot(f),m),y=Math.max(I6.dot(p),y),v=Math.max(I6.dot(g),v),b=Math.min(I6.dot(f),b),x=Math.min(I6.dot(p),x),w=Math.min(I6.dot(g),w);f=f.multiplyByScalar(.5*(b+m)),p=p.multiplyByScalar(.5*(x+y)),g=g.multiplyByScalar(.5*(w+v)),t.center.copy(f).add(p).add(g);let _=I8.set(m-b,y-x,v-w).multiplyByScalar(.5),k=new IP([_[0],0,0,0,_[1],0,0,0,_[2]]);return t.halfAxes.multiplyRight(k),t}(i)}let i=512/Math.pow(2,this.z),n=this.x*i+512*t,s=512-(this.y+1)*i;return new Iy([n,s,e[0]],[n+i,s+i,e[1]])}}let Lo=[-1/0,-1/0,1/0,1/0];function Ll(e,t){let r=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...r.map(e=>e[0])),Math.min(...r.map(e=>e[1])),Math.max(...r.map(e=>e[0])),Math.max(...r.map(e=>e[1]))]}function Lc({viewport:e,z:t,cullRect:r}){return(e.subViewports||[e]).map(e=>(function e(t,r,i){if(!Array.isArray(r)){let e=i.x-t.x,n=i.y-t.y,{width:s,height:a}=i,o={targetZ:r},l=t.unproject([e,n],o),c=t.unproject([e+s,n],o),u=t.unproject([e,n+a],o),h=t.unproject([e+s,n+a],o);return[Math.min(l[0],c[0],u[0],h[0]),Math.min(l[1],c[1],u[1],h[1]),Math.max(l[0],c[0],u[0],h[0]),Math.max(l[1],c[1],u[1],h[1])]}let n=e(t,r[0],i),s=e(t,r[1],i);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]})(e,t||0,r))}function Lu(e,t){return 512*Math.pow(2,e)/t}function Lh(e,t,r){let i=Lu(r,512),n=Math.PI-2*Math.PI*t/i;return[e/i*360-180,180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))]}function Ld(e,t,r,i){let n=Lu(r,i);return[e/n*512,t/n*512]}let Lf="best-available",Lp={[Lf]:function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&!Lm(t)&&Ly(t);for(let t of e)t.isVisible=!!(2&t.state)},"no-overlap":function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&Lm(t);for(let t of Array.from(e).sort((e,t)=>e.zoom-t.zoom))if(t.isVisible=!!(2&t.state),t.children&&(t.isVisible||1&t.state))for(let e of t.children)e.state=1;else t.isSelected&&Ly(t)},never:()=>{}},Lg={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};function Lm(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=2,!0;t=t.parent}return!1}function Ly(e){for(let t of e.children)t.isLoaded||t.content?t.state|=2:Ly(t)}class Lv extends CR{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(e=>e.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state,r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?r&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(e=>{e.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:t,maxCacheByteSize:r,refinementStrategy:i,extent:n,maxZoom:s,minZoom:a,maxRequests:o,debounceTime:l,zoomOffset:c}=this.props;return{maxCacheSize:t,maxCacheByteSize:r,maxZoom:s,minZoom:a,tileSize:e,refinementStrategy:i,extent:n,maxRequests:o,debounceTime:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:t,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:r}),{isLoaded:n}=e,s=this.state.isLoaded!==n,a=this.state.frameNumber!==i;n&&(s||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=n}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:t,getTileData:r,fetch:i}=this.props,{signal:n}=e;return(e.url="string"==typeof t||Array.isArray(t)?function(e,t){if(!e||!e.length)return null;let{index:r,id:i}=t;if(Array.isArray(e)){let t=Math.abs(i.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))%e.length;e=e[t]}let n=e;for(let e of Object.keys(r)){let t=RegExp(`{${e}}`,"g");n=n.replace(t,String(r[e]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}(t,e):null,r)?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:n}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let t=e.sourceLayer,r=t.props.tile,i=e.info;return i.picked&&(i.tile=r),i.sourceTile=r,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some(r=>e.layers[0].props[r]!==t[r])&&(e.layers=e.layers.map(e=>e.clone(t)));else{let r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=kI(r,Boolean).map(r=>r.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){let{tile:r}=e.props,{modelMatrix:i}=this.props;return this.state.tileset.isTileVisible(r,t,i?new _K(i):null)}}Lv.defaultProps={TilesetClass:class{constructor(e){this._getCullBounds=function(e){let t,r={};return i=>{for(let n in i)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}(i[n],r[n])){t=e(i),r=i;break}return t}}(Lc),this.opts={...Lg,...e},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),null!==this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new Ic({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new _K,this._modelMatrixInverse=new _K}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,{zRange:t,modelMatrix:r}={zRange:null,modelMatrix:null}){let i=r?new _K(r):new _K,n=!i.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&wb(this._zRange,t)&&!n)this.needsReload&&(this._selectedTiles=this._selectedTiles.map(e=>this._getTile(e.index,!0)));else{n&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;let r=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=r.map(e=>this._getTile(e,!0)),this._dirty&&this._rebuildTree()}let s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t,r){if(!e.isVisible)return!1;if(t&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:n}=e;for(let[e,t,s,a]of i){let i;if("west"in n)i=n.west<s&&n.east>e&&n.south<a&&n.north>t;else{if(r&&!_K.IDENTITY.equals(r)){let[e,t,i,s]=Ll([n.left,n.top,n.right,n.bottom],r);n={left:e,top:t,right:i,bottom:s}}let o=Math.min(n.top,n.bottom),l=Math.max(n.top,n.bottom);i=n.left<s&&n.right>e&&o<a&&l>t}if(i)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:r,zRange:i,modelMatrix:n,modelMatrixInverse:s}){let{tileSize:a,extent:o,zoomOffset:l}=this.opts;return function({viewport:e,maxZoom:t,minZoom:r,zRange:i,extent:n,tileSize:s=512,modelMatrix:a,modelMatrixInverse:o,zoomOffset:l=0}){let c=e.isGeospatial?Math.round(e.zoom+Math.log2(512/s))+l:Math.ceil(e.zoom)+l;if("number"==typeof r&&Number.isFinite(r)&&c<r){if(!n)return[];c=r}"number"==typeof t&&Number.isFinite(t)&&c>t&&(c=t);let u=n;return a&&o&&n&&!e.isGeospatial&&(u=Ll(n,a)),e.isGeospatial?function(e,t,r,i){let n=e instanceof If&&e.resolution?e.projectPosition:null,s=new IH(Object.values(e.getFrustumPlanes()).map(({normal:e,distance:t})=>new IV(e.clone().negate(),t))),a=e.distanceScales.unitsPerMeter[2],o=r&&r[0]*a||0,l=r&&r[1]*a||0,c=e instanceof Su&&e.pitch<=60?t:0;if(i){let[e,t,r,n]=i,s=_8([e,n]),a=_8([r,t]);i=[s[0],512-s[1],a[0],512-a[1]]}let u=new La(0,0,0),h={viewport:e,project:n,cullingVolume:s,elevationBounds:[o,l],minZ:c,maxZ:t,bounds:i,offset:0};if(u.update(h),e instanceof Su&&e.subViewports&&e.subViewports.length>1){for(h.offset=-1;u.update(h)&&!(--h.offset<-3););for(h.offset=1;u.update(h)&&!(++h.offset>3););}return u.getSelected()}(e,c,i,n):function(e,t,r,i,n){var s,a,o;let l,c=(s=e,a=0,o=i,l=s.getBounds(),s.isGeospatial?[Math.max(l[0],o[0]),Math.max(l[1],o[1]),Math.min(l[2],o[2]),Math.min(l[3],o[3])]:[Math.max(Math.min(l[0],o[2]),o[0]),Math.max(Math.min(l[1],o[3]),o[1]),Math.min(Math.max(l[2],o[0]),o[2]),Math.min(Math.max(l[3],o[1]),o[3])]),u=Lu(t,r),[h,d,f,p]=n?Ll(c,n).map(e=>e*u/512):c.map(e=>e*u/512),g=[];for(let e=Math.floor(h);e<f;e++)for(let r=Math.floor(d);r<p;r++)g.push({x:e,y:r,z:t});return g}(e,c,s,u||Lo,o)}({viewport:e,maxZoom:t,minZoom:r,zRange:i,tileSize:a,extent:o,modelMatrix:n,modelMatrixInverse:s,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:t}=this.opts;return{bbox:function(e,t,r,i,n=512){if(e.isGeospatial){let[e,n]=Lh(t,r,i),[s,a]=Lh(t+1,r+1,i);return{west:e,north:n,east:s,south:a}}let[s,a]=Ld(t,r,i,n),[o,l]=Ld(t+1,r+1,i,n);return{left:s,top:a,right:o,bottom:l}}(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){let t=Math.floor(e.x/2);return{x:t,y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){let e=this.opts.refinementStrategy||Lf,t=Array(this._cache.size),r=0;for(let e of this._cache.values())t[r++]=e.isVisible,e.isSelected=!1,e.isVisible=!1;for(let e of this._selectedTiles)e.isSelected=!0,e.isVisible=!0;for(let i of(("function"==typeof e?e:Lp[e])(Array.from(this._cache.values())),r=0,this._cache.values()))if(t[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,t=[],r=0;for(let e of this._cache.values())e.isLoading&&(r++,e.isSelected||e.isVisible||t.push(e));for(;e>0&&r>e&&t.length>0;)t.shift().abort(),r--}_rebuildTree(){let{_cache:e}=this;for(let t of e.values())t.parent=null,t.children&&(t.children.length=0);for(let t of e.values()){let e=this._getNearestAncestor(t);t.parent=e,e?.children&&e.children.push(t)}}_resizeCache(){let{_cache:e,opts:t}=this,r=t.maxCacheSize??(null!==t.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=t.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>i){for(let[n,s]of e)if(s.isVisible||s.isSelected||(this._cacheByteSize-=null!==t.maxCacheByteSize?s.byteLength:0,e.delete(n),this.opts.onTileUnload?.(s)),e.size<=r&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((e,t)=>e.zoom-t.zoom),this._dirty=!1)}_getTile(e,t){let r=this.getTileId(e),i=this._cache.get(r),n=!1;return!i&&t?(Object.assign(i=new Iu(e),this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),n=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(n=!0),i&&n&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){let{_minZoom:t=0}=this,r=e.index;for(;this.getTileZoom(r)>t;){r=this.getParentIndex(r);let e=this._getTile(r);if(e)return e}return null}},data:{type:"data",value:[]},dataComparator:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0},renderSubLayers:{type:"function",value:e=>new Io(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Lf,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Lv.layerName="TileLayer";let Lb={longitude:-73.9777,latitude:40.7527,zoom:10.6,minZoom:8.5,maxZoom:16,pitch:5,bearing:-4},Lx=new SK({ambientLight:new SD({color:[255,255,255],intensity:.65}),directionalLights:[new class extends SB{constructor(e){super(e),this.timestamp=e.timestamp}getProjectedLight({layer:e}){let{viewport:t}=e.context;if(t.resolution&&t.resolution>0){let[e,t,r]=CS(this.timestamp,0,0);this.direction=[e,-r,t]}else{let{latitude:e,longitude:r}=t;this.direction=CS(this.timestamp,e,r)}return this}}({timestamp:Date.UTC(2024,4,18,20),color:[253,186,116],intensity:1.1,direction:[-.7,-.6,-.5]})]});function Lw({scenario:e,focus:t,highlights:r=[]}){let[i,n]=(0,Q.useState)(Lb),[s,a]=(0,Q.useState)("supported"),o=(0,Q.useMemo)(()=>.55+t/100*.55,[t]),l=(0,Q.useMemo)(()=>new Lv({id:"osm-base-tiles",data:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:256,refinementStrategy:"best-available",renderSubLayers:e=>{let{tile:t,data:r}=e;if(!t||!t.bbox||!r)return null;let{west:i,south:n,east:s,north:a}=t.bbox;return new Cj(e,{data:null,image:r,bounds:[i,n,s,a]})}}),[]),c=(0,Q.useMemo)(()=>e.layers.flatMap(e=>(function(e,t){switch(e.visualization){case"choropleth":case"flow":default:return[];case"point":{let r=LP(3+4*t,3,12);return[new C_({id:`scenario-${e.id}-points`,data:e.dataset.features,pickable:!0,parameters:{depthTest:!1},getPosition:e=>e.geometry.coordinates,radiusUnits:"pixels",getRadius:()=>r,getFillColor:()=>Lk(e.style.color,.65+.25*t),getLineColor:()=>Lk(e.style.secondaryColor??e.style.color,.9),lineWidthUnits:"pixels",lineWidthMinPixels:1.8,updateTriggers:{getRadius:r}})]}}})(e,o)).filter(e=>!!e),[e.layers,o]),u=(0,Q.useMemo)(()=>{if(0===r.length)return null;let e=LP(5+8*o,5,18);return new C_({id:"scenario-highlights",data:r.slice(0,6),pickable:!0,parameters:{depthTest:!1},getPosition:e=>e.coordinates,radiusUnits:"pixels",getRadius:()=>e,getFillColor:[14,165,233,210],getLineColor:[236,254,255,240],lineWidthUnits:"pixels",lineWidthMinPixels:2,updateTriggers:{getRadius:e}})},[r,o]);(0,Q.useEffect)(()=>{requestAnimationFrame(()=>{let e=document.createElement("canvas");a(["webgl2","webgl","experimental-webgl"].some(t=>null!==e.getContext(t))?"supported":"unsupported")})},[]);let h=(0,Q.useMemo)(()=>{let e=[l,...c];return u&&e.push(u),e},[l,c,u]),d=(0,Q.useMemo)(()=>e=>{let{object:t,layer:r}=e;if(!t||!r)return null;if("scenario-highlights"===r.id)return{html:[`<div class="font-semibold text-slate-900">${t.sensorId}</div>`,`<div class="text-[12px] text-slate-500">${t.sensorType}${t.district?` \xb7 ${t.district}`:""}</div>`,`<div class="mt-1 text-[12px] text-slate-600">Score ${t.anomalyScore.toFixed(2)}</div>`,t.health?`<div class="mt-1 inline-flex rounded-full bg-slate-100 px-2 py-[2px] text-[11px] font-medium text-slate-600">${t.health}</div>`:""].join(""),style:L_};let i="properties"in t?t.properties??void 0:void 0;if(!i)return null;let n=i.district??i.program??i.indicator??i.name;if(!n)return null;let s=[i.priority,i.status,i.stage,i.leadTheme,i.leadAgency,i.borough].map(e=>"string"==typeof e?e:null).filter(Boolean).join("  "),a=function(e){for(let[t,r]of[["sdgComposite",e=>`${(100*e).toFixed(0)} index`],["impactScore",e=>`${Math.round(100*e)} impact`],["progressIndex",e=>`${Math.round(100*e)} progress`],["householdsReached",e=>`${Math.round(e/1e3)}k households`],["wellbeingScore",e=>`${Math.round(e)} wellbeing`],["resilienceScore",e=>`${Math.round(100*e)} resilience`],["score",e=>e.toFixed(2)],["percentage",e=>`${Math.round(e)}%`],["height",e=>`${Math.round(e)} m`]]){let i=e[t];if("number"==typeof i&&Number.isFinite(i))return r(i)}return null}(i);return{html:[`<div class="font-semibold text-slate-900">${n}</div>`,s?`<div class="text-[12px] text-slate-500">${s}</div>`:"",null!==a?`<div class="mt-1 text-[12px] text-slate-600">Metric ${a}</div>`:""].join(""),style:L_}},[]),f=(0,Q.useCallback)(e=>{n(t=>({...t,zoom:LP(t.zoom+e,t.minZoom??4,t.maxZoom??18)}))},[]),p=(0,Q.useCallback)(e=>{let t=e?.viewState;t&&"object"==typeof t&&"longitude"in t&&"latitude"in t&&"zoom"in t&&n(e=>({...e,longitude:Number(t.longitude)||e.longitude,latitude:Number(t.latitude)||e.latitude,zoom:Number(t.zoom)||e.zoom,minZoom:"minZoom"in t&&"number"==typeof t.minZoom?t.minZoom:e.minZoom,maxZoom:"maxZoom"in t&&"number"==typeof t.maxZoom?t.maxZoom:e.maxZoom,pitch:"pitch"in t&&"number"==typeof t.pitch?t.pitch:e.pitch,bearing:"bearing"in t&&"number"==typeof t.bearing?t.bearing:e.bearing}))},[]);return(0,J.jsxs)("div",{className:"relative h-[360px] w-full overflow-hidden rounded-[32px] bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 sm:h-[440px] lg:h-[520px] xl:h-[560px]",children:["supported"===s?(0,J.jsx)(Cf,{viewState:i,controller:{dragPan:!0,scrollZoom:!0,dragRotate:!1,doubleClickZoom:!0,touchZoom:!0},onViewStateChange:p,layers:h,effects:[Lx],getTooltip:d,parameters:{clearColor:[.94,.97,.99,1]}}):"unsupported"===s?(0,J.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 text-sm font-medium text-slate-500",children:"Interactive map unavailable on this device."}):(0,J.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-slate-100 via-slate-200/90 to-slate-100 text-sm font-medium text-slate-500",children:"Preparing interactive map"}),(0,J.jsx)("div",{className:"pointer-events-none absolute left-6 top-6 rounded-full bg-white/90 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-500 shadow-sm ring-1 ring-slate-900/5",children:"New York City"}),(0,J.jsxs)("div",{className:"absolute right-6 top-6 flex flex-col gap-2",children:[(0,J.jsx)("button",{type:"button",className:"rounded-full bg-white/95 p-2 shadow-md ring-1 ring-slate-900/10 transition hover:scale-105 hover:bg-white",onClick:()=>f(.6),"aria-label":"Zoom in",children:(0,J.jsx)("span",{className:"block text-base font-semibold text-slate-600",children:"+"})}),(0,J.jsx)("button",{type:"button",className:"rounded-full bg-white/95 p-2 shadow-md ring-1 ring-slate-900/10 transition hover:scale-105 hover:bg-white",onClick:()=>f(-.6),"aria-label":"Zoom out",children:(0,J.jsx)("span",{className:"block text-base font-semibold text-slate-600",children:"-"})})]})]})}let L_={backgroundColor:"rgba(255,255,255,0.95)",borderRadius:"12px",padding:"10px 12px",boxShadow:"0 18px 32px -20px rgba(15,23,42,0.35)",border:"1px solid rgba(148, 163, 184, 0.2)",color:"#0f172a"};function Lk(e,t=1){let r=e.replace("#",""),i=3===r.length?r.split("").map(e=>`${e}${e}`).join(""):r,n=Number.parseInt(i,16);return Number.isNaN(n)||6!==i.length?[30,64,175,Math.round(255*t)]:[n>>16&255,n>>8&255,255&n,Math.round(255*LP(t,0,1))]}function LP(e,t,r){return Math.min(r,Math.max(t,e))}let LS=[{id:"sdg-progress",label:"Cities ready",unit:"of 18",value:12,change:{direction:"up",percentage:1,period:"day"},changeLabel:"+1 today"},{id:"vlr-ready",label:"SDG Goals",unit:"of 9",value:7,change:{direction:"up",percentage:2,period:"day"},changeLabel:"+2 today"},{id:"wellbeing-score",label:"Wellbeing index",unit:"index",value:74,change:{direction:"up",percentage:4.2,period:"quarter"},changeLabel:"+4.2 vs last quarter"},{id:"capital-ready",label:"Capital funded",unit:"% funded",value:81,change:{direction:"down",percentage:2.6,period:"month"},changeLabel:"-2.6% vs last month"}],LE=[{timestamp:"2025-01-01T00:00:00Z",value:.62},{timestamp:"2025-02-01T00:00:00Z",value:.64},{timestamp:"2025-03-01T00:00:00Z",value:.67},{timestamp:"2025-04-01T00:00:00Z",value:.7},{timestamp:"2025-05-01T00:00:00Z",value:.73},{timestamp:"2025-06-01T00:00:00Z",value:.75},{timestamp:"2025-07-01T00:00:00Z",value:.77},{timestamp:"2025-08-01T00:00:00Z",value:.79}],LA=[{timestamp:"2025-03-31",value:68},{timestamp:"2025-06-30",value:69},{timestamp:"2025-09-30",value:71},{timestamp:"2025-12-31",value:72},{timestamp:"2026-03-31",value:74},{timestamp:"2026-06-30",value:76}],LM=[{id:"gender-pay-gap",cluster:"Gender wage data gap",severity:"moderate",affectedAssets:5,expectedResolutionDays:14},{id:"green-jobs-status",cluster:"Green jobs grant awaiting codes",severity:"high",affectedAssets:7,expectedResolutionDays:21},{id:"housing-sdg11",cluster:"Affordable units inventory refresh",severity:"low",affectedAssets:3,expectedResolutionDays:10}],LT=[{id:"narrative-quality",metric:"Gender equity benchmarks met",value:"78%",change:"+5%",tone:"up"},{id:"evidence-match",metric:"Green jobs milestones funded",value:"64%",change:"+8%",tone:"up"},{id:"assurance-drift",metric:"Critical reviews pending",value:"9%",change:"-3%",tone:"down"}],LC=[{id:"gender-equity",scenario:"Gender Equity Acceleration",baseline:58,optimized:74,unit:"index score",narrative:"Targeted programs close the gender gap across priority districts."},{id:"green-economy",scenario:"Green Economy Pipeline",baseline:52,optimized:81,unit:"projects delivered",narrative:"Job grants tied to SDG 8 keep small business support on schedule."},{id:"affordable-housing",scenario:"Affordable Housing Progress",baseline:61,optimized:84,unit:"units certified",narrative:"Coordinated VLR tracking keeps SDG 11 reporting ahead of reviews."}],LO=[{id:"harbor-loop",district:"Harbor Resilience Loop",quadrant:"SDG",score:.86,driver:"SDG 13 shoreline projects still waiting environmental audits."},{id:"innovation-basin",district:"Innovation Basin Studio",quadrant:"VLR",score:.79,driver:"VLR labor evidence pending upload from economic development."},{id:"northern-commons",district:"Northern Commons Network",quadrant:"Equity",score:.91,driver:"Gender parity initiatives beating the SDG 5 target."},{id:"civic-spine",district:"Civic Learning Spine",quadrant:"Capital",score:.74,driver:"Green skills training budget pacing below plan."}],LI=[{id:"sdg-traceability",title:"Equality metrics cite their source",detail:"Gender parity scores list the census feed, steward, and refresh cycle."},{id:"fairness-monitor",title:"Economic guardrails stay tuned",detail:"Scenario tests confirm new jobs and SDG 8 targets stay within budget."},{id:"copilot-review",title:"Teams leave plain-language notes",detail:"Planner comments teach the copilot which VLR evidence cleared review."}],LL=[{id:"ingestion",title:"Telemetry Ingestion",status:"complete",etaMinutes:0,completion:100,summary:"64 feeds cleaned and aligned with the twin.",insights:["Duplicate curb sensors removed before features load."],kpis:[{id:"ingestion-latency",label:"Pipeline latency",value:"84 s",deltaLabel:"-18%",direction:"down",narrative:"GPU streaming keeps weather feeds under 90 seconds."}],compliance:[{id:"gdpr",label:"GDPR",status:"pass",description:"PII removed across mobility surveys."}],artifacts:[{id:"feature-store",label:"Feature store snapshot",detail:"118 features ready for modeling."}],auditTrail:[{timestamp:"07:42",actor:"Pipeline bot",message:"All connectors returned healthy responses."},{timestamp:"07:48",actor:"Ops analyst",message:"Flagged EV charger feed for follow-up."}],trend:{id:"ingestion-throughput",title:"Feeds cleared",metricLabel:"per 15 min",points:[{label:"07:00",value:28},{label:"07:15",value:31},{label:"07:30",value:34},{label:"07:45",value:36},{label:"08:00",value:38}],baselineLabel:"Target",baselineValue:32,summary:"Running 18% faster than last week's pull."}},{id:"classification",title:"SDG Classification",status:"active",etaMinutes:6,completion:68,summary:"Models tag telemetry with SDG codes and policy context.",insights:["Equity scan flagged a subsidy gap in East Dock."],kpis:[{id:"classification-precision",label:"Classification precision",value:"97.4%",deltaLabel:"+2.1%",direction:"up",narrative:"Active learning used the latest permit checks."}],compliance:[{id:"undp",label:"UN SDG taxonomy",status:"pass",description:"Indicators mapped with source evidence."},{id:"equity-scan",label:"Equity scan",status:"attention",description:"Needs fresh census microdata for East Dock."}],artifacts:[{id:"taxonomy-crosswalk",label:"Taxonomy crosswalk",detail:"SDG to city KPI table with confidence scores."}],auditTrail:[{timestamp:"08:03",actor:"Model ops",message:"Scaled GPU nodes to 3 for inference."},{timestamp:"08:05",actor:"Policy engine",message:"Loaded 2025 VLR guidance update."}],trend:{id:"classification-confidence",title:"Model confidence",metricLabel:"precision",unit:"%",points:[{label:"07:30",value:94.2},{label:"07:45",value:95.6},{label:"08:00",value:96.1},{label:"08:15",value:97.4}],baselineLabel:"Floor",baselineValue:92,summary:"Active learning lifted precision above the 95% floor."}},{id:"scoring",title:"KPI Scoring",status:"pending",etaMinutes:12,completion:24,summary:"Simulator checks live KPIs against last year.",insights:["Micromobility share is 12 points above last year."],kpis:[{id:"mobility-delta",label:"Mobility uplift",value:"+12.6 pts",deltaLabel:"+12.6 pts",direction:"up",narrative:"Curb pilots boosting throughput in Innovation Corridor."}],compliance:[{id:"audit-readiness",label:"Audit readiness",status:"pass",description:"Variance explanations link to twin snapshots."},{id:"kpi-governance",label:"KPI governance",status:"attention",description:"Waiting on budget sign-off for affordability metric."}],artifacts:[{id:"scenario-sheets",label:"Scenario sheets",detail:"Baseline vs. improved comparison for 2023-2025."}],auditTrail:[{timestamp:"08:12",actor:"Twin simulator",message:"Monte Carlo batch #2 at 70% completion."},{timestamp:"08:15",actor:"Finance liaison",message:"Budget office notified for affordability review."}],trend:{id:"scoring-uplift",title:"Mobility uplift",metricLabel:"vs baseline",unit:"pts",points:[{label:"Baseline",value:0},{label:"Week 1",value:4.5},{label:"Week 2",value:7.3},{label:"Week 3",value:9.8},{label:"Week 4",value:12.6}],baselineLabel:"Goal",baselineValue:8,summary:"Mobility plan is already four points above the quarterly goal."}},{id:"narrative",title:"Narrative Assembly",status:"pending",etaMinutes:18,completion:12,summary:"Writer bot turns KPIs into clear VLR stories.",insights:["Executive summary waits for SDG 9 evidence."],kpis:[{id:"draft-speed",label:"Draft speed",value:"4m 28s",deltaLabel:"-1.9 min",direction:"down",narrative:"Template tuning trimmed drafting time this week."}],compliance:[{id:"language-pack",label:"Language pack",status:"pass",description:"Multilingual glossary validated."},{id:"sensitivity",label:"Sensitivity review",status:"risk",description:"Human review needed for coastal displacement section."}],artifacts:[{id:"briefing-deck",label:"Briefing deck",detail:"Slides with twin heatmaps ready for export."}],auditTrail:[{timestamp:"08:20",actor:"Narrative bot",message:"Drafted climate resilience chapter v1.4."},{timestamp:"08:23",actor:"Sensitivity reviewer",message:"Requested community quotes for Harbor District."}],trend:{id:"narrative-cycle",title:"Draft cycle time",metricLabel:"per chapter",unit:"min",points:[{label:"Kickoff",value:9.4},{label:"Climate",value:6.2},{label:"Equity",value:5.5},{label:"Mobility",value:4.8}],baselineLabel:"Target",baselineValue:6,summary:"Playbooks keep chapters under the six minute target."}}],Lj=[{id:"heat-strategy",severity:"warning",message:"Heat plan pending for two waterfront schools.",suggestedAction:"Trigger the cooling shelter protocol."},{id:"der-incentives",severity:"critical",message:"DER incentives need council approval before the Q4 vote.",suggestedAction:"Book a finance briefing with the innovation committee."},{id:"equity-gap",severity:"info",message:"Mobility subsidy data missing for East Dock.",suggestedAction:"Request census microdata and fare card reports."}],LN={type:"FeatureCollection",name:"ImpactCorridors",features:[{type:"Feature",properties:{program:"Civic Learning Spine",sdgTarget:"SDG 4.3  Lifelong Learning Access",impactScore:.91,stage:"Scaling",leadAgency:"Department of Learning Innovation"},geometry:{type:"LineString",coordinates:[[-74.012,40.704],[-74.002,40.716],[-73.989,40.73],[-73.977,40.744]]}},{type:"Feature",properties:{program:"Coastal Resilience Walk",sdgTarget:"SDG 13.1  Climate Preparedness",impactScore:.84,stage:"Pilot",leadAgency:"Urban Coast Office"},geometry:{type:"LineString",coordinates:[[-74.018,40.708],[-74.009,40.721],[-73.995,40.732],[-73.984,40.741]]}},{type:"Feature",properties:{program:"Innovation Commons Stroll",sdgTarget:"SDG 11.7  Public Space Equity",impactScore:.79,stage:"Discovery",leadAgency:"Civic Commons Lab"},geometry:{type:"LineString",coordinates:[[-73.982,40.768],[-73.971,40.778],[-73.959,40.785],[-73.947,40.793]]}}]},LD={type:"FeatureCollection",name:"DistrictSnapshots",features:[{type:"Feature",properties:{district:"Harbor Resilience Loop",sdgComposite:.86,leadTheme:"Climate Adaptation",householdsReached:186e3,priority:"Accelerate"},geometry:{type:"Polygon",coordinates:[[[-74.018,40.699],[-74.002,40.712],[-73.996,40.706],[-74.01,40.693],[-74.018,40.699]]]}},{type:"Feature",properties:{district:"Innovation Basin Studio",sdgComposite:.72,leadTheme:"Skills & Jobs",householdsReached:94e3,priority:"Stabilize"},geometry:{type:"Polygon",coordinates:[[[-73.999,40.741],[-73.985,40.748],[-73.973,40.739],[-73.988,40.733],[-73.999,40.741]]]}},{type:"Feature",properties:{district:"Northern Commons Network",sdgComposite:.9,leadTheme:"Housing Inclusion",householdsReached:158e3,priority:"Monitor"},geometry:{type:"Polygon",coordinates:[[[-73.972,40.795],[-73.958,40.803],[-73.946,40.792],[-73.96,40.784],[-73.972,40.795]]]}}]},LR={type:"FeatureCollection",name:"IndicatorSites",features:[{type:"Feature",properties:{id:"SDG-204",indicator:"Affordable Housing Access",sdgTarget:"SDG 11.1",status:"On Track",progressIndex:.82,refreshMinutesAgo:4,district:"Aurora District"},geometry:{type:"Point",coordinates:[-73.995,40.734]}},{type:"Feature",properties:{id:"SDG-441",indicator:"Green Schoolyards Coverage",sdgTarget:"SDG 3.4",status:"Watch",progressIndex:.63,refreshMinutesAgo:2,district:"Harbor Resilience Loop"},geometry:{type:"Point",coordinates:[-74.006,40.715]}},{type:"Feature",properties:{id:"SDG-109",indicator:"Clean Energy Retrofits",sdgTarget:"SDG 7.2",status:"On Track",progressIndex:.74,refreshMinutesAgo:1,district:"Aurora Medical Campus"},geometry:{type:"Point",coordinates:[-73.958,40.79]}},{type:"Feature",properties:{id:"SDG-512",indicator:"Community Health Access",sdgTarget:"SDG 3.8",status:"Delayed",progressIndex:.41,refreshMinutesAgo:17,district:"Care Corridor Spine"},geometry:{type:"Point",coordinates:[-73.981,40.758]}},{type:"Feature",properties:{id:"SDG-317",indicator:"Urban Cooling Canopies",sdgTarget:"SDG 13.1",status:"Watch",progressIndex:.58,refreshMinutesAgo:3,district:"Innovation Basin Studio"},geometry:{type:"Point",coordinates:[-73.973,40.743]}},{type:"Feature",properties:{id:"SDG-204B",indicator:"Resilient Infrastructure Upgrades",sdgTarget:"SDG 9.1",status:"Watch",progressIndex:.69,refreshMinutesAgo:6,district:"Harbor Resilience Loop"},geometry:{type:"Point",coordinates:[-74.01,40.706]}},{type:"Feature",properties:{id:"SDG-626",indicator:"Civic Wi-Fi Coverage",sdgTarget:"SDG 9.c",status:"On Track",progressIndex:.77,refreshMinutesAgo:5,district:"Civic Learning Spine"},geometry:{type:"Point",coordinates:[-73.948,40.772]}}]},Lz=Object.fromEntries(LS.map(e=>[e.id,e]));function LF(e){return e.map(e=>Lz[e]).filter(e=>!!e).map(e=>({...e}))}let LB={"sdg-localization":{key:"sdg-localization",name:"SDG Localization",tagline:"District SDG scorecards update in real time.",narrative:"Census, budget, and survey feeds flag which districts fall behind so crews can move before targets slip.",command:"Resolve the two districts slipping before the daily stand-up.",liveSignals:[{label:"Districts on track",value:"12 of 18",delta:"+1 today",tone:"positive"},{label:"Data refresh",value:"98%",delta:"Live",tone:"positive"}],aiInsights:[{title:"Send the tutoring crew back to Innovation Basin.",detail:"Attendance dipped in two schools; a mobile team lifts SDG 4 back on track within five days.",confidence:.82}],kpis:LF(["sdg-progress"]),layers:[{id:"district-sdg-composite",label:"District SDG Composite",legend:"Blue shows overall SDG score for each district.",visualization:"choropleth",dataset:LD,style:{color:"#38bdf8",secondaryColor:"#0ea5e9",intensity:.78}},{id:"indicator-observatories",label:"Indicator Observatories",legend:"Pins mark indicators drifting from plan.",visualization:"point",dataset:LR,style:{color:"#7c3aed",secondaryColor:"#a855f7",intensity:.62}},{id:"impact-corridors",label:"Impact Corridors",legend:"Lines show active programs boosting SDG delivery.",visualization:"flow",dataset:LN,style:{color:"#0ea5e9",secondaryColor:"#22d3ee",intensity:.7}}],actions:["Deploy the mobile tutoring team to Innovation Basin.","Add Harbor Loops climate win to tomorrows VLR brief."]},"vlr-automation":{key:"vlr-automation",name:"VLR Automation Console",tagline:"AI keeps the voluntary local review on schedule.",narrative:"Evidence from finance, climate, and community teams syncs automatically so drafts stay ready for sign-off.",command:"Publish the executive summary by Friday.",liveSignals:[{label:"Sections ready",value:"7 / 9",delta:"+2 today",tone:"positive"},{label:"Evidence cleared",value:"92%",delta:"+6%",tone:"positive"}],aiInsights:[{title:"SDG 9 packet still waits on invoice tags.",detail:"Finance is missing two project codes; approve the fetch and the automation will reconcile them.",confidence:.9}],kpis:LF(["vlr-ready"]),layers:[{id:"evidence-corridors",label:"Evidence Corridors",legend:"Lines show which programs feed the VLR workspace.",visualization:"flow",dataset:LN,style:{color:"#14b8a6",secondaryColor:"#22c55e",intensity:.68}},{id:"evidence-sites",label:"Evidence Sites",legend:"Pins highlight packets waiting for review.",visualization:"point",dataset:LR,style:{color:"#f97316",secondaryColor:"#fb923c",intensity:.58}}],actions:["Nudge finance to clear the SDG 9 invoices.","Publish the SDG 11 public space story after quotes land."]},"city-profiling":{key:"city-profiling",name:"City Profiling Studio",tagline:"Compare wellbeing lift by district.",narrative:"The twin blends demographics, capital plans, and sentiment to show which projects move wellbeing fastest.",command:"Select the next three districts for council funding.",liveSignals:[{label:"Wellbeing score",value:"74 index",delta:"+4 pts",tone:"positive"},{label:"Capital on track",value:"81% funded",delta:"-3%",tone:"warning"}],aiInsights:[{title:"Northern Commons still delivers the biggest lift.",detail:"A $14M streetscape bundle lifts wellbeing six points without raising displacement risk.",confidence:.88}],kpis:LF(["wellbeing-score","capital-ready"]),layers:[{id:"profile-districts",label:"District Profiles",legend:"Purple shows overall wellbeing score.",visualization:"choropleth",dataset:LD,style:{color:"#a855f7",secondaryColor:"#6366f1",intensity:.74}},{id:"investment-corridors",label:"Investment Corridors",legend:"Lines trace priority capital programs.",visualization:"flow",dataset:LN,style:{color:"#38bdf8",secondaryColor:"#22d3ee",intensity:.65}},{id:"wellbeing-sentinels",label:"Wellbeing Sentinels",legend:"Pins pulse if wellbeing deviates from forecast.",visualization:"point",dataset:LR,style:{color:"#22c55e",secondaryColor:"#4ade80",intensity:.6}}],actions:["Advance the Northern Commons package to the council agenda.","Share Harbor Loop shoreline options with the budget office."]}},LU=(e,t)=>{if(0===e.length)return t.classGroupId;let r=e[0],i=t.nextPart.get(r),n=i?LU(e.slice(1),i):void 0;if(n)return n;if(0===t.validators.length)return;let s=e.join("-");return t.validators.find(({validator:e})=>e(s))?.classGroupId},L$=/^\[(.+)\]$/,LV=(e,t,r,i)=>{e.forEach(e=>{if("string"==typeof e){(""===e?t:LW(t,e)).classGroupId=r;return}"function"==typeof e?LG(e)?LV(e(i),t,r,i):t.validators.push({validator:e,classGroupId:r}):Object.entries(e).forEach(([e,n])=>{LV(n,LW(t,e),r,i)})})},LW=(e,t)=>{let r=e;return t.split("-").forEach(e=>{r.nextPart.has(e)||r.nextPart.set(e,{nextPart:new Map,validators:[]}),r=r.nextPart.get(e)}),r},LG=e=>e.isThemeGetter,Lq=/\s+/;function LH(){let e,t,r=0,i="";for(;r<arguments.length;)(e=arguments[r++])&&(t=LK(e))&&(i&&(i+=" "),i+=t);return i}let LK=e=>{let t;if("string"==typeof e)return e;let r="";for(let i=0;i<e.length;i++)e[i]&&(t=LK(e[i]))&&(r&&(r+=" "),r+=t);return r},LZ=e=>{let t=t=>t[e]||[];return t.isThemeGetter=!0,t},LY=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,LX=/^\((?:(\w[\w-]*):)?(.+)\)$/i,LJ=/^\d+\/\d+$/,LQ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,L0=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,L1=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,L2=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,L3=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,L4=e=>LJ.test(e),L5=e=>!!e&&!Number.isNaN(Number(e)),L6=e=>!!e&&Number.isInteger(Number(e)),L8=e=>e.endsWith("%")&&L5(e.slice(0,-1)),L7=e=>LQ.test(e),L9=()=>!0,je=e=>L0.test(e)&&!L1.test(e),jt=()=>!1,jr=e=>L2.test(e),ji=e=>L3.test(e),jn=e=>!ja(e)&&!jd(e),js=e=>jb(e,jk,jt),ja=e=>LY.test(e),jo=e=>jb(e,jP,je),jl=e=>jb(e,jS,L5),jc=e=>jb(e,jw,jt),ju=e=>jb(e,j_,ji),jh=e=>jb(e,jA,jr),jd=e=>LX.test(e),jf=e=>jx(e,jP),jp=e=>jx(e,jE),jg=e=>jx(e,jw),jm=e=>jx(e,jk),jy=e=>jx(e,j_),jv=e=>jx(e,jA,!0),jb=(e,t,r)=>{let i=LY.exec(e);return!!i&&(i[1]?t(i[1]):r(i[2]))},jx=(e,t,r=!1)=>{let i=LX.exec(e);return!!i&&(i[1]?t(i[1]):r)},jw=e=>"position"===e||"percentage"===e,j_=e=>"image"===e||"url"===e,jk=e=>"length"===e||"size"===e||"bg-size"===e,jP=e=>"length"===e,jS=e=>"number"===e,jE=e=>"family-name"===e,jA=e=>"shadow"===e,jM=function(e,...t){let r,i,n,s=function(o){var l;let c;return i=(r={cache:(e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,r=new Map,i=new Map,n=(n,s)=>{r.set(n,s),++t>e&&(t=0,i=r,r=new Map)};return{get(e){let t=r.get(e);return void 0!==t?t:void 0!==(t=i.get(e))?(n(e,t),t):void 0},set(e,t){r.has(e)?r.set(e,t):n(e,t)}}})((l=t.reduce((e,t)=>t(e),e())).cacheSize),parseClassName:(e=>{let{prefix:t,experimentalParseClassName:r}=e,i=e=>{let t,r,i=[],n=0,s=0,a=0;for(let t=0;t<e.length;t++){let o=e[t];if(0===n&&0===s){if(":"===o){i.push(e.slice(a,t)),a=t+1;continue}if("/"===o){r=t;continue}}"["===o?n++:"]"===o?n--:"("===o?s++:")"===o&&s--}let o=0===i.length?e:e.substring(a),l=(t=o).endsWith("!")?t.substring(0,t.length-1):t.startsWith("!")?t.substring(1):t;return{modifiers:i,hasImportantModifier:l!==o,baseClassName:l,maybePostfixModifierPosition:r&&r>a?r-a:void 0}};if(t){let e=t+":",r=i;i=t=>t.startsWith(e)?r(t.substring(e.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:t,maybePostfixModifierPosition:void 0}}if(r){let e=i;i=t=>r({className:t,parseClassName:e})}return i})(l),sortModifiers:(c=Object.fromEntries(l.orderSensitiveModifiers.map(e=>[e,!0])),e=>{if(e.length<=1)return e;let t=[],r=[];return e.forEach(e=>{"["===e[0]||c[e]?(t.push(...r.sort(),e),r=[]):r.push(e)}),t.push(...r.sort()),t}),...(e=>{let t=(e=>{let{theme:t,classGroups:r}=e,i={nextPart:new Map,validators:[]};for(let e in r)LV(r[e],i,e,t);return i})(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:e=>{let r=e.split("-");return""===r[0]&&1!==r.length&&r.shift(),LU(r,t)||(e=>{if(L$.test(e)){let t=L$.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}})(e)},getConflictingClassGroupIds:(e,t)=>{let n=r[e]||[];return t&&i[e]?[...n,...i[e]]:n}}})(l)}).cache.get,n=r.cache.set,s=a,a(o)};function a(e){let t=i(e);if(t)return t;let s=((e,t)=>{let{parseClassName:r,getClassGroupId:i,getConflictingClassGroupIds:n,sortModifiers:s}=t,a=[],o=e.trim().split(Lq),l="";for(let e=o.length-1;e>=0;e-=1){let t=o[e],{isExternal:c,modifiers:u,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}=r(t);if(c){l=t+(l.length>0?" "+l:l);continue}let p=!!f,g=i(p?d.substring(0,f):d);if(!g){if(!p||!(g=i(d))){l=t+(l.length>0?" "+l:l);continue}p=!1}let m=s(u).join(":"),y=h?m+"!":m,v=y+g;if(a.includes(v))continue;a.push(v);let b=n(g,p);for(let e=0;e<b.length;++e){let t=b[e];a.push(y+t)}l=t+(l.length>0?" "+l:l)}return l})(e,r);return n(e,s),s}return function(){return s(LH.apply(null,arguments))}}(()=>{let e=LZ("color"),t=LZ("font"),r=LZ("text"),i=LZ("font-weight"),n=LZ("tracking"),s=LZ("leading"),a=LZ("breakpoint"),o=LZ("container"),l=LZ("spacing"),c=LZ("radius"),u=LZ("shadow"),h=LZ("inset-shadow"),d=LZ("text-shadow"),f=LZ("drop-shadow"),p=LZ("blur"),g=LZ("perspective"),m=LZ("aspect"),y=LZ("ease"),v=LZ("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],x=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],w=()=>[...x(),jd,ja],_=()=>["auto","hidden","clip","visible","scroll"],k=()=>["auto","contain","none"],P=()=>[jd,ja,l],S=()=>[L4,"full","auto",...P()],E=()=>[L6,"none","subgrid",jd,ja],A=()=>["auto",{span:["full",L6,jd,ja]},L6,jd,ja],M=()=>[L6,"auto",jd,ja],T=()=>["auto","min","max","fr",jd,ja],C=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],O=()=>["start","end","center","stretch","center-safe","end-safe"],I=()=>["auto",...P()],L=()=>[L4,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...P()],j=()=>[e,jd,ja],N=()=>[...x(),jg,jc,{position:[jd,ja]}],D=()=>["no-repeat",{repeat:["","x","y","space","round"]}],R=()=>["auto","cover","contain",jm,js,{size:[jd,ja]}],z=()=>[L8,jf,jo],F=()=>["","none","full",c,jd,ja],B=()=>["",L5,jf,jo],U=()=>["solid","dashed","dotted","double"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],V=()=>[L5,L8,jg,jc],W=()=>["","none",p,jd,ja],G=()=>["none",L5,jd,ja],q=()=>["none",L5,jd,ja],H=()=>[L5,jd,ja],K=()=>[L4,"full",...P()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[L7],breakpoint:[L7],color:[L9],container:[L7],"drop-shadow":[L7],ease:["in","out","in-out"],font:[jn],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[L7],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[L7],shadow:[L7],spacing:["px",L5],text:[L7],"text-shadow":[L7],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",L4,ja,jd,m]}],container:["container"],columns:[{columns:[L5,ja,jd,o]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:w()}],overflow:[{overflow:_()}],"overflow-x":[{"overflow-x":_()}],"overflow-y":[{"overflow-y":_()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:S()}],"inset-x":[{"inset-x":S()}],"inset-y":[{"inset-y":S()}],start:[{start:S()}],end:[{end:S()}],top:[{top:S()}],right:[{right:S()}],bottom:[{bottom:S()}],left:[{left:S()}],visibility:["visible","invisible","collapse"],z:[{z:[L6,"auto",jd,ja]}],basis:[{basis:[L4,"full","auto",o,...P()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[L5,L4,"auto","initial","none",ja]}],grow:[{grow:["",L5,jd,ja]}],shrink:[{shrink:["",L5,jd,ja]}],order:[{order:[L6,"first","last","none",jd,ja]}],"grid-cols":[{"grid-cols":E()}],"col-start-end":[{col:A()}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":E()}],"row-start-end":[{row:A()}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":T()}],"auto-rows":[{"auto-rows":T()}],gap:[{gap:P()}],"gap-x":[{"gap-x":P()}],"gap-y":[{"gap-y":P()}],"justify-content":[{justify:[...C(),"normal"]}],"justify-items":[{"justify-items":[...O(),"normal"]}],"justify-self":[{"justify-self":["auto",...O()]}],"align-content":[{content:["normal",...C()]}],"align-items":[{items:[...O(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...O(),{baseline:["","last"]}]}],"place-content":[{"place-content":C()}],"place-items":[{"place-items":[...O(),"baseline"]}],"place-self":[{"place-self":["auto",...O()]}],p:[{p:P()}],px:[{px:P()}],py:[{py:P()}],ps:[{ps:P()}],pe:[{pe:P()}],pt:[{pt:P()}],pr:[{pr:P()}],pb:[{pb:P()}],pl:[{pl:P()}],m:[{m:I()}],mx:[{mx:I()}],my:[{my:I()}],ms:[{ms:I()}],me:[{me:I()}],mt:[{mt:I()}],mr:[{mr:I()}],mb:[{mb:I()}],ml:[{ml:I()}],"space-x":[{"space-x":P()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":P()}],"space-y-reverse":["space-y-reverse"],size:[{size:L()}],w:[{w:[o,"screen",...L()]}],"min-w":[{"min-w":[o,"screen","none",...L()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...L()]}],h:[{h:["screen","lh",...L()]}],"min-h":[{"min-h":["screen","lh","none",...L()]}],"max-h":[{"max-h":["screen","lh",...L()]}],"font-size":[{text:["base",r,jf,jo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,jd,jl]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",L8,ja]}],"font-family":[{font:[jp,ja,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,jd,ja]}],"line-clamp":[{"line-clamp":[L5,"none",jd,jl]}],leading:[{leading:[s,...P()]}],"list-image":[{"list-image":["none",jd,ja]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",jd,ja]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:j()}],"text-color":[{text:j()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[L5,"from-font","auto",jd,jo]}],"text-decoration-color":[{decoration:j()}],"underline-offset":[{"underline-offset":[L5,"auto",jd,ja]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:P()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",jd,ja]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",jd,ja]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:N()}],"bg-repeat":[{bg:D()}],"bg-size":[{bg:R()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},L6,jd,ja],radial:["",jd,ja],conic:[L6,jd,ja]},jy,ju]}],"bg-color":[{bg:j()}],"gradient-from-pos":[{from:z()}],"gradient-via-pos":[{via:z()}],"gradient-to-pos":[{to:z()}],"gradient-from":[{from:j()}],"gradient-via":[{via:j()}],"gradient-to":[{to:j()}],rounded:[{rounded:F()}],"rounded-s":[{"rounded-s":F()}],"rounded-e":[{"rounded-e":F()}],"rounded-t":[{"rounded-t":F()}],"rounded-r":[{"rounded-r":F()}],"rounded-b":[{"rounded-b":F()}],"rounded-l":[{"rounded-l":F()}],"rounded-ss":[{"rounded-ss":F()}],"rounded-se":[{"rounded-se":F()}],"rounded-ee":[{"rounded-ee":F()}],"rounded-es":[{"rounded-es":F()}],"rounded-tl":[{"rounded-tl":F()}],"rounded-tr":[{"rounded-tr":F()}],"rounded-br":[{"rounded-br":F()}],"rounded-bl":[{"rounded-bl":F()}],"border-w":[{border:B()}],"border-w-x":[{"border-x":B()}],"border-w-y":[{"border-y":B()}],"border-w-s":[{"border-s":B()}],"border-w-e":[{"border-e":B()}],"border-w-t":[{"border-t":B()}],"border-w-r":[{"border-r":B()}],"border-w-b":[{"border-b":B()}],"border-w-l":[{"border-l":B()}],"divide-x":[{"divide-x":B()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":B()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:j()}],"border-color-x":[{"border-x":j()}],"border-color-y":[{"border-y":j()}],"border-color-s":[{"border-s":j()}],"border-color-e":[{"border-e":j()}],"border-color-t":[{"border-t":j()}],"border-color-r":[{"border-r":j()}],"border-color-b":[{"border-b":j()}],"border-color-l":[{"border-l":j()}],"divide-color":[{divide:j()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[L5,jd,ja]}],"outline-w":[{outline:["",L5,jf,jo]}],"outline-color":[{outline:j()}],shadow:[{shadow:["","none",u,jv,jh]}],"shadow-color":[{shadow:j()}],"inset-shadow":[{"inset-shadow":["none",h,jv,jh]}],"inset-shadow-color":[{"inset-shadow":j()}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:j()}],"ring-offset-w":[{"ring-offset":[L5,jo]}],"ring-offset-color":[{"ring-offset":j()}],"inset-ring-w":[{"inset-ring":B()}],"inset-ring-color":[{"inset-ring":j()}],"text-shadow":[{"text-shadow":["none",d,jv,jh]}],"text-shadow-color":[{"text-shadow":j()}],opacity:[{opacity:[L5,jd,ja]}],"mix-blend":[{"mix-blend":[...$(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":$()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[L5]}],"mask-image-linear-from-pos":[{"mask-linear-from":V()}],"mask-image-linear-to-pos":[{"mask-linear-to":V()}],"mask-image-linear-from-color":[{"mask-linear-from":j()}],"mask-image-linear-to-color":[{"mask-linear-to":j()}],"mask-image-t-from-pos":[{"mask-t-from":V()}],"mask-image-t-to-pos":[{"mask-t-to":V()}],"mask-image-t-from-color":[{"mask-t-from":j()}],"mask-image-t-to-color":[{"mask-t-to":j()}],"mask-image-r-from-pos":[{"mask-r-from":V()}],"mask-image-r-to-pos":[{"mask-r-to":V()}],"mask-image-r-from-color":[{"mask-r-from":j()}],"mask-image-r-to-color":[{"mask-r-to":j()}],"mask-image-b-from-pos":[{"mask-b-from":V()}],"mask-image-b-to-pos":[{"mask-b-to":V()}],"mask-image-b-from-color":[{"mask-b-from":j()}],"mask-image-b-to-color":[{"mask-b-to":j()}],"mask-image-l-from-pos":[{"mask-l-from":V()}],"mask-image-l-to-pos":[{"mask-l-to":V()}],"mask-image-l-from-color":[{"mask-l-from":j()}],"mask-image-l-to-color":[{"mask-l-to":j()}],"mask-image-x-from-pos":[{"mask-x-from":V()}],"mask-image-x-to-pos":[{"mask-x-to":V()}],"mask-image-x-from-color":[{"mask-x-from":j()}],"mask-image-x-to-color":[{"mask-x-to":j()}],"mask-image-y-from-pos":[{"mask-y-from":V()}],"mask-image-y-to-pos":[{"mask-y-to":V()}],"mask-image-y-from-color":[{"mask-y-from":j()}],"mask-image-y-to-color":[{"mask-y-to":j()}],"mask-image-radial":[{"mask-radial":[jd,ja]}],"mask-image-radial-from-pos":[{"mask-radial-from":V()}],"mask-image-radial-to-pos":[{"mask-radial-to":V()}],"mask-image-radial-from-color":[{"mask-radial-from":j()}],"mask-image-radial-to-color":[{"mask-radial-to":j()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":x()}],"mask-image-conic-pos":[{"mask-conic":[L5]}],"mask-image-conic-from-pos":[{"mask-conic-from":V()}],"mask-image-conic-to-pos":[{"mask-conic-to":V()}],"mask-image-conic-from-color":[{"mask-conic-from":j()}],"mask-image-conic-to-color":[{"mask-conic-to":j()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:N()}],"mask-repeat":[{mask:D()}],"mask-size":[{mask:R()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",jd,ja]}],filter:[{filter:["","none",jd,ja]}],blur:[{blur:W()}],brightness:[{brightness:[L5,jd,ja]}],contrast:[{contrast:[L5,jd,ja]}],"drop-shadow":[{"drop-shadow":["","none",f,jv,jh]}],"drop-shadow-color":[{"drop-shadow":j()}],grayscale:[{grayscale:["",L5,jd,ja]}],"hue-rotate":[{"hue-rotate":[L5,jd,ja]}],invert:[{invert:["",L5,jd,ja]}],saturate:[{saturate:[L5,jd,ja]}],sepia:[{sepia:["",L5,jd,ja]}],"backdrop-filter":[{"backdrop-filter":["","none",jd,ja]}],"backdrop-blur":[{"backdrop-blur":W()}],"backdrop-brightness":[{"backdrop-brightness":[L5,jd,ja]}],"backdrop-contrast":[{"backdrop-contrast":[L5,jd,ja]}],"backdrop-grayscale":[{"backdrop-grayscale":["",L5,jd,ja]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[L5,jd,ja]}],"backdrop-invert":[{"backdrop-invert":["",L5,jd,ja]}],"backdrop-opacity":[{"backdrop-opacity":[L5,jd,ja]}],"backdrop-saturate":[{"backdrop-saturate":[L5,jd,ja]}],"backdrop-sepia":[{"backdrop-sepia":["",L5,jd,ja]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":P()}],"border-spacing-x":[{"border-spacing-x":P()}],"border-spacing-y":[{"border-spacing-y":P()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",jd,ja]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[L5,"initial",jd,ja]}],ease:[{ease:["linear","initial",y,jd,ja]}],delay:[{delay:[L5,jd,ja]}],animate:[{animate:["none",v,jd,ja]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,jd,ja]}],"perspective-origin":[{"perspective-origin":w()}],rotate:[{rotate:G()}],"rotate-x":[{"rotate-x":G()}],"rotate-y":[{"rotate-y":G()}],"rotate-z":[{"rotate-z":G()}],scale:[{scale:q()}],"scale-x":[{"scale-x":q()}],"scale-y":[{"scale-y":q()}],"scale-z":[{"scale-z":q()}],"scale-3d":["scale-3d"],skew:[{skew:H()}],"skew-x":[{"skew-x":H()}],"skew-y":[{"skew-y":H()}],transform:[{transform:[jd,ja,"","none","gpu","cpu"]}],"transform-origin":[{origin:w()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:K()}],"translate-x":[{"translate-x":K()}],"translate-y":[{"translate-y":K()}],"translate-z":[{"translate-z":K()}],"translate-none":["translate-none"],accent:[{accent:j()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:j()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",jd,ja]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":P()}],"scroll-mx":[{"scroll-mx":P()}],"scroll-my":[{"scroll-my":P()}],"scroll-ms":[{"scroll-ms":P()}],"scroll-me":[{"scroll-me":P()}],"scroll-mt":[{"scroll-mt":P()}],"scroll-mr":[{"scroll-mr":P()}],"scroll-mb":[{"scroll-mb":P()}],"scroll-ml":[{"scroll-ml":P()}],"scroll-p":[{"scroll-p":P()}],"scroll-px":[{"scroll-px":P()}],"scroll-py":[{"scroll-py":P()}],"scroll-ps":[{"scroll-ps":P()}],"scroll-pe":[{"scroll-pe":P()}],"scroll-pt":[{"scroll-pt":P()}],"scroll-pr":[{"scroll-pr":P()}],"scroll-pb":[{"scroll-pb":P()}],"scroll-pl":[{"scroll-pl":P()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",jd,ja]}],fill:[{fill:["none",...j()]}],"stroke-w":[{stroke:[L5,jf,jo,jl]}],stroke:[{stroke:["none",...j()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}});function jT(...e){return jM(eu(e))}let jC=[{id:"digital-twin",label:"GIS City Analysis",description:"City map with SDG signals.",icon:ea},{id:"vlr",label:"VLR Automation",description:"Track the review workflow.",icon:el},{id:"pipelines",label:"AI Pipelines",description:"See forecasts and model health.",icon:es}],jO={"digital-twin":"sdg-localization",vlr:"vlr-automation",pipelines:"city-profiling"},jI={ingestion:"Data check",classification:"Tag evidence",scoring:"Score outcomes",narrative:"Draft stories"},jL={warning:"bg-amber-100 text-amber-700",critical:"bg-rose-100 text-rose-700",info:"bg-sky-100 text-sky-700"},jj={warning:"Attention",critical:"Urgent",info:"Info"};function jN(){let e,[t,r]=(0,Q.useState)("digital-twin"),[i,n]=(0,Q.useState)(55),s=jO[t],a=LB[s];if(!a)throw Error(`Scenario not found for key ${s}`);let o=(e=LB[s])?{signals:e.liveSignals,aiInsights:e.aiInsights,kpis:e.kpis,actions:e.actions}:[],l=Array.isArray(o)?{signals:[],aiInsights:[],kpis:[],actions:[]}:o,c=(0,Q.useMemo)(()=>{let e;return e=[],a.layers.filter(e=>"point"===e.visualization).forEach(t=>{t.dataset.features.forEach((r,i)=>{if(r.geometry?.type!=="Point")return;let n=r.geometry.coordinates;if(!Array.isArray(n)||n.length<2)return;let[s,a]=n;if("number"!=typeof s||"number"!=typeof a)return;let o=r.properties??{},l="number"==typeof o.progressIndex?o.progressIndex:null,c="number"==typeof o.anomalyScore?o.anomalyScore:null!==l?1-Math.min(Math.max(l,0),1):.45;e.push({id:String(o.id??r.id??`${t.id}-${i}`),sensorId:"string"==typeof o.id?o.id:`Node-${i+1}`,sensorType:"string"==typeof o.indicator?o.indicator:t.label,layerLabel:t.label,district:"string"==typeof o.district?o.district:null,health:"string"==typeof o.status?o.status:null,anomalyScore:Math.min(Math.max(c,0),1),lastReadingMinutes:"number"==typeof o.refreshMinutesAgo?o.refreshMinutesAgo:"number"==typeof o.lastReadingMinutesAgo?o.lastReadingMinutesAgo:null,coordinates:[s,a]})})}),e.slice(0,6)},[a]);return(0,J.jsxs)("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:[(0,J.jsx)(jD,{}),(0,J.jsx)("main",{className:"mx-auto w-full max-w-7xl px-4 pb-16 pt-6 sm:px-6 lg:px-8",children:(0,J.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-start",children:[(0,J.jsx)(jF,{activeModule:t,onSelect:r}),(0,J.jsxs)("div",{className:"flex-1 space-y-8",children:[(0,J.jsx)(jR,{}),(0,J.jsx)(jz,{activeModule:t,onSelect:r,className:"lg:hidden"}),"digital-twin"===t?(0,J.jsx)(jB,{scenario:a,insights:l,focus:i,onFocusChange:n,highlights:c}):null,"vlr"===t?(0,J.jsx)(j$,{scenario:a}):null,"pipelines"===t?(0,J.jsx)(jG,{}):null]})]})})]})}function jD(){return(0,J.jsx)("header",{className:"sticky top-0 z-30 border-b border-slate-200 bg-white/95 backdrop-blur",children:(0,J.jsxs)("div",{className:"mx-auto flex w-full max-w-7xl items-center gap-3 px-4 py-4 sm:px-6",children:[(0,J.jsx)("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-sky-100 text-sky-600 shadow-sm",children:(0,J.jsx)(eo,{className:"h-6 w-6"})}),(0,J.jsx)("span",{className:"text-xl font-semibold tracking-tight text-slate-700 sm:text-[1.6rem]",children:"Nexus Consulting"})]})})}function jR(){let e=LS.filter(e=>"sdg-progress"===e.id||"vlr-ready"===e.id);return(0,J.jsx)("section",{className:"mb-8 grid gap-3 sm:grid-cols-2",children:e.map(e=>{let t="up"===e.change.direction?"text-emerald-600":"text-rose-600",r=e.changeLabel??`${"up"===e.change.direction?"+":""}${e.change.percentage.toFixed(1)}% vs last ${e.change.period}`;return(0,J.jsxs)("article",{className:"flex flex-col justify-between rounded-3xl border border-slate-200 bg-white p-4 shadow-sm sm:p-5",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-sm font-medium text-slate-600",children:e.label}),(0,J.jsxs)("p",{className:"mt-3 flex items-baseline gap-2 text-slate-900",children:[(0,J.jsx)("span",{className:"text-3xl font-semibold",children:e.value}),(0,J.jsx)("span",{className:"text-sm font-medium text-slate-500",children:e.unit})]})]}),(0,J.jsx)("p",{className:jT("mt-4 text-xs font-medium",t),children:r})]},e.id)})})}function jz({activeModule:e,onSelect:t,className:r}){return(0,J.jsx)("nav",{className:jT("mb-6 flex flex-wrap gap-2",r),children:jC.map(r=>{let i=e===r.id;return(0,J.jsxs)("button",{type:"button",onClick:()=>t(r.id),className:jT("flex items-center gap-3 rounded-2xl border px-3 py-2 text-left text-sm transition-colors",i?"border-slate-300 bg-white text-slate-900 shadow-sm":"border-transparent bg-slate-100 text-slate-500 hover:border-slate-200 hover:bg-white"),children:[(0,J.jsx)("span",{className:jT("flex h-8 w-8 items-center justify-center rounded-xl text-sky-600",i?"bg-sky-100":"bg-slate-200/70"),children:(0,J.jsx)(r.icon,{className:"h-4 w-4"})}),(0,J.jsxs)("span",{children:[(0,J.jsx)("span",{className:"block text-sm font-semibold",children:r.label}),(0,J.jsx)("span",{className:"block text-xs text-slate-400",children:r.description})]})]},r.id)})})}function jF({activeModule:e,onSelect:t}){return(0,J.jsx)("aside",{className:"hidden shrink-0 lg:block lg:w-60 xl:w-64",children:(0,J.jsxs)("nav",{className:"sticky top-24 flex flex-col gap-1 rounded-3xl border border-slate-200 bg-white px-3 py-4 shadow-sm",children:[(0,J.jsx)("p",{className:"px-2 pb-2 text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Modules"}),jC.map(r=>{let i=e===r.id;return(0,J.jsxs)("button",{type:"button",onClick:()=>t(r.id),className:jT("flex items-start gap-3 rounded-2xl px-3 py-3 text-left transition-colors",i?"bg-sky-50 text-slate-900 shadow-[0_12px_32px_-24px_rgba(14,165,233,0.65)]":"text-slate-500 hover:bg-slate-100 hover:text-slate-800"),"aria-current":i?"page":void 0,children:[(0,J.jsx)("span",{className:jT("mt-0.5 flex h-9 w-9 items-center justify-center rounded-xl border text-sky-600",i?"border-sky-200 bg-white":"border-transparent bg-slate-200/60 text-slate-500"),children:(0,J.jsx)(r.icon,{className:"h-4 w-4"})}),(0,J.jsxs)("span",{className:"flex-1",children:[(0,J.jsx)("span",{className:"block text-sm font-semibold",children:r.label}),(0,J.jsx)("span",{className:"mt-1 block text-xs text-slate-400",children:r.description})]})]},r.id)})]})})}function jB({scenario:e,insights:t,focus:r,highlights:i}){let n=t.signals.slice(0,3),s=t.aiInsights[0],a=t.actions.slice(0,2),o=t.kpis.slice(0,2),l=i.slice(0,3),c=LE.slice(0,6).map(e=>({periodLabel:jq(e.timestamp),percentage:Math.round(100*e.value)})),u=c.length>0?c[c.length-1]?.percentage??null:null,h=c.length>0?c[0]?.percentage??null:null,d=null!==u&&null!==h?u-h:null,f=null!==d?`${d>=0?"+":""}${d.toFixed(0)} pts`:null,p=null!==d?d>=0?"text-emerald-600":"text-rose-600":"text-slate-400",g=[...n.map(e=>({id:`signal-${e.label}`,label:e.label,value:e.value,helper:e.delta})),...o.map(e=>({id:`kpi-${e.id}`,label:e.label,value:`${e.value} ${e.unit}`.trim(),helper:e.changeLabel??null}))];return(0,J.jsx)("section",{children:(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:e.name}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:e.tagline})]}),(0,J.jsxs)("p",{className:"text-xs text-slate-400",children:["Brief  ",e.command]})]}),(0,J.jsxs)("div",{className:"mt-6 grid gap-6 lg:grid-cols-[minmax(0,8.5fr)_minmax(0,3.5fr)] xl:gap-10",children:[(0,J.jsx)("div",{className:"space-y-4",children:(0,J.jsxs)("div",{className:"relative h-[400px] w-full overflow-hidden rounded-[36px] border border-slate-200 bg-slate-100/40 sm:h-[460px] lg:h-[560px] xl:h-[600px]",children:[(0,J.jsx)(Lw,{scenario:e,focus:r,highlights:i}),(0,J.jsx)(jU,{highlights:l})]})}),(0,J.jsxs)("aside",{className:"space-y-4",children:[l.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Active hotspots"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2",children:l.map(e=>{let t=`${Math.round(100*e.anomalyScore)}% watch`,r="Delayed"===e.health?"text-rose-600":"Watch"===e.health?"text-amber-600":"text-emerald-600";return(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2 text-sm text-slate-600",children:[(0,J.jsxs)("p",{className:"flex items-center justify-between text-sm font-semibold text-slate-900",children:[(0,J.jsx)("span",{children:e.sensorType}),(0,J.jsx)("span",{className:"text-xs font-medium text-slate-400",children:t})]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:[e.district??"Citywide",e.sensorId].filter(Boolean).join("  ")}),(0,J.jsx)("p",{className:jT("mt-1 text-xs font-medium",r),children:e.health??"On track"})]},e.id)})})]}):null,g.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Live numbers"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2",children:g.map(e=>(0,J.jsxs)("li",{className:"flex items-baseline justify-between gap-3 rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:e.label})]}),e.helper?(0,J.jsx)("span",{className:"text-xs font-medium text-slate-400",children:e.helper}):null]},e.id))})]}):null,c.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Gender parity outlook"}),(0,J.jsxs)("div",{className:"mt-2 flex items-baseline gap-2",children:[(0,J.jsx)("span",{className:"text-2xl font-semibold text-slate-900",children:null!==u?`${u.toFixed(0)}% SDG 5 achieved`:""}),f?(0,J.jsx)("span",{className:jT("text-xs font-medium",p),children:f}):null]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Updated monthly from the gender equity index"}),(0,J.jsx)("div",{className:"mt-4 h-24 w-full",children:(0,J.jsx)(nR,{width:"100%",height:"100%",children:(0,J.jsxs)(yt,{data:c,children:[(0,J.jsx)(vn,{hide:!0}),(0,J.jsx)(y4,{dataKey:"periodLabel",hide:!0}),(0,J.jsx)(m9,{type:"monotone",dataKey:"percentage",stroke:"#0ea5e9",strokeWidth:2,dot:!1})]})})})]}):null,s||a.length?(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"AI playbook"}),s?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"mt-2 text-base font-semibold text-slate-900",children:s.title}),s.detail?(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:s.detail}):null,(0,J.jsxs)("span",{className:"mt-3 inline-flex rounded-full bg-sky-100 px-3 py-1 text-xs font-medium text-sky-700",children:[Math.round(100*s.confidence),"% confidence"]})]}):null,a.length?(0,J.jsx)("ol",{className:"mt-4 space-y-2 text-sm text-slate-600",children:a.map((e,t)=>(0,J.jsxs)("li",{className:"flex gap-2",children:[(0,J.jsxs)("span",{className:"font-medium text-sky-500",children:[t+1,"."]}),(0,J.jsx)("span",{className:"leading-6",children:e})]},e))}):null]}):null]})]})]})})}function jU({highlights:e}){return e.length?(0,J.jsx)("div",{className:"pointer-events-none absolute right-4 top-4 flex max-w-xs flex-col gap-2",children:e.map(e=>(0,J.jsxs)("div",{className:"pointer-events-auto rounded-2xl border border-slate-200 bg-white/85 px-4 py-3 text-xs text-slate-600 shadow-[0_20px_50px_-32px_rgba(15,23,42,0.45)] backdrop-blur",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.sensorType}),(0,J.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:[e.district??"Citywide","  ",e.sensorId]}),(0,J.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,J.jsxs)("span",{className:"inline-flex items-center rounded-full bg-sky-100 px-2 py-1 text-[10px] font-medium text-sky-700",children:[Math.round(100*e.anomalyScore),"% watch"]}),null!==e.lastReadingMinutes?(0,J.jsxs)("span",{className:"text-[10px] text-slate-400",children:[e.lastReadingMinutes,"m ago"]}):null]})]},e.id))}):null}function j$({scenario:e}){let[t,r]=(0,Q.useState)(LL[0].id),i=LL.find(e=>e.id===t)??LL[0],n=Lj.slice(0,3),s=i.kpis.slice(0,2),a=i.artifacts.slice(0,3),o=i.trend?`vlr-trend-${i.trend.id}`:null;return(0,J.jsxs)("section",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:"VLR automation"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Follow each automated pass."})]}),(0,J.jsxs)("span",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Scenario  ",e.name]})]}),(0,J.jsx)("div",{className:"mt-5 space-y-2",children:LL.map(e=>{let i=jI[e.id]??e.title,n=e.id===t;return(0,J.jsxs)("button",{type:"button",onClick:()=>r(e.id),className:jT("w-full rounded-2xl border border-slate-200 bg-white p-4 text-left transition hover:border-slate-300",n&&"border-sky-200 bg-sky-50 shadow-[0_18px_42px_-30px_rgba(14,165,233,0.55)]"),children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,J.jsxs)("div",{className:"space-y-1",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:i}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:e.summary})]}),(0,J.jsx)(jV,{status:e.status})]}),(0,J.jsxs)("div",{className:"mt-3 flex items-center gap-3",children:[(0,J.jsx)("div",{className:"h-1.5 w-full flex-1 overflow-hidden rounded-full bg-slate-200",children:(0,J.jsx)("div",{className:jT("h-full rounded-full transition-all","complete"===e.status&&"bg-emerald-400","active"===e.status&&"bg-sky-400","pending"===e.status&&"bg-slate-400"),style:{width:`${Math.max(e.completion,"pending"===e.status?12:6)}%`}})}),(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:[e.etaMinutes,"m"]})]})]},e.id)})})]}),(0,J.jsxs)("div",{className:"space-y-5",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Stage snapshot"}),(0,J.jsxs)("div",{className:"mt-4 flex flex-col gap-5",children:[(0,J.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)(jW,{completion:i.completion}),(0,J.jsxs)("div",{className:"space-y-1 text-sm text-slate-600",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:jI[i.id]??i.title}),(0,J.jsx)("p",{children:i.summary}),(0,J.jsxs)("p",{className:"text-xs text-slate-400",children:["ETA ",i.etaMinutes," min"]})]})]})}),i.trend?(0,J.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-slate-50/60 p-4",children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:i.trend.title}),(0,J.jsx)("p",{className:"text-xs text-slate-500",children:i.trend.metricLabel})]}),i.trend.baselineLabel&&void 0!==i.trend.baselineValue?(0,J.jsxs)("span",{className:"text-xs font-medium text-slate-400",children:[i.trend.baselineLabel," ",`${i.trend.baselineValue}${i.trend.unit??""}`]}):null]}),(0,J.jsx)("div",{className:"mt-3 h-36 w-full sm:h-40",children:(0,J.jsx)(nR,{width:"100%",height:"100%",children:(0,J.jsxs)(g2,{data:i.trend.points,children:[o?(0,J.jsx)("defs",{children:(0,J.jsxs)("linearGradient",{id:o,x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,J.jsx)("stop",{offset:"5%",stopColor:"#0ea5e9",stopOpacity:.35}),(0,J.jsx)("stop",{offset:"95%",stopColor:"#0ea5e9",stopOpacity:.05})]})}):null,(0,J.jsx)(mI,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),(0,J.jsx)(y4,{dataKey:"label",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(vn,{hide:!0,domain:[0,"auto"]}),(0,J.jsx)(yK,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>{let t=i.trend?.unit??"",r=Number.isInteger(e)?String(e):e.toFixed(1);return[`${r}${t}`,i.trend?.title??"Value"]},labelFormatter:e=>e}),(0,J.jsx)(pd,{type:"monotone",dataKey:"value",stroke:"#0ea5e9",strokeWidth:2,fill:o?`url(#${o})`:"#bae6fd",fillOpacity:o?1:.4})]})})}),(0,J.jsx)("p",{className:"mt-3 text-xs text-slate-500",children:i.trend.summary})]}):null,s.length?(0,J.jsx)("ul",{className:"grid gap-3 sm:grid-cols-2",children:s.map(e=>{let t="up"===e.direction?"text-emerald-600":"text-rose-600";return(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 p-3",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.label}),(0,J.jsx)("p",{className:jT("mt-2 text-xs font-medium",t),children:e.deltaLabel}),(0,J.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:e.narrative})]},e.id)})}):null,i.compliance.length?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Checks"}),(0,J.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:i.compliance.map(e=>(0,J.jsx)("span",{className:jT("inline-flex items-center rounded-full px-3 py-1 text-xs font-medium","pass"===e.status?"bg-emerald-100 text-emerald-700":"attention"===e.status?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"),title:e.description,children:e.label},e.id))})]}):null,a.length?(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Artifacts"}),(0,J.jsx)("ul",{className:"mt-2 space-y-2",children:a.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:e.label}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.detail})]},e.id))})]}):null]})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Workflow log"}),i.insights.length?(0,J.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-slate-600",children:i.insights.map(e=>(0,J.jsx)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:e},e))}):null,(0,J.jsx)("p",{className:"mt-4 text-xs font-semibold uppercase tracking-wide text-slate-400",children:"Recent events"}),(0,J.jsx)("ul",{className:"mt-2 space-y-2 text-xs text-slate-500",children:i.auditTrail.map(e=>(0,J.jsxs)("li",{className:"flex items-start gap-3",children:[(0,J.jsx)("span",{className:"font-medium text-slate-400",children:e.timestamp}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"font-medium text-slate-600",children:e.actor}),(0,J.jsx)("p",{children:e.message})]})]},`${e.timestamp}-${e.actor}`))})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-700",children:"Alerts to clear"}),(0,J.jsx)("ul",{className:"mt-3 space-y-3",children:n.map(e=>{var t;let r="warning"===(t=e.severity)||"critical"===t||"info"===t?t:"info";return(0,J.jsxs)("li",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[(0,J.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,J.jsx)("p",{className:"text-sm font-medium text-slate-900",children:e.message}),(0,J.jsx)("span",{className:jT("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",jL[r]),children:jj[r]})]}),(0,J.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:e.suggestedAction})]},e.id)})})]})]})]})}function jV({status:e}){return(0,J.jsx)("span",{className:jT("inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium","complete"===e?"bg-emerald-100 text-emerald-700":"active"===e?"bg-sky-100 text-sky-700":"bg-slate-100 text-slate-600"),children:"complete"===e?"Done":"active"===e?"In progress":"pending"===e?"Queued":""})}function jW({completion:e}){let t=Math.min(100,Math.max(0,Math.round(e))),r=3.6*t,i=`conic-gradient(#0ea5e9 ${r}deg, rgba(14,165,233,0.12) ${r}deg)`;return(0,J.jsxs)("div",{className:"relative h-20 w-20",children:[(0,J.jsx)("div",{className:"absolute inset-0 rounded-full",style:{backgroundImage:i}}),(0,J.jsxs)("div",{className:"absolute inset-2 flex items-center justify-center rounded-full border border-slate-200 bg-white text-sm font-semibold text-slate-700 shadow-sm",children:[t,"%"]})]})}function jG(){let[e,t]=(0,Q.useState)(LC[0]?.id??""),r=LE.map(e=>({...e,periodLabel:jq(e.timestamp),percentage:Number((100*e.value).toFixed(1))})),i=LA.map(e=>{let t,r,i;return{...e,quarterLabel:(r=Math.floor((t=new Date(e.timestamp)).getUTCMonth()/3)+1,i=String(t.getUTCFullYear()).slice(-2),`Q${r} '${i}`)}}),n=LC.find(t=>t.id===e)??LC[0],s=n?.unit??"",a=n?n.optimized-n.baseline:0,o=LC.reduce((e,t)=>Math.max(e,t.optimized),0),l=o>0?o:1,c=r.length?Math.max(...r.map(e=>e.percentage)):0,u=r.length?Math.min(...r.map(e=>e.percentage)):0,h=r.length>1?r[r.length-1].percentage-r[0].percentage:0,d=h>0?"text-emerald-600":h<0?"text-rose-600":"text-slate-500",f=LO.slice(0,4).map(e=>({...e,percentage:Math.round(100*e.score)})),p=LM.slice(0,3),g=LI.slice(0,3),m=r.length?r[r.length-1].periodLabel:null,y=i.length?i[0].value:null,v=i.length?i[i.length-1].value:null,b=null!==y&&null!==v?v-y:null,x="number"==typeof b&&0!==b?b>0?"text-emerald-600":"text-rose-600":"text-slate-500";return(0,J.jsxs)("section",{className:"space-y-6",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6 lg:p-7",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h2",{className:"text-lg font-semibold text-slate-900 sm:text-xl",children:"SDG & VLR progress board"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Monthly and quarterly indicators show how planners are closing priority SDG gaps and VLR actions."})]}),m?(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:["Latest monthly update  ",m]}):null]}),(0,J.jsx)("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:LT.map(e=>{let t="up"===e.tone?"text-emerald-600":"text-rose-600";return(0,J.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3",children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.metric}),(0,J.jsx)("p",{className:"mt-2 text-lg font-semibold text-slate-900",children:e.value}),(0,J.jsx)("p",{className:jT("mt-1 text-xs font-medium",t),children:e.change})]},e.id)})})]}),(0,J.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.6fr)_minmax(0,1fr)]",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Gender equity projection"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Next 12 Months"})]}),(0,J.jsxs)("span",{className:"text-xs text-slate-400",children:["Model  ","Gender equity index"]})]}),(0,J.jsx)("div",{className:"mt-4 h-64 w-full",children:(0,J.jsx)(nR,{width:"100%",height:"100%",children:(0,J.jsxs)(yt,{data:r,children:[(0,J.jsx)(mI,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,J.jsx)(y4,{dataKey:"periodLabel",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(vn,{stroke:"#94a3b8",tickLine:!1,axisLine:!1,unit:"%"}),(0,J.jsx)(yK,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>[`${e.toFixed(1)}%`,"Gender equity index"],labelFormatter:e=>`Month ${e}`}),(0,J.jsx)(m9,{type:"monotone",dataKey:"percentage",stroke:"#0ea5e9",strokeWidth:3,dot:!1,activeDot:{r:5}})]})})}),(0,J.jsxs)("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Highest monthly score"}),(0,J.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:[c.toFixed(1),"%"]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Starting point"}),(0,J.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:[u.toFixed(1),"%"]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Change since start"}),(0,J.jsxs)("p",{className:jT("text-sm font-semibold",d),children:[h>0?"+":"",h.toFixed(1)," pts"]})]})]})]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Program impact scenarios"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Compare baseline vs coordinated programs to see how SDG and VLR goals advance."})]}),LC.length?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:LC.map(r=>{let i=r.id===e;return(0,J.jsx)("button",{type:"button",onClick:()=>t(r.id),className:jT("rounded-2xl border px-3 py-1.5 text-sm font-medium transition-colors",i?"border-sky-200 bg-sky-50 text-sky-700":"border-transparent bg-slate-100 text-slate-500 hover:border-slate-200 hover:bg-white"),children:r.scenario},r.id)})}),n?(0,J.jsxs)("div",{className:"mt-5 space-y-3 text-sm text-slate-600",children:[(0,J.jsxs)("div",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Baseline"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:[n.baseline.toLocaleString("en")," ",s]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-sky-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Automation"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:[n.optimized.toLocaleString("en")," ",s]})]}),(0,J.jsxs)("div",{className:"rounded-2xl bg-emerald-50 px-3 py-2 text-emerald-700",children:[(0,J.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide",children:"Lift"}),(0,J.jsxs)("p",{className:"mt-1 text-base font-semibold",children:[a>0?"+":"",a.toFixed(0)," ",s]})]}),(0,J.jsxs)("div",{className:"relative mt-4 h-2 w-full rounded-full bg-slate-200",children:[(0,J.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-full bg-slate-400/40",style:{width:`${Math.min(n.baseline/l*100,100)}%`}}),(0,J.jsx)("div",{className:"absolute inset-y-0 left-0 rounded-full bg-sky-500",style:{width:`${Math.min(n.optimized/l*100,100)}%`}})]}),(0,J.jsx)("p",{className:"text-xs text-slate-400",children:"Scaling against the strongest lift in this board."}),(0,J.jsx)("p",{className:"text-sm leading-6 text-slate-600",children:n.narrative})]}):null]}):(0,J.jsx)("p",{className:"mt-4 text-sm text-slate-500",children:"Scenario comparisons will appear here once they are set."})]})]}),(0,J.jsxs)("div",{className:"grid gap-6",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsxs)("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Wellbeing outlook"}),(0,J.jsx)("p",{className:"text-sm text-slate-500",children:"Next 6 Quarters"})]}),(0,J.jsx)("span",{className:"text-xs text-slate-400",children:"Model  wellbeing index"})]}),(0,J.jsx)("div",{className:"mt-4 h-64 w-full",children:(0,J.jsx)(nR,{width:"100%",height:"100%",children:(0,J.jsxs)(g2,{data:i,children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("linearGradient",{id:"resilienceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,J.jsx)("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.35}),(0,J.jsx)("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:.05})]})}),(0,J.jsx)(mI,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,J.jsx)(y4,{dataKey:"quarterLabel",stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(vn,{stroke:"#94a3b8",tickLine:!1,axisLine:!1}),(0,J.jsx)(yK,{contentStyle:{borderRadius:12,borderColor:"#e2e8f0",backgroundColor:"white",boxShadow:"0 20px 40px -32px rgba(15,23,42,0.24)"},formatter:e=>[`${e.toFixed(0)} index`,"Wellbeing"]}),(0,J.jsx)(pd,{type:"monotone",dataKey:"value",stroke:"#6366f1",strokeWidth:2,fill:"url(#resilienceGradient)",fillOpacity:1})]})})}),(0,J.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4 text-sm text-slate-600",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Now"}),(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"number"==typeof v?`${v.toFixed(0)} index`:""})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Six-quarter change"}),(0,J.jsx)("p",{className:jT("text-sm font-semibold",x),children:"number"==typeof b?`${b>0?"+":""}${b.toFixed(0)} pts`:""})]}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-xs text-slate-500",children:"Confidence"}),(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Model uses census & labor data"})]})]})]}),(0,J.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Watch list"}),(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"AI flags the districts that need attention before the monthly coordination meeting."}),(0,J.jsx)("ul",{className:"mt-4 space-y-3",children:f.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-4 py-3",children:[(0,J.jsxs)("p",{className:"flex items-center justify-between text-sm font-semibold text-slate-900",children:[(0,J.jsx)("span",{children:e.district}),(0,J.jsxs)("span",{children:[e.percentage,"%"]})]}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.driver}),(0,J.jsx)("div",{className:"mt-2 h-1.5 w-full rounded-full bg-slate-200",children:(0,J.jsx)("div",{className:"h-1.5 rounded-full bg-sky-500",style:{width:`${Math.min(e.percentage,100)}%`}})})]},e.id))}),p.length?(0,J.jsxs)("div",{className:"mt-5 border-t border-slate-200 pt-4",children:[(0,J.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"Automation queue"}),(0,J.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-slate-600",children:p.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-3 py-2",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.cluster}),(0,J.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:[e.affectedAssets," VLR packets  resolves in ",e.expectedResolutionDays," days"]})]},e.id))})]}):null]}),(0,J.jsxs)("article",{className:"rounded-3xl border border-slate-200 bg-white p-5 sm:p-6",children:[(0,J.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Explainable by design"}),(0,J.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Every insight carries the evidence trail city auditors expect."}),(0,J.jsx)("ul",{className:"mt-4 space-y-3",children:g.map(e=>(0,J.jsxs)("li",{className:"rounded-2xl bg-slate-50 px-4 py-3",children:[(0,J.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.title}),(0,J.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.detail})]},e.id))})]})]})]})]})}function jq(e){return new Intl.DateTimeFormat("en",{month:"short",year:"2-digit"}).format(new Date(e))}e.s(["default",()=>jN],52683)}]);